{"ast":null,"code":"/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\n'use strict';\n\nimport _Constructor from './constructor';\nimport _Context from './context';\nimport _history from './history';\nimport _util from './util';\nimport _notice from '../plugins/modules/_notice';\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\n\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\n  const _d = context.element.originElement.ownerDocument || document;\n\n  const _w = _d.defaultView || window;\n\n  const util = _util;\n  const icons = options.icons;\n  /**\r\n   * @description editor core object\r\n   * should always bind this object when registering an event in the plug-in.\r\n   */\n\n  const core = {\n    _d: _d,\n    _w: _w,\n    _parser: new _w.DOMParser(),\n\n    /**\r\n     * @description Document object of the iframe if created as an iframe || _d\r\n     * @private\r\n     */\n    _wd: null,\n\n    /**\r\n     * @description Window object of the iframe if created as an iframe || _w\r\n     * @private\r\n     */\n    _ww: null,\n\n    /**\r\n     * @description Closest ShadowRoot to editor if found\r\n     * @private\r\n     */\n    _shadowRoot: null,\n\n    /**\r\n     * @description Block controller mousedown events in \"shadowRoot\" environment\r\n     * @private\r\n     */\n    _shadowRootControllerEventTarget: null,\n\n    /**\r\n     * @description Util object\r\n     */\n    util: util,\n\n    /**\r\n     * @description Functions object\r\n     */\n    functions: null,\n\n    /**\r\n     * @description Editor options\r\n     */\n    options: null,\n\n    /**\r\n     * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n     */\n    wwComputedStyle: _w.getComputedStyle(context.element.wysiwyg),\n\n    /**\r\n     * @description Notice object\r\n     */\n    notice: _notice,\n\n    /**\r\n     * @description Default icons object\r\n     */\n    icons: icons,\n\n    /**\r\n     * @description History object for undo, redo\r\n     */\n    history: null,\n\n    /**\r\n     * @description Elements and user options parameters of the suneditor\r\n     */\n    context: context,\n\n    /**\r\n     * @description Plugin buttons\r\n     */\n    pluginCallButtons: pluginCallButtons,\n\n    /**\r\n     * @description Loaded plugins\r\n     */\n    plugins: plugins || {},\n\n    /**\r\n     * @description Whether the plugin is initialized\r\n     */\n    initPlugins: {},\n\n    /**\r\n     * @description Object for managing submenu elements\r\n     * @private\r\n     */\n    _targetPlugins: {},\n\n    /**\r\n     * @description Save rendered submenus and containers\r\n     * @private\r\n     */\n    _menuTray: {},\n\n    /**\r\n     * @description loaded language\r\n     */\n    lang: lang,\n\n    /**\r\n     * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n     */\n    effectNode: null,\n\n    /**\r\n     * @description submenu element\r\n     */\n    submenu: null,\n\n    /**\r\n     * @description container element\r\n     */\n    container: null,\n\n    /**\r\n     * @description current subment name\r\n     * @private\r\n     */\n    _submenuName: '',\n\n    /**\r\n     * @description binded submenuOff method\r\n     * @private\r\n     */\n    _bindedSubmenuOff: null,\n\n    /**\r\n     * @description binded containerOff method\r\n     * @private\r\n     */\n    _bindedContainerOff: null,\n\n    /**\r\n     * @description active button element in submenu\r\n     */\n    submenuActiveButton: null,\n\n    /**\r\n     * @description active button element in container\r\n     */\n    containerActiveButton: null,\n\n    /**\r\n     * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n     */\n    controllerArray: [],\n\n    /**\r\n     * @description The name of the plugin that called the currently active controller\r\n     */\n    currentControllerName: '',\n\n    /**\r\n     * @description The target element of current controller\r\n     */\n    currentControllerTarget: null,\n\n    /**\r\n     * @description The file component object of current selected file tag (getFileComponent)\r\n     */\n    currentFileComponentInfo: null,\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n     */\n    codeViewDisabledButtons: [],\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n     */\n    resizingDisabledButtons: [],\n\n    /**\r\n     * @description active more layer element in submenu\r\n     * @private\r\n     */\n    _moreLayerActiveButton: null,\n\n    /**\r\n     * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * ^(options._editorTagsWhitelist)$\r\n     * @private\r\n     */\n    _htmlCheckWhitelistRegExp: null,\n\n    /**\r\n     * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n     * @private\r\n     */\n    _disallowedTextTagsRegExp: null,\n\n    /**\r\n     * @description Editor tags whitelist (RegExp object)\r\n     * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n     */\n    editorTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag whitelist when pasting (RegExp object)\r\n     * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n     */\n    pasteTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Boolean value of whether the editor has focus\r\n     */\n    hasFocus: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is disabled\r\n     */\n    isDisabled: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is readOnly\r\n     */\n    isReadOnly: false,\n\n    /**\r\n     * @description Attributes whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesWhitelistRegExp: null,\n\n    /**\r\n     * @description Attributes of tags whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsWhitelist: null,\n\n    /**\r\n     * @description binded controllersOff method\r\n     * @private\r\n     */\n    _bindControllersOff: null,\n\n    /**\r\n     * @description Is inline mode?\r\n     * @private\r\n     */\n    _isInline: null,\n\n    /**\r\n     * @description Is balloon|balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloon: null,\n\n    /**\r\n     * @description Is balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloonAlways: null,\n\n    /**\r\n     * @description Required value when using inline mode to sticky toolbar\r\n     * @private\r\n     */\n    _inlineToolbarAttr: {\n      top: '',\n      width: '',\n      isShow: false\n    },\n\n    /**\r\n     * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n     * @private\r\n     */\n    _notHideToolbar: false,\n\n    /**\r\n     * @description Variable value that sticky toolbar mode\r\n     * @private\r\n     */\n    _sticky: false,\n\n    /**\r\n     * @description Variables for controlling focus and blur events\r\n     * @private\r\n     */\n    _antiBlur: false,\n\n    /**\r\n     * @description Component line breaker element\r\n     * @private\r\n     */\n    _lineBreaker: null,\n    _lineBreakerButton: null,\n\n    /**\r\n     * @description If true, (initialize, reset) all indexes of image, video information\r\n     * @private\r\n     */\n    _componentsInfoInit: true,\n    _componentsInfoReset: false,\n\n    /**\r\n     * @description Plugins array with \"active\" method.\r\n     * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n     */\n    activePlugins: null,\n\n    /**\r\n     * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n     * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n     * Basic Editor Actions:\r\n     * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n     * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n     * \"managedTagsInfo\" structure ex:\r\n     * managedTagsInfo: {\r\n     *   query: '.__se__xxx, se-xxx'\r\n     *   map: {\r\n     *     '__se__xxx': method.bind(core),\r\n     *     'se-xxx': method.bind(core),\r\n     *   }\r\n     * }\r\n     * @example\r\n     * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n     * managedTagInfo() => {\r\n     *  return {\r\n     *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n     *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n     *    // \"method\" is executed by binding \"core\".\r\n     *    method: function (element) {\r\n     *      // this === core\r\n     *      element.innerHTML = // (rendered html);\r\n     *    }\r\n     *  }\r\n     * }\r\n     */\n    managedTagsInfo: null,\n\n    /**\r\n     * @description cashing: options.charCounterType === 'byte-html'\r\n     * @private\r\n     */\n    _charTypeHTML: false,\n\n    /**\r\n     * @description Array of \"checkFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n     * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n     * @private\r\n     */\n    _fileInfoPluginsCheck: null,\n\n    /**\r\n     * @description Array of \"resetFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n     * @private\r\n     */\n    _fileInfoPluginsReset: null,\n\n    /**\r\n     * @description Variables for file component management\r\n     * @private\r\n     */\n    _fileManager: {\n      tags: null,\n      regExp: null,\n      queryString: null,\n      pluginRegExp: null,\n      pluginMap: null\n    },\n\n    /**\r\n     * @description Elements that need to change text or className for each selection change\r\n     * After creating the editor, \"activePlugins\" are added.\r\n     * @property {Element} STRONG bold button\r\n     * @property {Element} U underline button\r\n     * @property {Element} EM italic button\r\n     * @property {Element} DEL strike button\r\n     * @property {Element} SUB subscript button\r\n     * @property {Element} SUP superscript button\r\n     * @property {Element} OUTDENT outdent button\r\n     * @property {Element} INDENT indent button\r\n     */\n    commandMap: null,\n\n    /**\r\n     * @description Style button related to edit area\r\n     * @property {Element} fullScreen fullScreen button element\r\n     * @property {Element} showBlocks showBlocks button element\r\n     * @property {Element} codeView codeView button element\r\n     * @private\r\n     */\n    _styleCommandMap: null,\n\n    /**\r\n     * @description Map of default command\r\n     * @private\r\n     */\n    _defaultCommand: {\n      bold: options.textTags.bold,\n      underline: options.textTags.underline,\n      italic: options.textTags.italic,\n      strike: options.textTags.strike,\n      subscript: options.textTags.sub,\n      superscript: options.textTags.sup\n    },\n\n    /**\r\n     * @description Variables used internally in editor operation\r\n     * @property {Boolean} isCodeView State of code view\r\n     * @property {Boolean} isFullScreen State of full screen\r\n     * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n     * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n     * @property {Number} tabSize Indent size of tab (4)\r\n     * @property {Number} codeIndent Indent size of Code view mode (2)\r\n     * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n     * @property {Array} currentNodes  An array of the current cursor's node structure\r\n     * @private\r\n     */\n    _variable: {\n      isChanged: false,\n      isCodeView: false,\n      isFullScreen: false,\n      innerHeight_fullScreen: 0,\n      resizeClientY: 0,\n      tabSize: 4,\n      codeIndent: 2,\n      minResizingSize: util.getNumber(context.element.wysiwygFrame.style.minHeight || '65', 0),\n      currentNodes: [],\n      currentNodesMap: [],\n      _range: null,\n      _selectionNode: null,\n      _originCssText: context.element.topArea.style.cssText,\n      _bodyOverflow: '',\n      _editorAreaOriginCssText: '',\n      _wysiwygOriginCssText: '',\n      _codeOriginCssText: '',\n      _fullScreenAttrs: {\n        sticky: false,\n        balloon: false,\n        inline: false\n      },\n      _lineBreakComp: null,\n      _lineBreakDir: ''\n    },\n\n    /**\r\n     * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n     * If the plugin is added call callBack function.\r\n     * @param {String} pluginName The name of the plugin to call\r\n     * @param {function} callBackFunction Function to be executed immediately after module call\r\n     * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n     */\n    callPlugin: function (pluginName, callBackFunction, _target) {\n      _target = _target || pluginCallButtons[pluginName];\n\n      if (!this.plugins[pluginName]) {\n        throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\n      } else if (!this.initPlugins[pluginName]) {\n        this.plugins[pluginName].add(this, _target);\n        this.initPlugins[pluginName] = true;\n      } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\n        this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\n      }\n\n      if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\n        this.commandMap[pluginName] = _target;\n        this.activePlugins.push(pluginName);\n      }\n\n      if (typeof callBackFunction === 'function') callBackFunction();\n    },\n\n    /**\r\n     * @description If the module is not added, add the module and call the 'add' function\r\n     * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n     */\n    addModule: function (moduleArray) {\n      for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\n        moduleName = moduleArray[i].name;\n\n        if (!this.plugins[moduleName]) {\n          this.plugins[moduleName] = moduleArray[i];\n        }\n\n        if (!this.initPlugins[moduleName]) {\n          this.initPlugins[moduleName] = true;\n          if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\n        }\n      }\n    },\n\n    /**\r\n     * @description Gets the current editor-relative scroll offset.\r\n     * @returns {Object} {top, left}\r\n     */\n    getGlobalScrollOffset: function () {\n      let t = 0,\n          l = 0;\n      let el = context.element.topArea;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      el = this._shadowRoot ? this._shadowRoot.host : null;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      return {\n        top: t,\n        left: l\n      };\n    },\n\n    /**\r\n     * @description Method for managing submenu element.\r\n     * You must add the \"submenu\" element using the this method at custom plugin.\r\n     * @param {String} pluginName Plugin name\r\n     * @param {Element|null} target Target button\r\n     * @param {Element} menu Submenu element\r\n     */\n    initMenuTarget: function (pluginName, target, menu) {\n      if (!target) {\n        this._targetPlugins[pluginName] = menu;\n      } else {\n        context.element._menuTray.appendChild(menu);\n\n        this._targetPlugins[pluginName] = true;\n        this._menuTray[target.getAttribute('data-command')] = menu;\n      }\n    },\n\n    /**\r\n     * @description Enabled submenu\r\n     * @param {Element} element Submenu's button element to call\r\n     */\n    submenuOn: function (element) {\n      if (this._bindedSubmenuOff) this._bindedSubmenuOff();\n      if (this._bindControllersOff) this.controllersOff();\n      const submenuName = this._submenuName = element.getAttribute('data-command');\n      const menu = this.submenu = this._menuTray[submenuName];\n      this.submenuActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedSubmenuOff = this.submenuOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\n      if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable submenu\r\n     */\n    submenuOff: function () {\n      this.removeDocEvent('mousedown', this._bindedSubmenuOff);\n      this._bindedSubmenuOff = null;\n\n      if (this.submenu) {\n        this._submenuName = '';\n        this.submenu.style.display = 'none';\n        this.submenu = null;\n        util.removeClass(this.submenuActiveButton, 'on');\n        this.submenuActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Enabled container\r\n     * @param {Element} element Container's button element to call\r\n     */\n    containerOn: function (element) {\n      if (this._bindedContainerOff) this._bindedContainerOff();\n      const containerName = this._containerName = element.getAttribute('data-command');\n      const menu = this.container = this._menuTray[containerName];\n      this.containerActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedContainerOff = this.containerOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedContainerOff, false);\n      if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable container\r\n     */\n    containerOff: function () {\n      this.removeDocEvent('mousedown', this._bindedContainerOff);\n      this._bindedContainerOff = null;\n\n      if (this.container) {\n        this._containerName = '';\n        this.container.style.display = 'none';\n        this.container = null;\n        util.removeClass(this.containerActiveButton, 'on');\n        this.containerActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Set the menu position. (submenu, container)\r\n     * @param {*} element Button element\r\n     * @param {*} menu Menu element\r\n     * @private\r\n     */\n    _setMenuPosition: function (element, menu) {\n      menu.style.visibility = 'hidden';\n      menu.style.display = 'block';\n      menu.style.height = '';\n      util.addClass(element, 'on');\n      const toolbar = this.context.element.toolbar;\n      const toolbarW = toolbar.offsetWidth;\n\n      const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\n\n      const menuW = menu.offsetWidth;\n      const l = element.parentElement.offsetLeft + 3; // rtl\n\n      if (options.rtl) {\n        const elementW = element.offsetWidth;\n        const rtlW = menuW > elementW ? menuW - elementW : 0;\n        const rtlL = rtlW > 0 ? 0 : elementW - menuW;\n        menu.style.left = l - rtlW + rtlL + 'px';\n\n        if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\n          menu.style.left = '0px';\n        }\n      } else {\n        const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\n        if (overLeft < 0) menu.style.left = l + overLeft + 'px';else menu.style.left = l + 'px';\n      } // get element top\n\n\n      let t = 0;\n      let offsetEl = element;\n\n      while (offsetEl && offsetEl !== toolbar) {\n        t += offsetEl.offsetTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      const bt = t;\n\n      if (this._isBalloon) {\n        t += toolbar.offsetTop + element.offsetHeight;\n      } else {\n        t -= element.offsetHeight;\n      } // set menu position\n\n\n      const toolbarTop = toolbarOffset.top;\n      const menuHeight = menu.offsetHeight;\n      const scrollTop = this.getGlobalScrollOffset().top;\n      const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\n\n      if (menuHeight_bottom < menuHeight) {\n        let menuTop = -1 * (menuHeight - bt + 3);\n        const insTop = toolbarTop - scrollTop + menuTop;\n        const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\n\n        if (menuHeight_top > menuHeight_bottom) {\n          menu.style.height = menuHeight_top + 'px';\n          menuTop = -1 * (menuHeight_top - bt + 3);\n        } else {\n          menu.style.height = menuHeight_bottom + 'px';\n          menuTop = bt + element.parentElement.offsetHeight;\n        }\n\n        menu.style.top = menuTop + 'px';\n      } else {\n        menu.style.top = bt + element.parentElement.offsetHeight + 'px';\n      }\n\n      menu.style.visibility = '';\n    },\n\n    /**\r\n     * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n     * @param {*} arguments controller elements, functions..\r\n     */\n    controllersOn: function () {\n      if (this._bindControllersOff) this._bindControllersOff();\n      this.controllerArray = [];\n\n      for (let i = 0, arg; i < arguments.length; i++) {\n        arg = arguments[i];\n        if (!arg) continue;\n\n        if (typeof arg === 'string') {\n          this.currentControllerName = arg;\n          continue;\n        }\n\n        if (typeof arg === 'function') {\n          this.controllerArray.push(arg);\n          continue;\n        }\n\n        if (!util.hasClass(arg, 'se-controller')) {\n          this.currentControllerTarget = arg;\n          this.currentFileComponentInfo = this.getFileComponent(arg);\n          continue;\n        }\n\n        if (arg.style) {\n          arg.style.display = 'block';\n\n          if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\n            arg.addEventListener('mousedown', function (e) {\n              e.preventDefault();\n              e.stopPropagation();\n            });\n\n            this._shadowRootControllerEventTarget.push(arg);\n          }\n        }\n\n        this.controllerArray.push(arg);\n      }\n\n      this._bindControllersOff = this.controllersOff.bind(this);\n      this.addDocEvent('mousedown', this._bindControllersOff, false);\n      this.addDocEvent('keydown', this._bindControllersOff, false);\n      this._antiBlur = true;\n      if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\n    },\n\n    /**\r\n     * @description Hide controller at editor area (link button, image resize button..)\r\n     * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n     */\n    controllersOff: function (e) {\n      this._lineBreaker.style.display = 'none';\n      const len = this.controllerArray.length;\n\n      if (e && e.target && len > 0) {\n        for (let i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\n        }\n      }\n\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\n      context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\n      this._variable._lineBreakComp = null;\n      this.currentControllerName = '';\n      this.currentControllerTarget = null;\n      this.currentFileComponentInfo = null;\n      this.effectNode = null;\n      if (!this._bindControllersOff) return;\n      this.removeDocEvent('mousedown', this._bindControllersOff);\n      this.removeDocEvent('keydown', this._bindControllersOff);\n      this._bindControllersOff = null;\n\n      if (len > 0) {\n        for (let i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();else this.controllerArray[i].style.display = 'none';\n        }\n\n        this.controllerArray = [];\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Specify the position of the controller.\r\n     * @param {Element} controller Controller element.\r\n     * @param {Element} referEl Element that is the basis of the controller's position.\r\n     * @param {String} position Type of position (\"top\" | \"bottom\")\r\n     * When using the \"top\" position, there should not be an arrow on the controller.\r\n     * When using the \"bottom\" position there should be an arrow on the controller.\r\n     * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n     * This argument is required. - {left: 0, top: 0}\r\n     * Please enter the value based on ltr mode.\r\n     * Calculated automatically in rtl mode.\r\n     */\n    setControllerPosition: function (controller, referEl, position, addOffset) {\n      if (options.rtl) addOffset.left *= -1;\n      const offset = util.getOffset(referEl, context.element.wysiwygFrame);\n      controller.style.visibility = 'hidden';\n      controller.style.display = 'block'; // Height value of the arrow element is 11px\n\n      const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : referEl.offsetHeight + 12;\n      controller.style.top = offset.top + topMargin + addOffset.top + 'px';\n      const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\n      const controllerW = controller.offsetWidth;\n      const referElW = referEl.offsetWidth;\n      const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null; // rtl (Width value of the arrow element is 22px)\n\n      if (options.rtl) {\n        const rtlW = controllerW > referElW ? controllerW - referElW : 0;\n        const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\n        controller.style.left = l - rtlW + rtlL + 'px';\n\n        if (rtlW > 0) {\n          if (allow) allow.style.left = (controllerW - 14 < 10 + rtlW ? controllerW - 14 : 10 + rtlW) + 'px';\n        }\n\n        const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\n\n        if (overSize > 0) {\n          controller.style.left = '0px';\n          if (allow) allow.style.left = overSize + 'px';\n        }\n      } else {\n        controller.style.left = l + 'px';\n        const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\n\n        if (overSize < 0) {\n          controller.style.left = controller.offsetLeft + overSize + 'px';\n          if (allow) allow.style.left = 20 - overSize + 'px';\n        } else {\n          if (allow) allow.style.left = '20px';\n        }\n      }\n\n      controller.style.visibility = '';\n    },\n\n    /**\r\n     * @description javascript execCommand\r\n     * @param {String} command javascript execCommand function property\r\n     * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n     * @param {String|undefined} value javascript execCommand function property\r\n     */\n    execCommand: function (command, showDefaultUI, value) {\n      this._wd.execCommand(command, showDefaultUI, command === 'formatBlock' ? '<' + value + '>' : value); // history stack\n\n\n      this.history.push(true);\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area using \"native focus function\"\r\n     */\n    nativeFocus: function () {\n      const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\n\n      if (caption) {\n        caption.focus();\n      } else {\n        context.element.wysiwyg.focus();\n      }\n\n      this._editorRange();\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area\r\n     */\n    focus: function () {\n      if (context.element.wysiwygFrame.style.display === 'none') return;\n\n      if (options.iframe) {\n        this.nativeFocus();\n      } else {\n        try {\n          const range = this.getRange();\n\n          if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\n            const currentNode = range.commonAncestorContainer.children[range.startOffset];\n\n            if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\n              const format = util.createElement(options.defaultTag);\n              const br = util.createElement('BR');\n              format.appendChild(br);\n              context.element.wysiwyg.insertBefore(format, currentNode);\n              this.setRange(br, 0, br, 0);\n              return;\n            }\n          }\n\n          this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\n        } catch (e) {\n          this.nativeFocus();\n        }\n      }\n\n      event._applyTagEffects();\n\n      if (this._isBalloon) event._toggleToolbarBalloon();\n    },\n\n    /**\r\n     * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n     * If \"focusEdge\" is null, then selected last element\r\n     * @param {Element|null} focusEl Focus element\r\n     */\n    focusEdge: function (focusEl) {\n      if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\n      const fileComponentInfo = this.getFileComponent(focusEl);\n\n      if (fileComponentInfo) {\n        this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n      } else if (focusEl) {\n        focusEl = util.getChildElement(focusEl, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, true);\n        if (!focusEl) this.nativeFocus();else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\n      } else {\n        this.focus();\n      }\n    },\n\n    /**\r\n     * @description Focusout to wysiwyg area (.blur())\r\n     */\n    blur: function () {\n      if (options.iframe) {\n        context.element.wysiwygFrame.blur();\n      } else {\n        context.element.wysiwyg.blur();\n      }\n    },\n\n    /**\r\n     * @description Set current editor's range object and return.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @returns {Object} Range object.\r\n     */\n    setRange: function (startCon, startOff, endCon, endOff) {\n      if (!startCon || !endCon) return;\n      if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\n      if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon;\n        endOff = startOff > 1 ? startOff : 0;\n      }\n\n      const range = this._wd.createRange();\n\n      try {\n        range.setStart(startCon, startOff);\n        range.setEnd(endCon, endOff);\n      } catch (error) {\n        console.warn('[SUNEDITOR.core.focus.error] ' + error);\n        this.nativeFocus();\n        return;\n      }\n\n      const selection = this.getSelection();\n\n      if (selection.removeAllRanges) {\n        selection.removeAllRanges();\n      }\n\n      selection.addRange(range);\n\n      this._editorRange();\n\n      if (options.iframe) this.nativeFocus();\n      return range;\n    },\n\n    /**\r\n     * @description Remove range object and button effect\r\n     */\n    removeRange: function () {\n      this._variable._range = null;\n      this._variable._selectionNode = null;\n      if (this.hasFocus) this.getSelection().removeAllRanges();\n\n      this._setKeyEffect([]);\n    },\n\n    /**\r\n     * @description Get current editor's range object\r\n     * @returns {Object}\r\n     */\n    getRange: function () {\n      const range = this._variable._range || this._createDefaultRange();\n\n      const selection = this.getSelection();\n      if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\n\n      if (selection.rangeCount > 0) {\n        this._variable._range = selection.getRangeAt(0);\n        return this._variable._range;\n      } else {\n        const sc = selection.anchorNode,\n              ec = selection.focusNode,\n              so = selection.anchorOffset,\n              eo = selection.focusOffset;\n        const compareValue = util.compareElements(sc, ec);\n        const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\n        return this.setRange(rightDir ? sc : ec, rightDir ? so : eo, rightDir ? ec : sc, rightDir ? eo : so);\n      }\n    },\n\n    /**\r\n     * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n     * Returns a new \"range\" or argument \"range\".\r\n     * @param {Object} range core.getRange()\r\n     * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n     * @returns {Object} range\r\n     */\n    getRange_addLine: function (range, container) {\n      if (this._selectionVoid(range)) {\n        const wysiwyg = context.element.wysiwyg;\n        const op = util.createElement(options.defaultTag);\n        op.innerHTML = '<br>';\n        wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\n        this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\n        range = this._variable._range;\n      }\n\n      return range;\n    },\n\n    /**\r\n     * @description Get window selection obejct\r\n     * @returns {Object}\r\n     */\n    getSelection: function () {\n      return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\n    },\n\n    /**\r\n     * @description Get current select node\r\n     * @returns {Node}\r\n     */\n    getSelectionNode: function () {\n      if (!context.element.wysiwyg.contains(this._variable._selectionNode)) this._editorRange();\n\n      if (!this._variable._selectionNode) {\n        const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, false);\n\n        if (!selectionNode) {\n          this._editorRange();\n        } else {\n          this._variable._selectionNode = selectionNode;\n          return selectionNode;\n        }\n      }\n\n      return this._variable._selectionNode;\n    },\n\n    /**\r\n     * @description Saving the range object and the currently selected node of editor\r\n     * @private\r\n     */\n    _editorRange: function () {\n      const selection = this.getSelection();\n      if (!selection) return null;\n      let range = null;\n      let selectionNode = null;\n\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n      } else {\n        range = this._createDefaultRange();\n      }\n\n      this._variable._range = range;\n\n      if (range.collapsed) {\n        if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;else selectionNode = range.commonAncestorContainer;\n      } else {\n        selectionNode = selection.extentNode || selection.anchorNode;\n      }\n\n      this._variable._selectionNode = selectionNode;\n    },\n\n    /**\r\n     * @description Return the range object of editor's first child node\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _createDefaultRange: function () {\n      const wysiwyg = context.element.wysiwyg;\n      wysiwyg.focus();\n\n      const range = this._wd.createRange();\n\n      let focusEl = wysiwyg.firstElementChild;\n\n      if (!focusEl) {\n        focusEl = util.createElement(options.defaultTag);\n        focusEl.innerHTML = '<br>';\n        wysiwyg.appendChild(focusEl);\n      }\n\n      range.setStart(focusEl, 0);\n      range.setEnd(focusEl, 0);\n      return range;\n    },\n\n    /**\r\n     * @description Returns true if there is no valid \"selection\".\r\n     * @param {Object} range core.getRange()\r\n     * @returns {Object} range\r\n     * @private\r\n     */\n    _selectionVoid: function (range) {\n      const comm = range.commonAncestorContainer;\n      return util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\n    },\n\n    /**\r\n     * @description Reset range object to text node selected status.\r\n     * @returns {Boolean} Returns false if there is no valid selection.\r\n     * @private\r\n     */\n    _resetRangeToTextNode: function () {\n      const range = this.getRange();\n      if (this._selectionVoid(range)) return false;\n      let startCon = range.startContainer;\n      let startOff = range.startOffset;\n      let endCon = range.endContainer;\n      let endOff = range.endOffset;\n      let tempCon, tempOffset, tempChild;\n\n      if (util.isFormatElement(startCon)) {\n        if (!startCon.childNodes[startOff]) {\n          startCon = startCon.lastChild;\n          startOff = startCon.textContent.length;\n        } else {\n          startCon = startCon.childNodes[startOff];\n          startOff = 0;\n        }\n\n        while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\n          startCon = startCon.firstChild;\n          startOff = 0;\n        }\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n\n        while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\n          endCon = endCon.lastChild;\n        }\n\n        endOff = endCon.textContent.length;\n      } // startContainer\n\n\n      tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\n      tempOffset = startOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        const onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\n            tempOffset = 0;\n          }\n\n          let format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          const emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n\n          if (onlyBreak) {\n            if (startCon === endCon) {\n              endCon = tempCon;\n              endOff = 1;\n            }\n          }\n        }\n      } // set startContainer\n\n\n      startCon = tempCon;\n      startOff = tempOffset; // endContainer\n\n      tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\n      tempOffset = endOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        const onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempChild = tempCon.childNodes;\n            if (tempChild.length === 0) break;\n            tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : tempCon.previousElementSibling || tempCon.previousSibling || startCon;\n            tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\n          }\n\n          let format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          const emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n          tempOffset = 1;\n\n          if (onlyBreak && !tempCon.previousSibling) {\n            util.removeItem(endCon);\n          }\n        }\n      } // set endContainer\n\n\n      endCon = tempCon;\n      endOff = tempOffset; // set Range\n\n      this.setRange(startCon, startOff, endCon, endOff);\n      return true;\n    },\n\n    /**\r\n     * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n     * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n     * @returns {Array}\r\n     */\n    getSelectedElements: function (validation) {\n      if (!this._resetRangeToTextNode()) return [];\n      let range = this.getRange();\n\n      if (util.isWysiwygDiv(range.startContainer)) {\n        const children = context.element.wysiwyg.children;\n        if (children.length === 0) return [];\n        this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\n        range = this.getRange();\n      }\n\n      const startCon = range.startContainer;\n      const endCon = range.endContainer;\n      const commonCon = range.commonAncestorContainer; // get line nodes\n\n      const lineNodes = util.getListChildren(commonCon, function (current) {\n        return validation ? validation(current) : util.isFormatElement(current);\n      });\n      if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\n      if (startCon === endCon || lineNodes.length === 1) return lineNodes;\n      let startLine = util.getFormatElement(startCon, null);\n      let endLine = util.getFormatElement(endCon, null);\n      let startIdx = null;\n      let endIdx = null;\n\n      const onlyTable = function (current) {\n        return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\n      };\n\n      let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\n      let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\n      if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\n      if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\n      const sameRange = startRangeEl === endRangeEl;\n\n      for (let i = 0, len = lineNodes.length, line; i < len; i++) {\n        line = lineNodes[i];\n\n        if (startLine === line || !sameRange && line === startRangeEl) {\n          startIdx = i;\n          continue;\n        }\n\n        if (endLine === line || !sameRange && line === endRangeEl) {\n          endIdx = i;\n          break;\n        }\n      }\n\n      if (startIdx === null) startIdx = 0;\n      if (endIdx === null) endIdx = lineNodes.length - 1;\n      return lineNodes.slice(startIdx, endIdx + 1);\n    },\n\n    /**\r\n     * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n     * If some of the component are included in the selection, get the entire that component.\r\n     * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n     * @returns {Array}\r\n     */\n    getSelectedElementsAndComponents: function (removeDuplicate) {\n      const commonCon = this.getRange().commonAncestorContainer;\n      const myComponent = util.getParentElement(commonCon, util.isComponent);\n      const selectedLines = util.isTable(commonCon) ? this.getSelectedElements(null) : this.getSelectedElements(function (current) {\n        const component = this.getParentElement(current, this.isComponent);\n        return this.isFormatElement(current) && (!component || component === myComponent) || this.isComponent(current) && !this.getFormatElement(current);\n      }.bind(util));\n\n      if (removeDuplicate) {\n        for (let i = 0, len = selectedLines.length; i < len; i++) {\n          for (let j = i - 1; j >= 0; j--) {\n            if (selectedLines[j].contains(selectedLines[i])) {\n              selectedLines.splice(i, 1);\n              i--;\n              len--;\n              break;\n            }\n          }\n        }\n      }\n\n      return selectedLines;\n    },\n\n    /**\r\n     * @description Determine if this offset is the edge offset of container\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n     * @returns {Boolean}\r\n     */\n    isEdgePoint: function (container, offset, dir) {\n      return dir !== 'end' && offset === 0 || (!dir || dir !== 'front') && !container.nodeValue && offset === 1 || (!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length;\n    },\n\n    /**\r\n     * @description Check if the container and offset values are the edges of the format tag\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n     * @returns {Array|null}\r\n     * @private\r\n     */\n    _isEdgeFormat: function (node, offset, dir) {\n      if (!this.isEdgePoint(node, offset, dir)) return false;\n      const result = [];\n      dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\n\n      while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\n        if (!node[dir] || util.isBreak(node[dir]) && !node[dir][dir]) {\n          if (node.nodeType === 1) result.push(node.cloneNode(false));\n          node = node.parentNode;\n        } else {\n          return null;\n        }\n      }\n\n      return result;\n    },\n\n    /**\r\n     * @description Show loading box\r\n     */\n    showLoading: function () {\n      context.element.loading.style.display = 'block';\n    },\n\n    /**\r\n     * @description Close loading box\r\n     */\n    closeLoading: function () {\n      context.element.loading.style.display = 'none';\n    },\n\n    /**\r\n     * @description Append format element to sibling node of argument element.\r\n     * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n     * If not, the currently selected format tag is inserted.\r\n     * @param {Element} element Insert as siblings of that element\r\n     * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n     * @returns {Element}\r\n     */\n    appendFormatTag: function (element, formatNode) {\n      if (!element.parentNode) return null;\n      const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\n      let oFormat = null;\n\n      if (util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\n        oFormat = util.createElement('BR');\n      } else {\n        const oFormatName = formatNode ? typeof formatNode === 'string' ? formatNode : formatNode.nodeName : util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl) ? currentFormatEl.nodeName : options.defaultTag;\n        oFormat = util.createElement(oFormatName);\n        oFormat.innerHTML = '<br>';\n\n        if (formatNode && typeof formatNode !== 'string' || !formatNode && util.isFormatElement(currentFormatEl)) {\n          util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\n        }\n      }\n\n      if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\n      return oFormat;\n    },\n\n    /**\r\n     * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n     * If \"element\" is \"HR\", insert and return the new line.\r\n     * @param {Element} element Element to be inserted\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n     * @returns {Element}\r\n     */\n    insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(element, null)) {\n        return null;\n      }\n\n      const r = this.removeNode();\n      this.getRange_addLine(this.getRange(), r.container);\n      let oNode = null;\n      let selectionNode = this.getSelectionNode();\n      let formatEl = util.getFormatElement(selectionNode, null);\n\n      if (util.isListCell(formatEl)) {\n        this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\n        if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\n      } else {\n        if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\n          const depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current);\n          }.bind(util));\n          oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (oNode) formatEl = oNode.previousSibling;\n        }\n\n        this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\n        if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\n      }\n\n      this.setRange(element, 0, element, 0);\n\n      if (!notSelect) {\n        const fileComponentInfo = this.getFileComponent(element);\n\n        if (fileComponentInfo) {\n          this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        } else if (oNode) {\n          oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\n          this.setRange(oNode, 0, oNode, 0);\n        }\n      } // history stack\n\n\n      if (!notHistoryPush) this.history.push(1);\n      return oNode || element;\n    },\n\n    /**\r\n     * @description Gets the file component and that plugin name\r\n     * return: {target, component, pluginName} | null\r\n     * @param {Element} element Target element (figure tag, component div, file tag)\r\n     * @returns {Object|null}\r\n     */\n    getFileComponent: function (element) {\n      if (!this._fileManager.queryString || !element) return null;\n      let target, pluginName;\n\n      if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\n        target = element.querySelector(this._fileManager.queryString);\n      }\n\n      if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\n        target = element;\n      }\n\n      if (target) {\n        pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\n\n        if (pluginName) {\n          return {\n            target: target,\n            component: util.getParentElement(target, util.isComponent),\n            pluginName: pluginName\n          };\n        }\n      }\n\n      return null;\n    },\n\n    /**\r\n     * @description The component(image, video) is selected and the resizing module is called.\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @param {String} pluginName Plugin name (image, video)\r\n     */\n    selectComponent: function (element, pluginName) {\n      if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\n      if (!this.hasFocus) this.focus();\n      const plugin = this.plugins[pluginName];\n      if (!plugin) return;\n\n      _w.setTimeout(function () {\n        if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\n\n        this._setComponentLineBreaker(element);\n      }.bind(this));\n    },\n\n    /**\r\n     * @description Set line breaker of component\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @private\r\n     */\n    _setComponentLineBreaker: function (element) {\n      // line breaker\n      this._lineBreaker.style.display = 'none';\n      const container = util.getParentElement(element, util.isComponent);\n      const t_style = context.element.lineBreaker_t.style;\n      const b_style = context.element.lineBreaker_b.style;\n      const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\n      const isList = util.isListCell(container.parentNode);\n      let componentTop, wScroll, w; // top\n\n      if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\n        this._variable._lineBreakComp = container;\n        wScroll = context.element.wysiwyg.scrollTop;\n        componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n        w = target.offsetWidth / 2 / 2;\n        t_style.top = componentTop - wScroll - 12 + 'px';\n        t_style.left = util.getOffset(target).left + w + 'px';\n        t_style.display = 'block';\n      } else {\n        t_style.display = 'none';\n      } // bottom\n\n\n      if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\n        if (!componentTop) {\n          this._variable._lineBreakComp = container;\n          wScroll = context.element.wysiwyg.scrollTop;\n          componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n          w = target.offsetWidth / 2 / 2;\n        }\n\n        b_style.top = componentTop + target.offsetHeight - wScroll - 12 + 'px';\n        b_style.left = util.getOffset(target).left + target.offsetWidth - w - 24 + 'px';\n        b_style.display = 'block';\n      } else {\n        b_style.display = 'none';\n      }\n    },\n\n    /**\r\n     * @description Delete selected node and insert argument value node and return.\r\n     * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n     * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n     * @param {Node} oNode Element to be inserted\r\n     * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @returns {Object|Node|null}\r\n     */\n    insertNode: function (oNode, afterNode, checkCharCount) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(oNode, null)) {\n        return null;\n      }\n\n      const freeFormat = util.getFreeFormatElement(this.getSelectionNode(), null);\n      const isFormats = !freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) || util.isComponent(oNode);\n\n      if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\n        const r = this.removeNode();\n\n        if (r.container.nodeType === 3 || util.isBreak(r.container)) {\n          const depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current) || this.isListCell(current);\n          }.bind(util));\n          afterNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (afterNode) afterNode = afterNode.previousSibling;\n        }\n      }\n\n      const range = !afterNode && !isFormats ? this.getRange_addLine(this.getRange(), null) : this.getRange();\n      const commonCon = range.commonAncestorContainer;\n      const startOff = range.startOffset;\n      const endOff = range.endOffset;\n      const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\n      const startCon = formatRange ? commonCon.childNodes[startOff] || commonCon.childNodes[0] : range.startContainer;\n      const endCon = formatRange ? commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] : range.endContainer;\n      let parentNode,\n          originAfter = null;\n\n      if (!afterNode) {\n        parentNode = startCon;\n\n        if (startCon.nodeType === 3) {\n          parentNode = startCon.parentNode;\n        }\n        /** No Select range node */\n\n\n        if (range.collapsed) {\n          if (commonCon.nodeType === 3) {\n            if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);else afterNode = commonCon.nextSibling;\n          } else {\n            if (!util.isBreak(parentNode)) {\n              let c = parentNode.childNodes[startOff];\n              const focusNode = c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling) ? c.nextSibling : c;\n\n              if (focusNode) {\n                if (!focusNode.nextSibling) {\n                  parentNode.removeChild(focusNode);\n                  afterNode = null;\n                } else {\n                  afterNode = util.isBreak(focusNode) && !util.isBreak(oNode) ? focusNode : focusNode.nextSibling;\n                }\n              } else {\n                afterNode = null;\n              }\n            } else {\n              afterNode = parentNode;\n              parentNode = parentNode.parentNode;\n            }\n          }\n        } else {\n          /** Select range nodes */\n          const isSameContainer = startCon === endCon;\n\n          if (isSameContainer) {\n            if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;else afterNode = endCon.splitText(endOff);\n            let removeNode = startCon;\n            if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\n            parentNode.removeChild(removeNode);\n\n            if (parentNode.childNodes.length === 0 && isFormats) {\n              parentNode.innerHTML = '<br>';\n            }\n          } else {\n            const removedTag = this.removeNode();\n            const container = removedTag.container;\n            const prevContainer = removedTag.prevContainer;\n\n            if (container && container.childNodes.length === 0 && isFormats) {\n              if (util.isFormatElement(container)) {\n                container.innerHTML = '<br>';\n              } else if (util.isRangeFormatElement(container)) {\n                container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n              }\n            }\n\n            if (!isFormats && prevContainer) {\n              parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\n\n              if (parentNode.contains(container)) {\n                let sameParent = true;\n                afterNode = container;\n\n                while (afterNode.parentNode !== parentNode) {\n                  afterNode = afterNode.parentNode;\n                  sameParent = false;\n                }\n\n                if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\n              } else {\n                afterNode = null;\n              }\n            } else {\n              afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\n              parentNode = !afterNode || !afterNode.parentNode ? commonCon : afterNode.parentNode;\n            }\n\n            while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\n              afterNode = afterNode.parentNode;\n            }\n          }\n        }\n      } // has afterNode\n      else {\n          parentNode = afterNode.parentNode;\n          afterNode = afterNode.nextSibling;\n          originAfter = true;\n        } // --- insert node ---\n\n\n      try {\n        if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\n          parentNode = context.element.wysiwyg;\n          afterNode = null;\n        }\n\n        if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || !util.isListCell(parentNode) && util.isComponent(oNode)) {\n          const oldParent = parentNode;\n\n          if (util.isList(afterNode)) {\n            parentNode = afterNode;\n            afterNode = null;\n          } else if (util.isListCell(afterNode)) {\n            parentNode = afterNode.previousElementSibling || afterNode;\n          } else if (!originAfter && !afterNode) {\n            const r = this.removeNode();\n            const container = r.container.nodeType === 3 ? util.isListCell(util.getFormatElement(r.container, null)) ? r.container : util.getFormatElement(r.container, null) || r.container.parentNode : r.container;\n            const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\n            parentNode = rangeCon ? container : container.parentNode;\n            afterNode = rangeCon ? null : container.nextSibling;\n          }\n\n          if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\n        }\n\n        if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\n          afterNode = parentNode.nextElementSibling;\n          parentNode = parentNode.parentNode;\n        }\n\n        if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\n          const fNode = util.createElement(options.defaultTag);\n          fNode.appendChild(oNode);\n          oNode = fNode;\n        }\n\n        parentNode.insertBefore(oNode, parentNode === afterNode ? parentNode.lastChild : afterNode);\n      } catch (e) {\n        parentNode.appendChild(oNode);\n      } finally {\n        if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\n          const cItem = util.getFormatElement(commonCon, null);\n\n          if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\n            util.removeItem(cItem);\n          }\n        }\n\n        if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\n          oNode = this._setIntoFreeFormat(oNode);\n        }\n\n        if (!util.isComponent(oNode)) {\n          let offset = 1;\n\n          if (oNode.nodeType === 3) {\n            const previous = oNode.previousSibling;\n            const next = oNode.nextSibling;\n            const previousText = !previous || previous.nodeType === 1 || util.onlyZeroWidthSpace(previous) ? '' : previous.textContent;\n            const nextText = !next || next.nodeType === 1 || util.onlyZeroWidthSpace(next) ? '' : next.textContent;\n\n            if (previous && previousText.length > 0) {\n              oNode.textContent = previousText + oNode.textContent;\n              util.removeItem(previous);\n            }\n\n            if (next && next.length > 0) {\n              oNode.textContent += nextText;\n              util.removeItem(next);\n            }\n\n            const newRange = {\n              container: oNode,\n              startOffset: previousText.length,\n              endOffset: oNode.textContent.length - nextText.length\n            };\n            this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\n            return newRange;\n          } else if (!util.isBreak(oNode) && util.isFormatElement(parentNode)) {\n            let zeroWidth = null;\n\n            if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode);\n            }\n\n            if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\n            }\n\n            if (util._isIgnoreNodeChange(oNode)) {\n              oNode = oNode.nextSibling;\n              offset = 0;\n            }\n          }\n\n          this.setRange(oNode, offset, oNode, offset);\n        } // history stack\n\n\n        this.history.push(true);\n        return oNode;\n      }\n    },\n    _setIntoFreeFormat: function (oNode) {\n      const parentNode = oNode.parentNode;\n      let oNodeChildren, lastONode;\n\n      while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\n        oNodeChildren = oNode.childNodes;\n        lastONode = null;\n\n        while (oNodeChildren[0]) {\n          lastONode = oNodeChildren[0];\n\n          if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\n            this._setIntoFreeFormat(lastONode);\n\n            if (!oNode.parentNode) break;\n            oNodeChildren = oNode.childNodes;\n            continue;\n          }\n\n          parentNode.insertBefore(lastONode, oNode);\n        }\n\n        if (oNode.childNodes.length === 0) util.removeItem(oNode);\n        oNode = util.createElement('BR');\n        parentNode.insertBefore(oNode, lastONode.nextSibling);\n      }\n\n      return oNode;\n    },\n\n    /**\r\n     * @description Delete the currently selected nodes and reset selection range\r\n     * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n     * @returns {Object}\r\n     */\n    removeNode: function () {\n      this._resetRangeToTextNode();\n\n      const range = this.getRange();\n      let container,\n          offset = 0;\n      let startCon = range.startContainer;\n      let endCon = range.endContainer;\n      let startOff = range.startOffset;\n      let endOff = range.endOffset;\n      const commonCon = range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode ? startCon.parentNode : range.commonAncestorContainer;\n\n      if (commonCon === startCon && commonCon === endCon) {\n        startCon = commonCon.children[startOff];\n        endCon = commonCon.children[endOff];\n        startOff = endOff = 0;\n      }\n\n      let beforeNode = null;\n      let afterNode = null;\n      const childNodes = util.getListChildNodes(commonCon, null);\n      let startIndex = util.getArrayIndex(childNodes, startCon);\n      let endIndex = util.getArrayIndex(childNodes, endCon);\n\n      if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\n        for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\n          if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\n            startIndex = i;\n            startNode = startNode.parentNode;\n          }\n        }\n\n        for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\n          if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\n            childNodes.splice(i, 1);\n            endNode = endNode.parentNode;\n            --endIndex;\n          }\n        }\n      } else {\n        if (childNodes.length === 0) {\n          if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\n            return {\n              container: commonCon,\n              offset: 0\n            };\n          } else if (commonCon.nodeType === 3) {\n            return {\n              container: commonCon,\n              offset: endOff\n            };\n          }\n\n          childNodes.push(commonCon);\n          startCon = endCon = commonCon;\n        } else {\n          startCon = endCon = childNodes[0];\n\n          if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\n            return {\n              container: util.isMedia(commonCon) ? commonCon : startCon,\n              offset: 0\n            };\n          }\n        }\n\n        startIndex = endIndex = 0;\n      }\n\n      function remove(item) {\n        const format = util.getFormatElement(item, null);\n        util.removeItem(item);\n\n        if (util.isListCell(format)) {\n          const list = util.getArrayItem(format.children, util.isList, false);\n\n          if (list) {\n            const child = list.firstElementChild;\n            const children = child.childNodes;\n\n            while (children[0]) {\n              format.insertBefore(children[0], list);\n            }\n\n            util.removeItemAllParents(child, null, null);\n          }\n        }\n      }\n\n      for (let i = startIndex; i <= endIndex; i++) {\n        const item = childNodes[i];\n\n        if (item.length === 0 || item.nodeType === 3 && item.data === undefined) {\n          remove(item);\n          continue;\n        }\n\n        if (item === startCon) {\n          if (startCon.nodeType === 1) {\n            if (util.isComponent(startCon)) continue;else beforeNode = util.createTextNode(startCon.textContent);\n          } else {\n            if (item === endCon) {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, endCon.length - endOff));\n              offset = startOff;\n            } else {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff));\n            }\n          }\n\n          if (beforeNode.length > 0) {\n            startCon.data = beforeNode.data;\n          } else {\n            remove(startCon);\n          }\n\n          if (item === endCon) break;\n          continue;\n        }\n\n        if (item === endCon) {\n          if (endCon.nodeType === 1) {\n            if (util.isComponent(endCon)) continue;else afterNode = util.createTextNode(endCon.textContent);\n          } else {\n            afterNode = util.createTextNode(endCon.substringData(endOff, endCon.length - endOff));\n          }\n\n          if (afterNode.length > 0) {\n            endCon.data = afterNode.data;\n          } else {\n            remove(endCon);\n          }\n\n          continue;\n        }\n\n        remove(item);\n      }\n\n      container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : range.endContainer || range.startContainer;\n\n      if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\n        const rc = util.removeItemAllParents(container, function (current) {\n          if (this.isComponent(current)) return false;\n          const text = current.textContent;\n          return text.length === 0 || /^(\\n|\\u200B)+$/.test(text);\n        }.bind(util), null);\n        if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\n      } // set range\n\n\n      this.setRange(container, offset, container, offset); // history stack\n\n      this.history.push(true);\n      return {\n        container: container,\n        offset: offset,\n        prevContainer: startCon && startCon.parentNode ? startCon : null\n      };\n    },\n\n    /**\r\n     * @description Appended all selected format Element to the argument element and insert\r\n     * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n     */\n    applyRangeFormatElement: function (rangeElement) {\n      this.getRange_addLine(this.getRange(), null);\n      const rangeLines = this.getSelectedElementsAndComponents(false);\n      if (!rangeLines || rangeLines.length === 0) return;\n\n      linesLoop: for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\n        line = rangeLines[i];\n        if (!util.isListCell(line)) continue;\n        nested = line.lastElementChild;\n\n        if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\n          lEl = nested.lastElementChild;\n\n          if (rangeLines.indexOf(lEl) > -1) {\n            let list = null;\n\n            while (list = lEl.lastElementChild) {\n              if (util.isList(list)) {\n                if (rangeLines.indexOf(list.lastElementChild) > -1) {\n                  lEl = list.lastElementChild;\n                } else {\n                  continue linesLoop;\n                }\n              }\n            }\n\n            fEl = nested.firstElementChild;\n            f = rangeLines.indexOf(fEl);\n            l = rangeLines.indexOf(lEl);\n            rangeLines.splice(f, l - f + 1);\n            len = rangeLines.length;\n            continue;\n          }\n        }\n      }\n\n      let last = rangeLines[rangeLines.length - 1];\n      let standTag, beforeTag, pElement;\n\n      if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\n        standTag = last;\n      } else {\n        standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\n      }\n\n      if (util.isCell(standTag)) {\n        beforeTag = null;\n        pElement = standTag;\n      } else {\n        beforeTag = standTag.nextSibling;\n        pElement = standTag.parentNode;\n      }\n\n      let parentDepth = util.getElementDepth(standTag);\n      let listParent = null;\n      const lineArr = [];\n\n      const removeItems = function (parent, origin, before) {\n        let cc = null;\n\n        if (parent !== origin && !util.isTable(origin)) {\n          if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\n          cc = util.removeItemAllParents(origin, null, parent);\n        }\n\n        return cc ? cc.ec : before;\n      };\n\n      for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\n        line = rangeLines[i];\n        originParent = line.parentNode;\n        if (!originParent || rangeElement.contains(originParent)) continue;\n        depth = util.getElementDepth(line);\n\n        if (util.isList(originParent)) {\n          if (listParent === null) {\n            if (nextList) {\n              listParent = nextList;\n              nested = true;\n              nextList = null;\n            } else {\n              listParent = originParent.cloneNode(false);\n            }\n          }\n\n          lineArr.push(line);\n          nextLine = rangeLines[i + 1];\n\n          if (i === len - 1 || nextLine && nextLine.parentNode !== originParent) {\n            // nested list\n            if (nextLine && line.contains(nextLine.parentNode)) {\n              nextList = nextLine.parentNode.cloneNode(false);\n            }\n\n            let list = originParent.parentNode,\n                p;\n\n            while (util.isList(list)) {\n              p = util.createElement(list.nodeName);\n              p.appendChild(listParent);\n              listParent = p;\n              list = list.parentNode;\n            }\n\n            const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\n\n            if (parentDepth >= depth) {\n              parentDepth = depth;\n              pElement = edge.cc;\n              beforeTag = removeItems(pElement, originParent, edge.ec);\n              if (beforeTag) pElement = beforeTag.parentNode;\n            } else if (pElement === edge.cc) {\n              beforeTag = edge.ec;\n            }\n\n            if (pElement !== edge.cc) {\n              before = removeItems(pElement, edge.cc, before);\n              if (before !== undefined) beforeTag = before;else beforeTag = edge.cc;\n            }\n\n            for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\n              listParent.appendChild(edge.removeArray[c]);\n            }\n\n            if (!nested) rangeElement.appendChild(listParent);\n            if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\n            listParent = null;\n            nested = false;\n          }\n        } else {\n          if (parentDepth >= depth) {\n            parentDepth = depth;\n            pElement = originParent;\n            beforeTag = line.nextSibling;\n          }\n\n          rangeElement.appendChild(line);\n\n          if (pElement !== originParent) {\n            before = removeItems(pElement, originParent);\n            if (before !== undefined) beforeTag = before;\n          }\n        }\n      }\n\n      this.effectNode = null;\n      util.mergeSameTags(rangeElement, null, false);\n      util.mergeNestedTags(rangeElement, function (current) {\n        return this.isList(current);\n      }.bind(util)); // Nested list\n\n      if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\n        const depthFormat = util.getParentElement(beforeTag, function (current) {\n          return this.isRangeFormatElement(current) && !this.isList(current);\n        }.bind(util));\n        const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n        splitRange.parentNode.insertBefore(rangeElement, splitRange);\n      } else {\n        // basic\n        pElement.insertBefore(rangeElement, beforeTag);\n        removeItems(rangeElement, beforeTag);\n      }\n\n      const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\n\n      if (rangeLines.length > 1) {\n        this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\n      } else {\n        this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n     * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n     * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n     * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n     * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n     * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @returns {Object}\r\n     */\n    detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\n      const range = this.getRange();\n      const so = range.startOffset;\n      const eo = range.endOffset;\n      let children = util.getListChildNodes(rangeElement, function (current) {\n        return current.parentNode === rangeElement;\n      });\n      let parent = rangeElement.parentNode;\n      let firstNode = null;\n      let lastNode = null;\n      let rangeEl = rangeElement.cloneNode(false);\n      const removeArray = [];\n      const newList = util.isList(newRangeElement);\n      let insertedNew = false;\n      let reset = false;\n      let moveComplete = false;\n\n      function appendNode(parent, insNode, sibling, originNode) {\n        if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\n\n        if (insNode.nodeType === 3) {\n          parent.insertBefore(insNode, sibling);\n          return insNode;\n        }\n\n        const insChildren = (moveComplete ? insNode : originNode).childNodes;\n        let format = insNode.cloneNode(false);\n        let first = null;\n        let c = null;\n\n        while (insChildren[0]) {\n          c = insChildren[0];\n\n          if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\n            if (format.childNodes.length > 0) {\n              if (!first) first = format;\n              parent.insertBefore(format, sibling);\n              format = insNode.cloneNode(false);\n            }\n\n            parent.insertBefore(c, sibling);\n            if (!first) first = c;\n          } else {\n            format.appendChild(c);\n          }\n        }\n\n        if (format.childNodes.length > 0) {\n          if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\n            if (newList) {\n              first = sibling;\n\n              while (sibling) {\n                format.appendChild(sibling);\n                sibling = sibling.nextSibling;\n              }\n\n              parent.parentNode.insertBefore(format, parent.nextElementSibling);\n            } else {\n              const originNext = originNode.nextElementSibling;\n              const detachRange = util.detachNestedList(originNode, false);\n\n              if (rangeElement !== detachRange || originNext !== originNode.nextElementSibling) {\n                const fChildren = format.childNodes;\n\n                while (fChildren[0]) {\n                  originNode.appendChild(fChildren[0]);\n                }\n\n                rangeElement = detachRange;\n                reset = true;\n              }\n            }\n          } else {\n            parent.insertBefore(format, sibling);\n          }\n\n          if (!first) first = format;\n        }\n\n        return first;\n      } // detach loop\n\n\n      for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\n        insNode = children[i];\n        if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\n        moveComplete = false;\n\n        if (remove && i === 0) {\n          if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\n            firstNode = rangeElement.previousSibling;\n          } else {\n            firstNode = rangeEl;\n          }\n        }\n\n        if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\n\n        if (selectedFormats && lineIndex === -1) {\n          if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\n          rangeEl.appendChild(insNode);\n        } else {\n          if (selectedFormats) next = selectedFormats[lineIndex + 1];\n\n          if (rangeEl && rangeEl.children.length > 0) {\n            parent.insertBefore(rangeEl, rangeElement);\n            rangeEl = null;\n          }\n\n          if (!newList && util.isListCell(insNode)) {\n            if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\n              const insNext = insNode.nextElementSibling;\n              const detachRange = util.detachNestedList(insNode, false);\n\n              if (rangeElement !== detachRange || insNext !== insNode.nextElementSibling) {\n                rangeElement = detachRange;\n                reset = true;\n              }\n            } else {\n              const inner = insNode;\n              insNode = util.createElement(remove ? inner.nodeName : util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\n              const isCell = util.isListCell(insNode);\n              const innerChildren = inner.childNodes;\n\n              while (innerChildren[0]) {\n                if (util.isList(innerChildren[0]) && !isCell) break;\n                insNode.appendChild(innerChildren[0]);\n              }\n\n              util.copyFormatAttributes(insNode, inner);\n              moveComplete = true;\n            }\n          } else {\n            insNode = insNode.cloneNode(false);\n          }\n\n          if (!reset) {\n            if (!remove) {\n              if (newRangeElement) {\n                if (!insertedNew) {\n                  parent.insertBefore(newRangeElement, rangeElement);\n                  insertedNew = true;\n                }\n\n                insNode = appendNode(newRangeElement, insNode, null, children[i]);\n              } else {\n                insNode = appendNode(parent, insNode, rangeElement, children[i]);\n              }\n\n              if (!reset) {\n                if (selectedFormats) {\n                  lastNode = insNode;\n\n                  if (!firstNode) {\n                    firstNode = insNode;\n                  }\n                } else if (!firstNode) {\n                  firstNode = lastNode = insNode;\n                }\n              }\n            } else {\n              removeArray.push(insNode);\n              util.removeItem(children[i]);\n            }\n\n            if (reset) {\n              reset = moveComplete = false;\n              children = util.getListChildNodes(rangeElement, function (current) {\n                return current.parentNode === rangeElement;\n              });\n              rangeEl = rangeElement.cloneNode(false);\n              parent = rangeElement.parentNode;\n              i = -1;\n              len = children.length;\n              continue;\n            }\n          }\n        }\n      }\n\n      const rangeParent = rangeElement.parentNode;\n      let rangeRight = rangeElement.nextSibling;\n\n      if (rangeEl && rangeEl.children.length > 0) {\n        rangeParent.insertBefore(rangeEl, rangeRight);\n      }\n\n      if (newRangeElement) firstNode = newRangeElement.previousSibling;else if (!firstNode) firstNode = rangeElement.previousSibling;\n      rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\n\n      if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\n        util.removeItem(rangeElement);\n      } else {\n        util.removeEmptyNode(rangeElement, null);\n      }\n\n      let edge = null;\n\n      if (remove) {\n        edge = {\n          cc: rangeParent,\n          sc: firstNode,\n          ec: rangeRight,\n          removeArray: removeArray\n        };\n      } else {\n        if (!firstNode) firstNode = lastNode;\n        if (!lastNode) lastNode = firstNode;\n        const childEdge = util.getEdgeChildNodes(firstNode, lastNode.parentNode ? firstNode : lastNode);\n        edge = {\n          cc: (childEdge.sc || childEdge.ec).parentNode,\n          sc: childEdge.sc,\n          ec: childEdge.ec\n        };\n      }\n\n      this.effectNode = null;\n      if (notHistoryPush) return edge;\n\n      if (!remove && edge) {\n        if (!selectedFormats) {\n          this.setRange(edge.sc, 0, edge.sc, 0);\n        } else {\n          this.setRange(edge.sc, so, edge.ec, eo);\n        }\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description \"selectedFormats\" array are detached from the list element.\r\n     * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n     * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n     */\n    detachList: function (selectedFormats, remove) {\n      let rangeArr = {};\n      let listFirst = false;\n      let listLast = false;\n      let first = null;\n      let last = null;\n\n      const passComponent = function (current) {\n        return !this.isComponent(current);\n      }.bind(util);\n\n      for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\n        lastIndex = i === len - 1;\n        o = util.getRangeFormatElement(selectedFormats[i], passComponent);\n        isList = util.isList(o);\n\n        if (!r && isList) {\n          r = o;\n          rangeArr = {\n            r: r,\n            f: [util.getParentElement(selectedFormats[i], 'LI')]\n          };\n          if (i === 0) listFirst = true;\n        } else if (r && isList) {\n          if (r !== o) {\n            const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n            o = selectedFormats[i].parentNode;\n\n            if (listFirst) {\n              first = edge.sc;\n              listFirst = false;\n            }\n\n            if (lastIndex) last = edge.ec;\n\n            if (isList) {\n              r = o;\n              rangeArr = {\n                r: r,\n                f: [util.getParentElement(selectedFormats[i], 'LI')]\n              };\n              if (lastIndex) listLast = true;\n            } else {\n              r = null;\n            }\n          } else {\n            rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\n            if (lastIndex) listLast = true;\n          }\n        }\n\n        if (lastIndex && util.isList(r)) {\n          const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n          if (listLast || len === 1) last = edge.ec;\n          if (listFirst) first = edge.sc || last;\n        }\n      }\n\n      return {\n        sc: first,\n        ec: last\n      };\n    },\n\n    /**\r\n     * @description Add, update, and delete nodes from selected text.\r\n     * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n     * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n     * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n     * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n     *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n     * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n     *    (The class name is preceded by \".\" [\".className\"])\r\n     * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n     * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n     * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n     * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     *10. It won't work if the parent node has the same class and same value style.\r\n     *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n     * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n     * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n     * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n     * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     */\n    nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\n      this._resetRangeToTextNode();\n\n      let range = this.getRange_addLine(this.getRange(), null);\n      styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\n      removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\n      const isRemoveNode = !appendNode;\n      const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\n      let startCon = range.startContainer;\n      let startOff = range.startOffset;\n      let endCon = range.endContainer;\n      let endOff = range.endOffset;\n\n      if (isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) && util.isFormatElement(endCon.parentNode) || startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon)) {\n        return;\n      }\n\n      if (range.collapsed && !isRemoveFormat) {\n        if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\n          let afterNode = null;\n          const focusNode = startCon.childNodes[startOff];\n\n          if (focusNode) {\n            if (!focusNode.nextSibling) {\n              afterNode = null;\n            } else {\n              afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\n            }\n          }\n\n          const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          startCon.insertBefore(zeroWidth, afterNode);\n          this.setRange(zeroWidth, 1, zeroWidth, 1);\n          range = this.getRange();\n          startCon = range.startContainer;\n          startOff = range.startOffset;\n          endCon = range.endContainer;\n          endOff = range.endOffset;\n        }\n      }\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.firstChild;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n        endOff = endCon.textContent.length;\n      }\n\n      if (isRemoveNode) {\n        appendNode = util.createElement('DIV');\n      }\n\n      const wRegExp = _w.RegExp;\n      const newNodeName = appendNode.nodeName;\n      /* checked same style property */\n\n      if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\n        let sNode = startCon;\n        let checkCnt = 0;\n        const checkAttrs = [];\n        const checkStyles = appendNode.style;\n\n        for (let i = 0, len = checkStyles.length; i < len; i++) {\n          checkAttrs.push(checkStyles[i]);\n        }\n\n        const ckeckClasses = appendNode.classList;\n\n        for (let i = 0, len = ckeckClasses.length; i < len; i++) {\n          checkAttrs.push('.' + ckeckClasses[i]);\n        }\n\n        if (checkAttrs.length > 0) {\n          while (!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\n            for (let i = 0; i < checkAttrs.length; i++) {\n              if (sNode.nodeType === 1) {\n                const s = checkAttrs[i];\n                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\n                const styleCheck = isRemoveNode ? !!sNode.style[s] : !!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s];\n                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\n\n                if (styleCheck || classCheck) {\n                  checkCnt++;\n                }\n              }\n            }\n\n            sNode = sNode.parentNode;\n          }\n\n          if (checkCnt >= checkAttrs.length) return;\n        }\n      }\n\n      let start = {},\n          end = {};\n      let newNode,\n          styleRegExp = '',\n          classRegExp = '',\n          removeNodeRegExp = '';\n\n      if (styleArray) {\n        for (let i = 0, len = styleArray.length, s; i < len; i++) {\n          s = styleArray[i];\n\n          if (/^\\./.test(s)) {\n            classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\n          } else {\n            styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\n          }\n        }\n\n        if (styleRegExp) {\n          styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\n          styleRegExp = new wRegExp(styleRegExp, 'ig');\n        }\n\n        if (classRegExp) {\n          classRegExp += ')(?=\\\\s+|$)';\n          classRegExp = new wRegExp(classRegExp, 'ig');\n        }\n      }\n\n      if (removeNodeArray) {\n        removeNodeRegExp = '^(?:' + removeNodeArray[0];\n\n        for (let i = 1; i < removeNodeArray.length; i++) {\n          removeNodeRegExp += '|' + removeNodeArray[i];\n        }\n\n        removeNodeRegExp += ')$';\n        removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\n      }\n      /** validation check function*/\n\n\n      const wBoolean = _w.Boolean;\n      const _removeCheck = {\n        v: false\n      };\n\n      const validation = function (checkNode) {\n        const vNode = checkNode.cloneNode(false); // all path\n\n        if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode; // all remove\n\n        if (isRemoveFormat) return null; // remove node check\n\n        const tagRemove = !removeNodeRegExp && isRemoveNode || removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName); // tag remove\n\n        if (tagRemove && !strictRemove) {\n          _removeCheck.v = true;\n          return null;\n        } // style regexp\n\n\n        const originStyle = vNode.style.cssText;\n        let style = '';\n\n        if (styleRegExp && originStyle.length > 0) {\n          style = originStyle.replace(styleRegExp, '').trim();\n          if (style !== originStyle) _removeCheck.v = true;\n        } // class check\n\n\n        const originClasses = vNode.className;\n        let classes = '';\n\n        if (classRegExp && originClasses.length > 0) {\n          classes = originClasses.replace(classRegExp, '').trim();\n          if (classes !== originClasses) _removeCheck.v = true;\n        } // remove only\n\n\n        if (isRemoveNode) {\n          if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\n            _removeCheck.v = true;\n            return null;\n          }\n        } // change\n\n\n        if (style || classes || vNode.nodeName !== newNodeName || wBoolean(styleRegExp) !== wBoolean(originStyle) || wBoolean(classRegExp) !== wBoolean(originClasses)) {\n          if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\n\n          if (!vNode.style.cssText) {\n            vNode.removeAttribute('style');\n          }\n\n          if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\n\n          if (!vNode.className.trim()) {\n            vNode.removeAttribute('class');\n          }\n\n          if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\n            _removeCheck.v = true;\n            return null;\n          }\n\n          return vNode;\n        }\n\n        _removeCheck.v = true;\n        return null;\n      }; // get line nodes\n\n\n      const lineNodes = this.getSelectedElements(null);\n      range = this.getRange();\n      startCon = range.startContainer;\n      startOff = range.startOffset;\n      endCon = range.endContainer;\n      endOff = range.endOffset;\n\n      if (!util.getFormatElement(startCon, null)) {\n        startCon = util.getChildElement(lineNodes[0], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        startOff = 0;\n      }\n\n      if (!util.getFormatElement(endCon, null)) {\n        endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        endOff = endCon.textContent.length;\n      }\n\n      const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\n      const endLength = lineNodes.length - (oneLine ? 0 : 1); // node Changes\n\n      newNode = appendNode.cloneNode(false);\n\n      const isRemoveAnchor = isRemoveFormat || isRemoveNode && function (arr) {\n        for (let n = 0, len = arr.length; n < len; n++) {\n          if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\n        }\n\n        return false;\n      }(removeNodeArray);\n\n      const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\n\n      const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\n\n      const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode); // one line\n\n\n      if (oneLine) {\n        const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n\n        start.container = newRange.startContainer;\n        start.offset = newRange.startOffset;\n        end.container = newRange.endContainer;\n        end.offset = newRange.endOffset;\n\n        if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\n          start.offset = end.offset = 1;\n        }\n\n        this._setCommonListStyle(newRange.ancestor, null);\n      } else {\n        // multi line \n        // end\n        if (endLength > 0) {\n          newNode = appendNode.cloneNode(false);\n          end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n        } // mid\n\n\n        for (let i = endLength - 1, newRange; i > 0; i--) {\n          newNode = appendNode.cloneNode(false);\n          newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\n\n          if (newRange.endContainer) {\n            end.ancestor = null;\n            end.container = newRange.endContainer;\n          }\n\n          this._setCommonListStyle(newRange.ancestor, null);\n        } // start\n\n\n        newNode = appendNode.cloneNode(false);\n        start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\n\n        if (start.endContainer) {\n          end.ancestor = null;\n          end.container = start.endContainer;\n        }\n\n        if (endLength <= 0) {\n          end = start;\n        } else if (!end.container) {\n          end.ancestor = null;\n          end.container = start.container;\n          end.offset = start.container.textContent.length;\n        }\n\n        this._setCommonListStyle(start.ancestor, null);\n\n        this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\n      } // set range\n\n\n      this.controllersOff();\n      this.setRange(start.container, start.offset, end.container, end.offset); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n     * @private\r\n     */\n    _setCommonListStyle: function (el, child) {\n      if (!util.isListCell(el)) return;\n      if (!child) el.removeAttribute('style');\n      const children = util.getArrayItem((child || el).childNodes, function (current) {\n        return !util.isBreak(current);\n      }, true);\n\n      if (children[0] && children.length === 1) {\n        child = children[0];\n        if (!child || child.nodeType !== 1) return;\n        const childStyle = child.style;\n        const elStyle = el.style; // bold, italic\n\n        if (options._textTagsMap[child.nodeName.toLowerCase()] === this._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold'; // bold\n        else if (childStyle.fontWeight) elStyle.fontWeight = childStyle.fontWeight;\n        if (options._textTagsMap[child.nodeName.toLowerCase()] === this._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic'; // italic\n        else if (childStyle.fontStyle) elStyle.fontStyle = childStyle.fontStyle; // styles\n\n        if (childStyle.color) elStyle.color = childStyle.color; // color\n\n        if (childStyle.fontSize) elStyle.fontSize = childStyle.fontSize; // size\n\n        this._setCommonListStyle(el, child);\n      }\n    },\n\n    /**\r\n     * @description Strip remove node\r\n     * @param {Node} removeNode The remove node\r\n     * @private\r\n     */\n    _stripRemoveNode: function (removeNode) {\n      const element = removeNode.parentNode;\n      if (!removeNode || removeNode.nodeType === 3 || !element) return;\n      const children = removeNode.childNodes;\n\n      while (children[0]) {\n        element.insertBefore(children[0], removeNode);\n      }\n\n      element.removeChild(removeNode);\n    },\n\n    /**\r\n     * @description Return the parent maintained tag. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove) return null;\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\n    },\n\n    /**\r\n     * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove || element.nodeType !== 1) return false;\n\n      const anchor = this._isMaintainedNode(element);\n\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : anchor || (!_isSizeNode ? this._isSizeNode(element) : false);\n    },\n\n    /**\r\n     * @description wraps text nodes of line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Boolean} collapsed range.collapsed\r\n     * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n     * @private\r\n     */\n    _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      let parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\n        if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n          const children = parentCon.childNodes;\n          let sameTag = true;\n\n          for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\n            c = children[i];\n            z = !util.onlyZeroWidthSpace(c);\n\n            if (c === startCon) {\n              s = true;\n              continue;\n            }\n\n            if (c === endCon) {\n              e = true;\n              continue;\n            }\n\n            if (!s && z || s && e && z) {\n              sameTag = false;\n              break;\n            }\n          }\n\n          if (sameTag) {\n            util.copyTagAttributes(parentCon, newInnerNode);\n            return {\n              startContainer: startCon,\n              startOffset: startOff,\n              endContainer: endCon,\n              endOffset: endOff\n            };\n          }\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      const isSameNode = startCon === endCon;\n      let startContainer = startCon;\n      let startOffset = startOff;\n      let endContainer = endCon;\n      let endOffset = endOff;\n      let startPass = false;\n      let endPass = false;\n      let pCurrent, newNode, appendNode, cssText, anchorNode;\n      const wRegExp = _w.RegExp;\n\n      function checkCss(vNode) {\n        const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\n        let style = '';\n\n        if (regExp && vNode.style.cssText.length > 0) {\n          style = regExp.test(vNode.style.cssText);\n        }\n\n        return !style;\n      }\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\n          let child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n          let cloneNode; // startContainer\n\n          if (!startPass && child === startContainer) {\n            let line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\n            const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, isSameNode ? endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset : startContainer.data.length - startOffset));\n\n            if (anchorNode) {\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            const prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== line && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            newInnerNode.appendChild(childNode);\n            line.appendChild(newInnerNode);\n\n            if (anchorNode && !_getMaintainedNode(endContainer)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            startContainer = textNode;\n            startOffset = 0;\n            startPass = true;\n            if (newNode !== textNode) newNode.appendChild(startContainer);\n            if (!isSameNode) continue;\n          } // endContainer\n\n\n          if (!endPass && child === endContainer) {\n            anchorNode = _getMaintainedNode(child);\n            const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, endContainer.length - endOffset));\n            const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              newNode = child;\n              cssText = '';\n              pCurrent = [];\n              const anchors = [];\n\n              while (newNode !== pNode && newNode !== el && newNode !== null) {\n                if (newNode.nodeType === 1 && checkCss(newNode)) {\n                  if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));else pCurrent.push(newNode.cloneNode(false));\n                  cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n                }\n\n                newNode = newNode.parentNode;\n              }\n\n              pCurrent = pCurrent.concat(anchors);\n              cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\n\n              while (pCurrent.length > 0) {\n                newNode = pCurrent.pop();\n                appendNode.appendChild(newNode);\n                appendNode = newNode;\n              }\n\n              pNode.appendChild(cloneNode);\n              newNode.textContent = afterNode.data;\n            }\n\n            if (anchorNode && cloneNode) {\n              const afterAnchorNode = _getMaintainedNode(cloneNode);\n\n              if (afterAnchorNode) {\n                anchorNode = afterAnchorNode;\n              }\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== pNode && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              newInnerNode.appendChild(childNode);\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.appendChild(anchorNode);\n              nNodeArray.push(newInnerNode);\n              anchorNode = null;\n            } else {\n              newInnerNode.appendChild(childNode);\n            }\n\n            endContainer = textNode;\n            endOffset = textNode.data.length;\n            endPass = true;\n\n            if (!isRemoveFormat && collapsed) {\n              newInnerNode = textNode;\n              textNode.textContent = util.zeroWidthSpace;\n            }\n\n            if (newNode !== textNode) newNode.appendChild(endContainer);\n            continue;\n          } // other\n\n\n          if (startPass) {\n            if (child.nodeType === 1 && !util.isBreak(child)) {\n              if (util._isIgnoreNodeChange(child)) {\n                pNode.appendChild(child.cloneNode(true));\n\n                if (!collapsed) {\n                  newInnerNode = newInnerNode.cloneNode(false);\n                  pNode.appendChild(newInnerNode);\n                  nNodeArray.push(newInnerNode);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\n\n              if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (childNode === child) {\n              if (!endPass) ancestor = newInnerNode;else ancestor = pNode;\n            } else if (endPass) {\n              pNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          }\n\n          cloneNode = child.cloneNode(false);\n          ancestor.appendChild(cloneNode);\n          if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          startContainer: startCon,\n          startOffset: startOff,\n          endContainer: endCon,\n          endOffset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          let textNode, textNode_s, textNode_e;\n\n          if (collapsed) {\n            textNode = util.createTextNode(util.zeroWidthSpace);\n            pNode.replaceChild(textNode, removeNode);\n          } else {\n            const rChildren = removeNode.childNodes;\n            textNode_s = rChildren[0];\n\n            while (rChildren[0]) {\n              textNode_e = rChildren[0];\n              pNode.insertBefore(textNode_e, removeNode);\n            }\n\n            util.removeItem(removeNode);\n          }\n\n          if (i === 0) {\n            if (collapsed) {\n              startContainer = endContainer = textNode;\n            } else {\n              startContainer = textNode_s;\n              endContainer = textNode_e;\n            }\n          }\n        }\n      } else {\n        if (isRemoveNode) {\n          for (let i = 0; i < nNodeArray.length; i++) {\n            this._stripRemoveNode(nNodeArray[i]);\n          }\n        }\n\n        if (collapsed) {\n          startContainer = endContainer = newInnerNode;\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n\n      if (collapsed) {\n        startOffset = startContainer.textContent.length;\n        endOffset = endContainer.textContent.length;\n      } // endContainer reset\n\n\n      const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\n\n      if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\n        util.removeItem(endContainer);\n        endContainer = startContainer;\n      }\n\n      endOffset = endConReset ? endContainer.textContent.length : endOffset; // node change\n\n      const newStartOffset = {\n        s: 0,\n        e: 0\n      };\n      const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\n      const mergeEndCon = !endContainer.parentNode;\n      if (mergeEndCon) endContainer = startContainer;\n      const newEndOffset = {\n        s: 0,\n        e: 0\n      };\n      const endPath = util.getNodePath(endContainer, pNode, !mergeEndCon && !endConReset ? newEndOffset : null);\n      startOffset += newStartOffset.s;\n      endOffset = collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s; // tag merge\n\n      const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\n      element.parentNode.replaceChild(pNode, element);\n      startContainer = util.getNodeFromPath(startPath, pNode);\n      endContainer = util.getNodeFromPath(endPath, pNode);\n      return {\n        ancestor: pNode,\n        startContainer: startContainer,\n        startOffset: startOffset + newOffsets[0],\n        endContainer: endContainer,\n        endOffset: endOffset + newOffsets[1]\n      };\n    },\n\n    /**\r\n     * @description wraps first line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {null|Node} If end container is renewed, returned renewed node\r\n     * @returns {Object} { ancestor, container, offset, endContainer }\r\n     * @private\r\n     */\n    _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\n      // not add tag\n      let parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\n        let sameTag = true;\n        let s = startCon.previousSibling;\n\n        while (s) {\n          if (!util.onlyZeroWidthSpace(s)) {\n            sameTag = false;\n            break;\n          }\n\n          s = s.previousSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: startCon,\n            offset: startOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      let container = startCon;\n      let offset = startOff;\n      let passNode = false;\n      let pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          const child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                cloneChild = child.cloneNode(true);\n                pNode.appendChild(cloneChild);\n                pNode.appendChild(newInnerNode);\n                nNodeArray.push(newInnerNode); // end container\n\n                if (_endContainer && child.contains(_endContainer)) {\n                  const endPath = util.getNodePath(_endContainer, child);\n                  _endContainer = util.getNodeFromPath(endPath, cloneChild);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const isTopNode = pCurrent.length > 0;\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\n              nNodeArray.push(newInnerNode);\n            } else if (isTopNode) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // startContainer\n\n\n          if (!passNode && child === container) {\n            let line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n            const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n\n            if (anchorNode) {\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            const prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== line && newNode !== null) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || ancestor;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (childNode !== ancestor) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n            line.appendChild(newInnerNode);\n            container = textNode;\n            offset = 0;\n            passNode = true;\n            ancestor.appendChild(container);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.appendChild(vNode);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: startCon,\n          offset: startOff,\n          endContainer: _endContainer\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n          const textNode = rChildren[0];\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n          if (i === 0) container = textNode;\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = 0;\n        } // node change\n\n\n        const offsets = {\n          s: 0,\n          e: 0\n        };\n        const path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        const newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps mid lines selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n     * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n     * @private\r\n     */\n    _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\n      // not add tag\n      if (!isRemoveNode) {\n        // end container path\n        let endPath = null;\n        if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\n        const tempNode = element.cloneNode(true);\n        const newNodeName = newInnerNode.nodeName;\n        const newCssText = newInnerNode.style.cssText;\n        const newClass = newInnerNode.className;\n        let children = tempNode.childNodes;\n        let i = 0,\n            len = children.length;\n\n        for (let child; i < len; i++) {\n          child = children[i];\n          if (child.nodeType === 3) break;\n\n          if (child.nodeName === newNodeName) {\n            child.style.cssText += newCssText;\n            util.addClass(child, newClass);\n          } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            continue;\n          } else if (len === 1) {\n            children = child.childNodes;\n            len = children.length;\n            i = -1;\n            continue;\n          } else {\n            break;\n          }\n        }\n\n        if (len > 0 && i === len) {\n          element.innerHTML = tempNode.innerHTML;\n          return {\n            ancestor: element,\n            endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const pNode = element.cloneNode(false);\n      const nNodeArray = [newInnerNode];\n      let noneChange = true;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          let child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            if (newInnerNode.childNodes.length > 0) {\n              pNode.appendChild(newInnerNode);\n              newInnerNode = newInnerNode.cloneNode(false);\n            }\n\n            cloneChild = child.cloneNode(true);\n            pNode.appendChild(cloneChild);\n            pNode.appendChild(newInnerNode);\n            nNodeArray.push(newInnerNode);\n            ancestor = newInnerNode; // end container\n\n            if (_endContainer && child.contains(_endContainer)) {\n              const endPath = util.getNodePath(_endContainer, child);\n              _endContainer = util.getNodeFromPath(endPath, cloneChild);\n            }\n\n            continue;\n          } else {\n            vNode = validation(child);\n\n            if (vNode) {\n              noneChange = false;\n              ancestor.appendChild(vNode);\n              if (child.nodeType === 1) coverNode = vNode;\n            }\n          }\n\n          if (!util.isBreak(child)) recursionFunc(child, coverNode);\n        }\n      })(element, newInnerNode); // not remove tag\n\n\n      if (noneChange || isRemoveNode && !isRemoveFormat && !_removeCheck.v) return {\n        ancestor: element,\n        endContainer: _endContainer\n      };\n      pNode.appendChild(newInnerNode);\n\n      if (isRemoveFormat && isRemoveNode) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n      util.mergeSameTags(pNode, null, true); // node change\n\n      element.parentNode.replaceChild(pNode, element);\n      return {\n        ancestor: pNode,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps last line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {Object} { ancestor, container, offset }\r\n     * @private\r\n     */\n    _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      let parentCon = endCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n        let sameTag = true;\n        let e = endCon.nextSibling;\n\n        while (e) {\n          if (!util.onlyZeroWidthSpace(e)) {\n            sameTag = false;\n            break;\n          }\n\n          e = e.nextSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: endCon,\n            offset: endOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      const el = element;\n      const nNodeArray = [newInnerNode];\n      const pNode = element.cloneNode(false);\n      let container = endCon;\n      let offset = endOff;\n      let passNode = false;\n      let pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        const childNodes = current.childNodes;\n\n        for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\n          const child = childNodes[i];\n          if (!child) continue;\n          let coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                const cloneChild = child.cloneNode(true);\n                pNode.insertBefore(cloneChild, ancestor);\n                pNode.insertBefore(newInnerNode, cloneChild);\n                nNodeArray.push(newInnerNode);\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            const anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            const isTopNode = pCurrent.length > 0;\n            const childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              const aChildren = childNode.childNodes;\n\n              for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.insertBefore(childNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (isTopNode) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.insertBefore(newInnerNode, pNode.firstChild);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // endContainer\n\n\n          if (!passNode && child === container) {\n            anchorNode = _getMaintainedNode(child);\n            const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n            const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n\n              const a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== pNode) {\n                let m = a;\n                let p = null;\n\n                while (m.parentNode !== pNode) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.insertBefore(a, m.parentNode.firstChild);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              ancestor.insertBefore(afterNode, ancestor.firstChild);\n            }\n\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== pNode && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            const childNode = pCurrent.pop() || ancestor;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (childNode !== ancestor) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n\n            if (anchorNode) {\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.insertBefore(anchorNode, pNode.firstChild);\n              anchorNode = null;\n            } else {\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n            }\n\n            container = textNode;\n            offset = textNode.data.length;\n            passNode = true;\n            ancestor.insertBefore(container, ancestor.firstChild);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.insertBefore(vNode, ancestor.firstChild);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: endCon,\n          offset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (let i = 0; i < nNodeArray.length; i++) {\n          let removeNode = nNodeArray[i];\n          const rChildren = removeNode.childNodes;\n          let textNode = null;\n\n          while (rChildren[0]) {\n            textNode = rChildren[0];\n            pNode.insertBefore(textNode, removeNode);\n          }\n\n          util.removeItem(removeNode);\n\n          if (i === nNodeArray.length - 1) {\n            container = textNode;\n            offset = textNode.textContent.length;\n          }\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (let i = 0; i < nNodeArray.length; i++) {\n          this._stripRemoveNode(nNodeArray[i]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        if (!isRemoveNode && newInnerNode.textContent.length === 0) {\n          util.removeEmptyNode(pNode, null);\n          return {\n            ancestor: null,\n            container: null,\n            offset: 0\n          };\n        }\n\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = container.textContent.length;\n        } else if (util.onlyZeroWidthSpace(container)) {\n          container = newInnerNode;\n          offset = 1;\n        } // node change\n\n\n        const offsets = {\n          s: 0,\n          e: 0\n        };\n        const path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        const newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset\n      };\n    },\n\n    /**\r\n     * @description Run plugin calls and basic commands.\r\n     * @param {String} command Command string\r\n     * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n     * @param {Element} target The element of command button\r\n     */\n    actionCall: function (command, display, target) {\n      // call plugins\n      if (display) {\n        if (/more/i.test(display) && target !== this._moreLayerActiveButton) {\n          const layer = context.element.toolbar.querySelector('.' + command);\n\n          if (layer) {\n            if (this._moreLayerActiveButton) {\n              context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command')).style.display = 'none';\n              util.removeClass(this._moreLayerActiveButton, 'on');\n            }\n\n            util.addClass(target, 'on');\n            this._moreLayerActiveButton = target;\n            layer.style.display = 'block';\n\n            event._showToolbarBalloon();\n\n            event._showToolbarInline();\n          }\n\n          return;\n        }\n\n        if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\n          this.callPlugin(command, this.containerOn.bind(this, target), target);\n          return;\n        }\n\n        if (this.isReadOnly) return;\n\n        if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\n          this.callPlugin(command, this.submenuOn.bind(this, target), target);\n          return;\n        } else if (/dialog/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this), target);\n          return;\n        } else if (/command/.test(display)) {\n          this.callPlugin(command, this.plugins[command].action.bind(this), target);\n        } else if (/fileBrowser/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\n        }\n      } // default command\n      else if (command) {\n          this.commandHandler(target, command);\n        }\n\n      if (/more/i.test(display)) {\n        const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n\n        if (layer) {\n          util.removeClass(this._moreLayerActiveButton, 'on');\n          this._moreLayerActiveButton = null;\n          layer.style.display = 'none';\n\n          event._showToolbarBalloon();\n\n          event._showToolbarInline();\n        }\n      } else if (/submenu/.test(display)) {\n        this.submenuOff();\n      } else if (!/command/.test(display)) {\n        this.submenuOff();\n        this.containerOff();\n      }\n    },\n\n    /**\r\n     * @description Execute command of command button(All Buttons except submenu and dialog)\r\n     * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n     * @param {Element|null} target The element of command button\r\n     * @param {String} command Property of command button (data-value)\r\n     */\n    commandHandler: function (target, command) {\n      if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\n\n      switch (command) {\n        case 'copy':\n        case 'cut':\n          this.execCommand(command);\n          break;\n\n        case 'paste':\n          break;\n\n        case 'selectAll':\n          const wysiwyg = context.element.wysiwyg;\n          let first = util.getChildElement(wysiwyg.firstChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, false) || wysiwyg.firstChild;\n          let last = util.getChildElement(wysiwyg.lastChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, true) || wysiwyg.lastChild;\n          if (!first || !last) return;\n\n          if (util.isMedia(first)) {\n            const info = this.getFileComponent(first);\n            const br = util.createElement('BR');\n            const format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            first = info ? info.component : first;\n            first.parentNode.insertBefore(format, first);\n            first = br;\n          }\n\n          if (util.isMedia(last)) {\n            const br = util.createElement('BR');\n            const format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            wysiwyg.appendChild(format);\n            last = br;\n          }\n\n          this.setRange(first, 0, last, last.textContent.length);\n          break;\n\n        case 'codeView':\n          this.toggleCodeView();\n          break;\n\n        case 'fullScreen':\n          this.toggleFullScreen(target);\n          break;\n\n        case 'indent':\n        case 'outdent':\n          this.indent(command);\n          break;\n\n        case 'undo':\n          this.history.undo();\n          break;\n\n        case 'redo':\n          this.history.redo();\n          break;\n\n        case 'removeFormat':\n          this.removeFormat();\n          this.focus();\n          break;\n\n        case 'print':\n          this.print();\n          break;\n\n        case 'preview':\n          this.preview();\n          break;\n\n        case 'showBlocks':\n          this.toggleDisplayBlocks();\n          break;\n\n        case 'save':\n          if (typeof options.callBackSave === 'function') {\n            options.callBackSave(this.getContents(false), this._variable.isChanged);\n          } else if (this._variable.isChanged && typeof functions.save === 'function') {\n            functions.save();\n          } else {\n            throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\n          }\n\n          this._variable.isChanged = false;\n          if (context.tool.save) context.tool.save.setAttribute('disabled', true);\n          break;\n\n        default:\n          // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\n          command = this._defaultCommand[command.toLowerCase()] || command;\n          if (!this.commandMap[command]) this.commandMap[command] = target;\n          const nodesMap = this._variable.currentNodesMap;\n          const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\n          let removeNode = command;\n\n          if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\n            removeNode = 'SUP';\n          } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\n            removeNode = 'SUB';\n          }\n\n          this.nodeChange(cmd, null, [removeNode], false);\n          this.focus();\n      }\n    },\n\n    /**\r\n     * @description Remove format of the currently selected range\r\n     */\n    removeFormat: function () {\n      this.nodeChange(null, null, null, null);\n    },\n\n    /**\r\n     * @description This method implements indentation to selected range.\r\n     * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n     * @param {String} command Separator (\"indent\" or \"outdent\")\r\n     */\n    indent: function (command) {\n      const range = this.getRange();\n      const rangeLines = this.getSelectedElements(null);\n      const cells = [];\n      const shift = 'indent' !== command;\n      const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      let sc = range.startContainer;\n      let ec = range.endContainer;\n      let so = range.startOffset;\n      let eo = range.endOffset;\n\n      for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\n        f = rangeLines[i];\n\n        if (!util.isListCell(f) || !this.plugins.list) {\n          margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\n\n          if (shift) {\n            margin -= 25;\n          } else {\n            margin += 25;\n          }\n\n          util.setStyle(f, marginDir, margin <= 0 ? '' : margin + 'px');\n        } else {\n          if (shift || f.previousElementSibling) {\n            cells.push(f);\n          }\n        }\n      } // list cells\n\n\n      if (cells.length > 0) {\n        this.plugins.list.editInsideList.call(this, shift, cells);\n      }\n\n      this.effectNode = null;\n      this.setRange(sc, so, ec, eo); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Add or remove the class name of \"body\" so that the code block is visible\r\n     */\n    toggleDisplayBlocks: function () {\n      const wysiwyg = context.element.wysiwyg;\n      util.toggleClass(wysiwyg, 'se-show-block');\n\n      if (util.hasClass(wysiwyg, 'se-show-block')) {\n        util.addClass(this._styleCommandMap.showBlocks, 'active');\n      } else {\n        util.removeClass(this._styleCommandMap.showBlocks, 'active');\n      }\n\n      this._resourcesStateChange();\n    },\n\n    /**\r\n     * @description Changes to code view or wysiwyg view\r\n     */\n    toggleCodeView: function () {\n      const isCodeView = this._variable.isCodeView;\n      this.controllersOff();\n      util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\n\n      if (isCodeView) {\n        this._setCodeDataToEditor();\n\n        context.element.wysiwygFrame.scrollTop = 0;\n        context.element.code.style.display = 'none';\n        context.element.wysiwygFrame.style.display = 'block';\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\n        this._variable.isCodeView = false;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = false;\n\n          if (/balloon|balloon-always/i.test(options.mode)) {\n            context.element._arrow.style.display = '';\n            this._isInline = false;\n            this._isBalloon = true;\n\n            event._hideToolbar();\n          }\n        }\n\n        this.nativeFocus();\n        util.removeClass(this._styleCommandMap.codeView, 'active'); // history stack\n\n        this.history.push(false);\n\n        this.history._resetCachingButton();\n      } else {\n        this._setEditorDataToCodeView();\n\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? context.element.code.scrollHeight + 'px' : 'auto';\n        if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\n        this._variable.isCodeView = true;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = true;\n\n          if (this._isBalloon) {\n            context.element._arrow.style.display = 'none';\n            context.element.toolbar.style.left = '';\n            this._isInline = true;\n            this._isBalloon = false;\n\n            event._showToolbarInline();\n          }\n        }\n\n        this._variable._range = null;\n        context.element.code.focus();\n        util.addClass(this._styleCommandMap.codeView, 'active');\n      }\n\n      this._checkPlaceholder();\n\n      if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons); // user event\n\n      if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\n    },\n\n    /**\r\n     * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n     * @private\r\n     */\n    _setCodeDataToEditor: function () {\n      const code_html = this._getCodeView();\n\n      if (options.fullPage) {\n        const parseDocument = this._parser.parseFromString(code_html, 'text/html');\n\n        const headChildren = parseDocument.head.children;\n\n        for (let i = 0, len = headChildren.length; i < len; i++) {\n          if (/^script$/i.test(headChildren[i].tagName)) {\n            parseDocument.head.removeChild(headChildren[i]);\n            i--, len--;\n          }\n        }\n\n        this._wd.head.innerHTML = parseDocument.head.innerHTML;\n        this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\n        const attrs = parseDocument.body.attributes;\n\n        for (let i = 0, len = attrs.length; i < len; i++) {\n          if (attrs[i].name === 'contenteditable') continue;\n\n          this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\n        }\n\n        if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\n          const editableClasses = options._editableClass.split(' ');\n\n          for (let i = 0; i < editableClasses.length; i++) {\n            util.addClass(this._wd.body, options._editableClass[i]);\n          }\n        }\n      } else {\n        context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      }\n    },\n\n    /**\r\n     * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n     * @private\r\n     */\n    _setEditorDataToCodeView: function () {\n      const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg);\n      let codeValue = '';\n\n      if (options.fullPage) {\n        const attrs = util.getAttributesToString(this._wd.body, null);\n        codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\n      } else {\n        codeValue = codeContents;\n      }\n\n      context.element.code.style.display = 'block';\n      context.element.wysiwygFrame.style.display = 'none';\n\n      this._setCodeView(codeValue);\n    },\n\n    /**\r\n     * @description Changes to full screen or default screen\r\n     * @param {Element} element full screen button\r\n     */\n    toggleFullScreen: function (element) {\n      const topArea = context.element.topArea;\n      const toolbar = context.element.toolbar;\n      const editorArea = context.element.editorArea;\n      const wysiwygFrame = context.element.wysiwygFrame;\n      const code = context.element.code;\n      const _var = this._variable;\n      this.controllersOff();\n\n      if (!_var.isFullScreen) {\n        _var.isFullScreen = true;\n        _var._fullScreenAttrs.inline = this._isInline;\n        _var._fullScreenAttrs.balloon = this._isBalloon;\n\n        if (this._isInline || this._isBalloon) {\n          this._isInline = false;\n          this._isBalloon = false;\n        }\n\n        if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\n        topArea.style.position = 'fixed';\n        topArea.style.top = '0';\n        topArea.style.left = '0';\n        topArea.style.width = '100%';\n        topArea.style.maxWidth = '100%';\n        topArea.style.height = '100%';\n        topArea.style.zIndex = '2147483647';\n\n        if (context.element._stickyDummy.style.display !== ('none' && '')) {\n          _var._fullScreenAttrs.sticky = true;\n          context.element._stickyDummy.style.display = 'none';\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        _var._bodyOverflow = _d.body.style.overflow;\n        _d.body.style.overflow = 'hidden';\n        _var._editorAreaOriginCssText = editorArea.style.cssText;\n        _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\n        _var._codeOriginCssText = code.style.cssText;\n        editorArea.style.cssText = toolbar.style.cssText = '';\n        wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\n        toolbar.style.position = 'relative';\n        toolbar.style.display = 'block';\n        _var.innerHeight_fullScreen = _w.innerHeight - toolbar.offsetHeight;\n        editorArea.style.height = _var.innerHeight_fullScreen - options.fullScreenOffset + 'px';\n        util.changeElement(element.firstElementChild, icons.reduction);\n\n        if (options.iframe && options.height === 'auto') {\n          editorArea.style.overflow = 'auto';\n\n          this._iframeAutoHeight();\n        }\n\n        context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\n        util.addClass(this._styleCommandMap.fullScreen, 'active');\n      } else {\n        _var.isFullScreen = false;\n        wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\n        code.style.cssText = _var._codeOriginCssText;\n        toolbar.style.cssText = '';\n        editorArea.style.cssText = _var._editorAreaOriginCssText;\n        topArea.style.cssText = _var._originCssText;\n        _d.body.style.overflow = _var._bodyOverflow;\n        if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\n\n        if (options.stickyToolbar > -1) {\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\n          _var._fullScreenAttrs.sticky = false;\n          context.element._stickyDummy.style.display = 'block';\n          util.addClass(toolbar, \"se-toolbar-sticky\");\n        }\n\n        this._isInline = _var._fullScreenAttrs.inline;\n        this._isBalloon = _var._fullScreenAttrs.balloon;\n        if (this._isInline) event._showToolbarInline();\n        if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\n        event.onScroll_window();\n        util.changeElement(element.firstElementChild, icons.expansion);\n        context.element.topArea.style.marginTop = '';\n        util.removeClass(this._styleCommandMap.fullScreen, 'active');\n      } // user event\n\n\n      if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\n    },\n\n    /**\r\n     * @description Prints the current contents of the editor.\r\n     */\n    print: function () {\n      const iframe = util.createElement('IFRAME');\n      iframe.style.display = 'none';\n\n      _d.body.appendChild(iframe);\n\n      const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n      const printDocument = util.getIframeDocument(iframe);\n      const wDoc = this._wd;\n\n      if (options.iframe) {\n        const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        const links = _d.head.getElementsByTagName('link');\n\n        const styles = _d.head.getElementsByTagName('style');\n\n        let linkHTML = '';\n\n        for (let i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (let i = 0, len = styles.length; i < len; i++) {\n          linkHTML += styles[i].outerHTML;\n        }\n\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' + '</html>');\n      }\n\n      this.showLoading();\n\n      _w.setTimeout(function () {\n        try {\n          iframe.focus(); // IE or Edge\n\n          if (util.isIE_Edge || !!_d.documentMode || !!_w.StyleMedia) {\n            try {\n              iframe.contentWindow.document.execCommand('print', false, null);\n            } catch (e) {\n              iframe.contentWindow.print();\n            }\n          } else {\n            // Other browsers\n            iframe.contentWindow.print();\n          }\n        } catch (error) {\n          throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\n        } finally {\n          core.closeLoading();\n          util.removeItem(iframe);\n        }\n      }, 1000);\n    },\n\n    /**\r\n     * @description Open the preview window.\r\n     */\n    preview: function () {\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n\n      const windowObject = _w.open('', '_blank');\n\n      windowObject.mimeType = 'text/html';\n      const wDoc = this._wd;\n\n      if (options.iframe) {\n        const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        const links = _d.head.getElementsByTagName('link');\n\n        const styles = _d.head.getElementsByTagName('style');\n\n        let linkHTML = '';\n\n        for (let i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (let i = 0, len = styles.length; i < len; i++) {\n          linkHTML += styles[i].outerHTML;\n        }\n\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + '<meta charset=\"utf-8\" />' + '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' + '<title>' + lang.toolbar.preview + '</title>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' + '</html>');\n      }\n    },\n\n    /**\r\n     * @description Sets the HTML string\r\n     * @param {String|undefined} html HTML string\r\n     */\n    setContents: function (html) {\n      this.removeRange();\n      const convertValue = html === null || html === undefined ? '' : this.convertContentsForEditor(html);\n\n      this._resetComponents();\n\n      if (!this._variable.isCodeView) {\n        context.element.wysiwyg.innerHTML = convertValue; // history stack\n\n        this.history.push(false);\n      } else {\n        const value = this.convertHTMLForCodeView(convertValue);\n\n        this._setCodeView(value);\n      }\n    },\n\n    /**\r\n     * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n     * @param {Object} ctx { head: HTML string, body: HTML string}\r\n     */\n    setIframeContents: function (ctx) {\n      if (!options.iframe) return false;\n      if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\n      if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\n    },\n\n    /**\r\n     * @description Gets the current contents\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {Object}\r\n     */\n    getContents: function (onlyContents) {\n      const contents = context.element.wysiwyg.innerHTML;\n      const renderHTML = util.createElement('DIV');\n      renderHTML.innerHTML = contents;\n      const figcaptions = util.getListChildren(renderHTML, function (current) {\n        return /FIGCAPTION/i.test(current.nodeName);\n      });\n\n      for (let i = 0, len = figcaptions.length; i < len; i++) {\n        figcaptions[i].removeAttribute('contenteditable');\n      }\n\n      if (options.fullPage && !onlyContents) {\n        const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\n        return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\n      } else {\n        return renderHTML.innerHTML;\n      }\n    },\n\n    /**\r\n     * @description Returns HTML string according to tag type and configuration.\r\n     * Use only \"cleanHTML\"\r\n     * @param {Node} node Node\r\n     * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n     * @private\r\n     */\n    _makeLine: function (node, requireFormat) {\n      const defaultTag = options.defaultTag; // element\n\n      if (node.nodeType === 1) {\n        if (util._disallowedTags(node)) return '';\n\n        if (!requireFormat || util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || util.isAnchor(node) && util.isMedia(node.firstElementChild)) {\n          return node.outerHTML;\n        } else {\n          return '<' + defaultTag + '>' + node.outerHTML + '</' + defaultTag + '>';\n        }\n      } // text\n\n\n      if (node.nodeType === 3) {\n        if (!requireFormat) return util._HTMLConvertor(node.textContent);\n        const textArray = node.textContent.split(/\\n/g);\n        let html = '';\n\n        for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\n          text = textArray[i].trim();\n          if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\n        }\n\n        return html;\n      } // comments\n\n\n      if (node.nodeType === 8 && this._allowHTMLComments) {\n        return '<!--' + node.textContent.trim() + '-->';\n      }\n\n      return '';\n    },\n\n    /**\r\n     * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n     * @param {String} text \r\n     * @returns {String} HTML string\r\n     * @private\r\n     */\n    _tagConvertor: function (text) {\n      if (!this._disallowedTextTagsRegExp) return text;\n      const ec = options._textTagsMap;\n      return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\n        return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\n      });\n    },\n\n    /**\r\n     * @description Delete disallowed tags\r\n     * @param {String} html HTML string\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _deleteDisallowedTags: function (html) {\n      return html.replace(/\\n/g, '').replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '').replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '').replace(this.editorTagsWhitelistRegExp, '');\n    },\n\n    /**\r\n     * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n     * @param {Boolean} lowLevelCheck Row level check\r\n     * @param {String} m RegExp value\r\n     * @param {String} t RegExp value\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _cleanTags: function (lowLevelCheck, m, t) {\n      if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\n      let v = null;\n\n      const tAttr = this._attributesTagsWhitelist[t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase()];\n\n      if (tAttr) v = m.match(tAttr);else v = m.match(this._attributesWhitelistRegExp);\n\n      if (!lowLevelCheck || /<a\\b/i.test(t)) {\n        const sv = m.match(/id\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (sv) {\n          if (!v) v = [];\n          v.push(sv[0]);\n        }\n      }\n\n      if ((!lowLevelCheck || /<span/i.test(t)) && (!v || !/style=/i.test(v.toString()))) {\n        const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (sv) {\n          if (!v) v = [];\n          v.push(sv[0]);\n        }\n      }\n\n      if (v) {\n        for (let i = 0, len = v.length; i < len; i++) {\n          if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i])) continue;\n          t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i]) ? '' : v[i]);\n        }\n      }\n\n      return t;\n    },\n\n    /**\r\n     * @description Gets the clean HTML code for editor\r\n     * @param {String} html HTML string\r\n     * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n     * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n     * @returns {String}\r\n     */\n    cleanHTML: function (html, whitelist) {\n      html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\n\n      const dom = _d.createRange().createContextualFragment(html);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, true);\n      } catch (error) {\n        console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (let c = 0, cLen = classList.length; c < cLen; c++) {\n            initMethod = this.managedTagsInfo.map[classList[c]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      const domTree = dom.childNodes;\n      let cleanHTML = '';\n      let requireFormat = false;\n\n      for (let i = 0, len = domTree.length, t; i < len; i++) {\n        t = domTree[i];\n\n        if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\n          requireFormat = true;\n          break;\n        }\n      }\n\n      for (let i = 0, len = domTree.length; i < len; i++) {\n        cleanHTML += this._makeLine(domTree[i], requireFormat);\n      }\n\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(!cleanHTML ? html : !whitelist ? cleanHTML : cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, ''));\n    },\n\n    /**\r\n     * @description Converts contents into a format that can be placed in an editor\r\n     * @param {String} contents contents\r\n     * @returns {String}\r\n     */\n    convertContentsForEditor: function (contents) {\n      contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\n\n      const dom = _d.createRange().createContextualFragment(contents);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, false);\n      } catch (error) {\n        console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (let c = 0, cLen = classList.length; c < cLen; c++) {\n            initMethod = this.managedTagsInfo.map[classList[c]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      const domTree = dom.childNodes;\n      let cleanHTML = '';\n\n      for (let i = 0, len = domTree.length; i < len; i++) {\n        cleanHTML += this._makeLine(domTree[i], true);\n      }\n\n      if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n     * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n     * @returns {String}\r\n     */\n    convertHTMLForCodeView: function (html) {\n      let returnHTML = '';\n      const wRegExp = _w.RegExp;\n      const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\n      const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\n\n      const isFormat = function (current) {\n        return this.isFormatElement(current) || this.isComponent(current);\n      }.bind(util);\n\n      let indentSize = this._variable.codeIndent * 1;\n      indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\n\n      (function recursionFunc(element, indent, lineBR) {\n        const children = element.childNodes;\n        const elementRegTest = brReg.test(element.nodeName);\n        const elementIndent = elementRegTest ? indent : '';\n\n        for (let i = 0, len = children.length, node, br, nodeRegTest, tag, tagIndent; i < len; i++) {\n          node = children[i];\n          nodeRegTest = brReg.test(node.nodeName);\n          br = nodeRegTest ? '\\n' : '';\n          lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? '\\n' : '';\n\n          if (node.nodeType === 8) {\n            returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\n            continue;\n          }\n\n          if (node.nodeType === 3) {\n            if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\n            continue;\n          }\n\n          if (node.childNodes.length === 0) {\n            returnHTML += (/^HR$/i.test(node.nodeName) ? '\\n' : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\n            continue;\n          }\n\n          if (!node.outerHTML) {\n            // IE\n            returnHTML += new _w.XMLSerializer().serializeToString(node);\n          } else {\n            tag = node.nodeName.toLowerCase();\n            tagIndent = elementIndent || nodeRegTest ? indent : '';\n            returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\n            recursionFunc(node, indent + indentSize, '');\n            returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? '\\n' : '' || /^(TH|TD)$/i.test(node.nodeName) ? '\\n' : '');\n          }\n        }\n      })(wDoc, '', '\\n');\n\n      return returnHTML.trim() + '\\n';\n    },\n\n    /**\r\n     * @description Add an event to document.\r\n     * When created as an Iframe, the same event is added to the document in the Iframe.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     * @param {Boolean} useCapture Use event capture\r\n     */\n    addDocEvent: function (type, listener, useCapture) {\n      _d.addEventListener(type, listener, useCapture);\n\n      if (options.iframe) {\n        this._wd.addEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description Remove events from document.\r\n     * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     */\n    removeDocEvent: function (type, listener) {\n      _d.removeEventListener(type, listener);\n\n      if (options.iframe) {\n        this._wd.removeEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description The current number of characters is counted and displayed.\r\n     * @param {String} inputText Text added.\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\n    _charCount: function (inputText) {\n      const maxCharCount = options.maxCharCount;\n      const countType = options.charCounterType;\n      let nextCharCount = 0;\n      if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\n\n      this._setCharCount();\n\n      if (maxCharCount > 0) {\n        let over = false;\n        const count = functions.getCharCount(countType);\n\n        if (count > maxCharCount) {\n          over = true;\n\n          if (nextCharCount > 0) {\n            this._editorRange();\n\n            const range = this.getRange();\n            const endOff = range.endOffset - 1;\n            const text = this.getSelectionNode().textContent;\n            const slicePosition = range.endOffset - (count - maxCharCount);\n            this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\n            this.setRange(range.endContainer, endOff, range.endContainer, endOff);\n          }\n        } else if (count + nextCharCount > maxCharCount) {\n          over = true;\n        }\n\n        if (over) {\n          this._callCounterBlink();\n\n          if (nextCharCount > 0) return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n     * @param {Node|String} element Element node or String.\r\n     * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n     * @returns {Boolean}\r\n     */\n    checkCharCount: function (element, charCounterType) {\n      if (options.maxCharCount) {\n        const countType = charCounterType || options.charCounterType;\n        const length = this.getCharLength(typeof element === 'string' ? element : this._charTypeHTML && element.nodeType === 1 ? element.outerHTML : element.textContent, countType);\n\n        if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\n          this._callCounterBlink();\n\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description Get the length of the content.\r\n     * Depending on the option, the length of the character is taken. (charCounterType)\r\n     * @param {String} content Content to count\r\n     * @param {String} charCounterType options.charCounterType\r\n     * @returns {Number}\r\n     */\n    getCharLength: function (content, charCounterType) {\n      return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\n    },\n\n    /**\r\n     * @description Set the char count to charCounter element textContent.\r\n     * @private\r\n     */\n    _setCharCount: function () {\n      if (context.element.charCounter) {\n        _w.setTimeout(function () {\n          context.element.charCounter.textContent = functions.getCharCount(options.charCounterType);\n        });\n      }\n    },\n\n    /**\r\n     * @description The character counter blinks.\r\n     * @private\r\n     */\n    _callCounterBlink: function () {\n      const charWrapper = context.element.charWrapper;\n\n      if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\n        util.addClass(charWrapper, 'se-blink');\n\n        _w.setTimeout(function () {\n          util.removeClass(charWrapper, 'se-blink');\n        }, 600);\n      }\n    },\n\n    /**\r\n     * @description Check the components such as image and video and modify them according to the format.\r\n     * @private\r\n     */\n    _checkComponents: function () {\n      for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\n        this._fileInfoPluginsCheck[i]();\n      }\n    },\n\n    /**\r\n     * @description Initialize the information of the components.\r\n     * @private\r\n     */\n    _resetComponents: function () {\n      for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\n        this._fileInfoPluginsReset[i]();\n      }\n    },\n\n    /**\r\n     * @description Set method in the code view area\r\n     * @param {String} value HTML string\r\n     * @private\r\n     */\n    _setCodeView: function (value) {\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.getDoc().setValue(value);\n      } else {\n        context.element.code.value = value;\n      }\n    },\n\n    /**\r\n     * @description Get method in the code view area\r\n     * @private\r\n     */\n    _getCodeView: function () {\n      return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\n    },\n\n    /**\r\n     * @description remove class, display text.\r\n     * @param {Array|null} ignoredList Igonred button list\r\n     */\n    _setKeyEffect: function (ignoredList) {\n      const commandMap = this.commandMap;\n      const activePlugins = this.activePlugins;\n\n      for (let key in commandMap) {\n        if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(this, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          if (!this.isReadOnly) commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          if (!this.isReadOnly) commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n    },\n\n    /**\r\n     * @description Initializ core variable\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _init: function (reload, _initHTML) {\n      const wRegExp = _w.RegExp;\n      this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\n      this._wd = _d;\n      this._charTypeHTML = options.charCounterType === 'byte-html';\n\n      if (!options.iframe && typeof _w.ShadowRoot === 'function') {\n        let child = context.element.wysiwygFrame;\n\n        while (child) {\n          if (child.shadowRoot) {\n            this._shadowRoot = child.shadowRoot;\n            break;\n          } else if (child instanceof _w.ShadowRoot) {\n            this._shadowRoot = child;\n            break;\n          }\n\n          child = child.parentNode;\n        }\n\n        if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\n      } // set disallow text nodes\n\n\n      const disallowTextTags = _w.Object.keys(options._textTagsMap);\n\n      const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) {\n        return /b|i|ins|s|strike/i.test(v);\n      });\n\n      for (let i = 0; i < allowTextTags.length; i++) {\n        disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\n      }\n\n      this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi'); // set whitelist\n\n      const defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size|data-exp|data-font-size';\n      this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1;\n      this._htmlCheckWhitelistRegExp = new wRegExp('^(' + options._editorTagsWhitelist.replace('|//', '') + ')$', 'i');\n      this.editorTagsWhitelistRegExp = util.createTagsWhitelist(options._editorTagsWhitelist.replace('|//', '|<!--|-->'));\n      this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(options.pasteTagsWhitelist);\n      const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\n      const _attr = options.attributesWhitelist;\n      const tagsAttr = {};\n      let allAttr = '';\n\n      if (!!_attr) {\n        for (let k in _attr) {\n          if (!util.hasOwn(_attr, k) || /^on[a-z]+$/i.test(_attr[k])) continue;\n\n          if (k === 'all') {\n            allAttr = _attr[k] + '|';\n          } else {\n            tagsAttr[k] = new wRegExp('(?:' + _attr[k] + '|' + defaultAttr + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesWhitelistRegExp = new wRegExp('(?:' + allAttr + defaultAttr + ')' + regEndStr, 'ig');\n      this._attributesTagsWhitelist = tagsAttr; // set modes\n\n      this._isInline = /inline/i.test(options.mode);\n      this._isBalloon = /balloon|balloon-always/i.test(options.mode);\n      this._isBalloonAlways = /balloon-always/i.test(options.mode); // caching buttons\n\n      this._cachingButtons(); // file components\n\n\n      this._fileInfoPluginsCheck = [];\n      this._fileInfoPluginsReset = []; // text components\n\n      this.managedTagsInfo = {\n        query: '',\n        map: {}\n      };\n      const managedClass = []; // Command and file plugins registration\n\n      this.activePlugins = [];\n      this._fileManager.tags = [];\n      this._fileManager.pluginMap = {};\n      let filePluginRegExp = [];\n      let plugin, button;\n\n      for (let key in plugins) {\n        if (!util.hasOwn(plugins, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if (plugin.active && button) {\n          this.callPlugin(key, null, button);\n        }\n\n        if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\n          this.callPlugin(key, null, button);\n\n          this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\n\n          this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\n        }\n\n        if (_w.Array.isArray(plugin.fileTags)) {\n          const fileTags = plugin.fileTags;\n          this.callPlugin(key, null, button);\n          this._fileManager.tags = this._fileManager.tags.concat(fileTags);\n          filePluginRegExp.push(key);\n\n          for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\n            this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\n          }\n        }\n\n        if (plugin.managedTags) {\n          const info = plugin.managedTags();\n          managedClass.push('.' + info.className);\n          this.managedTagsInfo.map[info.className] = info.method.bind(this);\n        }\n      }\n\n      this.managedTagsInfo.query = managedClass.toString();\n      this._fileManager.queryString = this._fileManager.tags.join(',');\n      this._fileManager.regExp = new wRegExp('^(' + this._fileManager.tags.join('|') + ')$', 'i');\n      this._fileManager.pluginRegExp = new wRegExp('^(' + (filePluginRegExp.length === 0 ? 'undefined' : filePluginRegExp.join('|')) + ')$', 'i'); // cache editor's element\n\n      this._variable._originCssText = context.element.topArea.style.cssText;\n      this._placeholder = context.element.placeholder;\n      this._lineBreaker = context.element.lineBreaker;\n      this._lineBreakerButton = this._lineBreaker.querySelector('button'); // Excute history function\n\n      this.history = _history(this, this._onChange_historyStack.bind(this)); // register notice module\n\n      this.addModule([_notice]); // Init, validate\n\n      if (options.iframe) {\n        this._wd = context.element.wysiwygFrame.contentDocument;\n        context.element.wysiwyg = this._wd.body;\n        if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\n        if (options.height === 'auto') this._iframeAuto = this._wd.body;\n      }\n\n      this._initWysiwygArea(reload, _initHTML);\n    },\n\n    /**\r\n     * @description Caching basic buttons to use\r\n     * @private\r\n     */\n    _cachingButtons: function () {\n      this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"])');\n      this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\n      const tool = context.tool;\n      this.commandMap = {\n        SUB: tool.subscript,\n        SUP: tool.superscript,\n        OUTDENT: tool.outdent,\n        INDENT: tool.indent\n      };\n      this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\n      this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\n      this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\n      this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\n      this._styleCommandMap = {\n        fullScreen: tool.fullScreen,\n        showBlocks: tool.showBlocks,\n        codeView: tool.codeView\n      };\n    },\n\n    /**\r\n     * @description Initializ wysiwyg area (Only called from core._init)\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _initWysiwygArea: function (reload, _initHTML) {\n      context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\n    },\n\n    /**\r\n     * @description Called when there are changes to tags in the wysiwyg region.\r\n     * @private\r\n     */\n    _resourcesStateChange: function () {\n      this._iframeAutoHeight();\n\n      this._checkPlaceholder();\n    },\n\n    /**\r\n     * @description Called when after execute \"history.push\"\r\n     * @private\r\n     */\n    _onChange_historyStack: function () {\n      if (this.hasFocus) event._applyTagEffects();\n      this._variable.isChanged = true;\n      if (context.tool.save) context.tool.save.removeAttribute('disabled'); // user event\n\n      if (functions.onChange) functions.onChange(this.getContents(true), this);\n      if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\n    },\n\n    /**\r\n     * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n     * @private\r\n     */\n    _iframeAutoHeight: function () {\n      if (this._iframeAuto) {\n        _w.setTimeout(function () {\n          context.element.wysiwygFrame.style.height = core._iframeAuto.offsetHeight + 'px';\n        });\n      }\n    },\n\n    /**\r\n     * @description Set display property when there is placeholder.\r\n     * @private\r\n     */\n    _checkPlaceholder: function () {\n      if (this._placeholder) {\n        if (this._variable.isCodeView) {\n          this._placeholder.style.display = 'none';\n          return;\n        }\n\n        const wysiwyg = context.element.wysiwyg;\n\n        if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\n          this._placeholder.style.display = 'none';\n        } else {\n          this._placeholder.style.display = 'block';\n        }\n      }\n    },\n\n    /**\r\n     * @description If there is no default format, add a format and move \"selection\".\r\n     * @param {String|null} formatName Format tag name (default: 'P')\r\n     * @returns {undefined|null}\r\n     * @private\r\n     */\n    _setDefaultFormat: function (formatName) {\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\n      const range = this.getRange();\n      const commonCon = range.commonAncestorContainer;\n      const startCon = range.startContainer;\n      const rangeEl = util.getRangeFormatElement(commonCon, null);\n      let focusNode, offset, format;\n      const fileComponent = util.getParentElement(commonCon, util.isComponent);\n      if (fileComponent && !util.isTable(fileComponent)) return;\n      if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\n      if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\n\n      if (rangeEl) {\n        format = util.createElement(formatName || options.defaultTag);\n        format.innerHTML = rangeEl.innerHTML;\n        if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\n        rangeEl.innerHTML = format.outerHTML;\n        format = rangeEl.firstChild;\n        focusNode = util.getEdgeChildNodes(format, null).sc;\n\n        if (!focusNode) {\n          focusNode = util.createTextNode(util.zeroWidthSpace);\n          format.insertBefore(focusNode, format.firstChild);\n        }\n\n        offset = focusNode.textContent.length;\n        this.setRange(focusNode, offset, focusNode, offset);\n        return;\n      }\n\n      if (util.isRangeFormatElement(commonCon) && commonCon.childNodes.length <= 1) {\n        let br = null;\n\n        if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\n          br = commonCon.firstChild;\n        } else {\n          br = util.createTextNode(util.zeroWidthSpace);\n          commonCon.appendChild(br);\n        }\n\n        this.setRange(br, 1, br, 1);\n        return;\n      }\n\n      this.execCommand('formatBlock', false, formatName || options.defaultTag);\n      focusNode = util.getEdgeChildNodes(commonCon, commonCon);\n      focusNode = focusNode ? focusNode.ec : commonCon;\n      format = util.getFormatElement(focusNode, null);\n\n      if (!format) {\n        this.removeRange();\n\n        this._editorRange();\n\n        return;\n      }\n\n      if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\n      if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\n\n      if (util.isBreak(focusNode)) {\n        const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        focusNode.parentNode.insertBefore(zeroWidth, focusNode);\n        focusNode = zeroWidth;\n      }\n\n      this.effectNode = null;\n      this.nativeFocus();\n    },\n\n    /**\r\n     * @description Initialization after \"setOptions\"\r\n     * @param {Object} el context.element\r\n     * @param {String} _initHTML Initial html string\r\n     * @private\r\n     */\n    _setOptionsInit: function (el, _initHTML) {\n      this.context = context = _Context(el.originElement, this._getConstructed(el), options);\n      this._componentsInfoReset = true;\n\n      this._editorInit(true, _initHTML);\n    },\n\n    /**\r\n     * @description Initializ editor\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _editorInit: function (reload, _initHTML) {\n      // initialize core and add event listeners\n      this._init(reload, _initHTML);\n\n      event._addEvent();\n\n      this._setCharCount();\n\n      event._offStickyToolbar();\n\n      event.onResize_window(); // toolbar visibility\n\n      context.element.toolbar.style.visibility = '';\n\n      this._checkComponents();\n\n      this._componentsInfoInit = false;\n      this._componentsInfoReset = false;\n      this.history.reset(true);\n\n      this._resourcesStateChange();\n\n      _w.setTimeout(function () {\n        // user event\n        if (typeof functions.onload === 'function') functions.onload(core, reload);\n      });\n    },\n\n    /**\r\n     * @description Create and return an object to cache the new context.\r\n     * @param {Element} contextEl context.element\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _getConstructed: function (contextEl) {\n      return {\n        _top: contextEl.topArea,\n        _relative: contextEl.relative,\n        _toolBar: contextEl.toolbar,\n        _menuTray: contextEl._menuTray,\n        _editorArea: contextEl.editorArea,\n        _wysiwygArea: contextEl.wysiwygFrame,\n        _codeArea: contextEl.code,\n        _placeholder: contextEl.placeholder,\n        _resizingBar: contextEl.resizingBar,\n        _navigation: contextEl.navigation,\n        _charCounter: contextEl.charCounter,\n        _charWrapper: contextEl.charWrapper,\n        _loading: contextEl.loading,\n        _lineBreaker: contextEl.lineBreaker,\n        _lineBreaker_t: contextEl.lineBreaker_t,\n        _lineBreaker_b: contextEl.lineBreaker_b,\n        _resizeBack: contextEl.resizeBackground,\n        _stickyDummy: contextEl._stickyDummy,\n        _arrow: contextEl._arrow\n      };\n    }\n  };\n  /**\r\n   * @description event function\r\n   */\n\n  const event = {\n    _IEisComposing: false,\n    // In IE, there is no \"e.isComposing\" in the key-up event.\n    _lineBreakerBind: null,\n    _responsiveCurrentSize: 'default',\n    _responsiveButtonSize: null,\n    _responsiveButtons: null,\n    _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\n    _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\n    _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\n    _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\n    _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\n    _keyCodeShortcut: {\n      65: 'A',\n      66: 'B',\n      83: 'S',\n      85: 'U',\n      73: 'I',\n      89: 'Y',\n      90: 'Z',\n      219: '[',\n      221: ']'\n    },\n    _shortcutCommand: function (keyCode, shift) {\n      let command = null;\n      const keyStr = event._keyCodeShortcut[keyCode];\n\n      switch (keyStr) {\n        case 'A':\n          command = 'selectAll';\n          break;\n\n        case 'B':\n          if (options.shortcutsDisable.indexOf('bold') === -1) {\n            command = 'bold';\n          }\n\n          break;\n\n        case 'S':\n          if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\n            command = 'strike';\n          } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\n            command = 'save';\n          }\n\n          break;\n\n        case 'U':\n          if (options.shortcutsDisable.indexOf('underline') === -1) {\n            command = 'underline';\n          }\n\n          break;\n\n        case 'I':\n          if (options.shortcutsDisable.indexOf('italic') === -1) {\n            command = 'italic';\n          }\n\n          break;\n\n        case 'Z':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            if (shift) {\n              command = 'redo';\n            } else {\n              command = 'undo';\n            }\n          }\n\n          break;\n\n        case 'Y':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            command = 'redo';\n          }\n\n          break;\n\n        case '[':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'indent' : 'outdent';\n          }\n\n          break;\n\n        case ']':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'outdent' : 'indent';\n          }\n\n          break;\n      }\n\n      if (!command) return false;\n      core.commandHandler(core.commandMap[command], command);\n      return true;\n    },\n    _applyTagEffects: function () {\n      let selectionNode = core.getSelectionNode();\n      if (selectionNode === core.effectNode) return;\n      core.effectNode = selectionNode;\n      const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      const commandMap = core.commandMap;\n      const classOnCheck = this._onButtonsCheck;\n      const commandMapNodes = [];\n      const currentNodes = [];\n      const activePlugins = core.activePlugins;\n      const cLen = activePlugins.length;\n      let nodeName = '';\n\n      while (selectionNode.firstChild) {\n        selectionNode = selectionNode.firstChild;\n      }\n\n      for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\n        if (!element) break;\n        if (element.nodeType !== 1 || util.isBreak(element)) continue;\n        nodeName = element.nodeName.toUpperCase();\n        currentNodes.push(nodeName);\n        /* Active plugins */\n\n        if (!core.isReadOnly) {\n          for (let c = 0, name; c < cLen; c++) {\n            name = activePlugins[c];\n\n            if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\n              commandMapNodes.push(name);\n            }\n          }\n        }\n\n        if (!core.isReadOnly && util.isFormatElement(element)) {\n          /* Outdent */\n          if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT) {\n            if (util.isListCell(element) || element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0) {\n              commandMapNodes.push('OUTDENT');\n              commandMap.OUTDENT.removeAttribute('disabled');\n            }\n          }\n          /* Indent */\n\n\n          if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT) {\n            commandMapNodes.push('INDENT');\n\n            if (util.isListCell(element) && !element.previousElementSibling) {\n              commandMap.INDENT.setAttribute('disabled', true);\n            } else {\n              commandMap.INDENT.removeAttribute('disabled');\n            }\n          }\n\n          continue;\n        }\n        /** default active buttons [strong, ins, em, del, sub, sup] */\n\n\n        if (classOnCheck.test(nodeName)) {\n          commandMapNodes.push(nodeName);\n          util.addClass(commandMap[nodeName], 'active');\n        }\n      }\n\n      core._setKeyEffect(commandMapNodes);\n      /** save current nodes */\n\n\n      core._variable.currentNodes = currentNodes.reverse();\n      core._variable.currentNodesMap = commandMapNodes;\n      /**  Displays the current node structure to resizingBar */\n\n      if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\n    },\n    _cancelCaptionEdit: function () {\n      this.setAttribute('contenteditable', false);\n      this.removeEventListener('blur', event._cancelCaptionEdit);\n    },\n    _buttonsEventHandler: function (e) {\n      let target = e.target;\n      if (core._bindControllersOff) e.stopPropagation();\n\n      if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\n        core._antiBlur = false;\n      } else {\n        e.preventDefault();\n      }\n\n      if (util.getParentElement(target, '.se-submenu')) {\n        e.stopPropagation();\n        core._notHideToolbar = true;\n      } else {\n        let command = target.getAttribute('data-command');\n        let className = target.className;\n\n        while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\n          target = target.parentNode;\n          command = target.getAttribute('data-command');\n          className = target.className;\n        }\n\n        if (command === core._submenuName || command === core._containerName) {\n          e.stopPropagation();\n        }\n      }\n    },\n    onClick_toolbar: function (e) {\n      let target = e.target;\n      let display = target.getAttribute('data-display');\n      let command = target.getAttribute('data-command');\n      let className = target.className;\n      core.controllersOff();\n\n      while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\n        target = target.parentNode;\n        command = target.getAttribute('data-command');\n        display = target.getAttribute('data-display');\n        className = target.className;\n      }\n\n      if (!command && !display) return;\n      if (target.disabled) return;\n      if (!core.isReadOnly && !core.hasFocus) core.nativeFocus();\n      if (!core.isReadOnly && !core._variable.isCodeView) core._editorRange();\n      core.actionCall(command, display, target);\n    },\n    onMouseDown_wysiwyg: function (e) {\n      if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\n      const tableCell = util.getParentElement(e.target, util.isCell);\n\n      if (tableCell) {\n        const tablePlugin = core.plugins.table;\n\n        if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\n          core.callPlugin('table', function () {\n            tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\n          }, null);\n        }\n      }\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      }\n\n      if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\n    },\n    onClick_wysiwyg: function (e) {\n      const targetElement = e.target;\n\n      if (core.isReadOnly) {\n        e.preventDefault();\n\n        if (util.isAnchor(targetElement)) {\n          _w.open(targetElement.href, targetElement.target);\n        }\n\n        return false;\n      }\n\n      if (util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\n      const fileComponentInfo = core.getFileComponent(targetElement);\n\n      if (fileComponentInfo) {\n        e.preventDefault();\n        core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        return;\n      }\n\n      const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\n\n      if (util.isNonEditable(figcaption)) {\n        e.preventDefault();\n        figcaption.setAttribute('contenteditable', true);\n        figcaption.focus();\n\n        if (core._isInline && !core._inlineToolbarAttr.isShow) {\n          event._showToolbarInline();\n\n          const hideToolbar = function () {\n            event._hideToolbar();\n\n            figcaption.removeEventListener('blur', hideToolbar);\n          };\n\n          figcaption.addEventListener('blur', hideToolbar);\n        }\n      }\n\n      _w.setTimeout(core._editorRange.bind(core));\n\n      core._editorRange();\n\n      const selectionNode = core.getSelectionNode();\n      const formatEl = util.getFormatElement(selectionNode, null);\n      const rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\n        const range = core.getRange();\n\n        if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\n          if (util.isList(rangeEl)) {\n            e.preventDefault();\n            const oLi = util.createElement('LI');\n            const prevLi = selectionNode.nextElementSibling;\n            oLi.appendChild(selectionNode);\n            rangeEl.insertBefore(oLi, prevLi);\n            core.focus();\n          } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n            e.preventDefault();\n            core.focus();\n          } else {\n            event._applyTagEffects();\n          }\n        }\n      } else {\n        event._applyTagEffects();\n      }\n\n      if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\n    },\n    _balloonDelay: null,\n    _showToolbarBalloonDelay: function () {\n      if (event._balloonDelay) {\n        _w.clearTimeout(event._balloonDelay);\n      }\n\n      event._balloonDelay = _w.setTimeout(function () {\n        _w.clearTimeout(this._balloonDelay);\n\n        this._balloonDelay = null;\n\n        this._showToolbarBalloon();\n      }.bind(event), 350);\n    },\n    _toggleToolbarBalloon: function () {\n      core._editorRange();\n\n      const range = core.getRange();\n      if (core._bindControllersOff || !core._isBalloonAlways && range.collapsed) event._hideToolbar();else event._showToolbarBalloon(range);\n    },\n    _showToolbarBalloon: function (rangeObj) {\n      if (!core._isBalloon) return;\n      const range = rangeObj || core.getRange();\n      const toolbar = context.element.toolbar;\n      const topArea = context.element.topArea;\n      const selection = core.getSelection();\n      let isDirTop;\n\n      if (core._isBalloonAlways && range.collapsed) {\n        isDirTop = true;\n      } else if (selection.focusNode === selection.anchorNode) {\n        isDirTop = selection.focusOffset < selection.anchorOffset;\n      } else {\n        const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\n        isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\n      }\n\n      let rects = range.getClientRects();\n      rects = rects[isDirTop ? 0 : rects.length - 1];\n      const globalScroll = core.getGlobalScrollOffset();\n      let scrollLeft = globalScroll.left;\n      let scrollTop = globalScroll.top;\n      const editorWidth = topArea.offsetWidth;\n\n      const offsets = event._getEditorOffsets(null);\n\n      const stickyTop = offsets.top;\n      const editorLeft = offsets.left;\n      toolbar.style.top = '-10000px';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n\n      if (!rects) {\n        const node = core.getSelectionNode();\n\n        if (util.isFormatElement(node)) {\n          const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          core.insertNode(zeroWidth, null, false);\n          core.setRange(zeroWidth, 1, zeroWidth, 1);\n\n          core._editorRange();\n\n          rects = core.getRange().getClientRects();\n          rects = rects[isDirTop ? 0 : rects.length - 1];\n        }\n\n        if (!rects) {\n          const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\n          rects = {\n            left: nodeOffset.left,\n            top: nodeOffset.top,\n            right: nodeOffset.left,\n            bottom: nodeOffset.top + node.offsetHeight,\n            noText: true\n          };\n          scrollLeft = 0;\n          scrollTop = 0;\n        }\n\n        isDirTop = true;\n      }\n\n      const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\n\n      const toolbarWidth = toolbar.offsetWidth;\n      const toolbarHeight = toolbar.offsetHeight;\n      const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\n\n      if (iframeRects) {\n        rects = {\n          left: rects.left + iframeRects.left,\n          top: rects.top + iframeRects.top,\n          right: rects.right + iframeRects.right - iframeRects.width,\n          bottom: rects.bottom + iframeRects.bottom - iframeRects.height\n        };\n      }\n\n      event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n\n      if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\n        event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n      }\n\n      if (options.toolbarContainer) {\n        const editorParent = topArea.parentElement;\n        let container = options.toolbarContainer;\n        let left = container.offsetLeft;\n        let top = container.offsetTop;\n\n        while (!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\n          container = container.offsetParent;\n          left += container.offsetLeft;\n          top += container.offsetTop;\n        }\n\n        toolbar.style.left = toolbar.offsetLeft - left + topArea.offsetLeft + 'px';\n        toolbar.style.top = toolbar.offsetTop - top + topArea.offsetTop + 'px';\n      }\n\n      toolbar.style.visibility = '';\n    },\n    _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\n      const padding = 1;\n      const toolbarWidth = toolbar.offsetWidth;\n      const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\n      const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - toolbarWidth / 2 + scrollLeft;\n      const overRight = absoluteLeft + toolbarWidth - editorWidth;\n      let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\n      let resetTop = false;\n      const space = t + (isDirTop ? event._getEditorOffsets(null).top : toolbar.offsetHeight - context.element.wysiwyg.offsetHeight);\n\n      if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\n        isDirTop = true;\n        resetTop = true;\n      } else if (isDirTop && _d.documentElement.offsetTop > space) {\n        isDirTop = false;\n        resetTop = true;\n      }\n\n      if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      toolbar.style.left = _w.Math.floor(l) + 'px';\n      toolbar.style.top = _w.Math.floor(t) + 'px';\n\n      if (isDirTop) {\n        util.removeClass(context.element._arrow, 'se-arrow-up');\n        util.addClass(context.element._arrow, 'se-arrow-down');\n        context.element._arrow.style.top = toolbarHeight + 'px';\n      } else {\n        util.removeClass(context.element._arrow, 'se-arrow-down');\n        util.addClass(context.element._arrow, 'se-arrow-up');\n        context.element._arrow.style.top = -arrowMargin + 'px';\n      }\n\n      const arrow_left = _w.Math.floor(toolbarWidth / 2 + (absoluteLeft - l));\n\n      context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\n    },\n    _showToolbarInline: function () {\n      if (!core._isInline) return;\n      const toolbar = context.element.toolbar;\n      if (options.toolbarContainer) toolbar.style.position = 'relative';else toolbar.style.position = 'absolute';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n      core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\n      core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : -1 - toolbar.offsetHeight) + 'px';\n      if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\n      event.onScroll_window();\n      core._inlineToolbarAttr.isShow = true;\n      toolbar.style.visibility = '';\n    },\n    _hideToolbar: function () {\n      if (!core._notHideToolbar && !core._variable.isFullScreen) {\n        context.element.toolbar.style.display = 'none';\n        core._inlineToolbarAttr.isShow = false;\n      }\n    },\n    onInput_wysiwyg: function (e) {\n      if (core.isReadOnly || core.isDisabled) {\n        e.preventDefault();\n        e.stopPropagation();\n        core.history.go(core.history.getCurrentIndex());\n        return false;\n      }\n\n      core._editorRange(); // user event\n\n\n      if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\n      const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';\n\n      if (!core._charCount(data)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } // history stack\n\n\n      core.history.push(true);\n    },\n    _isUneditableNode: function (range, isFront) {\n      const container = isFront ? range.startContainer : range.endContainer;\n      const offset = isFront ? range.startOffset : range.endOffset;\n      const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\n      const isElement = container.nodeType === 1;\n      let siblingNode;\n\n      if (isElement) {\n        siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\n        return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      } else {\n        siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\n        return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      }\n    },\n    _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\n      if (!selectNode) return null;\n      let siblingNode = selectNode[siblingKey];\n\n      if (!siblingNode) {\n        siblingNode = util.getFormatElement(container);\n        siblingNode = siblingNode ? siblingNode[siblingKey] : null;\n        if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;else return null;\n      }\n\n      return siblingNode;\n    },\n    _onShortcutKey: false,\n    onKeyDown_wysiwyg: function (e) {\n      const keyCode = e.keyCode;\n      const shift = e.shiftKey;\n      const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      const alt = e.altKey;\n      event._IEisComposing = keyCode === 229;\n\n      if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\n        e.preventDefault();\n        return false;\n      }\n\n      core.submenuOff();\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      } // user event\n\n\n      if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\n      /** Shortcuts */\n\n      if (ctrl && event._shortcutCommand(keyCode, shift)) {\n        event._onShortcutKey = true;\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } else if (event._onShortcutKey) {\n        event._onShortcutKey = false;\n      }\n      /** default key action */\n\n\n      let selectionNode = core.getSelectionNode();\n      const range = core.getRange();\n      const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\n      const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\n      let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\n      let rangeEl = util.getRangeFormatElement(formatEl, null);\n\n      switch (keyCode) {\n        case 8:\n          /** backspace key */\n          if (!selectRange) {\n            if (fileComponentName) {\n              e.preventDefault();\n              e.stopPropagation();\n              core.plugins[fileComponentName].destroy.call(core);\n              break;\n            }\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          }\n\n          if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\n            e.preventDefault();\n            e.stopPropagation();\n            return false;\n          }\n\n          if (!selectRange && !formatEl.previousElementSibling && range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))) {\n            // closure range\n            if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            } // maintain default format\n\n\n            if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\n              e.preventDefault();\n              e.stopPropagation();\n\n              if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\n                formatEl.innerHTML = '<br>';\n                const attrs = formatEl.attributes;\n\n                while (attrs[0]) {\n                  formatEl.removeAttribute(attrs[0].name);\n                }\n              } else {\n                const defaultFormat = util.createElement(options.defaultTag);\n                defaultFormat.innerHTML = '<br>';\n                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\n              }\n\n              core.nativeFocus();\n              return false;\n            }\n          } // clean remove tag\n\n\n          if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\n            if (range.collapsed ? selectionNode.textContent.length === 1 : range.endOffset - range.startOffset === selectionNode.textContent.length) {\n              e.preventDefault();\n              let offset = null;\n              let prev = selectionNode.parentNode.previousSibling;\n              const next = selectionNode.parentNode.nextSibling;\n\n              if (!prev) {\n                if (!next) {\n                  prev = util.createElement('BR');\n                  formatEl.appendChild(prev);\n                } else {\n                  prev = next;\n                  offset = 0;\n                }\n              }\n\n              selectionNode.textContent = '';\n              util.removeItemAllParents(selectionNode, null, formatEl);\n              offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\n              core.setRange(prev, offset, prev, offset);\n              break;\n            }\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, true)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // nested list\n\n\n          const commonCon = range.commonAncestorContainer;\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling))) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : range.startOffset === 0 && range.collapsed)) {\n              if (range.startContainer !== range.endContainer) {\n                e.preventDefault();\n                core.removeNode();\n\n                if (range.startContainer.nodeType === 3) {\n                  core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\n                } // history stack\n\n\n                core.history.push(true);\n              } else {\n                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\n\n                if (util.isListCell(prev)) {\n                  e.preventDefault();\n                  let prevLast = prev;\n\n                  if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                    prevLast = prevLast.lastElementChild.lastElementChild;\n\n                    while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                      prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\n                    }\n\n                    prev = prevLast;\n                  }\n\n                  let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\n\n                  if (!con) {\n                    con = util.createTextNode(util.zeroWidthSpace);\n                    rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\n                  }\n\n                  const offset = con.nodeType === 3 ? con.textContent.length : 1;\n                  const children = formatEl.childNodes;\n                  let after = con;\n                  let child = children[0];\n\n                  while (child = children[0]) {\n                    prev.insertBefore(child, after.nextSibling);\n                    after = child;\n                  }\n\n                  util.removeItem(formatEl);\n                  if (rangeEl.children.length === 0) util.removeItem(rangeEl);\n                  core.setRange(con, offset, con, offset); // history stack\n\n                  core.history.push(true);\n                }\n              }\n\n              break;\n            } // detach range\n\n\n            if (!selectRange && range.startOffset === 0) {\n              let detach = true;\n              let comm = commonCon;\n\n              while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\n                if (comm.previousSibling) {\n                  if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\n                    detach = false;\n                    break;\n                  }\n                }\n\n                comm = comm.parentNode;\n              }\n\n              if (detach && rangeEl.parentNode) {\n                e.preventDefault();\n                core.detachRangeFormatElement(rangeEl, util.isListCell(formatEl) ? [formatEl] : null, null, false, false); // history stack\n\n                core.history.push(true);\n                break;\n              }\n            }\n          } // component\n\n\n          if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\n            const prev = formatEl.previousSibling; // select file component\n\n            const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\n\n            if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || ignoreZWS && util.isComponent(prev))) {\n              const fileComponentInfo = core.getFileComponent(prev);\n\n              if (fileComponentInfo) {\n                e.preventDefault();\n                e.stopPropagation();\n                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(prev)) {\n                e.preventDefault();\n                e.stopPropagation();\n                util.removeItem(prev);\n              }\n\n              break;\n            } // delete nonEditable\n\n\n            if (util.isNonEditable(sel.previousSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.previousSibling);\n              break;\n            }\n          }\n\n          break;\n\n        case 46:\n          /** delete key */\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.plugins[fileComponentName].destroy.call(core);\n            break;\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, false)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // component\n\n\n          if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null) && range.startOffset === selectionNode.textContent.length) {\n            const nextEl = formatEl.nextElementSibling;\n            if (!nextEl) break;\n\n            if (util.isComponent(nextEl)) {\n              e.preventDefault();\n\n              if (util.onlyZeroWidthSpace(formatEl)) {\n                util.removeItem(formatEl); // table component\n\n                if (util.isTable(nextEl)) {\n                  let cell = util.getChildElement(nextEl, util.isCell, false);\n                  cell = cell.firstElementChild || cell;\n                  core.setRange(cell, 0, cell, 0);\n                  break;\n                }\n              } // select file component\n\n\n              const fileComponentInfo = core.getFileComponent(nextEl);\n\n              if (fileComponentInfo) {\n                e.stopPropagation();\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(nextEl)) {\n                e.stopPropagation();\n                util.removeItem(nextEl);\n              }\n\n              break;\n            }\n          }\n\n          if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode; // delete nonEditable\n\n            if (sel && util.isNonEditable(sel.nextSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.nextSibling);\n              break;\n            } else if (util.isComponent(sel)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel);\n              break;\n            }\n          } // nested list\n\n\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : range.endOffset === selectionNode.textContent.length && range.collapsed))) {\n            if (range.startContainer !== range.endContainer) core.removeNode();\n            let next = util.getArrayItem(formatEl.children, util.isList, false);\n            next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\n\n            if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\n              e.preventDefault();\n              let con, children;\n\n              if (util.isList(next)) {\n                const child = next.firstElementChild;\n                children = child.childNodes;\n                con = children[0];\n\n                while (children[0]) {\n                  formatEl.insertBefore(children[0], next);\n                }\n\n                util.removeItem(child);\n              } else {\n                con = next.firstChild;\n                children = next.childNodes;\n\n                while (children[0]) {\n                  formatEl.appendChild(children[0]);\n                }\n\n                util.removeItem(next);\n              }\n\n              core.setRange(con, 0, con, 0); // history stack\n\n              core.history.push(true);\n            }\n\n            break;\n          }\n\n          break;\n\n        case 9:\n          /** tab key */\n          if (fileComponentName || options.tabDisable) break;\n          e.preventDefault();\n          if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\n          const isEdge = !range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset);\n          const selectedFormats = core.getSelectedElements(null);\n          selectionNode = core.getSelectionNode();\n          const cells = [];\n          let lines = [];\n          let fc = util.isListCell(selectedFormats[0]),\n              lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\n          let r = {\n            sc: range.startContainer,\n            so: range.startOffset,\n            ec: range.endContainer,\n            eo: range.endOffset\n          };\n\n          for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\n            f = selectedFormats[i];\n\n            if (util.isListCell(f)) {\n              if (!f.previousElementSibling && !shift) {\n                continue;\n              } else {\n                cells.push(f);\n              }\n            } else {\n              lines.push(f);\n            }\n          } // Nested list\n\n\n          if (cells.length > 0 && isEdge && core.plugins.list) {\n            r = core.plugins.list.editInsideList.call(core, shift, cells);\n          } else {\n            // table\n            const tableCell = util.getParentElement(selectionNode, util.isCell);\n\n            if (tableCell && isEdge) {\n              const table = util.getParentElement(tableCell, 'table');\n              const cells = util.getListChildren(table, util.isCell);\n              let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\n              if (idx === cells.length && !shift) idx = 0;\n              if (idx === -1 && shift) idx = cells.length - 1;\n              let moveCell = cells[idx];\n              if (!moveCell) break;\n              moveCell = moveCell.firstElementChild || moveCell;\n              core.setRange(moveCell, 0, moveCell, 0);\n              break;\n            }\n\n            lines = lines.concat(cells);\n            fc = lc = null;\n          } // Lines tab(4)\n\n\n          if (lines.length > 0) {\n            if (!shift) {\n              const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\n\n              if (lines.length === 1) {\n                const textRange = core.insertNode(tabText, null, true);\n                if (!textRange) return false;\n\n                if (!fc) {\n                  r.sc = tabText;\n                  r.so = textRange.endOffset;\n                }\n\n                if (!lc) {\n                  r.ec = tabText;\n                  r.eo = textRange.endOffset;\n                }\n              } else {\n                const len = lines.length - 1;\n\n                for (let i = 0, child; i <= len; i++) {\n                  child = lines[i].firstChild;\n                  if (!child) continue;\n\n                  if (util.isBreak(child)) {\n                    lines[i].insertBefore(tabText.cloneNode(false), child);\n                  } else {\n                    child.textContent = tabText.textContent + child.textContent;\n                  }\n                }\n\n                const firstChild = util.getChildElement(lines[0], 'text', false);\n                const endChild = util.getChildElement(lines[len], 'text', true);\n\n                if (!fc && firstChild) {\n                  r.sc = firstChild;\n                  r.so = 0;\n                }\n\n                if (!lc && endChild) {\n                  r.ec = endChild;\n                  r.eo = endChild.textContent.length;\n                }\n              }\n            } else {\n              const len = lines.length - 1;\n\n              for (let i = 0, line; i <= len; i++) {\n                line = lines[i].childNodes;\n\n                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\n                  child = line[c];\n                  if (!child) break;\n                  if (util.onlyZeroWidthSpace(child)) continue;\n\n                  if (/^\\s{1,4}$/.test(child.textContent)) {\n                    util.removeItem(child);\n                  } else if (/^\\s{1,4}/.test(child.textContent)) {\n                    child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\n                  }\n\n                  break;\n                }\n              }\n\n              const firstChild = util.getChildElement(lines[0], 'text', false);\n              const endChild = util.getChildElement(lines[len], 'text', true);\n\n              if (!fc && firstChild) {\n                r.sc = firstChild;\n                r.so = 0;\n              }\n\n              if (!lc && endChild) {\n                r.ec = endChild;\n                r.eo = endChild.textContent.length;\n              }\n            }\n          }\n\n          core.setRange(r.sc, r.so, r.ec, r.eo); // history stack\n\n          core.history.push(false);\n          break;\n\n        case 13:\n          /** enter key */\n          const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\n\n          if (core._charTypeHTML) {\n            let enterHTML = '';\n\n            if (!shift && freeFormatEl || shift) {\n              enterHTML = '<br>';\n            } else {\n              enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\n            }\n\n            if (!core.checkCharCount(enterHTML, 'byte-html')) {\n              e.preventDefault();\n              return false;\n            }\n          }\n\n          if (!shift) {\n            const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\n\n            if (formatInners && /^H[1-6]$/i.test(formatEl.nodeName) || /^HR$/i.test(formatEl.nodeName)) {\n              e.preventDefault();\n              let temp = null;\n              const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\n\n              if (formatInners && formatInners.length > 0) {\n                temp = formatInners.pop();\n                const innerNode = temp;\n\n                while (formatInners.length > 0) {\n                  temp = temp.appendChild(formatInners.pop());\n                }\n\n                newFormat.appendChild(innerNode);\n              }\n\n              temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\n              core.setRange(temp, 0, temp, 0);\n              break;\n            }\n\n            if (freeFormatEl) {\n              e.preventDefault();\n              const selectionFormat = selectionNode === freeFormatEl;\n              const wSelection = core.getSelection();\n              const children = selectionNode.childNodes,\n                    offset = wSelection.focusOffset,\n                    prev = selectionNode.previousElementSibling,\n                    next = selectionNode.nextSibling;\n\n              if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && (selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || (!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent)) && offset > 0 && util.isBreak(children[offset - 1]) || !selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || !util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))) {\n                if (selectionFormat) util.removeItem(children[offset - 1]);else util.removeItem(selectionNode);\n                const newEl = core.appendFormatTag(freeFormatEl, util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling) ? freeFormatEl.nextElementSibling : null);\n                util.copyFormatAttributes(newEl, freeFormatEl);\n                core.setRange(newEl, 1, newEl, 1);\n                break;\n              }\n\n              if (selectionFormat) {\n                functions.insertHTML(range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1]) ? '<br>' : '<br><br>', true, false);\n                let focusNode = wSelection.focusNode;\n                const wOffset = wSelection.focusOffset;\n\n                if (freeFormatEl === focusNode) {\n                  focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\n                }\n\n                core.setRange(focusNode, 1, focusNode, 1);\n              } else {\n                const focusNext = wSelection.focusNode.nextSibling;\n                const br = util.createElement('BR');\n                core.insertNode(br, null, false);\n                const brPrev = br.previousSibling,\n                      brNext = br.nextSibling;\n\n                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\n                  br.parentNode.insertBefore(br.cloneNode(false), br);\n                  core.setRange(br, 1, br, 1);\n                } else {\n                  core.setRange(brNext, 0, brNext, 0);\n                }\n              }\n\n              event._onShortcutKey = true;\n              break;\n            }\n          }\n\n          if (selectRange) break;\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            const range = core.getRange();\n\n            if (core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\n              e.preventDefault();\n              const newEl = util.createElement('LI');\n              const br = util.createElement('BR');\n              newEl.appendChild(br);\n              formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\n              newEl.appendChild(selectionNode.nextSibling);\n              core.setRange(br, 1, br, 1);\n              break;\n            }\n\n            if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\n              e.preventDefault();\n              let newEl = null;\n\n              if (util.isListCell(rangeEl.parentNode)) {\n                rangeEl = formatEl.parentNode.parentNode.parentNode;\n                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\n\n                if (!newEl) {\n                  const newListCell = util.createElement('LI');\n                  newListCell.innerHTML = '<br>';\n                  rangeEl.insertBefore(newListCell, newEl);\n                  newEl = newListCell;\n                }\n              } else {\n                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling) ? rangeEl.nextElementSibling.nodeName : util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\n                newEl = util.createElement(newFormat);\n                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\n                edge.cc.insertBefore(newEl, edge.ec);\n              }\n\n              newEl.innerHTML = '<br>';\n              util.removeItemAllParents(formatEl, null, null);\n              core.setRange(newEl, 1, newEl, 1);\n              break;\n            }\n          }\n\n          if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\n            e.preventDefault();\n            formatEl = core.appendFormatTag(formatEl, null);\n            core.setRange(formatEl, 0, formatEl, 0);\n          }\n\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            const compContext = context[fileComponentName];\n            const container = compContext._container;\n            const sibling = container.previousElementSibling || container.nextElementSibling;\n            let newEl = null;\n\n            if (util.isListCell(container.parentNode)) {\n              newEl = util.createElement('BR');\n            } else {\n              newEl = util.createElement(util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling) ? sibling.nodeName : options.defaultTag);\n              newEl.innerHTML = '<br>';\n            }\n\n            container.parentNode.insertBefore(newEl, container);\n            core.callPlugin(fileComponentName, function () {\n              if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\n            }, null);\n          }\n\n          break;\n\n        case 27:\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.controllersOff();\n            return false;\n          }\n\n          break;\n      }\n\n      if (shift && keyCode === 16) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tablePlugin = core.plugins.table;\n\n        if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\n          const cell = util.getParentElement(formatEl, util.isCell);\n\n          if (cell) {\n            tablePlugin.onTableCellMultiSelect.call(core, cell, true);\n            return;\n          }\n        }\n      } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\n        e.preventDefault();\n        e.stopPropagation();\n        const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\n\n        if (nbsp && nbsp.container) {\n          core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\n          return;\n        }\n      }\n\n      const textKey = !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && range.collapsed && range.startContainer === range.endContainer && util.isBreak(range.commonAncestorContainer)) {\n        const zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        core.insertNode(zeroWidth, null, false);\n        core.setRange(zeroWidth, 1, zeroWidth, 1);\n      }\n    },\n    onKeyUp_wysiwyg: function (e) {\n      if (event._onShortcutKey) return;\n\n      core._editorRange();\n\n      const keyCode = e.keyCode;\n      const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      const alt = e.altKey;\n\n      if (core.isReadOnly) {\n        if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\n        return;\n      }\n\n      const range = core.getRange();\n      let selectionNode = core.getSelectionNode();\n\n      if (core._isBalloon && (core._isBalloonAlways && keyCode !== 27 || !range.collapsed)) {\n        if (core._isBalloonAlways) {\n          if (keyCode !== 27) event._showToolbarBalloonDelay();\n        } else {\n          event._showToolbarBalloon();\n\n          return;\n        }\n      }\n      /** when format tag deleted */\n\n\n      if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        selectionNode.innerHTML = '';\n        const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\n        oFormatTag.innerHTML = '<br>';\n        selectionNode.appendChild(oFormatTag);\n        core.setRange(oFormatTag, 0, oFormatTag, 0);\n\n        event._applyTagEffects();\n\n        core.history.push(false);\n        return;\n      }\n\n      const formatEl = util.getFormatElement(selectionNode, null);\n      const rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n        selectionNode = core.getSelectionNode();\n      }\n\n      if (event._directionKeyCode.test(keyCode)) {\n        event._applyTagEffects();\n      }\n\n      const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\n        let so = range.startOffset,\n            eo = range.endOffset;\n        const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\n        so = range.startOffset - frontZeroWidthCnt;\n        eo = range.endOffset - frontZeroWidthCnt;\n        selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\n        core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\n      }\n\n      core._charCount(''); // user event\n\n\n      if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return; // history stack\n\n      if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\n        core.history.push(true);\n      }\n    },\n    onScroll_wysiwyg: function (e) {\n      core.controllersOff();\n      if (core._isBalloon) event._hideToolbar(); // user event\n\n      if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\n    },\n    onFocus_wysiwyg: function (e) {\n      if (core._antiBlur) return;\n      core.hasFocus = true;\n\n      event._applyTagEffects();\n\n      if (core._isInline) event._showToolbarInline(); // user event\n\n      if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\n    },\n    onBlur_wysiwyg: function (e) {\n      if (core._antiBlur || core._variable.isCodeView) return;\n      core.hasFocus = false;\n      core.controllersOff();\n      if (core._isInline || core._isBalloon) event._hideToolbar();\n\n      core._setKeyEffect([]);\n\n      core._variable.currentNodes = [];\n      core._variable.currentNodesMap = [];\n      if (options.showPathLabel) context.element.navigation.textContent = ''; // user event\n\n      if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\n    },\n    onMouseDown_resizingBar: function (e) {\n      e.stopPropagation();\n      core.submenuOff();\n      core.controllersOff();\n      const prevHeight = util.getNumber(context.element.wysiwygFrame.style.height, 0);\n      core._variable.resizeClientY = e.clientY;\n      context.element.resizeBackground.style.display = 'block';\n\n      function closureFunc() {\n        context.element.resizeBackground.style.display = 'none';\n\n        _d.removeEventListener('mousemove', event._resize_editor);\n\n        _d.removeEventListener('mouseup', closureFunc);\n\n        if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(util.getNumber(context.element.wysiwygFrame.style.height, 0), prevHeight, core);\n      }\n\n      _d.addEventListener('mousemove', event._resize_editor);\n\n      _d.addEventListener('mouseup', closureFunc);\n    },\n    _resize_editor: function (e) {\n      const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\n      context.element.wysiwygFrame.style.height = context.element.code.style.height = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval) + 'px';\n      core._variable.resizeClientY = e.clientY;\n    },\n    onResize_window: function () {\n      core.controllersOff();\n      const responsiveSize = event._responsiveButtonSize;\n\n      if (responsiveSize) {\n        let w = 0;\n\n        if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\n          w = context.element.topArea.offsetWidth;\n        } else {\n          w = context.element.toolbar.offsetWidth;\n        }\n\n        let responsiveWidth = 'default';\n\n        for (let i = 1, len = responsiveSize.length; i < len; i++) {\n          if (w < responsiveSize[i]) {\n            responsiveWidth = responsiveSize[i] + '';\n            break;\n          }\n        }\n\n        if (event._responsiveCurrentSize !== responsiveWidth) {\n          event._responsiveCurrentSize = responsiveWidth;\n          functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\n        }\n      }\n\n      if (context.element.toolbar.offsetWidth === 0) return;\n\n      if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\n        context.fileBrowser.body.style.maxHeight = _w.innerHeight - context.fileBrowser.header.offsetHeight - 50 + 'px';\n      }\n\n      if (core.submenuActiveButton && core.submenu) {\n        core._setMenuPosition(core.submenuActiveButton, core.submenu);\n      }\n\n      if (core._variable.isFullScreen) {\n        core._variable.innerHeight_fullScreen += _w.innerHeight - context.element.toolbar.offsetHeight - core._variable.innerHeight_fullScreen;\n        context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\n        return;\n      }\n\n      if (core._variable.isCodeView && core._isInline) {\n        event._showToolbarInline();\n\n        return;\n      }\n\n      core._iframeAutoHeight();\n\n      if (core._sticky) {\n        context.element.toolbar.style.width = context.element.topArea.offsetWidth - 2 + 'px';\n        event.onScroll_window();\n      }\n    },\n    onScroll_window: function () {\n      if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\n      const element = context.element;\n      const editorHeight = element.editorArea.offsetHeight;\n      const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\n      const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\n      const inlineOffset = core._isInline && y - editorTop > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\n\n      if (y < editorTop) {\n        event._offStickyToolbar();\n      } else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\n        if (!core._sticky) event._onStickyToolbar(inlineOffset);\n        element.toolbar.style.top = inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize + 'px';\n      } else if (y >= editorTop) {\n        event._onStickyToolbar(inlineOffset);\n      }\n    },\n    _getEditorOffsets: function (container) {\n      let offsetEl = container || context.element.topArea;\n      let t = 0,\n          l = 0,\n          s = 0;\n\n      while (offsetEl) {\n        t += offsetEl.offsetTop;\n        l += offsetEl.offsetLeft;\n        s += offsetEl.scrollTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      return {\n        top: t,\n        left: l,\n        scroll: s\n      };\n    },\n    _getPageBottomSpace: function () {\n      return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\n    },\n    _onStickyToolbar: function (inlineOffset) {\n      const element = context.element;\n\n      if (!core._isInline && !options.toolbarContainer) {\n        element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\n        element._stickyDummy.style.display = 'block';\n      }\n\n      element.toolbar.style.top = options.stickyToolbar + inlineOffset + 'px';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\n      util.addClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = true;\n    },\n    _offStickyToolbar: function () {\n      const element = context.element;\n      element._stickyDummy.style.display = 'none';\n      element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\n      element.editorArea.style.marginTop = '';\n      util.removeClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = false;\n    },\n    _codeViewAutoHeight: function () {\n      context.element.code.style.height = context.element.code.scrollHeight + 'px';\n    },\n    // FireFox - table delete, Chrome - image, video, audio\n    _hardDelete: function () {\n      const range = core.getRange();\n      const sc = range.startContainer;\n      const ec = range.endContainer; // table\n\n      const sCell = util.getRangeFormatElement(sc);\n      const eCell = util.getRangeFormatElement(ec);\n      const sIsCell = util.isCell(sCell);\n      const eIsCell = util.isCell(eCell);\n      const ancestor = range.commonAncestorContainer;\n\n      if ((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling || eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling) && sCell !== eCell) {\n        if (!sIsCell) {\n          util.removeItem(util.getParentElement(eCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else if (!eIsCell) {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n          core.nativeFocus();\n          return true;\n        }\n      } // component\n\n\n      const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\n      const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\n      if (sComp) util.removeItem(sComp);\n      if (eComp) util.removeItem(eComp);\n      return false;\n    },\n    onPaste_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\n      if (!clipboardData) return true;\n      return event._dataTransferAction('paste', e, clipboardData);\n    },\n    _setClipboardComponent: function (e, info, clipboardData) {\n      e.preventDefault();\n      e.stopPropagation();\n      clipboardData.setData('text/html', info.component.outerHTML);\n    },\n    onCopy_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      const info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.addClass(info.component, 'se-component-copy'); // copy effect\n\n        _w.setTimeout(function () {\n          util.removeClass(info.component, 'se-component-copy');\n        }, 150);\n      }\n    },\n    onCut_wysiwyg: function (e) {\n      const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      const info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.removeItem(info.component);\n        core.controllersOff();\n      }\n\n      _w.setTimeout(function () {\n        // history stack\n        core.history.push(false);\n      });\n    },\n    onDrop_wysiwyg: function (e) {\n      if (core.isReadOnly || util.isIE) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      const dataTransfer = e.dataTransfer;\n      if (!dataTransfer) return true;\n      core.removeNode();\n\n      event._setDropLocationSelection(e);\n\n      return event._dataTransferAction('drop', e, dataTransfer);\n    },\n    _setDropLocationSelection: function (e) {\n      if (e.rangeParent) {\n        core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\n      } else if (core._wd.caretRangeFromPoint) {\n        const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\n\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      } else {\n        const r = core.getRange();\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      }\n    },\n    _dataTransferAction: function (type, e, data) {\n      let plainText, cleanData;\n\n      if (util.isIE) {\n        plainText = data.getData('Text');\n        const range = core.getRange();\n        const tempDiv = util.createElement('DIV');\n        const tempRange = {\n          sc: range.startContainer,\n          so: range.startOffset,\n          ec: range.endContainer,\n          eo: range.endOffset\n        };\n        tempDiv.setAttribute('contenteditable', true);\n        tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\n        context.element.relative.appendChild(tempDiv);\n        tempDiv.focus();\n\n        _w.setTimeout(function () {\n          cleanData = tempDiv.innerHTML;\n          util.removeItem(tempDiv);\n          core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\n\n          event._setClipboardData(type, e, plainText, cleanData, data);\n        });\n\n        return true;\n      } else {\n        plainText = data.getData('text/plain');\n        cleanData = data.getData('text/html');\n\n        if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\n          e.preventDefault();\n          e.stopPropagation();\n          return false;\n        }\n      }\n    },\n    _setClipboardData: function (type, e, plainText, cleanData, data) {\n      // MS word, OneNode, Excel\n      const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\n      const onlyText = !cleanData;\n\n      if (!onlyText) {\n        if (MSData) {\n          cleanData = cleanData.replace(/\\n/g, ' ');\n          plainText = plainText.replace(/\\n/g, ' ');\n        } else {\n          cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\n        }\n\n        cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp);\n      } else {\n        cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\n      }\n\n      const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText); // user event - paste\n\n\n      if (type === 'paste' && typeof functions.onPaste === 'function') {\n        const value = functions.onPaste(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // user event - drop\n\n\n      if (type === 'drop' && typeof functions.onDrop === 'function') {\n        const value = functions.onDrop(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // files\n\n\n      const files = data.files;\n\n      if (files.length > 0 && !MSData) {\n        if (/^image/.test(files[0].type) && core.plugins.image) {\n          functions.insertImage(files);\n        }\n\n        return false;\n      }\n\n      if (!maxCharCount) {\n        return false;\n      }\n\n      if (cleanData) {\n        functions.insertHTML(cleanData, true, false);\n        return false;\n      }\n    },\n    onMouseMove_wysiwyg: function (e) {\n      if (core.isDisabled || core.isReadOnly) return false;\n      const component = util.getParentElement(e.target, util.isComponent);\n      const lineBreakerStyle = core._lineBreaker.style;\n\n      if (component && !core.currentControllerName) {\n        const ctxEl = context.element;\n        let scrollTop = 0;\n        let el = ctxEl.wysiwyg;\n\n        do {\n          scrollTop += el.scrollTop;\n          el = el.parentElement;\n        } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\n\n        const wScroll = ctxEl.wysiwyg.scrollTop;\n\n        const offsets = event._getEditorOffsets(null);\n\n        const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\n        const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\n        const c = componentTop + (options.iframe ? scrollTop : offsets.top);\n        const isList = util.isListCell(component.parentNode);\n        let dir = '',\n            top = '';\n\n        if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < c + 20) {\n          top = componentTop;\n          dir = 't';\n        } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > c + component.offsetHeight - 20) {\n          top = componentTop + component.offsetHeight;\n          dir = 'b';\n        } else {\n          lineBreakerStyle.display = 'none';\n          return;\n        }\n\n        core._variable._lineBreakComp = component;\n        core._variable._lineBreakDir = dir;\n        lineBreakerStyle.top = top - wScroll + 'px';\n        core._lineBreakerButton.style.left = util.getOffset(component).left + component.offsetWidth / 2 - 15 + 'px';\n        lineBreakerStyle.display = 'block';\n      } // off line breaker\n      else if (lineBreakerStyle.display !== 'none') {\n          lineBreakerStyle.display = 'none';\n        }\n    },\n    _onMouseDown_lineBreak: function (e) {\n      e.preventDefault();\n    },\n    _onLineBreak: function (e) {\n      e.preventDefault();\n      const component = core._variable._lineBreakComp;\n      const dir = !this ? core._variable._lineBreakDir : this;\n      const isList = util.isListCell(component.parentNode);\n      const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\n      if (!isList) format.innerHTML = '<br>';\n      if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\n      component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\n      core._lineBreaker.style.display = 'none';\n      core._variable._lineBreakComp = null;\n      const focusEl = isList ? format : format.firstChild;\n      core.setRange(focusEl, 1, focusEl, 1); // history stack\n\n      core.history.push(false);\n    },\n    _addEvent: function () {\n      const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      /** toolbar event */\n\n      context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\n      /** editor area */\n\n      eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\n      eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\n      eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\n      eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\n      eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\n      eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\n      eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\n      eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\n      eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\n      eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\n      /** line breaker */\n\n      event._lineBreakerBind = {\n        a: event._onLineBreak.bind(''),\n        t: event._onLineBreak.bind('t'),\n        b: event._onLineBreak.bind('b')\n      };\n      eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\n\n      core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\n\n      core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\n\n      context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\n      context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\n      /** Events are registered only when there is a table plugin.  */\n\n      if (core.plugins.table) {\n        eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {\n          passive: true,\n          useCapture: false\n        });\n      }\n      /** code view area auto line */\n\n\n      if (options.height === 'auto' && !options.codeMirrorEditor) {\n        context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\n      }\n      /** resizingBar */\n\n\n      if (context.element.resizingBar) {\n        if (/\\d+/.test(options.height)) {\n          context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\n        } else {\n          util.addClass(context.element.resizingBar, 'se-resizing-none');\n        }\n      }\n      /** window event */\n\n\n      event._setResponsiveToolbar();\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n\n      _w.addEventListener('resize', event.onResize_window, false);\n\n      if (options.stickyToolbar > -1) {\n        _w.addEventListener('scroll', event.onScroll_window, false);\n      }\n    },\n    _removeEvent: function () {\n      const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\n      eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\n      eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\n      eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\n      eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\n      eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\n      eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\n      eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\n      eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\n      eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\n      eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\n      eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\n\n      core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\n\n      core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\n\n      context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\n      context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\n      event._lineBreakerBind = null;\n      eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {\n        passive: true,\n        useCapture: false\n      });\n      eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\n      eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\n      context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\n\n      if (context.element.resizingBar) {\n        context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\n      }\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n    },\n    _setResponsiveToolbar: function () {\n      if (_responsiveButtons.length === 0) {\n        _responsiveButtons = null;\n        return;\n      }\n\n      event._responsiveCurrentSize = 'default';\n      const sizeArray = event._responsiveButtonSize = [];\n      const buttonsObj = event._responsiveButtons = {\n        default: _responsiveButtons[0]\n      };\n\n      for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\n        buttonGroup = _responsiveButtons[i];\n        size = buttonGroup[0] * 1;\n        sizeArray.push(size);\n        buttonsObj[size] = buttonGroup[1];\n      }\n\n      sizeArray.sort(function (a, b) {\n        return a - b;\n      }).unshift('default');\n    }\n  };\n  /** functions */\n\n  const functions = {\n    /**\r\n     * @description Core, Util object\r\n     */\n    core: core,\n    util: util,\n\n    /**\r\n     * @description Event functions\r\n     * @param {Object} e Event Object\r\n     * @param {Object} core Core object\r\n     */\n    onload: null,\n    onScroll: null,\n    onMouseDown: null,\n    onClick: null,\n    onInput: null,\n    onKeyDown: null,\n    onKeyUp: null,\n    onCopy: null,\n    onCut: null,\n    onFocus: null,\n    onBlur: null,\n\n    /**\r\n     * @description Event functions\r\n     * @param {String} contents Current contents\r\n     * @param {Object} core Core object\r\n     */\n    onChange: null,\n\n    /**\r\n     * @description Event functions (drop, paste)\r\n     * When false is returned, the default behavior is stopped.\r\n     * If the string is returned, the cleanData value is modified to the return value.\r\n     * @param {Object} e Event object.\r\n     * @param {String} cleanData HTML string modified for editor format.\r\n     * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean|String}\r\n     */\n    onDrop: null,\n    onPaste: null,\n\n    /**\r\n     * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n     * @param {Element} toolbar Toolbar Element\r\n     * @param {Object} context The editor's context object (editor.getContext())\r\n     * @param {Object} core Core object\r\n     */\n    showInline: null,\n\n    /**\r\n     * @description Called just after the controller is positioned and displayed on the screen.\r\n     * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n     * @param {String} name The name of the plugin that called the controller\r\n     * @param {Array} controllers Array of Controller elements\r\n     * @param {Object} core Core object\r\n     */\n    showController: null,\n\n    /**\r\n     * @description An event when toggling between code view and wysiwyg view.\r\n     * @param {Boolean} isCodeView Whether the current code view mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleCodeView: null,\n\n    /**\r\n     * @description An event when toggling full screen.\r\n     * @param {Boolean} isFullScreen Whether the current full screen mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleFullScreen: null,\n\n    /**\r\n     * @description It replaces the default callback function of the image upload\r\n     * @param {Object} response Response object\r\n     * @param {Object} info Input information\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * @param {Object} core Core object\r\n     */\n    imageUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the video upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * @param core Core object\r\n     */\n    videoUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the audio upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * @param core Core object\r\n     */\n    audioUploadHandler: null,\n\n    /**\r\n     * @description Called before the image is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no image upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onImageUploadBefore: null,\n\n    /**\r\n     * @description Called before the video is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no video(iframe, video) upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onVideoUploadBefore: null,\n\n    /**\r\n     * @description Called before the audio is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no audio upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onAudioUploadBefore: null,\n\n    /**\r\n     * @description Called when the image is uploaded, updated, deleted\r\n     * @param {Element} targetElement Target element\r\n     * @param {Number} index Uploaded index\r\n     * @param {String} state Upload status ('create', 'update', 'delete')\r\n     * @param {Object} info Image info object\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n     * @param {Object} core Core object\r\n     */\n    onImageUpload: null,\n\n    /**\r\n    * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onVideoUpload: null,\n\n    /**\r\n    * @description Called when the audio is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onAudioUpload: null,\n\n    /**\r\n     * @description Called when the image is upload failed\r\n     * @param {String} errorMessage Error message\r\n     * @param {Object} result Response Object\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean}\r\n     */\n    onImageUploadError: null,\n\n    /**\r\n     * @description Called when the video(iframe, video) upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onVideoUploadError: null,\n\n    /**\r\n     * @description Called when the audio upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onAudioUploadError: null,\n\n    /**\r\n     * @description Called when the editor is resized using the bottom bar\r\n     */\n    onResizeEditor: null,\n\n    /**\r\n     * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n     * You cannot set a new plugin for the button.\r\n     * @param {Array} buttonList Button list \r\n     */\n    setToolbarButtons: function (buttonList) {\n      core.submenuOff();\n      core.containerOff();\n\n      const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\n\n      _responsiveButtons = newToolbar.responsiveButtons;\n      core._moreLayerActiveButton = null;\n\n      event._setResponsiveToolbar();\n\n      context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\n\n      const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\n\n      context.element = newContext.element;\n      context.tool = newContext.tool;\n      if (options.iframe) context.element.wysiwyg = core._wd.body;\n\n      core._cachingButtons();\n\n      core.history._resetCachingButton();\n\n      core.activePlugins = [];\n      const oldCallButtons = pluginCallButtons;\n      pluginCallButtons = newToolbar.pluginCallButtons;\n      let plugin, button, oldButton;\n\n      for (let key in pluginCallButtons) {\n        if (!util.hasOwn(pluginCallButtons, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if (plugin.active && button) {\n          oldButton = oldCallButtons[key];\n          core.callPlugin(key, null, oldButton || button);\n\n          if (oldButton) {\n            button.parentElement.replaceChild(oldButton, button);\n            pluginCallButtons[key] = oldButton;\n          }\n        }\n      }\n\n      if (core.hasFocus) event._applyTagEffects();\n      if (core._variable.isCodeView) util.addClass(core._styleCommandMap.codeView, 'active');\n      if (core._variable.isFullScreen) util.addClass(core._styleCommandMap.fullScreen, 'active');\n      if (util.hasClass(context.element.wysiwyg, 'se-show-block')) util.addClass(core._styleCommandMap.showBlocks, 'active');\n    },\n\n    /**\r\n     * @description Add or reset option property (Editor is reloaded)\r\n     * @param {Object} _options Options\r\n     */\n    setOptions: function (_options) {\n      event._removeEvent();\n\n      core._resetComponents();\n\n      util.removeClass(core._styleCommandMap.showBlocks, 'active');\n      util.removeClass(core._styleCommandMap.codeView, 'active');\n      core._variable.isCodeView = false;\n      core._iframeAuto = null;\n      core.plugins = _options.plugins || core.plugins;\n      const mergeOptions = [options, _options].reduce(function (init, option) {\n        for (let key in option) {\n          if (!util.hasOwn(option, key)) continue;\n\n          if (key === 'plugins' && option[key] && init[key]) {\n            let i = init[key],\n                o = option[key];\n            i = i.length ? i : _w.Object.keys(i).map(function (name) {\n              return i[name];\n            });\n            o = o.length ? o : _w.Object.keys(o).map(function (name) {\n              return o[name];\n            });\n            init[key] = o.filter(function (val) {\n              return i.indexOf(val) === -1;\n            }).concat(i);\n          } else {\n            init[key] = option[key];\n          }\n        }\n\n        return init;\n      }, {});\n      const el = context.element;\n      const _initHTML = el.wysiwyg.innerHTML; // set option\n\n      const cons = _Constructor._setOptions(mergeOptions, context, options);\n\n      if (cons.callButtons) {\n        pluginCallButtons = cons.callButtons;\n        core.initPlugins = {};\n      }\n\n      if (cons.plugins) {\n        core.plugins = plugins = cons.plugins;\n      } // reset context\n\n\n      if (el._menuTray.children.length === 0) this._menuTray = {};\n      _responsiveButtons = cons.toolbar.responsiveButtons;\n      core.options = options = mergeOptions;\n      core.lang = lang = options.lang;\n\n      if (options.iframe) {\n        el.wysiwygFrame.addEventListener('load', function () {\n          util._setIframeDocument(this, options);\n\n          core._setOptionsInit(el, _initHTML);\n        });\n      }\n\n      el.editorArea.appendChild(el.wysiwygFrame);\n\n      if (!options.iframe) {\n        core._setOptionsInit(el, _initHTML);\n      }\n    },\n\n    /**\r\n     * @description Set \"options.defaultStyle\" style.\r\n     * Define the style of the edit area\r\n     * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n     * @param {String} style Style string\r\n     */\n    setDefaultStyle: function (style) {\n      const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\n\n      const el = context.element; // top area\n\n      el.topArea.style.cssText = newStyles.top; // code view\n\n      el.code.style.cssText = options._editorStyles.frame;\n      el.code.style.display = 'none';\n\n      if (options.height === 'auto') {\n        el.code.style.overflow = 'hidden';\n      } else {\n        el.code.style.overflow = '';\n      } // wysiwyg frame\n\n\n      if (!options.iframe) {\n        el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\n      } else {\n        el.wysiwygFrame.style.cssText = newStyles.frame;\n        el.wysiwyg.style.cssText = newStyles.editor;\n      }\n    },\n\n    /**\r\n     * @description Open a notice area\r\n     * @param {String} message Notice message\r\n     */\n    noticeOpen: function (message) {\n      core.notice.open.call(core, message);\n    },\n\n    /**\r\n     * @description Close a notice area\r\n     */\n    noticeClose: function () {\n      core.notice.close.call(core);\n    },\n\n    /**\r\n     * @description Copying the contents of the editor to the original textarea\r\n     */\n    save: function () {\n      context.element.originElement.value = core.getContents(false);\n    },\n\n    /**\r\n     * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n     * @returns {Object}\r\n     */\n    getContext: function () {\n      return context;\n    },\n\n    /**\r\n     * @description Gets the contents of the suneditor\r\n     * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getContents: function (onlyContents) {\n      return core.getContents(onlyContents);\n    },\n\n    /**\r\n     * @description Gets only the text of the suneditor contents\r\n     * @returns {String}\r\n     */\n    getText: function () {\n      return context.element.wysiwyg.textContent;\n    },\n\n    /**\r\n     * @description Get the editor's number of characters or binary data size.\r\n     * You can use the \"charCounterType\" option format.\r\n     * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n     * If argument is no value, the currently set \"charCounterType\" option is used.\r\n     * @returns {Number}\r\n     */\n    getCharCount: function (charCounterType) {\n      charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\n      return core.getCharLength(core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent, charCounterType);\n    },\n\n    /**\r\n     * @description Gets uploaded images informations\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @returns {Array}\r\n     */\n    getImagesInfo: function () {\n      return context.image ? context.image._infoList : [];\n    },\n\n    /**\r\n     * @description Gets uploaded files(plugin using fileManager) information list.\r\n     * image: [img], video: [video, iframe], audio: [audio]\r\n     * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {String} pluginName Plugin name (image, video, audio)\r\n     * @returns {Array}\r\n     */\n    getFilesInfo: function (pluginName) {\n      return context[pluginName] ? context[pluginName]._infoList : [];\n    },\n\n    /**\r\n     * @description Upload images using image plugin\r\n     * @param {FileList} files FileList\r\n     */\n    insertImage: function (files) {\n      if (!core.plugins.image || !files) return;\n      if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);else core.plugins.image.submitAction.call(core, files);\n      core.focus();\n    },\n\n    /**\r\n     * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n     * @param {Element|String} html HTML Element or HTML string or plain string\r\n     * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n     */\n    insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\n      if (typeof html === 'string') {\n        if (!notCleaningData) html = core.cleanHTML(html, null);\n\n        try {\n          const dom = _d.createRange().createContextualFragment(html);\n\n          const domTree = dom.childNodes;\n\n          if (checkCharCount) {\n            const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\n            let checkHTML = '';\n\n            for (let i = 0, len = domTree.length; i < len; i++) {\n              checkHTML += domTree[i][type];\n            }\n\n            if (!core.checkCharCount(checkHTML, null)) return;\n          }\n\n          let c, a, t, prev, firstCon;\n\n          while (c = domTree[0]) {\n            if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\n              prev = c;\n              util.removeItem(c);\n              continue;\n            }\n\n            t = core.insertNode(c, a, false);\n            a = t.container || t;\n            if (!firstCon) firstCon = t;\n            prev = c;\n          }\n\n          if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\n          const offset = a.nodeType === 3 ? t.endOffset || a.textContent.length : a.childNodes.length;\n          if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);else core.setRange(a, offset, a, offset);\n        } catch (error) {\n          if (core.isDisabled || core.isReadOnly) return;\n          console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\n          core.execCommand('insertHTML', false, html);\n        }\n      } else {\n        if (util.isComponent(html)) {\n          core.insertComponent(html, false, checkCharCount, false);\n        } else {\n          let afterNode = null;\n\n          if (util.isFormatElement(html) || util.isMedia(html)) {\n            afterNode = util.getFormatElement(core.getSelectionNode(), null);\n          }\n\n          core.insertNode(html, afterNode, checkCharCount);\n        }\n      }\n\n      core.effectNode = null;\n      core.focus(); // history stack\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Change the contents of the suneditor\r\n     * @param {String|undefined} contents Contents to Input\r\n     */\n    setContents: function (contents) {\n      core.setContents(contents);\n    },\n\n    /**\r\n     * @description Add contents to the suneditor\r\n     * @param {String} contents Contents to Input\r\n     */\n    appendContents: function (contents) {\n      const convertValue = core.convertContentsForEditor(contents);\n\n      if (!core._variable.isCodeView) {\n        const temp = util.createElement('DIV');\n        temp.innerHTML = convertValue;\n        const wysiwyg = context.element.wysiwyg;\n        const children = temp.children;\n\n        for (let i = 0, len = children.length; i < len; i++) {\n          wysiwyg.appendChild(children[i]);\n        }\n      } else {\n        core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue));\n      } // history stack\n\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Switch to or off \"ReadOnly\" mode.\r\n     * @param {Boolean} value \"readOnly\" boolean value.\r\n     */\n    readOnly: function (value) {\n      core.isReadOnly = value;\n\n      if (value) {\n        context.element.code.setAttribute(\"readOnly\", \"true\");\n      } else {\n        context.element.code.removeAttribute(\"readOnly\");\n      }\n\n      util.setDisabledButtons(!!value, core.resizingDisabledButtons);\n      if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\n    },\n\n    /**\r\n     * @description Disable the suneditor\r\n     */\n    disabled: function () {\n      context.tool.cover.style.display = 'block';\n      context.element.wysiwyg.setAttribute('contenteditable', false);\n      core.isDisabled = true;\n\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.setOption('readOnly', true);\n      } else {\n        context.element.code.setAttribute('disabled', 'disabled');\n      }\n    },\n\n    /**\r\n     * @description Enable the suneditor\r\n     */\n    enabled: function () {\n      context.tool.cover.style.display = 'none';\n      context.element.wysiwyg.setAttribute('contenteditable', true);\n      core.isDisabled = false;\n\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.setOption('readOnly', false);\n      } else {\n        context.element.code.removeAttribute('disabled');\n      }\n    },\n\n    /**\r\n     * @description Show the suneditor\r\n     */\n    show: function () {\n      const topAreaStyle = context.element.topArea.style;\n      if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\n    },\n\n    /**\r\n     * @description Hide the suneditor\r\n     */\n    hide: function () {\n      context.element.topArea.style.display = 'none';\n    },\n\n    /**\r\n     * @description Destroy the suneditor\r\n     */\n    destroy: function () {\n      /** off menus */\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      if (core.notice) core.notice.close.call(core);\n      if (core.modalForm) core.plugins.dialog.close.call(core);\n      /** remove history */\n\n      core.history._destroy();\n      /** remove event listeners */\n\n\n      event._removeEvent();\n      /** remove element */\n\n\n      util.removeItem(context.element.toolbar);\n      util.removeItem(context.element.topArea);\n      /** remove object reference */\n\n      for (let k in core.functions) {\n        if (util.hasOwn(core, k)) delete core.functions[k];\n      }\n\n      for (let k in core) {\n        if (util.hasOwn(core, k)) delete core[k];\n      }\n\n      for (let k in event) {\n        if (util.hasOwn(event, k)) delete event[k];\n      }\n\n      for (let k in context) {\n        if (util.hasOwn(context, k)) delete context[k];\n      }\n\n      for (let k in pluginCallButtons) {\n        if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k];\n      }\n      /** remove user object */\n\n\n      for (let k in this) {\n        if (util.hasOwn(this, k)) delete this[k];\n      }\n    },\n\n    /**\r\n     * @description Toolbar methods\r\n     */\n    toolbar: {\n      /**\r\n       * @description Disable the toolbar\r\n       */\n      disabled: function () {\n        context.tool.cover.style.display = 'block';\n      },\n\n      /**\r\n       * @description Enable the toolbar\r\n       */\n      enabled: function () {\n        context.tool.cover.style.display = 'none';\n      },\n\n      /**\r\n       * @description Show the toolbar\r\n       */\n      show: function () {\n        if (core._isInline) {\n          event._showToolbarInline();\n        } else {\n          context.element.toolbar.style.display = '';\n          context.element._stickyDummy.style.display = '';\n        }\n      },\n\n      /**\r\n       * @description Hide the toolbar\r\n       */\n      hide: function () {\n        if (core._isInline) {\n          event._hideToolbar();\n        } else {\n          context.element.toolbar.style.display = 'none';\n          context.element._stickyDummy.style.display = 'none';\n        }\n      }\n    }\n  };\n  /************ Core init ************/\n  // functions\n\n  core.functions = functions;\n  core.options = options; // Create to sibling node\n\n  let contextEl = context.element;\n  let originEl = contextEl.originElement;\n  let topEl = contextEl.topArea;\n  originEl.style.display = 'none';\n  topEl.style.display = 'block'; // init\n\n  if (options.iframe) {\n    contextEl.wysiwygFrame.addEventListener('load', function () {\n      util._setIframeDocument(this, options);\n\n      core._editorInit(false, options.value);\n\n      options.value = null;\n    });\n  } // insert editor element\n\n\n  if (typeof originEl.nextElementSibling === 'object') {\n    originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\n  } else {\n    originEl.parentNode.appendChild(topEl);\n  }\n\n  contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\n  contextEl = originEl = topEl = null; // init\n\n  if (!options.iframe) {\n    core._editorInit(false, options.value);\n\n    options.value = null;\n  }\n\n  return functions;\n}","map":{"version":3,"sources":["/Users/emilessung/dev/psy-website/node_modules/suneditor/src/lib/core.js"],"names":["_Constructor","_Context","_history","_util","_notice","context","pluginCallButtons","plugins","lang","options","_responsiveButtons","_d","element","originElement","ownerDocument","document","_w","defaultView","window","util","icons","core","_parser","DOMParser","_wd","_ww","_shadowRoot","_shadowRootControllerEventTarget","functions","wwComputedStyle","getComputedStyle","wysiwyg","notice","history","initPlugins","_targetPlugins","_menuTray","effectNode","submenu","container","_submenuName","_bindedSubmenuOff","_bindedContainerOff","submenuActiveButton","containerActiveButton","controllerArray","currentControllerName","currentControllerTarget","currentFileComponentInfo","codeViewDisabledButtons","resizingDisabledButtons","_moreLayerActiveButton","_htmlCheckWhitelistRegExp","_disallowedTextTagsRegExp","editorTagsWhitelistRegExp","pasteTagsWhitelistRegExp","hasFocus","isDisabled","isReadOnly","_attributesWhitelistRegExp","_attributesTagsWhitelist","_bindControllersOff","_isInline","_isBalloon","_isBalloonAlways","_inlineToolbarAttr","top","width","isShow","_notHideToolbar","_sticky","_antiBlur","_lineBreaker","_lineBreakerButton","_componentsInfoInit","_componentsInfoReset","activePlugins","managedTagsInfo","_charTypeHTML","_fileInfoPluginsCheck","_fileInfoPluginsReset","_fileManager","tags","regExp","queryString","pluginRegExp","pluginMap","commandMap","_styleCommandMap","_defaultCommand","bold","textTags","underline","italic","strike","subscript","sub","superscript","sup","_variable","isChanged","isCodeView","isFullScreen","innerHeight_fullScreen","resizeClientY","tabSize","codeIndent","minResizingSize","getNumber","wysiwygFrame","style","minHeight","currentNodes","currentNodesMap","_range","_selectionNode","_originCssText","topArea","cssText","_bodyOverflow","_editorAreaOriginCssText","_wysiwygOriginCssText","_codeOriginCssText","_fullScreenAttrs","sticky","balloon","inline","_lineBreakComp","_lineBreakDir","callPlugin","pluginName","callBackFunction","_target","Error","add","initMenuTarget","active","push","addModule","moduleArray","i","len","length","moduleName","name","getGlobalScrollOffset","t","l","el","scrollTop","scrollLeft","parentElement","host","left","target","menu","appendChild","getAttribute","submenuOn","controllersOff","submenuName","_setMenuPosition","submenuOff","bind","addDocEvent","on","call","removeDocEvent","display","removeClass","containerOn","containerName","_containerName","containerOff","visibility","height","addClass","toolbar","toolbarW","offsetWidth","toolbarOffset","event","_getEditorOffsets","menuW","offsetLeft","rtl","elementW","rtlW","rtlL","overLeft","offsetEl","offsetTop","offsetParent","bt","offsetHeight","toolbarTop","menuHeight","menuHeight_bottom","innerHeight","menuTop","insTop","menuHeight_top","controllersOn","arg","arguments","hasClass","getFileComponent","indexOf","addEventListener","e","preventDefault","stopPropagation","showController","contains","test","type","keyCode","lineBreaker_t","lineBreaker_b","setControllerPosition","controller","referEl","position","addOffset","offset","getOffset","topMargin","controllerW","referElW","allow","firstElementChild","overSize","execCommand","command","showDefaultUI","value","nativeFocus","caption","getParentElement","getSelectionNode","focus","_editorRange","iframe","range","getRange","startContainer","endContainer","isWysiwygDiv","currentNode","commonAncestorContainer","children","startOffset","isFormatElement","isComponent","format","createElement","defaultTag","br","insertBefore","setRange","endOffset","_applyTagEffects","_toggleToolbarBalloon","focusEdge","focusEl","lastElementChild","fileComponentInfo","selectComponent","getChildElement","current","childNodes","nodeType","textContent","blur","startCon","startOff","endCon","endOff","createRange","setStart","setEnd","error","console","warn","selection","getSelection","removeAllRanges","addRange","removeRange","_setKeyEffect","_createDefaultRange","collapsed","isCollapsed","focusNode","rangeCount","getRangeAt","sc","anchorNode","ec","so","anchorOffset","eo","focusOffset","compareValue","compareElements","rightDir","ancestor","result","getRange_addLine","_selectionVoid","op","innerHTML","nextElementSibling","selectionNode","firstChild","extentNode","comm","nodeName","isMediaComponent","_resetRangeToTextNode","tempCon","tempOffset","tempChild","lastChild","isBreak","onlyBreak","nextSibling","getFormatElement","getRangeFormatElement","isCell","parentNode","emptyText","createTextNode","zeroWidthSpace","previousElementSibling","previousSibling","removeItem","getSelectedElements","validation","trim","commonCon","lineNodes","getListChildren","isRangeFormatElement","unshift","startLine","endLine","startIdx","endIdx","onlyTable","isTable","startRangeEl","endRangeEl","isListCell","sameRange","line","slice","getSelectedElementsAndComponents","removeDuplicate","myComponent","selectedLines","component","j","splice","isEdgePoint","dir","nodeValue","_isEdgeFormat","node","cloneNode","showLoading","loading","closeLoading","appendFormatTag","formatNode","currentFormatEl","oFormat","isFreeFormatElement","oFormatName","copyTagAttributes","insertComponent","notHistoryPush","checkCharCount","notSelect","r","removeNode","oNode","formatEl","insertNode","depthFormat","splitElement","getElementDepth","onlyZeroWidthSpace","getEdgeChildNodes","className","querySelector","toLowerCase","isUneditableComponent","plugin","setTimeout","select","_setComponentLineBreaker","t_style","b_style","resizing","resizeContainer","isList","componentTop","wScroll","w","afterNode","freeFormat","getFreeFormatElement","isFormats","isMedia","formatRange","originAfter","splitText","c","removeChild","isSameContainer","removedTag","prevContainer","sameParent","oldParent","rangeCon","fNode","cItem","isEmptyLine","_setIntoFreeFormat","previous","next","previousText","nextText","newRange","zeroWidth","_isIgnoreNodeChange","oNodeChildren","lastONode","beforeNode","getListChildNodes","startIndex","getArrayIndex","endIndex","startNode","endNode","remove","item","list","getArrayItem","child","removeItemAllParents","data","undefined","substringData","rc","text","applyRangeFormatElement","rangeElement","rangeLines","linesLoop","nested","fEl","lEl","f","last","standTag","beforeTag","pElement","parentDepth","listParent","lineArr","removeItems","parent","origin","before","cc","originParent","depth","nextLine","nextList","p","edge","detachRangeFormatElement","cLen","removeArray","mergeSameTags","mergeNestedTags","splitRange","selectedFormats","newRangeElement","firstNode","lastNode","rangeEl","newList","insertedNew","reset","moveComplete","appendNode","insNode","sibling","originNode","insChildren","first","_notTextNode","originNext","detachRange","detachNestedList","fChildren","lineIndex","insNext","inner","innerChildren","copyFormatAttributes","rangeParent","rangeRight","removeEmptyNode","childEdge","detachList","rangeArr","listFirst","listLast","passComponent","o","lastIndex","nodeChange","styleArray","removeNodeArray","strictRemove","isRemoveNode","isRemoveFormat","isNonEditable","wRegExp","RegExp","newNodeName","sNode","checkCnt","checkAttrs","checkStyles","ckeckClasses","classList","s","classReg","replace","styleCheck","classCheck","match","start","end","newNode","styleRegExp","classRegExp","removeNodeRegExp","wBoolean","Boolean","_removeCheck","v","checkNode","vNode","tagRemove","originStyle","originClasses","classes","removeAttribute","oneLine","endLength","isRemoveAnchor","arr","n","_isMaintainedNode","_isSizeNode","isSizeNode","_getMaintainedNode","_util_getMaintainedNode","_util_isMaintainedNode","_nodeChange_oneLine","_setCommonListStyle","_nodeChange_endLine","_nodeChange_middleLine","_nodeChange_startLine","childStyle","elStyle","_textTagsMap","fontWeight","fontStyle","color","fontSize","_stripRemoveNode","_isRemove","anchor","newInnerNode","parentCon","sameTag","z","nNodeArray","pNode","isSameNode","startPass","endPass","pCurrent","checkCss","recursionFunc","coverNode","prevNode","textNode","a","m","prevAnchorNode","substr","childNode","pop","anchors","concat","afterAnchorNode","aChildren","aLen","ancestorAnchorNode","textNode_s","textNode_e","replaceChild","rChildren","endConReset","newStartOffset","startPath","getNodePath","mergeEndCon","newEndOffset","endPath","newOffsets","getNodeFromPath","_endContainer","passNode","cloneChild","isTopNode","offsets","path","tempNode","newCssText","newClass","noneChange","actionCall","layer","_showToolbarBalloon","_showToolbarInline","open","action","commandHandler","info","toggleCodeView","toggleFullScreen","indent","undo","redo","removeFormat","print","preview","toggleDisplayBlocks","callBackSave","getContents","save","tool","setAttribute","nodesMap","cmd","cells","shift","marginDir","margin","setStyle","editInsideList","toggleClass","showBlocks","_resourcesStateChange","setDisabledButtons","_setCodeDataToEditor","code","codeMirrorEditor","mode","_arrow","_hideToolbar","codeView","_resetCachingButton","_setEditorDataToCodeView","scrollHeight","refresh","_checkPlaceholder","code_html","_getCodeView","fullPage","parseDocument","parseFromString","headChildren","head","tagName","body","convertContentsForEditor","attrs","attributes","editableClasses","_editableClass","split","codeContents","convertHTMLForCodeView","codeValue","getAttributesToString","outerHTML","_setCodeView","editorArea","_var","toolbarContainer","relative","maxWidth","zIndex","_stickyDummy","overflow","fullScreenOffset","changeElement","reduction","_iframeAutoHeight","marginTop","fullScreen","stickyToolbar","onScroll_window","expansion","contentsHTML","printTemplate","printDocument","getIframeDocument","wDoc","arrts","_printClass","write","links","getElementsByTagName","styles","linkHTML","isIE_Edge","documentMode","StyleMedia","contentWindow","previewTemplate","windowObject","mimeType","setContents","html","convertValue","_resetComponents","setIframeContents","ctx","onlyContents","contents","renderHTML","figcaptions","_makeLine","requireFormat","_disallowedTags","isAnchor","_HTMLConvertor","textArray","tLen","_allowHTMLComments","_tagConvertor","_deleteDisallowedTags","_cleanTags","lowLevelCheck","tAttr","sv","toString","cleanHTML","whitelist","dom","createContextualFragment","_consistencyCheckOfHTML","query","textCompList","querySelectorAll","initMethod","map","domTree","isTextStyleElement","htmlRemoveWhiteSpace","createTagsWhitelist","returnHTML","brReg","isFormat","indentSize","Array","join","lineBR","elementRegTest","elementIndent","nodeRegTest","tag","tagIndent","XMLSerializer","serializeToString","listener","useCapture","removeEventListener","_charCount","inputText","maxCharCount","countType","charCounterType","nextCharCount","getCharLength","_setCharCount","over","count","getCharCount","slicePosition","_callCounterBlink","content","getByteLength","charCounter","charWrapper","_checkComponents","getDoc","setValue","getValue","ignoredList","key","hasOwn","OUTDENT","INDENT","_init","reload","_initHTML","ShadowRoot","shadowRoot","disallowTextTags","Object","keys","allowTextTags","addTagsWhitelist","filter","defaultAttr","_editorTagsWhitelist","pasteTagsWhitelist","regEndStr","_attr","attributesWhitelist","tagsAttr","allAttr","k","_cachingButtons","managedClass","filePluginRegExp","button","checkFileInfo","resetFileInfo","isArray","fileTags","managedTags","method","_placeholder","placeholder","lineBreaker","_onChange_historyStack","contentDocument","_editorStyles","editor","_iframeAuto","_initWysiwygArea","_buttonTray","SUB","SUP","outdent","toUpperCase","onChange","_allowedEmptyNodeList","innerText","_setDefaultFormat","formatName","fileComponent","isNotCheckingNode","_setOptionsInit","_getConstructed","_editorInit","_addEvent","_offStickyToolbar","onResize_window","onload","contextEl","_top","_relative","_toolBar","_editorArea","_wysiwygArea","_codeArea","_resizingBar","resizingBar","_navigation","navigation","_charCounter","_charWrapper","_loading","_lineBreaker_t","_lineBreaker_b","_resizeBack","resizeBackground","_IEisComposing","_lineBreakerBind","_responsiveCurrentSize","_responsiveButtonSize","_directionKeyCode","_nonTextKeyCode","_historyIgnoreKeyCode","_onButtonsCheck","_frontZeroWidthReg","_keyCodeShortcut","_shortcutCommand","keyStr","shortcutsDisable","classOnCheck","commandMapNodes","reverse","showPathLabel","_cancelCaptionEdit","_buttonsEventHandler","onClick_toolbar","disabled","onMouseDown_wysiwyg","onMouseDown","tableCell","tablePlugin","table","_fixedCell","_shift","onTableCellMultiSelect","onClick_wysiwyg","targetElement","href","onClick","figcaption","hideToolbar","oLi","prevLi","_balloonDelay","_showToolbarBalloonDelay","clearTimeout","rangeObj","isDirTop","rects","getClientRects","globalScroll","editorWidth","stickyTop","editorLeft","nodeOffset","right","bottom","noText","arrowMargin","Math","round","toolbarWidth","toolbarHeight","iframeRects","_setToolbarOffset","editorParent","padding","absoluteLeft","overRight","resetTop","space","_getPageBottomSpace","documentElement","floor","arrow_left","showInline","onInput_wysiwyg","go","getCurrentIndex","onInput","_isUneditableNode","isFront","siblingKey","isElement","siblingNode","_isUneditableNode_getSibling","selectNode","_onShortcutKey","onKeyDown_wysiwyg","shiftKey","ctrl","ctrlKey","metaKey","alt","altKey","onKeyDown","selectRange","fileComponentName","destroy","_hardDelete","isClosureFreeFormatElement","isClosureRangeFormatElement","defaultFormat","prev","prevLast","con","after","detach","sel","ignoreZWS","nextEl","cell","tabDisable","isEdge","lines","fc","lc","idx","prevIdx","nextIdx","moveCell","tabText","textRange","endChild","freeFormatEl","enterHTML","formatInners","temp","newFormat","innerNode","selectionFormat","wSelection","newEl","insertHTML","wOffset","focusNext","brPrev","brNext","newListCell","compContext","_container","_element","_ref","isOSX_IOS","nbsp","textKey","onKeyUp_wysiwyg","oFormatTag","zeroWidthRegExp","isComposing","frontZeroWidthCnt","substring","onKeyUp","onScroll_wysiwyg","onScroll","onFocus_wysiwyg","onFocus","onBlur_wysiwyg","onBlur","onMouseDown_resizingBar","prevHeight","clientY","closureFunc","_resize_editor","onResizeEditor","resizeInterval","responsiveSize","responsiveWidth","setToolbarButtons","fileBrowser","area","maxHeight","header","editorHeight","y","scrollY","editorTop","inlineOffset","_onStickyToolbar","scroll","_codeViewAutoHeight","sCell","eCell","sIsCell","eIsCell","sComp","eComp","onPaste_wysiwyg","clipboardData","isIE","_dataTransferAction","_setClipboardComponent","setData","onCopy_wysiwyg","onCopy","onCut_wysiwyg","onCut","onDrop_wysiwyg","dataTransfer","_setDropLocationSelection","rangeOffset","caretRangeFromPoint","clientX","plainText","cleanData","getData","tempDiv","tempRange","_setClipboardData","MSData","onlyText","onPaste","onDrop","files","image","insertImage","onMouseMove_wysiwyg","lineBreakerStyle","ctxEl","pageY","_onMouseDown_lineBreak","_onLineBreak","eventWysiwyg","b","passive","_setResponsiveToolbar","_removeEvent","sizeArray","buttonsObj","default","size","buttonGroup","sort","imageUploadHandler","videoUploadHandler","audioUploadHandler","onImageUploadBefore","onVideoUploadBefore","onAudioUploadBefore","onImageUpload","onVideoUpload","onAudioUpload","onImageUploadError","onVideoUploadError","onAudioUploadError","buttonList","newToolbar","_createToolBar","responsiveButtons","newContext","oldCallButtons","oldButton","setOptions","_options","mergeOptions","reduce","init","option","val","cons","_setOptions","callButtons","_setIframeDocument","setDefaultStyle","newStyles","_setDefaultOptionStyle","frame","noticeOpen","message","noticeClose","close","getContext","getText","getImagesInfo","_infoList","getFilesInfo","submitAction","notCleaningData","rangeSelection","checkHTML","firstCon","appendContents","readOnly","setOption","cover","enabled","show","topAreaStyle","hide","modalForm","dialog","_destroy","originEl","topEl"],"mappings":"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CR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IA1KP;;AA2Kd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAnMP;;AAqMd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IArND;;AAsNb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA1ND;;AA2Nb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA/ND;;AAiOd;AACR;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAxON;;AAyOd;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IA7ON;;AA8Od;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAlPN;;AAoPd;AACR;AACA;AACQhF,IAAAA,cAAc,EAAE,IAvPF;;AAyPd;AACR;AACA;AACA;AACA;AACQI,IAAAA,iBAAiB,EAAE,UAAU6E,UAAV,EAAsB;AACrC/lC,MAAAA,IAAI,CAAC6I,UAAL;AACA7I,MAAAA,IAAI,CAACwJ,YAAL;;AAEA,YAAMw8B,UAAU,GAAGrnC,YAAY,CAACsnC,cAAb,CAA4B3mC,EAA5B,EAAgCymC,UAAhC,EAA4C/lC,IAAI,CAACd,OAAjD,EAA0DE,OAA1D,CAAnB;;AACAC,MAAAA,kBAAkB,GAAG2mC,UAAU,CAACE,iBAAhC;AACAlmC,MAAAA,IAAI,CAAC8B,sBAAL,GAA8B,IAA9B;;AACAkI,MAAAA,KAAK,CAAC26B,qBAAN;;AAEA3lC,MAAAA,OAAO,CAACO,OAAR,CAAgBqK,OAAhB,CAAwB0b,YAAxB,CAAqC0gB,UAAU,CAACrR,WAAhD,EAA6D31B,OAAO,CAACO,OAAR,CAAgBo1B,WAA7E;;AACA,YAAMwR,UAAU,GAAGvnC,QAAQ,CAACI,OAAO,CAACO,OAAR,CAAgBC,aAAjB,EAAgCQ,IAAI,CAACw1B,eAAL,CAAqBx2B,OAAO,CAACO,OAA7B,CAAhC,EAAuEH,OAAvE,CAA3B;;AAEAJ,MAAAA,OAAO,CAACO,OAAR,GAAkB4mC,UAAU,CAAC5mC,OAA7B;AACAP,MAAAA,OAAO,CAAC+oB,IAAR,GAAeoe,UAAU,CAACpe,IAA1B;AACA,UAAI3oB,OAAO,CAACyO,MAAZ,EAAoB7O,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,GAA0BV,IAAI,CAACG,GAAL,CAAS8pB,IAAnC;;AACpBjqB,MAAAA,IAAI,CAACwzB,eAAL;;AACAxzB,MAAAA,IAAI,CAACY,OAAL,CAAawoB,mBAAb;;AAEAppB,MAAAA,IAAI,CAACuD,aAAL,GAAqB,EAArB;AACA,YAAM6iC,cAAc,GAAGnnC,iBAAvB;AACAA,MAAAA,iBAAiB,GAAG+mC,UAAU,CAAC/mC,iBAA/B;AACA,UAAIwY,MAAJ,EAAYkc,MAAZ,EAAoB0S,SAApB;;AACA,WAAK,IAAIrU,GAAT,IAAgB/yB,iBAAhB,EAAmC;AAC/B,YAAI,CAACa,IAAI,CAACmyB,MAAL,CAAYhzB,iBAAZ,EAA+B+yB,GAA/B,CAAL,EAA0C;AAC1Cva,QAAAA,MAAM,GAAGvY,OAAO,CAAC8yB,GAAD,CAAhB;AACA2B,QAAAA,MAAM,GAAG10B,iBAAiB,CAAC+yB,GAAD,CAA1B;;AACA,YAAIva,MAAM,CAACtQ,MAAP,IAAiBwsB,MAArB,EAA6B;AACzB0S,UAAAA,SAAS,GAAGD,cAAc,CAACpU,GAAD,CAA1B;AACAhyB,UAAAA,IAAI,CAAC4G,UAAL,CAAgBorB,GAAhB,EAAqB,IAArB,EAA2BqU,SAAS,IAAI1S,MAAxC;;AACA,cAAI0S,SAAJ,EAAe;AACX1S,YAAAA,MAAM,CAACzrB,aAAP,CAAqBod,YAArB,CAAkC+gB,SAAlC,EAA6C1S,MAA7C;AACA10B,YAAAA,iBAAiB,CAAC+yB,GAAD,CAAjB,GAAyBqU,SAAzB;AACH;AACJ;AACJ;;AAED,UAAIrmC,IAAI,CAACmC,QAAT,EAAmB6H,KAAK,CAACgF,gBAAN;AAEnB,UAAIhP,IAAI,CAAC8E,SAAL,CAAeE,UAAnB,EAA+BlF,IAAI,CAAC6J,QAAL,CAAc3J,IAAI,CAACmE,gBAAL,CAAsBglB,QAApC,EAA8C,QAA9C;AAC/B,UAAInpB,IAAI,CAAC8E,SAAL,CAAeG,YAAnB,EAAiCnF,IAAI,CAAC6J,QAAL,CAAc3J,IAAI,CAACmE,gBAAL,CAAsBwnB,UAApC,EAAgD,QAAhD;AACjC,UAAI7rB,IAAI,CAAC0L,QAAL,CAAcxM,OAAO,CAACO,OAAR,CAAgBmB,OAA9B,EAAuC,eAAvC,CAAJ,EAA6DZ,IAAI,CAAC6J,QAAL,CAAc3J,IAAI,CAACmE,gBAAL,CAAsBukB,UAApC,EAAgD,QAAhD;AAChE,KAvSa;;AAySd;AACR;AACA;AACA;AACQ4d,IAAAA,UAAU,EAAE,UAAUC,QAAV,EAAoB;AAC5Bv8B,MAAAA,KAAK,CAAC46B,YAAN;;AACA5kC,MAAAA,IAAI,CAACqtB,gBAAL;;AAEAvtB,MAAAA,IAAI,CAACsJ,WAAL,CAAiBpJ,IAAI,CAACmE,gBAAL,CAAsBukB,UAAvC,EAAmD,QAAnD;AACA5oB,MAAAA,IAAI,CAACsJ,WAAL,CAAiBpJ,IAAI,CAACmE,gBAAL,CAAsBglB,QAAvC,EAAiD,QAAjD;AACAnpB,MAAAA,IAAI,CAAC8E,SAAL,CAAeE,UAAf,GAA4B,KAA5B;AACAhF,MAAAA,IAAI,CAACy0B,WAAL,GAAmB,IAAnB;AAEAz0B,MAAAA,IAAI,CAACd,OAAL,GAAeqnC,QAAQ,CAACrnC,OAAT,IAAoBc,IAAI,CAACd,OAAxC;AACA,YAAMsnC,YAAY,GAAG,CAACpnC,OAAD,EAAUmnC,QAAV,EAAoBE,MAApB,CAA2B,UAAUC,IAAV,EAAgBC,MAAhB,EAAwB;AACpE,aAAK,IAAI3U,GAAT,IAAgB2U,MAAhB,EAAwB;AACpB,cAAI,CAAC7mC,IAAI,CAACmyB,MAAL,CAAY0U,MAAZ,EAAoB3U,GAApB,CAAL,EAA+B;;AAC/B,cAAIA,GAAG,KAAK,SAAR,IAAqB2U,MAAM,CAAC3U,GAAD,CAA3B,IAAoC0U,IAAI,CAAC1U,GAAD,CAA5C,EAAmD;AAC/C,gBAAIzqB,CAAC,GAAGm/B,IAAI,CAAC1U,GAAD,CAAZ;AAAA,gBAAmB1S,CAAC,GAAGqnB,MAAM,CAAC3U,GAAD,CAA7B;AACAzqB,YAAAA,CAAC,GAAGA,CAAC,CAACE,MAAF,GAAWF,CAAX,GAAe5H,EAAE,CAAC+yB,MAAH,CAAUC,IAAV,CAAeprB,CAAf,EAAkB6nB,GAAlB,CAAsB,UAASznB,IAAT,EAAe;AAAE,qBAAOJ,CAAC,CAACI,IAAD,CAAR;AAAiB,aAAxD,CAAnB;AACA2X,YAAAA,CAAC,GAAGA,CAAC,CAAC7X,MAAF,GAAW6X,CAAX,GAAe3f,EAAE,CAAC+yB,MAAH,CAAUC,IAAV,CAAerT,CAAf,EAAkB8P,GAAlB,CAAsB,UAASznB,IAAT,EAAe;AAAE,qBAAO2X,CAAC,CAAC3X,IAAD,CAAR;AAAiB,aAAxD,CAAnB;AACA++B,YAAAA,IAAI,CAAC1U,GAAD,CAAJ,GAAa1S,CAAC,CAACwT,MAAF,CAAS,UAAS8T,GAAT,EAAc;AAAE,qBAAOr/B,CAAC,CAACmE,OAAF,CAAUk7B,GAAV,MAAmB,CAAC,CAA3B;AAA+B,aAAxD,CAAD,CAA4D7hB,MAA5D,CAAmExd,CAAnE,CAAZ;AACH,WALD,MAKO;AACHm/B,YAAAA,IAAI,CAAC1U,GAAD,CAAJ,GAAY2U,MAAM,CAAC3U,GAAD,CAAlB;AACH;AACJ;;AACD,eAAO0U,IAAP;AACH,OAboB,EAalB,EAbkB,CAArB;AAeA,YAAM3+B,EAAE,GAAG/I,OAAO,CAACO,OAAnB;AACA,YAAM+yB,SAAS,GAAGvqB,EAAE,CAACrH,OAAH,CAAWwR,SAA7B,CA1B4B,CA4B5B;;AACA,YAAM20B,IAAI,GAAGloC,YAAY,CAACmoC,WAAb,CAAyBN,YAAzB,EAAuCxnC,OAAvC,EAAgDI,OAAhD,CAAb;;AAEA,UAAIynC,IAAI,CAACE,WAAT,EAAsB;AAClB9nC,QAAAA,iBAAiB,GAAG4nC,IAAI,CAACE,WAAzB;AACA/mC,QAAAA,IAAI,CAACa,WAAL,GAAmB,EAAnB;AACH;;AAED,UAAIgmC,IAAI,CAAC3nC,OAAT,EAAkB;AACdc,QAAAA,IAAI,CAACd,OAAL,GAAeA,OAAO,GAAG2nC,IAAI,CAAC3nC,OAA9B;AACH,OAtC2B,CAwC5B;;;AACA,UAAI6I,EAAE,CAAChH,SAAH,CAAasN,QAAb,CAAsB5G,MAAtB,KAAiC,CAArC,EAAwC,KAAK1G,SAAL,GAAiB,EAAjB;AACxC1B,MAAAA,kBAAkB,GAAGwnC,IAAI,CAACj9B,OAAL,CAAas8B,iBAAlC;AACAlmC,MAAAA,IAAI,CAACZ,OAAL,GAAeA,OAAO,GAAGonC,YAAzB;AACAxmC,MAAAA,IAAI,CAACb,IAAL,GAAYA,IAAI,GAAGC,OAAO,CAACD,IAA3B;;AAEA,UAAIC,OAAO,CAACyO,MAAZ,EAAoB;AAChB9F,QAAAA,EAAE,CAACvC,YAAH,CAAgBmG,gBAAhB,CAAiC,MAAjC,EAAyC,YAAY;AACjD7L,UAAAA,IAAI,CAACknC,kBAAL,CAAwB,IAAxB,EAA8B5nC,OAA9B;;AACAY,UAAAA,IAAI,CAACu1B,eAAL,CAAqBxtB,EAArB,EAAyBuqB,SAAzB;AACH,SAHD;AAIH;;AAEDvqB,MAAAA,EAAE,CAAC+iB,UAAH,CAAcviB,WAAd,CAA0BR,EAAE,CAACvC,YAA7B;;AAEA,UAAI,CAACpG,OAAO,CAACyO,MAAb,EAAqB;AACjB7N,QAAAA,IAAI,CAACu1B,eAAL,CAAqBxtB,EAArB,EAAyBuqB,SAAzB;AACH;AACJ,KAvWa;;AAyWd;AACR;AACA;AACA;AACA;AACA;AACQ2U,IAAAA,eAAe,EAAE,UAAUxhC,KAAV,EAAiB;AAC9B,YAAMyhC,SAAS,GAAG9nC,OAAO,CAACm1B,aAAR,GAAwBz0B,IAAI,CAACqnC,sBAAL,CAA4B/nC,OAA5B,EAAqCqG,KAArC,CAA1C;;AACA,YAAMsC,EAAE,GAAG/I,OAAO,CAACO,OAAnB,CAF8B,CAI9B;;AACAwI,MAAAA,EAAE,CAAC/B,OAAH,CAAWP,KAAX,CAAiBQ,OAAjB,GAA2BihC,SAAS,CAACrkC,GAArC,CAL8B,CAM9B;;AACAkF,MAAAA,EAAE,CAAC+gB,IAAH,CAAQrjB,KAAR,CAAcQ,OAAd,GAAwB7G,OAAO,CAACm1B,aAAR,CAAsB6S,KAA9C;AACAr/B,MAAAA,EAAE,CAAC+gB,IAAH,CAAQrjB,KAAR,CAAc0D,OAAd,GAAwB,MAAxB;;AACA,UAAI/J,OAAO,CAACsK,MAAR,KAAmB,MAAvB,EAA+B;AAC3B3B,QAAAA,EAAE,CAAC+gB,IAAH,CAAQrjB,KAAR,CAAc4lB,QAAd,GAAyB,QAAzB;AACH,OAFD,MAEO;AACHtjB,QAAAA,EAAE,CAAC+gB,IAAH,CAAQrjB,KAAR,CAAc4lB,QAAd,GAAyB,EAAzB;AACH,OAb6B,CAc9B;;;AACA,UAAI,CAACjsB,OAAO,CAACyO,MAAb,EAAqB;AACjB9F,QAAAA,EAAE,CAACvC,YAAH,CAAgBC,KAAhB,CAAsBQ,OAAtB,GAAgCihC,SAAS,CAACE,KAAV,GAAkBF,SAAS,CAAC1S,MAA5D;AACH,OAFD,MAEO;AACHzsB,QAAAA,EAAE,CAACvC,YAAH,CAAgBC,KAAhB,CAAsBQ,OAAtB,GAAgCihC,SAAS,CAACE,KAA1C;AACAr/B,QAAAA,EAAE,CAACrH,OAAH,CAAW+E,KAAX,CAAiBQ,OAAjB,GAA2BihC,SAAS,CAAC1S,MAArC;AACH;AACJ,KApYa;;AAsYd;AACR;AACA;AACA;AACQ6S,IAAAA,UAAU,EAAE,UAAUC,OAAV,EAAmB;AAC3BtnC,MAAAA,IAAI,CAACW,MAAL,CAAYomB,IAAZ,CAAiB9d,IAAjB,CAAsBjJ,IAAtB,EAA4BsnC,OAA5B;AACH,KA5Ya;;AA8Yd;AACR;AACA;AACQC,IAAAA,WAAW,EAAE,YAAY;AACrBvnC,MAAAA,IAAI,CAACW,MAAL,CAAY6mC,KAAZ,CAAkBv+B,IAAlB,CAAuBjJ,IAAvB;AACH,KAnZa;;AAqZd;AACR;AACA;AACQ8nB,IAAAA,IAAI,EAAE,YAAY;AACd9oB,MAAAA,OAAO,CAACO,OAAR,CAAgBC,aAAhB,CAA8B8N,KAA9B,GAAsCtN,IAAI,CAAC6nB,WAAL,CAAiB,KAAjB,CAAtC;AACH,KA1Za;;AA4Zd;AACR;AACA;AACA;AACQ4f,IAAAA,UAAU,EAAE,YAAY;AACpB,aAAOzoC,OAAP;AACH,KAlaa;;AAoad;AACR;AACA;AACA;AACA;AACQ6oB,IAAAA,WAAW,EAAE,UAAU2F,YAAV,EAAwB;AACjC,aAAOxtB,IAAI,CAAC6nB,WAAL,CAAiB2F,YAAjB,CAAP;AACH,KA3aa;;AA6ad;AACR;AACA;AACA;AACQka,IAAAA,OAAO,EAAE,YAAY;AACjB,aAAO1oC,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,CAAwBiP,WAA/B;AACH,KAnba;;AAqbd;AACR;AACA;AACA;AACA;AACA;AACA;AACQyhB,IAAAA,YAAY,EAAE,UAAUN,eAAV,EAA2B;AACrCA,MAAAA,eAAe,GAAG,OAAOA,eAAP,KAA2B,QAA3B,GAAsCA,eAAtC,GAAwD1xB,OAAO,CAAC0xB,eAAlF;AACA,aAAO9wB,IAAI,CAACgxB,aAAL,CAAoBhxB,IAAI,CAACyD,aAAL,GAAqBzE,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,CAAwBwR,SAA7C,GAAyDlT,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,CAAwBiP,WAArG,EAAmHmhB,eAAnH,CAAP;AACH,KA/ba;;AAicd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ6W,IAAAA,aAAa,EAAE,YAAY;AACvB,aAAO3oC,OAAO,CAACglC,KAAR,GAAgBhlC,OAAO,CAACglC,KAAR,CAAc4D,SAA9B,GAA0C,EAAjD;AACH,KA9ca;;AAgdd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,YAAY,EAAE,UAAUhhC,UAAV,EAAsB;AAChC,aAAO7H,OAAO,CAAC6H,UAAD,CAAP,GAAsB7H,OAAO,CAAC6H,UAAD,CAAP,CAAoB+gC,SAA1C,GAAsD,EAA7D;AACH,KAhea;;AAked;AACR;AACA;AACA;AACQ3D,IAAAA,WAAW,EAAE,UAAUF,KAAV,EAAiB;AAC1B,UAAI,CAAC/jC,IAAI,CAACd,OAAL,CAAa8kC,KAAd,IAAuB,CAACD,KAA5B,EAAmC;AAEnC,UAAI,CAAC/jC,IAAI,CAACa,WAAL,CAAiBmjC,KAAtB,EAA6BhkC,IAAI,CAAC4G,UAAL,CAAgB,OAAhB,EAAyB5G,IAAI,CAACd,OAAL,CAAa8kC,KAAb,CAAmB8D,YAAnB,CAAgCh/B,IAAhC,CAAqC9I,IAArC,EAA2C+jC,KAA3C,CAAzB,EAA4E,IAA5E,EAA7B,KACK/jC,IAAI,CAACd,OAAL,CAAa8kC,KAAb,CAAmB8D,YAAnB,CAAgC7+B,IAAhC,CAAqCjJ,IAArC,EAA2C+jC,KAA3C;AACL/jC,MAAAA,IAAI,CAAC2N,KAAL;AACH,KA5ea;;AA8ed;AACR;AACA;AACA;AACA;AACA;AACA;AACQoxB,IAAAA,UAAU,EAAE,UAAU5R,IAAV,EAAgB4a,eAAhB,EAAiCtxB,cAAjC,EAAiDuxB,cAAjD,EAAiE;AACzE,UAAI,OAAO7a,IAAP,KAAgB,QAApB,EAA8B;AAC1B,YAAI,CAAC4a,eAAL,EAAsB5a,IAAI,GAAGntB,IAAI,CAAC2uB,SAAL,CAAexB,IAAf,EAAqB,IAArB,CAAP;;AACtB,YAAI;AACA,gBAAM0B,GAAG,GAAGvvB,EAAE,CAAC2Q,WAAH,GAAiB6e,wBAAjB,CAA0C3B,IAA1C,CAAZ;;AACA,gBAAMkC,OAAO,GAAGR,GAAG,CAACpf,UAApB;;AAEA,cAAIgH,cAAJ,EAAoB;AAChB,kBAAMvK,IAAI,GAAGlM,IAAI,CAACyD,aAAL,GAAqB,WAArB,GAAmC,aAAhD;AACA,gBAAIwkC,SAAS,GAAG,EAAhB;;AACA,iBAAK,IAAI1gC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG6nB,OAAO,CAAC5nB,MAA9B,EAAsCF,CAAC,GAAGC,GAA1C,EAA+CD,CAAC,EAAhD,EAAoD;AAChD0gC,cAAAA,SAAS,IAAI5Y,OAAO,CAAC9nB,CAAD,CAAP,CAAW2E,IAAX,CAAb;AACH;;AACD,gBAAI,CAAClM,IAAI,CAACyW,cAAL,CAAoBwxB,SAApB,EAA+B,IAA/B,CAAL,EAA2C;AAC9C;;AAED,cAAIpvB,CAAJ,EAAO2L,CAAP,EAAU3c,CAAV,EAAao1B,IAAb,EAAmBiL,QAAnB;;AACA,iBAAQrvB,CAAC,GAAGwW,OAAO,CAAC,CAAD,CAAnB,EAAyB;AACrB,gBAAI4N,IAAI,IAAIA,IAAI,CAACvtB,QAAL,KAAkB,CAA1B,IAA+B8U,CAA/B,IAAoCA,CAAC,CAAC9U,QAAF,KAAe,CAAnD,IAAwD5P,IAAI,CAACiT,OAAL,CAAa8F,CAAb,CAA5D,EAA6E;AACzEokB,cAAAA,IAAI,GAAGpkB,CAAP;AACA/Y,cAAAA,IAAI,CAAC6T,UAAL,CAAgBkF,CAAhB;AACA;AACH;;AACDhR,YAAAA,CAAC,GAAG7H,IAAI,CAAC+W,UAAL,CAAgB8B,CAAhB,EAAmB2L,CAAnB,EAAsB,KAAtB,CAAJ;AACAA,YAAAA,CAAC,GAAG3c,CAAC,CAAC3G,SAAF,IAAe2G,CAAnB;AACA,gBAAI,CAACqgC,QAAL,EAAeA,QAAQ,GAAGrgC,CAAX;AACfo1B,YAAAA,IAAI,GAAGpkB,CAAP;AACH;;AAED,cAAIokB,IAAI,CAACvtB,QAAL,KAAkB,CAAlB,IAAuB8U,CAAC,CAAC9U,QAAF,KAAe,CAA1C,EAA6C8U,CAAC,GAAGyY,IAAJ;AAC7C,gBAAMtwB,MAAM,GAAG6X,CAAC,CAAC9U,QAAF,KAAe,CAAf,GAAoB7H,CAAC,CAACkH,SAAF,IAAeyV,CAAC,CAAC7U,WAAF,CAAclI,MAAjD,GAA0D+c,CAAC,CAAC/U,UAAF,CAAahI,MAAtF;AACA,cAAIugC,cAAJ,EAAoBhoC,IAAI,CAAC8O,QAAL,CAAco5B,QAAQ,CAAChnC,SAAT,IAAsBgnC,QAApC,EAA8CA,QAAQ,CAAC55B,WAAT,IAAwB,CAAtE,EAAyEkW,CAAzE,EAA4E7X,MAA5E,EAApB,KACK3M,IAAI,CAAC8O,QAAL,CAAc0V,CAAd,EAAiB7X,MAAjB,EAAyB6X,CAAzB,EAA4B7X,MAA5B;AACR,SA9BD,CA8BE,OAAOyD,KAAP,EAAc;AACZ,cAAIpQ,IAAI,CAACoC,UAAL,IAAmBpC,IAAI,CAACqC,UAA5B,EAAwC;AACxCgO,UAAAA,OAAO,CAACC,IAAR,CAAa,iCAAiCF,KAA9C;AACApQ,UAAAA,IAAI,CAACmN,WAAL,CAAiB,YAAjB,EAA+B,KAA/B,EAAsCggB,IAAtC;AACH;AACJ,OArCD,MAqCO;AACH,YAAIrtB,IAAI,CAAC0O,WAAL,CAAiB2e,IAAjB,CAAJ,EAA4B;AACxBntB,UAAAA,IAAI,CAACuW,eAAL,CAAqB4W,IAArB,EAA2B,KAA3B,EAAkC1W,cAAlC,EAAkD,KAAlD;AACH,SAFD,MAEO;AACH,cAAI4B,SAAS,GAAG,IAAhB;;AACA,cAAIvY,IAAI,CAACyO,eAAL,CAAqB4e,IAArB,KAA8BrtB,IAAI,CAAC2Y,OAAL,CAAa0U,IAAb,CAAlC,EAAsD;AAClD9U,YAAAA,SAAS,GAAGvY,IAAI,CAACoT,gBAAL,CAAsBlT,IAAI,CAAC0N,gBAAL,EAAtB,EAA+C,IAA/C,CAAZ;AACH;;AACD1N,UAAAA,IAAI,CAAC+W,UAAL,CAAgBoW,IAAhB,EAAsB9U,SAAtB,EAAiC5B,cAAjC;AACH;AACJ;;AAEDzW,MAAAA,IAAI,CAACgB,UAAL,GAAkB,IAAlB;AACAhB,MAAAA,IAAI,CAAC2N,KAAL,GAnDyE,CAqDzE;;AACA3N,MAAAA,IAAI,CAACY,OAAL,CAAawG,IAAb,CAAkB,KAAlB;AACH,KA5iBa;;AA8iBd;AACR;AACA;AACA;AACQ8lB,IAAAA,WAAW,EAAE,UAAUO,QAAV,EAAoB;AAC7BztB,MAAAA,IAAI,CAACktB,WAAL,CAAiBO,QAAjB;AACH,KApjBa;;AAsjBd;AACR;AACA;AACA;AACQ0a,IAAAA,cAAc,EAAE,UAAU1a,QAAV,EAAoB;AAChC,YAAML,YAAY,GAAGptB,IAAI,CAACkqB,wBAAL,CAA8BuD,QAA9B,CAArB;;AAEA,UAAI,CAACztB,IAAI,CAAC8E,SAAL,CAAeE,UAApB,EAAgC;AAC5B,cAAMy5B,IAAI,GAAG3+B,IAAI,CAAC4O,aAAL,CAAmB,KAAnB,CAAb;AACA+vB,QAAAA,IAAI,CAACvsB,SAAL,GAAiBkb,YAAjB;AAEA,cAAM1sB,OAAO,GAAG1B,OAAO,CAACO,OAAR,CAAgBmB,OAAhC;AACA,cAAM2N,QAAQ,GAAGowB,IAAI,CAACpwB,QAAtB;;AACA,aAAK,IAAI9G,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG6G,QAAQ,CAAC5G,MAA/B,EAAuCF,CAAC,GAAGC,GAA3C,EAAgDD,CAAC,EAAjD,EAAqD;AACjD7G,UAAAA,OAAO,CAAC6H,WAAR,CAAoB8F,QAAQ,CAAC9G,CAAD,CAA5B;AACH;AACJ,OATD,MASO;AACHvH,QAAAA,IAAI,CAAC6qB,YAAL,CAAkB7qB,IAAI,CAAC0pB,YAAL,KAAsB,IAAtB,GAA6B1pB,IAAI,CAACyqB,sBAAL,CAA4B2C,YAA5B,CAA/C;AACH,OAd+B,CAgBhC;;;AACAptB,MAAAA,IAAI,CAACY,OAAL,CAAawG,IAAb,CAAkB,KAAlB;AACH,KA5kBa;;AA8kBd;AACR;AACA;AACA;AACQghC,IAAAA,QAAQ,EAAE,UAAU96B,KAAV,EAAiB;AACvBtN,MAAAA,IAAI,CAACqC,UAAL,GAAkBiL,KAAlB;;AAEA,UAAIA,KAAJ,EAAW;AACPtO,QAAAA,OAAO,CAACO,OAAR,CAAgBupB,IAAhB,CAAqBd,YAArB,CAAkC,UAAlC,EAA8C,MAA9C;AACH,OAFD,MAEO;AACHhpB,QAAAA,OAAO,CAACO,OAAR,CAAgBupB,IAAhB,CAAqBhH,eAArB,CAAqC,UAArC;AACH;;AAEDhiB,MAAAA,IAAI,CAAC8oB,kBAAL,CAAwB,CAAC,CAACtb,KAA1B,EAAiCtN,IAAI,CAAC6B,uBAAtC;AACA,UAAIzC,OAAO,CAAC2pB,gBAAZ,EAA8B3pB,OAAO,CAAC2pB,gBAAR,CAAyBsf,SAAzB,CAAmC,UAAnC,EAA+C,CAAC,CAAC/6B,KAAjD;AACjC,KA7lBa;;AA+lBd;AACR;AACA;AACQ8qB,IAAAA,QAAQ,EAAE,YAAY;AAClBp5B,MAAAA,OAAO,CAAC+oB,IAAR,CAAaugB,KAAb,CAAmB7iC,KAAnB,CAAyB0D,OAAzB,GAAmC,OAAnC;AACAnK,MAAAA,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,CAAwBsnB,YAAxB,CAAqC,iBAArC,EAAwD,KAAxD;AACAhoB,MAAAA,IAAI,CAACoC,UAAL,GAAkB,IAAlB;;AAEA,UAAIhD,OAAO,CAAC2pB,gBAAZ,EAA8B;AAC1B3pB,QAAAA,OAAO,CAAC2pB,gBAAR,CAAyBsf,SAAzB,CAAmC,UAAnC,EAA+C,IAA/C;AACH,OAFD,MAEO;AACHrpC,QAAAA,OAAO,CAACO,OAAR,CAAgBupB,IAAhB,CAAqBd,YAArB,CAAkC,UAAlC,EAA8C,UAA9C;AACH;AACJ,KA5mBa;;AA8mBd;AACR;AACA;AACQugB,IAAAA,OAAO,EAAE,YAAY;AACjBvpC,MAAAA,OAAO,CAAC+oB,IAAR,CAAaugB,KAAb,CAAmB7iC,KAAnB,CAAyB0D,OAAzB,GAAmC,MAAnC;AACAnK,MAAAA,OAAO,CAACO,OAAR,CAAgBmB,OAAhB,CAAwBsnB,YAAxB,CAAqC,iBAArC,EAAwD,IAAxD;AACAhoB,MAAAA,IAAI,CAACoC,UAAL,GAAkB,KAAlB;;AAEA,UAAIhD,OAAO,CAAC2pB,gBAAZ,EAA8B;AAC1B3pB,QAAAA,OAAO,CAAC2pB,gBAAR,CAAyBsf,SAAzB,CAAmC,UAAnC,EAA+C,KAA/C;AACH,OAFD,MAEO;AACHrpC,QAAAA,OAAO,CAACO,OAAR,CAAgBupB,IAAhB,CAAqBhH,eAArB,CAAqC,UAArC;AACH;AACJ,KA3nBa;;AA6nBd;AACR;AACA;AACQ0mB,IAAAA,IAAI,EAAE,YAAY;AACd,YAAMC,YAAY,GAAGzpC,OAAO,CAACO,OAAR,CAAgByG,OAAhB,CAAwBP,KAA7C;AACA,UAAIgjC,YAAY,CAACt/B,OAAb,KAAyB,MAA7B,EAAqCs/B,YAAY,CAACt/B,OAAb,GAAuB/J,OAAO,CAAC+J,OAA/B;AACxC,KAnoBa;;AAqoBd;AACR;AACA;AACQu/B,IAAAA,IAAI,EAAE,YAAY;AACd1pC,MAAAA,OAAO,CAACO,OAAR,CAAgByG,OAAhB,CAAwBP,KAAxB,CAA8B0D,OAA9B,GAAwC,MAAxC;AACH,KA1oBa;;AA4oBd;AACR;AACA;AACQyzB,IAAAA,OAAO,EAAE,YAAY;AACjB;AACA58B,MAAAA,IAAI,CAAC6I,UAAL;AACA7I,MAAAA,IAAI,CAACwJ,YAAL;AACAxJ,MAAAA,IAAI,CAAC0I,cAAL;AACA,UAAI1I,IAAI,CAACW,MAAT,EAAiBX,IAAI,CAACW,MAAL,CAAY6mC,KAAZ,CAAkBv+B,IAAlB,CAAuBjJ,IAAvB;AACjB,UAAIA,IAAI,CAAC2oC,SAAT,EAAoB3oC,IAAI,CAACd,OAAL,CAAa0pC,MAAb,CAAoBpB,KAApB,CAA0Bv+B,IAA1B,CAA+BjJ,IAA/B;AAEpB;;AACAA,MAAAA,IAAI,CAACY,OAAL,CAAaioC,QAAb;AAEA;;;AACA7+B,MAAAA,KAAK,CAAC46B,YAAN;AAEA;;;AACA9kC,MAAAA,IAAI,CAAC6T,UAAL,CAAgB3U,OAAO,CAACO,OAAR,CAAgBqK,OAAhC;AACA9J,MAAAA,IAAI,CAAC6T,UAAL,CAAgB3U,OAAO,CAACO,OAAR,CAAgByG,OAAhC;AAEA;;AACA,WAAK,IAAIutB,CAAT,IAAcvzB,IAAI,CAACO,SAAnB,EAA8B;AAAE,YAAIT,IAAI,CAACmyB,MAAL,CAAYjyB,IAAZ,EAAkBuzB,CAAlB,CAAJ,EAA0B,OAAOvzB,IAAI,CAACO,SAAL,CAAegzB,CAAf,CAAP;AAA2B;;AACrF,WAAK,IAAIA,CAAT,IAAcvzB,IAAd,EAAoB;AAAE,YAAIF,IAAI,CAACmyB,MAAL,CAAYjyB,IAAZ,EAAkBuzB,CAAlB,CAAJ,EAA0B,OAAOvzB,IAAI,CAACuzB,CAAD,CAAX;AAAiB;;AACjE,WAAK,IAAIA,CAAT,IAAcvpB,KAAd,EAAqB;AAAE,YAAIlK,IAAI,CAACmyB,MAAL,CAAYjoB,KAAZ,EAAmBupB,CAAnB,CAAJ,EAA2B,OAAOvpB,KAAK,CAACupB,CAAD,CAAZ;AAAkB;;AACpE,WAAK,IAAIA,CAAT,IAAcv0B,OAAd,EAAuB;AAAE,YAAIc,IAAI,CAACmyB,MAAL,CAAYjzB,OAAZ,EAAqBu0B,CAArB,CAAJ,EAA6B,OAAOv0B,OAAO,CAACu0B,CAAD,CAAd;AAAoB;;AAC1E,WAAK,IAAIA,CAAT,IAAct0B,iBAAd,EAAiC;AAAE,YAAIa,IAAI,CAACmyB,MAAL,CAAYhzB,iBAAZ,EAA+Bs0B,CAA/B,CAAJ,EAAuC,OAAOt0B,iBAAiB,CAACs0B,CAAD,CAAxB;AAA8B;AAExG;;;AACA,WAAK,IAAIA,CAAT,IAAc,IAAd,EAAoB;AAAE,YAAIzzB,IAAI,CAACmyB,MAAL,CAAY,IAAZ,EAAkBsB,CAAlB,CAAJ,EAA0B,OAAO,KAAKA,CAAL,CAAP;AAAiB;AACpE,KA1qBa;;AA4qBd;AACR;AACA;AACQ3pB,IAAAA,OAAO,EAAE;AACL;AACZ;AACA;AACYwuB,MAAAA,QAAQ,EAAE,YAAY;AAClBp5B,QAAAA,OAAO,CAAC+oB,IAAR,CAAaugB,KAAb,CAAmB7iC,KAAnB,CAAyB0D,OAAzB,GAAmC,OAAnC;AACH,OANI;;AAQL;AACZ;AACA;AACYo/B,MAAAA,OAAO,EAAE,YAAY;AACjBvpC,QAAAA,OAAO,CAAC+oB,IAAR,CAAaugB,KAAb,CAAmB7iC,KAAnB,CAAyB0D,OAAzB,GAAmC,MAAnC;AACH,OAbI;;AAeL;AACZ;AACA;AACYq/B,MAAAA,IAAI,EAAE,YAAY;AACd,YAAIxoC,IAAI,CAACyC,SAAT,EAAoB;AAChBuH,UAAAA,KAAK,CAAC8c,kBAAN;AACH,SAFD,MAEO;AACH9nB,UAAAA,OAAO,CAACO,OAAR,CAAgBqK,OAAhB,CAAwBnE,KAAxB,CAA8B0D,OAA9B,GAAwC,EAAxC;AACAnK,UAAAA,OAAO,CAACO,OAAR,CAAgB6rB,YAAhB,CAA6B3lB,KAA7B,CAAmC0D,OAAnC,GAA6C,EAA7C;AACH;AACJ,OAzBI;;AA2BL;AACZ;AACA;AACYu/B,MAAAA,IAAI,EAAE,YAAY;AACd,YAAI1oC,IAAI,CAACyC,SAAT,EAAoB;AAChBuH,UAAAA,KAAK,CAACkf,YAAN;AACH,SAFD,MAEO;AACHlqB,UAAAA,OAAO,CAACO,OAAR,CAAgBqK,OAAhB,CAAwBnE,KAAxB,CAA8B0D,OAA9B,GAAwC,MAAxC;AACAnK,UAAAA,OAAO,CAACO,OAAR,CAAgB6rB,YAAhB,CAA6B3lB,KAA7B,CAAmC0D,OAAnC,GAA6C,MAA7C;AACH;AACJ;AArCI;AA/qBK,GAAlB;AAwtBA;AACA;;AACAnJ,EAAAA,IAAI,CAACO,SAAL,GAAiBA,SAAjB;AACAP,EAAAA,IAAI,CAACZ,OAAL,GAAeA,OAAf,CA11P6F,CA41P7F;;AACA,MAAI02B,SAAS,GAAG92B,OAAO,CAACO,OAAxB;AACA,MAAIupC,QAAQ,GAAGhT,SAAS,CAACt2B,aAAzB;AACA,MAAIupC,KAAK,GAAGjT,SAAS,CAAC9vB,OAAtB;AACA8iC,EAAAA,QAAQ,CAACrjC,KAAT,CAAe0D,OAAf,GAAyB,MAAzB;AACA4/B,EAAAA,KAAK,CAACtjC,KAAN,CAAY0D,OAAZ,GAAsB,OAAtB,CAj2P6F,CAm2P7F;;AACA,MAAI/J,OAAO,CAACyO,MAAZ,EAAoB;AAChBioB,IAAAA,SAAS,CAACtwB,YAAV,CAAuBmG,gBAAvB,CAAwC,MAAxC,EAAgD,YAAY;AACxD7L,MAAAA,IAAI,CAACknC,kBAAL,CAAwB,IAAxB,EAA8B5nC,OAA9B;;AACAY,MAAAA,IAAI,CAACy1B,WAAL,CAAiB,KAAjB,EAAwBr2B,OAAO,CAACkO,KAAhC;;AACAlO,MAAAA,OAAO,CAACkO,KAAR,GAAgB,IAAhB;AACH,KAJD;AAKH,GA12P4F,CA42P7F;;;AACA,MAAI,OAAOw7B,QAAQ,CAAC32B,kBAAhB,KAAuC,QAA3C,EAAqD;AACjD22B,IAAAA,QAAQ,CAACz1B,UAAT,CAAoBxE,YAApB,CAAiCk6B,KAAjC,EAAwCD,QAAQ,CAAC32B,kBAAjD;AACH,GAFD,MAEO;AACH22B,IAAAA,QAAQ,CAACz1B,UAAT,CAAoB9K,WAApB,CAAgCwgC,KAAhC;AACH;;AAEDjT,EAAAA,SAAS,CAAChL,UAAV,CAAqBviB,WAArB,CAAiCutB,SAAS,CAACtwB,YAA3C;AACAswB,EAAAA,SAAS,GAAGgT,QAAQ,GAAGC,KAAK,GAAG,IAA/B,CAp3P6F,CAs3P7F;;AACA,MAAI,CAAC3pC,OAAO,CAACyO,MAAb,EAAqB;AACjB7N,IAAAA,IAAI,CAACy1B,WAAL,CAAiB,KAAjB,EAAwBr2B,OAAO,CAACkO,KAAhC;;AACAlO,IAAAA,OAAO,CAACkO,KAAR,GAAgB,IAAhB;AACH;;AAED,SAAO/M,SAAP;AACH","sourcesContent":["/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\r\n'use strict';\r\n\r\nimport _Constructor from './constructor';\r\nimport _Context from './context';\r\nimport _history from './history';\r\nimport _util from './util';\r\nimport _notice from '../plugins/modules/_notice';\r\n\r\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\r\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\r\n    const _d = context.element.originElement.ownerDocument || document;\r\n    const _w = _d.defaultView || window;\r\n    const util = _util;\r\n    const icons = options.icons;\r\n\r\n    /**\r\n     * @description editor core object\r\n     * should always bind this object when registering an event in the plug-in.\r\n     */\r\n    const core = {\r\n        _d: _d,\r\n        _w: _w,\r\n        _parser: new _w.DOMParser(),\r\n\r\n        /**\r\n         * @description Document object of the iframe if created as an iframe || _d\r\n         * @private\r\n         */\r\n        _wd: null,\r\n\r\n        /**\r\n         * @description Window object of the iframe if created as an iframe || _w\r\n         * @private\r\n         */\r\n        _ww: null,\r\n        \r\n        /**\r\n         * @description Closest ShadowRoot to editor if found\r\n         * @private\r\n         */\r\n        _shadowRoot: null,\r\n\r\n        /**\r\n         * @description Block controller mousedown events in \"shadowRoot\" environment\r\n         * @private\r\n         */\r\n        _shadowRootControllerEventTarget: null,\r\n\r\n        /**\r\n         * @description Util object\r\n         */\r\n        util: util,\r\n\r\n        /**\r\n         * @description Functions object\r\n         */\r\n        functions: null,\r\n\r\n        /**\r\n         * @description Editor options\r\n         */\r\n        options: null,\r\n\r\n        /**\r\n         * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n         */\r\n        wwComputedStyle: _w.getComputedStyle(context.element.wysiwyg),\r\n\r\n        /**\r\n         * @description Notice object\r\n         */\r\n        notice: _notice,\r\n\r\n        /**\r\n         * @description Default icons object\r\n         */\r\n        icons: icons,\r\n\r\n        /**\r\n         * @description History object for undo, redo\r\n         */\r\n        history: null,\r\n        \r\n        /**\r\n         * @description Elements and user options parameters of the suneditor\r\n         */\r\n        context: context,\r\n\r\n        /**\r\n         * @description Plugin buttons\r\n         */\r\n        pluginCallButtons: pluginCallButtons,\r\n\r\n        /**\r\n         * @description Loaded plugins\r\n         */\r\n        plugins: plugins || {},\r\n\r\n        /**\r\n         * @description Whether the plugin is initialized\r\n         */\r\n        initPlugins: {},\r\n\r\n        /**\r\n         * @description Object for managing submenu elements\r\n         * @private\r\n         */\r\n        _targetPlugins: {},\r\n\r\n        /**\r\n         * @description Save rendered submenus and containers\r\n         * @private\r\n         */\r\n        _menuTray: {},\r\n\r\n        /**\r\n         * @description loaded language\r\n         */\r\n        lang: lang,\r\n\r\n        /**\r\n         * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n         */\r\n        effectNode: null,\r\n\r\n        /**\r\n         * @description submenu element\r\n         */\r\n        submenu: null,\r\n\r\n        /**\r\n         * @description container element\r\n         */\r\n        container: null,\r\n\r\n        /**\r\n         * @description current subment name\r\n         * @private\r\n         */\r\n        _submenuName: '',\r\n\r\n        /**\r\n         * @description binded submenuOff method\r\n         * @private\r\n         */\r\n        _bindedSubmenuOff: null,\r\n\r\n        /**\r\n         * @description binded containerOff method\r\n         * @private\r\n         */\r\n        _bindedContainerOff: null,\r\n\r\n        /**\r\n         * @description active button element in submenu\r\n         */\r\n        submenuActiveButton: null,\r\n\r\n        /**\r\n         * @description active button element in container\r\n         */\r\n        containerActiveButton: null,\r\n\r\n        /**\r\n         * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n         */\r\n        controllerArray: [],\r\n\r\n        /**\r\n         * @description The name of the plugin that called the currently active controller\r\n         */\r\n        currentControllerName: '',\r\n\r\n        /**\r\n         * @description The target element of current controller\r\n         */\r\n        currentControllerTarget: null,\r\n\r\n        /**\r\n         * @description The file component object of current selected file tag (getFileComponent)\r\n         */\r\n        currentFileComponentInfo: null,\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n         */\r\n        codeViewDisabledButtons: [],\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n         */\r\n        resizingDisabledButtons: [],\r\n\r\n        /**\r\n         * @description active more layer element in submenu\r\n         * @private\r\n         */\r\n        _moreLayerActiveButton: null,\r\n\r\n        /**\r\n         * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * ^(options._editorTagsWhitelist)$\r\n         * @private\r\n         */\r\n        _htmlCheckWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n         * @private\r\n         */\r\n        _disallowedTextTagsRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags whitelist (RegExp object)\r\n         * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n         */\r\n        editorTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag whitelist when pasting (RegExp object)\r\n         * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n         */\r\n        pasteTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor has focus\r\n         */\r\n        hasFocus: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is disabled\r\n         */\r\n        isDisabled: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is readOnly\r\n         */\r\n        isReadOnly: false,\r\n\r\n        /**\r\n         * @description Attributes whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Attributes of tags whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsWhitelist: null,\r\n\r\n        /**\r\n         * @description binded controllersOff method\r\n         * @private\r\n         */\r\n        _bindControllersOff: null,\r\n\r\n        /**\r\n         * @description Is inline mode?\r\n         * @private\r\n         */\r\n        _isInline: null,\r\n\r\n        /**\r\n         * @description Is balloon|balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloon: null,\r\n\r\n        /**\r\n         * @description Is balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloonAlways: null,\r\n\r\n        /**\r\n         * @description Required value when using inline mode to sticky toolbar\r\n         * @private\r\n         */\r\n        _inlineToolbarAttr: {top: '', width: '', isShow: false},\r\n\r\n        /**\r\n         * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n         * @private\r\n         */\r\n        _notHideToolbar: false,\r\n\r\n        /**\r\n         * @description Variable value that sticky toolbar mode\r\n         * @private\r\n         */\r\n        _sticky: false,\r\n\r\n        /**\r\n         * @description Variables for controlling focus and blur events\r\n         * @private\r\n         */\r\n        _antiBlur: false,\r\n\r\n        /**\r\n         * @description Component line breaker element\r\n         * @private\r\n         */\r\n        _lineBreaker: null,\r\n        _lineBreakerButton: null,\r\n\r\n        /**\r\n         * @description If true, (initialize, reset) all indexes of image, video information\r\n         * @private\r\n         */\r\n        _componentsInfoInit: true,\r\n        _componentsInfoReset: false,\r\n\r\n        /**\r\n         * @description Plugins array with \"active\" method.\r\n         * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n         */\r\n        activePlugins: null,\r\n\r\n        /**\r\n         * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n         * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n         * Basic Editor Actions:\r\n         * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n         * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n         * \"managedTagsInfo\" structure ex:\r\n         * managedTagsInfo: {\r\n         *   query: '.__se__xxx, se-xxx'\r\n         *   map: {\r\n         *     '__se__xxx': method.bind(core),\r\n         *     'se-xxx': method.bind(core),\r\n         *   }\r\n         * }\r\n         * @example\r\n         * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n         * managedTagInfo() => {\r\n         *  return {\r\n         *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n         *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n         *    // \"method\" is executed by binding \"core\".\r\n         *    method: function (element) {\r\n         *      // this === core\r\n         *      element.innerHTML = // (rendered html);\r\n         *    }\r\n         *  }\r\n         * }\r\n         */\r\n        managedTagsInfo: null,\r\n\r\n        /**\r\n         * @description cashing: options.charCounterType === 'byte-html'\r\n         * @private\r\n         */\r\n        _charTypeHTML: false,\r\n\r\n        /**\r\n         * @description Array of \"checkFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n         * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsCheck: null,\r\n\r\n        /**\r\n         * @description Array of \"resetFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsReset: null,\r\n\r\n        /**\r\n         * @description Variables for file component management\r\n         * @private\r\n         */\r\n        _fileManager: {\r\n            tags: null,\r\n            regExp: null,\r\n            queryString: null,\r\n            pluginRegExp: null,\r\n            pluginMap: null\r\n        },\r\n\r\n        /**\r\n         * @description Elements that need to change text or className for each selection change\r\n         * After creating the editor, \"activePlugins\" are added.\r\n         * @property {Element} STRONG bold button\r\n         * @property {Element} U underline button\r\n         * @property {Element} EM italic button\r\n         * @property {Element} DEL strike button\r\n         * @property {Element} SUB subscript button\r\n         * @property {Element} SUP superscript button\r\n         * @property {Element} OUTDENT outdent button\r\n         * @property {Element} INDENT indent button\r\n         */\r\n        commandMap: null,\r\n\r\n        /**\r\n         * @description Style button related to edit area\r\n         * @property {Element} fullScreen fullScreen button element\r\n         * @property {Element} showBlocks showBlocks button element\r\n         * @property {Element} codeView codeView button element\r\n         * @private\r\n         */\r\n        _styleCommandMap: null,\r\n\r\n        /**\r\n         * @description Map of default command\r\n         * @private\r\n         */\r\n        _defaultCommand: {\r\n            bold: options.textTags.bold,\r\n            underline: options.textTags.underline,\r\n            italic: options.textTags.italic,\r\n            strike: options.textTags.strike,\r\n            subscript: options.textTags.sub,\r\n            superscript: options.textTags.sup\r\n        },\r\n\r\n        /**\r\n         * @description Variables used internally in editor operation\r\n         * @property {Boolean} isCodeView State of code view\r\n         * @property {Boolean} isFullScreen State of full screen\r\n         * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n         * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n         * @property {Number} tabSize Indent size of tab (4)\r\n         * @property {Number} codeIndent Indent size of Code view mode (2)\r\n         * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n         * @property {Array} currentNodes  An array of the current cursor's node structure\r\n         * @private\r\n         */\r\n        _variable: {\r\n            isChanged: false,\r\n            isCodeView: false,\r\n            isFullScreen: false,\r\n            innerHeight_fullScreen: 0,\r\n            resizeClientY: 0,\r\n            tabSize: 4,\r\n            codeIndent: 2,\r\n            minResizingSize: util.getNumber((context.element.wysiwygFrame.style.minHeight || '65'), 0),\r\n            currentNodes: [],\r\n            currentNodesMap: [],\r\n            _range: null,\r\n            _selectionNode: null,\r\n            _originCssText: context.element.topArea.style.cssText,\r\n            _bodyOverflow: '',\r\n            _editorAreaOriginCssText: '',\r\n            _wysiwygOriginCssText: '',\r\n            _codeOriginCssText: '',\r\n            _fullScreenAttrs: {sticky: false, balloon: false, inline: false},\r\n            _lineBreakComp: null,\r\n            _lineBreakDir: ''\r\n        },\r\n\r\n        /**\r\n         * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n         * If the plugin is added call callBack function.\r\n         * @param {String} pluginName The name of the plugin to call\r\n         * @param {function} callBackFunction Function to be executed immediately after module call\r\n         * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n         */\r\n        callPlugin: function (pluginName, callBackFunction, _target) {\r\n            _target = _target || pluginCallButtons[pluginName];\r\n\r\n            if (!this.plugins[pluginName]) {\r\n                throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\r\n            } else if (!this.initPlugins[pluginName]) {\r\n                this.plugins[pluginName].add(this, _target);\r\n                this.initPlugins[pluginName] = true;\r\n            } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\r\n                this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\r\n            }\r\n\r\n            if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\r\n                this.commandMap[pluginName] = _target;\r\n                this.activePlugins.push(pluginName);\r\n            }\r\n                \r\n            if (typeof callBackFunction === 'function') callBackFunction();\r\n        },\r\n\r\n        /**\r\n         * @description If the module is not added, add the module and call the 'add' function\r\n         * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n         */\r\n        addModule: function (moduleArray) {\r\n            for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\r\n                moduleName = moduleArray[i].name;\r\n                if (!this.plugins[moduleName]) {\r\n                    this.plugins[moduleName] = moduleArray[i];\r\n                }\r\n                if (!this.initPlugins[moduleName]) {\r\n                    this.initPlugins[moduleName] = true;\r\n                    if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current editor-relative scroll offset.\r\n         * @returns {Object} {top, left}\r\n         */\r\n        getGlobalScrollOffset: function () {\r\n            let t = 0, l = 0;\r\n            let el = context.element.topArea;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n            \r\n            el = this._shadowRoot ? this._shadowRoot.host : null;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Method for managing submenu element.\r\n         * You must add the \"submenu\" element using the this method at custom plugin.\r\n         * @param {String} pluginName Plugin name\r\n         * @param {Element|null} target Target button\r\n         * @param {Element} menu Submenu element\r\n         */\r\n        initMenuTarget: function (pluginName, target, menu) {\r\n            if (!target) {\r\n                this._targetPlugins[pluginName] = menu;\r\n            } else {\r\n                context.element._menuTray.appendChild(menu);\r\n                this._targetPlugins[pluginName] = true;\r\n                this._menuTray[target.getAttribute('data-command')] = menu;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enabled submenu\r\n         * @param {Element} element Submenu's button element to call\r\n         */\r\n        submenuOn: function (element) {\r\n            if (this._bindedSubmenuOff) this._bindedSubmenuOff();\r\n            if (this._bindControllersOff) this.controllersOff();\r\n\r\n            const submenuName = this._submenuName = element.getAttribute('data-command');\r\n            const menu = this.submenu = this._menuTray[submenuName];\r\n            this.submenuActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedSubmenuOff = this.submenuOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\r\n\r\n            if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable submenu\r\n         */\r\n        submenuOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedSubmenuOff);\r\n            this._bindedSubmenuOff = null;\r\n\r\n            if (this.submenu) {\r\n                this._submenuName = '';\r\n                this.submenu.style.display = 'none';\r\n                this.submenu = null;\r\n                util.removeClass(this.submenuActiveButton, 'on');\r\n                this.submenuActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Enabled container\r\n         * @param {Element} element Container's button element to call\r\n         */\r\n        containerOn: function (element) {\r\n            if (this._bindedContainerOff) this._bindedContainerOff();\r\n\r\n            const containerName = this._containerName = element.getAttribute('data-command');\r\n            const menu = this.container = this._menuTray[containerName];\r\n            this.containerActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedContainerOff = this.containerOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedContainerOff, false);\r\n\r\n            if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable container\r\n         */\r\n        containerOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedContainerOff);\r\n            this._bindedContainerOff = null;\r\n\r\n            if (this.container) {\r\n                this._containerName = '';\r\n                this.container.style.display = 'none';\r\n                this.container = null;\r\n                util.removeClass(this.containerActiveButton, 'on');\r\n                this.containerActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Set the menu position. (submenu, container)\r\n         * @param {*} element Button element\r\n         * @param {*} menu Menu element\r\n         * @private\r\n         */\r\n        _setMenuPosition: function (element, menu) {\r\n            menu.style.visibility = 'hidden';\r\n            menu.style.display = 'block';\r\n            menu.style.height = '';\r\n            util.addClass(element, 'on');\r\n\r\n            const toolbar = this.context.element.toolbar;\r\n            const toolbarW = toolbar.offsetWidth;\r\n            const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\r\n            const menuW = menu.offsetWidth;\r\n            const l = element.parentElement.offsetLeft + 3;\r\n\r\n            // rtl\r\n            if (options.rtl) {\r\n                const elementW = element.offsetWidth;\r\n                const rtlW = menuW > elementW ? menuW - elementW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : elementW - menuW;\r\n                menu.style.left = (l - rtlW + rtlL) + 'px';\r\n                if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\r\n                    menu.style.left = '0px';\r\n                }\r\n            } else {\r\n                const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\r\n                if (overLeft < 0) menu.style.left = (l + overLeft) + 'px';\r\n                else menu.style.left = l + 'px';\r\n            }\r\n\r\n            // get element top\r\n            let t = 0;\r\n            let offsetEl = element;\r\n            while (offsetEl && offsetEl !== toolbar) {\r\n                t += offsetEl.offsetTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            const bt = t;\r\n            if (this._isBalloon) {\r\n                t += toolbar.offsetTop + element.offsetHeight;\r\n            } else {\r\n                t -= element.offsetHeight;\r\n            }\r\n\r\n            // set menu position\r\n            const toolbarTop = toolbarOffset.top;\r\n            const menuHeight = menu.offsetHeight;\r\n            const scrollTop = this.getGlobalScrollOffset().top;\r\n\r\n            const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\r\n            if (menuHeight_bottom < menuHeight) {\r\n                let menuTop = -1 * (menuHeight - bt + 3);\r\n                const insTop = toolbarTop - scrollTop + menuTop;\r\n                const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\r\n                \r\n                if (menuHeight_top > menuHeight_bottom) {\r\n                    menu.style.height = menuHeight_top + 'px';\r\n                    menuTop = -1 * (menuHeight_top - bt + 3);\r\n                } else {\r\n                    menu.style.height = menuHeight_bottom + 'px';\r\n                    menuTop = bt + element.parentElement.offsetHeight;\r\n                }\r\n\r\n                menu.style.top = menuTop + 'px';\r\n            } else {\r\n                menu.style.top = (bt + element.parentElement.offsetHeight) + 'px';\r\n            }\r\n\r\n            menu.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n         * @param {*} arguments controller elements, functions..\r\n         */\r\n        controllersOn: function () {\r\n            if (this._bindControllersOff) this._bindControllersOff();\r\n            this.controllerArray = [];\r\n\r\n            for (let i = 0, arg; i < arguments.length; i++) {\r\n                arg = arguments[i];\r\n                if (!arg) continue;\r\n                \r\n                if (typeof arg === 'string') {\r\n                    this.currentControllerName = arg;\r\n                    continue;\r\n                }\r\n                if (typeof arg === 'function') {\r\n                    this.controllerArray.push(arg);\r\n                    continue;\r\n                }\r\n                if (!util.hasClass(arg, 'se-controller')) {\r\n                    this.currentControllerTarget = arg;\r\n                    this.currentFileComponentInfo = this.getFileComponent(arg);\r\n                    continue;\r\n                }\r\n                if (arg.style) {\r\n                    arg.style.display = 'block';\r\n                    if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\r\n                        arg.addEventListener('mousedown', function (e) { e.preventDefault(); e.stopPropagation(); });\r\n                        this._shadowRootControllerEventTarget.push(arg);\r\n                    }\r\n                }\r\n                this.controllerArray.push(arg);\r\n            }\r\n\r\n            this._bindControllersOff = this.controllersOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindControllersOff, false);\r\n            this.addDocEvent('keydown', this._bindControllersOff, false);\r\n            this._antiBlur = true;\r\n\r\n            if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\r\n        },\r\n\r\n        /**\r\n         * @description Hide controller at editor area (link button, image resize button..)\r\n         * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n         */\r\n        controllersOff: function (e) {\r\n            this._lineBreaker.style.display = 'none';\r\n            const len = this.controllerArray.length;\r\n\r\n            if (e && e.target && len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\r\n                }\r\n            }\r\n            \r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\r\n            context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\r\n            this._variable._lineBreakComp = null;\r\n\r\n            this.currentControllerName = '';\r\n            this.currentControllerTarget = null;\r\n            this.currentFileComponentInfo = null;\r\n            this.effectNode = null;\r\n            if (!this._bindControllersOff) return;\r\n\r\n            this.removeDocEvent('mousedown', this._bindControllersOff);\r\n            this.removeDocEvent('keydown', this._bindControllersOff);\r\n            this._bindControllersOff = null;\r\n\r\n            if (len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();\r\n                    else this.controllerArray[i].style.display = 'none';\r\n                }\r\n\r\n                this.controllerArray = [];\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Specify the position of the controller.\r\n         * @param {Element} controller Controller element.\r\n         * @param {Element} referEl Element that is the basis of the controller's position.\r\n         * @param {String} position Type of position (\"top\" | \"bottom\")\r\n         * When using the \"top\" position, there should not be an arrow on the controller.\r\n         * When using the \"bottom\" position there should be an arrow on the controller.\r\n         * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n         * This argument is required. - {left: 0, top: 0}\r\n         * Please enter the value based on ltr mode.\r\n         * Calculated automatically in rtl mode.\r\n         */\r\n        setControllerPosition: function (controller, referEl, position, addOffset) {\r\n            if (options.rtl) addOffset.left *= -1;\r\n\r\n            const offset = util.getOffset(referEl, context.element.wysiwygFrame);\r\n            controller.style.visibility = 'hidden';\r\n            controller.style.display = 'block';\r\n\r\n            // Height value of the arrow element is 11px\r\n            const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : (referEl.offsetHeight + 12);\r\n            controller.style.top = (offset.top + topMargin + addOffset.top) + 'px';\r\n\r\n            const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\r\n            const controllerW = controller.offsetWidth;\r\n            const referElW = referEl.offsetWidth;\r\n            \r\n            const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null;\r\n\r\n            // rtl (Width value of the arrow element is 22px)\r\n            if (options.rtl) {\r\n                const rtlW = (controllerW > referElW) ? controllerW - referElW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\r\n                controller.style.left = (l - rtlW + rtlL) + 'px';\r\n                \r\n                if (rtlW > 0) {\r\n                    if (allow) allow.style.left = ((controllerW - 14 < 10 + rtlW) ? (controllerW - 14) : (10 + rtlW)) + 'px';\r\n                }\r\n                \r\n                const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\r\n                if (overSize > 0) {\r\n                    controller.style.left = '0px';\r\n                    if (allow) allow.style.left = overSize + 'px';\r\n                }\r\n            } else {\r\n                controller.style.left = l + 'px';\r\n\r\n                const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\r\n                if (overSize < 0) {\r\n                    controller.style.left = (controller.offsetLeft + overSize) + 'px';\r\n                    if (allow) allow.style.left = (20 - overSize) + 'px';\r\n                } else {\r\n                    if (allow) allow.style.left = '20px';\r\n                }\r\n            }\r\n\r\n            controller.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description javascript execCommand\r\n         * @param {String} command javascript execCommand function property\r\n         * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n         * @param {String|undefined} value javascript execCommand function property\r\n         */\r\n        execCommand: function (command, showDefaultUI, value) {\r\n            this._wd.execCommand(command, showDefaultUI, (command === 'formatBlock' ? '<' + value + '>' : value));\r\n            // history stack\r\n            this.history.push(true);\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area using \"native focus function\"\r\n         */\r\n        nativeFocus: function () {\r\n            const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\r\n            if (caption) {\r\n                caption.focus();\r\n            } else {\r\n                context.element.wysiwyg.focus();\r\n            }\r\n\r\n            this._editorRange();\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area\r\n         */\r\n        focus: function () {\r\n            if (context.element.wysiwygFrame.style.display === 'none') return;\r\n\r\n            if (options.iframe) {\r\n                this.nativeFocus();\r\n            } else {\r\n                try {\r\n                    const range = this.getRange();\r\n                    if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\r\n                        const currentNode = range.commonAncestorContainer.children[range.startOffset];\r\n                        if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\r\n                            const format = util.createElement(options.defaultTag);\r\n                            const br = util.createElement('BR');\r\n                            format.appendChild(br);\r\n                            context.element.wysiwyg.insertBefore(format, currentNode);\r\n                            this.setRange(br, 0, br, 0);\r\n                            return;\r\n                        }\r\n                    }\r\n                    this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\r\n                } catch (e) {\r\n                    this.nativeFocus();\r\n                }\r\n            }\r\n\r\n            event._applyTagEffects();\r\n            if (this._isBalloon) event._toggleToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n         * If \"focusEdge\" is null, then selected last element\r\n         * @param {Element|null} focusEl Focus element\r\n         */\r\n        focusEdge: function (focusEl) {\r\n            if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\r\n\r\n            const fileComponentInfo = this.getFileComponent(focusEl);\r\n            if (fileComponentInfo) {\r\n                this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n            } else if (focusEl) {\r\n                focusEl = util.getChildElement(focusEl, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true);\r\n                if (!focusEl) this.nativeFocus();\r\n                else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\r\n            } else {\r\n                this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focusout to wysiwyg area (.blur())\r\n         */\r\n        blur: function () {\r\n            if (options.iframe) {\r\n                context.element.wysiwygFrame.blur();\r\n            } else {\r\n                context.element.wysiwyg.blur();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set current editor's range object and return.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @returns {Object} Range object.\r\n         */\r\n        setRange: function (startCon, startOff, endCon, endOff) {\r\n            if (!startCon || !endCon) return;\r\n            if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\r\n            if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon;\r\n                endOff = startOff > 1 ? startOff : 0;\r\n            }\r\n            \r\n            const range = this._wd.createRange();\r\n\r\n            try {\r\n                range.setStart(startCon, startOff);\r\n                range.setEnd(endCon, endOff);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.core.focus.error] ' + error);\r\n                this.nativeFocus();\r\n                return;\r\n            }\r\n\r\n            const selection = this.getSelection();\r\n\r\n            if (selection.removeAllRanges) {\r\n                selection.removeAllRanges();\r\n            }\r\n\r\n            selection.addRange(range);\r\n            this._editorRange();\r\n            if (options.iframe) this.nativeFocus();\r\n\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Remove range object and button effect\r\n         */\r\n        removeRange: function () {\r\n            this._variable._range = null;\r\n            this._variable._selectionNode = null;\r\n            if (this.hasFocus) this.getSelection().removeAllRanges();\r\n            this._setKeyEffect([]);\r\n        },\r\n\r\n        /**\r\n         * @description Get current editor's range object\r\n         * @returns {Object}\r\n         */\r\n        getRange: function () {\r\n            const range = this._variable._range || this._createDefaultRange();\r\n            const selection = this.getSelection();\r\n            if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\r\n            \r\n            if (selection.rangeCount > 0) {\r\n                this._variable._range = selection.getRangeAt(0);\r\n                return this._variable._range;\r\n            } else {\r\n                const sc = selection.anchorNode, ec = selection.focusNode, so = selection.anchorOffset, eo = selection.focusOffset;\r\n                const compareValue = util.compareElements(sc, ec);\r\n                const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\r\n                return this.setRange(\r\n                    rightDir ? sc : ec,\r\n                    rightDir ? so : eo,\r\n                    rightDir ? ec : sc,\r\n                    rightDir ? eo : so\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n         * Returns a new \"range\" or argument \"range\".\r\n         * @param {Object} range core.getRange()\r\n         * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n         * @returns {Object} range\r\n         */\r\n        getRange_addLine: function (range, container) {\r\n            if (this._selectionVoid(range)) {\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const op = util.createElement(options.defaultTag);\r\n                op.innerHTML = '<br>';\r\n                wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\r\n                this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\r\n                range = this._variable._range;\r\n            }\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Get window selection obejct\r\n         * @returns {Object}\r\n         */\r\n        getSelection: function () {\r\n            return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\r\n        },\r\n\r\n        /**\r\n         * @description Get current select node\r\n         * @returns {Node}\r\n         */\r\n        getSelectionNode: function () {\r\n            if(!context.element.wysiwyg.contains(this._variable._selectionNode))this._editorRange();\r\n            if (!this._variable._selectionNode) {\r\n                const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false);\r\n                if (!selectionNode){\r\n                    this._editorRange();\r\n                } else {\r\n                    this._variable._selectionNode = selectionNode;\r\n                    return selectionNode;\r\n                }\r\n            }\r\n            return this._variable._selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Saving the range object and the currently selected node of editor\r\n         * @private\r\n         */\r\n        _editorRange: function () {\r\n            const selection = this.getSelection();\r\n            if (!selection) return null;\r\n            let range = null;\r\n            let selectionNode = null;\r\n\r\n            if (selection.rangeCount > 0) {\r\n                range = selection.getRangeAt(0);\r\n            } else {\r\n                range = this._createDefaultRange();\r\n            }\r\n\r\n            this._variable._range = range;\r\n\r\n            if (range.collapsed) {\r\n                if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;\r\n                else selectionNode = range.commonAncestorContainer;\r\n            } else {\r\n                selectionNode = selection.extentNode || selection.anchorNode;\r\n            }\r\n\r\n            this._variable._selectionNode = selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Return the range object of editor's first child node\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _createDefaultRange: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            wysiwyg.focus();\r\n            const range = this._wd.createRange();\r\n\r\n            let focusEl = wysiwyg.firstElementChild;\r\n            if (!focusEl) {\r\n                focusEl = util.createElement(options.defaultTag);\r\n                focusEl.innerHTML = '<br>';\r\n                wysiwyg.appendChild(focusEl);\r\n            }\r\n\r\n            range.setStart(focusEl, 0);\r\n            range.setEnd(focusEl, 0);\r\n            \r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Returns true if there is no valid \"selection\".\r\n         * @param {Object} range core.getRange()\r\n         * @returns {Object} range\r\n         * @private\r\n         */\r\n        _selectionVoid: function (range) {\r\n            const comm = range.commonAncestorContainer;\r\n            return (util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer)) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\r\n        },\r\n\r\n        /**\r\n         * @description Reset range object to text node selected status.\r\n         * @returns {Boolean} Returns false if there is no valid selection.\r\n         * @private\r\n         */\r\n        _resetRangeToTextNode: function () {\r\n            const range = this.getRange();\r\n            if (this._selectionVoid(range)) return false;\r\n            \r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n            let tempCon, tempOffset, tempChild;\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                if (!startCon.childNodes[startOff]) {\r\n                    startCon = startCon.lastChild;\r\n                    startOff = startCon.textContent.length;\r\n                } else {\r\n                    startCon = startCon.childNodes[startOff];\r\n                    startOff = 0;\r\n                }\r\n                while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\r\n                    startCon = startCon.firstChild;\r\n                    startOff = 0;\r\n                }\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\r\n                    endCon = endCon.lastChild;\r\n                }\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            // startContainer\r\n            tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\r\n            tempOffset = startOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\r\n                        tempOffset = 0;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    if (onlyBreak) {\r\n                        if (startCon === endCon) {\r\n                            endCon = tempCon;\r\n                            endOff = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set startContainer\r\n            startCon = tempCon;\r\n            startOff = tempOffset;\r\n\r\n            // endContainer\r\n            tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\r\n            tempOffset = endOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempChild = tempCon.childNodes;\r\n                        if (tempChild.length === 0) break;\r\n                        tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : (tempCon.previousElementSibling || tempCon.previousSibling || startCon);\r\n                        tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    tempOffset = 1;\r\n                    if (onlyBreak && !tempCon.previousSibling) {\r\n                        util.removeItem(endCon);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set endContainer\r\n            endCon = tempCon;\r\n            endOff = tempOffset;\r\n\r\n            // set Range\r\n            this.setRange(startCon, startOff, endCon, endOff);\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n         * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElements: function (validation) {\r\n            if (!this._resetRangeToTextNode()) return [];\r\n            let range = this.getRange();\r\n\r\n            if (util.isWysiwygDiv(range.startContainer)) {\r\n                const children = context.element.wysiwyg.children;\r\n                if (children.length === 0) return [];\r\n\r\n                this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\r\n                range = this.getRange();\r\n            }\r\n\r\n            const startCon = range.startContainer;\r\n            const endCon = range.endContainer;\r\n            const commonCon = range.commonAncestorContainer;\r\n\r\n            // get line nodes\r\n            const lineNodes = util.getListChildren(commonCon, function (current) {\r\n                return validation ? validation(current) : util.isFormatElement(current);\r\n            });\r\n\r\n            if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\r\n            if (startCon === endCon || lineNodes.length === 1) return lineNodes;\r\n\r\n            let startLine = util.getFormatElement(startCon, null);\r\n            let endLine = util.getFormatElement(endCon, null);\r\n            let startIdx = null;\r\n            let endIdx = null;\r\n            \r\n            const onlyTable = function (current) {\r\n                return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\r\n            };\r\n\r\n            let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\r\n            let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\r\n            if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\r\n            if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\r\n            \r\n            const sameRange = startRangeEl === endRangeEl;\r\n            for (let i = 0, len = lineNodes.length, line; i < len; i++) {\r\n                line = lineNodes[i];\r\n\r\n                if (startLine === line || (!sameRange && line === startRangeEl)) {\r\n                    startIdx = i;\r\n                    continue;\r\n                }\r\n\r\n                if (endLine === line || (!sameRange && line === endRangeEl)) {\r\n                    endIdx = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (startIdx === null) startIdx = 0;\r\n            if (endIdx === null) endIdx = lineNodes.length - 1;\r\n\r\n            return lineNodes.slice(startIdx, endIdx + 1);\r\n        },\r\n\r\n        /**\r\n         * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n         * If some of the component are included in the selection, get the entire that component.\r\n         * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElementsAndComponents: function (removeDuplicate) {\r\n            const commonCon = this.getRange().commonAncestorContainer;\r\n            const myComponent = util.getParentElement(commonCon, util.isComponent);\r\n            const selectedLines = util.isTable(commonCon) ? \r\n                this.getSelectedElements(null) :\r\n                this.getSelectedElements(function (current) {\r\n                    const component = this.getParentElement(current, this.isComponent);\r\n                    return (this.isFormatElement(current) && (!component || component === myComponent)) || (this.isComponent(current) && !this.getFormatElement(current));\r\n                }.bind(util));\r\n            \r\n            if (removeDuplicate) {\r\n                for (let i = 0, len = selectedLines.length; i < len; i++) {\r\n                    for (let j = i - 1; j >= 0; j--) {\r\n                        if (selectedLines[j].contains(selectedLines[i])) {\r\n                            selectedLines.splice(i, 1);\r\n                            i--; len--;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return selectedLines;\r\n        },\r\n\r\n        /**\r\n         * @description Determine if this offset is the edge offset of container\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n         * @returns {Boolean}\r\n         */\r\n        isEdgePoint: function (container, offset, dir) {\r\n            return (dir !== 'end' && offset === 0) || ((!dir || dir !== 'front') && !container.nodeValue && offset === 1) || ((!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length);\r\n        },\r\n\r\n        /**\r\n         * @description Check if the container and offset values are the edges of the format tag\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n         * @returns {Array|null}\r\n         * @private\r\n         */\r\n        _isEdgeFormat: function (node, offset, dir) {\r\n            if (!this.isEdgePoint(node, offset, dir)) return false;\r\n\r\n            const result = [];\r\n            dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\r\n            while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\r\n                if (!node[dir] || (util.isBreak(node[dir]) && !node[dir][dir])) {\r\n                    if (node.nodeType === 1) result.push(node.cloneNode(false));\r\n                    node = node.parentNode;\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        /**\r\n         * @description Show loading box\r\n         */\r\n        showLoading: function () {\r\n            context.element.loading.style.display = 'block';\r\n        },\r\n\r\n        /**\r\n         * @description Close loading box\r\n         */\r\n        closeLoading: function () {\r\n            context.element.loading.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Append format element to sibling node of argument element.\r\n         * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n         * If not, the currently selected format tag is inserted.\r\n         * @param {Element} element Insert as siblings of that element\r\n         * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n         * @returns {Element}\r\n         */\r\n        appendFormatTag: function (element, formatNode) {\r\n            if (!element.parentNode) return null;\r\n\r\n            const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\r\n            let oFormat = null;\r\n            if (util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\r\n                oFormat = util.createElement('BR');\r\n            } else {\r\n                const oFormatName = formatNode ? (typeof formatNode === 'string' ? formatNode : formatNode.nodeName) : (util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl)) ? currentFormatEl.nodeName : options.defaultTag;\r\n                oFormat = util.createElement(oFormatName);\r\n                oFormat.innerHTML = '<br>';\r\n                if ((formatNode && typeof formatNode !== 'string') || (!formatNode && util.isFormatElement(currentFormatEl))) {\r\n                    util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\r\n                }\r\n            }\r\n\r\n            if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);\r\n            else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\r\n\r\n            return oFormat;\r\n        },\r\n\r\n        /**\r\n         * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n         * If \"element\" is \"HR\", insert and return the new line.\r\n         * @param {Element} element Element to be inserted\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n         * @returns {Element}\r\n         */\r\n        insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(element, null))) {\r\n                return null;\r\n            }\r\n\r\n            const r = this.removeNode();\r\n            this.getRange_addLine(this.getRange(), r.container);\r\n            let oNode = null;\r\n            let selectionNode = this.getSelectionNode();\r\n            let formatEl = util.getFormatElement(selectionNode, null);\r\n\r\n            if (util.isListCell(formatEl)) {\r\n                this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\r\n                if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\r\n            } else {\r\n                if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current); }.bind(util));\r\n                    oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (oNode) formatEl = oNode.previousSibling;\r\n                }\r\n                this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\r\n                if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\r\n            }\r\n\r\n            this.setRange(element, 0, element, 0);\r\n\r\n            if (!notSelect) {\r\n                const fileComponentInfo = this.getFileComponent(element);\r\n                if (fileComponentInfo) {\r\n                    this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                } else if (oNode) {\r\n                    oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\r\n                    this.setRange(oNode, 0, oNode, 0);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            if (!notHistoryPush) this.history.push(1);\r\n\r\n            return oNode || element;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the file component and that plugin name\r\n         * return: {target, component, pluginName} | null\r\n         * @param {Element} element Target element (figure tag, component div, file tag)\r\n         * @returns {Object|null}\r\n         */\r\n        getFileComponent: function (element) {\r\n            if (!this._fileManager.queryString || !element) return null;\r\n\r\n            let target, pluginName;\r\n            if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\r\n                target = element.querySelector(this._fileManager.queryString);\r\n            }\r\n            if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\r\n                target = element;\r\n            }\r\n\r\n            if (target) {\r\n                pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\r\n                if (pluginName) {\r\n                    return {\r\n                        target: target,\r\n                        component: util.getParentElement(target, util.isComponent),\r\n                        pluginName: pluginName\r\n                    };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        /**\r\n         * @description The component(image, video) is selected and the resizing module is called.\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @param {String} pluginName Plugin name (image, video)\r\n         */\r\n        selectComponent: function (element, pluginName) {\r\n            if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\r\n            if (!this.hasFocus) this.focus();\r\n            const plugin = this.plugins[pluginName];\r\n            if (!plugin) return;\r\n            _w.setTimeout(function () {\r\n                if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\r\n                this._setComponentLineBreaker(element);\r\n            }.bind(this));\r\n        },\r\n\r\n        /**\r\n         * @description Set line breaker of component\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @private\r\n         */\r\n        _setComponentLineBreaker: function (element) {\r\n            // line breaker\r\n            this._lineBreaker.style.display = 'none';\r\n            const container = util.getParentElement(element, util.isComponent);\r\n            const t_style = context.element.lineBreaker_t.style;\r\n            const b_style = context.element.lineBreaker_b.style;\r\n            const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\r\n\r\n            const isList = util.isListCell(container.parentNode);\r\n            let componentTop, wScroll, w;\r\n            // top\r\n            if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\r\n                this._variable._lineBreakComp = container;\r\n                wScroll = context.element.wysiwyg.scrollTop;\r\n                componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                w = (target.offsetWidth / 2) / 2;\r\n\r\n                t_style.top = (componentTop - wScroll - 12) + 'px';\r\n                t_style.left = (util.getOffset(target).left + w) + 'px';\r\n                t_style.display = 'block';\r\n            } else {\r\n                t_style.display = 'none';\r\n            }\r\n            // bottom\r\n            if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\r\n                if (!componentTop) {\r\n                    this._variable._lineBreakComp = container;\r\n                    wScroll = context.element.wysiwyg.scrollTop;\r\n                    componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                    w = (target.offsetWidth / 2) / 2;\r\n                }\r\n\r\n                b_style.top = (componentTop + target.offsetHeight - wScroll - 12) + 'px';\r\n                b_style.left = (util.getOffset(target).left + target.offsetWidth - w - 24) + 'px';\r\n                b_style.display = 'block';\r\n            } else {\r\n                b_style.display = 'none';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Delete selected node and insert argument value node and return.\r\n         * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n         * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n         * @param {Node} oNode Element to be inserted\r\n         * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @returns {Object|Node|null}\r\n         */\r\n        insertNode: function (oNode, afterNode, checkCharCount) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(oNode, null))) {\r\n                return null;\r\n            }\r\n\r\n            const freeFormat = util.getFreeFormatElement(this.getSelectionNode(), null);\r\n            const isFormats = (!freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) || util.isComponent(oNode);\r\n\r\n            if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\r\n                const r = this.removeNode();\r\n                if (r.container.nodeType === 3 || util.isBreak(r.container)) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current) || this.isListCell(current); }.bind(util));\r\n                    afterNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (afterNode) afterNode = afterNode.previousSibling;\r\n                }\r\n            }\r\n\r\n            const range = (!afterNode && !isFormats) ? this.getRange_addLine(this.getRange(), null) : this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startOff = range.startOffset;\r\n            const endOff = range.endOffset;\r\n            const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\r\n            const startCon = formatRange ? (commonCon.childNodes[startOff] || commonCon.childNodes[0]) : range.startContainer;\r\n            const endCon = formatRange ? (commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1]) : range.endContainer;\r\n            let parentNode, originAfter = null;\r\n\r\n            if (!afterNode) {\r\n                parentNode = startCon;\r\n                if (startCon.nodeType === 3) {\r\n                    parentNode = startCon.parentNode;\r\n                }\r\n\r\n                /** No Select range node */\r\n                if (range.collapsed) {\r\n                    if (commonCon.nodeType === 3) {\r\n                        if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);\r\n                        else afterNode = commonCon.nextSibling;\r\n                    } else {\r\n                        if (!util.isBreak(parentNode)) {\r\n                            let c = parentNode.childNodes[startOff];\r\n                            const focusNode = (c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling)) ? c.nextSibling : c;\r\n                            if (focusNode) {\r\n                                if (!focusNode.nextSibling) {\r\n                                    parentNode.removeChild(focusNode);\r\n                                    afterNode = null;\r\n                                } else {\r\n                                    afterNode = (util.isBreak(focusNode) && !util.isBreak(oNode)) ? focusNode : focusNode.nextSibling;\r\n                                }\r\n                            } else {\r\n                                afterNode = null;\r\n                            }\r\n                        } else {\r\n                            afterNode = parentNode;\r\n                            parentNode = parentNode.parentNode;\r\n                        }\r\n                    }\r\n                } else { /** Select range nodes */\r\n                    const isSameContainer = startCon === endCon;\r\n\r\n                    if (isSameContainer) {\r\n                        if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;\r\n                        else afterNode = endCon.splitText(endOff);\r\n\r\n                        let removeNode = startCon;\r\n                        if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\r\n\r\n                        parentNode.removeChild(removeNode);\r\n                        if (parentNode.childNodes.length === 0 && isFormats) {\r\n                            parentNode.innerHTML = '<br>';\r\n                        }\r\n                    }\r\n                    else {\r\n                        const removedTag = this.removeNode();\r\n                        const container = removedTag.container;\r\n                        const prevContainer = removedTag.prevContainer;\r\n                        if (container && container.childNodes.length === 0 && isFormats) {\r\n                            if (util.isFormatElement(container)) {\r\n                                container.innerHTML = '<br>';\r\n                            } else if (util.isRangeFormatElement(container)) {\r\n                                container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n                            }\r\n                        }\r\n\r\n                        if (!isFormats && prevContainer) {\r\n                            parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                            if (parentNode.contains(container)) {\r\n                                let sameParent = true;\r\n                                afterNode = container;\r\n                                while (afterNode.parentNode !== parentNode) {\r\n                                    afterNode = afterNode.parentNode;\r\n                                    sameParent = false;\r\n                                }\r\n                                if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\r\n                            } else {\r\n                                afterNode = null;\r\n                            }\r\n                        } else {\r\n                            afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\r\n                            parentNode = (!afterNode || !afterNode.parentNode) ? commonCon : afterNode.parentNode;\r\n                        }\r\n\r\n                        while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\r\n                            afterNode = afterNode.parentNode;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            // has afterNode\r\n            else {\r\n                parentNode = afterNode.parentNode;\r\n                afterNode = afterNode.nextSibling;\r\n                originAfter = true;\r\n            }\r\n\r\n            // --- insert node ---\r\n            try {\r\n                if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\r\n                    parentNode = context.element.wysiwyg;\r\n                    afterNode = null;\r\n                }\r\n\r\n                if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || (!util.isListCell(parentNode) && util.isComponent(oNode))) {\r\n                    const oldParent = parentNode;\r\n                    if (util.isList(afterNode)) {\r\n                        parentNode = afterNode;\r\n                        afterNode = null;\r\n                    } else if (util.isListCell(afterNode)) {\r\n                        parentNode = afterNode.previousElementSibling || afterNode;\r\n                    } else if (!originAfter && !afterNode) {\r\n                        const r = this.removeNode();\r\n                        const container = r.container.nodeType === 3 ? (util.isListCell(util.getFormatElement(r.container, null)) ? r.container : (util.getFormatElement(r.container, null) || r.container.parentNode)) : r.container;\r\n                        const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\r\n                        parentNode = rangeCon ? container : container.parentNode;\r\n                        afterNode = rangeCon ? null : container.nextSibling;\r\n                    }\r\n\r\n                    if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\r\n                }\r\n\r\n                if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\r\n                    afterNode = parentNode.nextElementSibling;\r\n                    parentNode = parentNode.parentNode;\r\n                }\r\n\r\n                if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\r\n                    const fNode = util.createElement(options.defaultTag);\r\n                    fNode.appendChild(oNode);\r\n                    oNode = fNode;\r\n                }\r\n\r\n                parentNode.insertBefore(oNode, parentNode === afterNode ? parentNode.lastChild : afterNode);\r\n            } catch (e) {\r\n                parentNode.appendChild(oNode);\r\n            } finally {\r\n                if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\r\n                    const cItem = util.getFormatElement(commonCon, null);\r\n                    if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\r\n                        util.removeItem(cItem);\r\n                    }\r\n                }\r\n\r\n                if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\r\n                    oNode = this._setIntoFreeFormat(oNode);\r\n                }\r\n\r\n                if (!util.isComponent(oNode)) {\r\n                    let offset = 1;\r\n                    if (oNode.nodeType === 3) {\r\n                        const previous = oNode.previousSibling;\r\n                        const next = oNode.nextSibling;\r\n                        const previousText = (!previous ||  previous.nodeType === 1 || util.onlyZeroWidthSpace(previous)) ? '' : previous.textContent;\r\n                        const nextText = (!next || next.nodeType === 1 || util.onlyZeroWidthSpace(next)) ? '' : next.textContent;\r\n        \r\n                        if (previous && previousText.length > 0) {\r\n                            oNode.textContent = previousText + oNode.textContent;\r\n                            util.removeItem(previous);\r\n                        }\r\n        \r\n                        if (next && next.length > 0) {\r\n                            oNode.textContent += nextText;\r\n                            util.removeItem(next);\r\n                        }\r\n\r\n                        const newRange = {\r\n                            container: oNode,\r\n                            startOffset: previousText.length,\r\n                            endOffset: oNode.textContent.length - nextText.length\r\n                        };\r\n\r\n                        this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\r\n    \r\n                        return newRange;\r\n                    } else if (!util.isBreak(oNode) && util.isFormatElement(parentNode)) {\r\n                        let zeroWidth = null;\r\n                        if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode);\r\n                        }\r\n                        \r\n                        if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\r\n                        }\r\n    \r\n                        if (util._isIgnoreNodeChange(oNode)) {\r\n                            oNode = oNode.nextSibling;\r\n                            offset = 0;\r\n                        }\r\n                    }\r\n    \r\n                    this.setRange(oNode, offset, oNode, offset);\r\n                }\r\n\r\n                // history stack\r\n                this.history.push(true);\r\n\r\n                return oNode;\r\n            }\r\n        },\r\n\r\n        _setIntoFreeFormat: function (oNode) {\r\n            const parentNode = oNode.parentNode;\r\n            let oNodeChildren, lastONode;\r\n            \r\n            while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\r\n                oNodeChildren = oNode.childNodes;\r\n                lastONode = null;\r\n                \r\n                while (oNodeChildren[0]) {\r\n                    lastONode = oNodeChildren[0];\r\n                    if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\r\n                        this._setIntoFreeFormat(lastONode);\r\n                        if (!oNode.parentNode) break;\r\n                        oNodeChildren = oNode.childNodes;\r\n                        continue;\r\n                    }\r\n                    \r\n                    parentNode.insertBefore(lastONode, oNode);\r\n                }\r\n                \r\n                if (oNode.childNodes.length === 0) util.removeItem(oNode);\r\n                oNode = util.createElement('BR');\r\n                parentNode.insertBefore(oNode, lastONode.nextSibling);\r\n            }\r\n\r\n            return oNode;\r\n        },\r\n\r\n        /**\r\n         * @description Delete the currently selected nodes and reset selection range\r\n         * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n         * @returns {Object}\r\n         */\r\n        removeNode: function () {\r\n            this._resetRangeToTextNode();\r\n\r\n            const range = this.getRange();\r\n            let container, offset = 0;\r\n            let startCon = range.startContainer;\r\n            let endCon = range.endContainer;\r\n            let startOff = range.startOffset;\r\n            let endOff = range.endOffset;\r\n            const commonCon = (range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode) ? startCon.parentNode : range.commonAncestorContainer;\r\n            if (commonCon === startCon && commonCon === endCon) {\r\n                startCon = commonCon.children[startOff];\r\n                endCon = commonCon.children[endOff];\r\n                startOff = endOff = 0;\r\n            }\r\n\r\n            let beforeNode = null;\r\n            let afterNode = null;\r\n\r\n            const childNodes = util.getListChildNodes(commonCon, null);\r\n            let startIndex = util.getArrayIndex(childNodes, startCon);\r\n            let endIndex = util.getArrayIndex(childNodes, endCon);\r\n\r\n            if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\r\n                for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\r\n                    if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\r\n                        startIndex = i;\r\n                        startNode = startNode.parentNode;\r\n                    }\r\n                }\r\n    \r\n                for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\r\n                    if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\r\n                        childNodes.splice(i, 1);\r\n                        endNode = endNode.parentNode;\r\n                        --endIndex;\r\n                    }\r\n                }\r\n            } else {\r\n                if (childNodes.length === 0) {\r\n                    if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: 0\r\n                        };\r\n                    } else if (commonCon.nodeType === 3) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: endOff\r\n                        };\r\n                    }\r\n                    childNodes.push(commonCon);\r\n                    startCon = endCon = commonCon;\r\n                } else {\r\n                    startCon = endCon = childNodes[0];\r\n                    if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\r\n                        return {\r\n                            container: util.isMedia(commonCon) ? commonCon : startCon,\r\n                            offset: 0\r\n                        };\r\n                    }\r\n                }\r\n\r\n                startIndex = endIndex = 0;\r\n            }\r\n\r\n            function remove (item) {\r\n                const format = util.getFormatElement(item, null);\r\n                util.removeItem(item);\r\n\r\n                if(util.isListCell(format)) {\r\n                    const list = util.getArrayItem(format.children, util.isList, false);\r\n                    if (list) {\r\n                        const child = list.firstElementChild;\r\n                        const children = child.childNodes;\r\n                        while (children[0]) {\r\n                            format.insertBefore(children[0], list);\r\n                        }\r\n                        util.removeItemAllParents(child, null, null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            for (let i = startIndex; i <= endIndex; i++) {\r\n                const item = childNodes[i];\r\n\r\n                if (item.length === 0 || (item.nodeType === 3 && item.data === undefined)) {\r\n                    remove(item);\r\n                    continue;\r\n                }\r\n\r\n                if (item === startCon) {\r\n                    if (startCon.nodeType === 1) {\r\n                        if (util.isComponent(startCon)) continue;\r\n                        else beforeNode = util.createTextNode(startCon.textContent);\r\n                    } else {\r\n                        if (item === endCon) {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, (endCon.length - endOff)));\r\n                            offset = startOff;\r\n                        } else {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff));\r\n                        }\r\n                    }\r\n\r\n                    if (beforeNode.length > 0) {\r\n                        startCon.data = beforeNode.data;\r\n                    } else {\r\n                        remove(startCon);\r\n                    }\r\n\r\n                    if (item === endCon) break;\r\n                    continue;\r\n                }\r\n\r\n                if (item === endCon) {\r\n                    if (endCon.nodeType === 1) {\r\n                        if (util.isComponent(endCon)) continue;\r\n                        else afterNode = util.createTextNode(endCon.textContent);\r\n                    } else {\r\n                        afterNode = util.createTextNode(endCon.substringData(endOff, (endCon.length - endOff)));\r\n                    }\r\n\r\n                    if (afterNode.length > 0) {\r\n                        endCon.data = afterNode.data;\r\n                    } else {\r\n                        remove(endCon);\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                remove(item);\r\n            }\r\n\r\n            container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : (range.endContainer || range.startContainer);\r\n            \r\n            if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\r\n                const rc = util.removeItemAllParents(container, function (current) {\r\n                    if (this.isComponent(current)) return false;\r\n                    const text = current.textContent;\r\n                    return text.length === 0 || /^(\\n|\\u200B)+$/.test(text);\r\n                }.bind(util), null);\r\n                \r\n                if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\r\n            }\r\n\r\n            // set range\r\n            this.setRange(container, offset, container, offset);\r\n            // history stack\r\n            this.history.push(true);\r\n\r\n            return {\r\n                container: container,\r\n                offset: offset,\r\n                prevContainer: startCon && startCon.parentNode ? startCon : null\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Appended all selected format Element to the argument element and insert\r\n         * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n         */\r\n        applyRangeFormatElement: function (rangeElement) {\r\n            this.getRange_addLine(this.getRange(), null);\r\n            const rangeLines = this.getSelectedElementsAndComponents(false);\r\n            if (!rangeLines || rangeLines.length === 0) return;\r\n\r\n            linesLoop:\r\n            for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\r\n                line = rangeLines[i];\r\n                if (!util.isListCell(line)) continue;\r\n\r\n                nested = line.lastElementChild;\r\n                if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\r\n                    lEl = nested.lastElementChild;\r\n                    if (rangeLines.indexOf(lEl) > -1) {\r\n                        let list = null;\r\n                        while ((list = lEl.lastElementChild)) {\r\n                            if (util.isList(list)) {\r\n                                if (rangeLines.indexOf(list.lastElementChild) > -1) {\r\n                                    lEl = list.lastElementChild;\r\n                                } else {\r\n                                    continue linesLoop;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        fEl = nested.firstElementChild;\r\n                        f = rangeLines.indexOf(fEl);\r\n                        l = rangeLines.indexOf(lEl);\r\n                        rangeLines.splice(f, (l - f) + 1);\r\n                        len = rangeLines.length;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let last  = rangeLines[rangeLines.length - 1];\r\n            let standTag, beforeTag, pElement;\r\n\r\n            if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\r\n                standTag = last;\r\n            } else {\r\n                standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\r\n            }\r\n\r\n            if (util.isCell(standTag)) {\r\n                beforeTag = null;\r\n                pElement = standTag;\r\n            } else {\r\n                beforeTag = standTag.nextSibling;\r\n                pElement = standTag.parentNode;\r\n            }\r\n            \r\n            let parentDepth = util.getElementDepth(standTag);\r\n            let listParent = null;\r\n            const lineArr = [];\r\n            const removeItems = function (parent, origin, before) {\r\n                let cc = null;\r\n                if (parent !== origin && !util.isTable(origin)) {\r\n                    if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\r\n                    cc = util.removeItemAllParents(origin, null, parent);\r\n                }\r\n\r\n                return cc ? cc.ec : before;\r\n            };\r\n            \r\n            for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\r\n                line = rangeLines[i];\r\n                originParent = line.parentNode;\r\n                if (!originParent || rangeElement.contains(originParent)) continue;\r\n\r\n                depth = util.getElementDepth(line);\r\n\r\n                if (util.isList(originParent)) {\r\n                    if (listParent === null) {\r\n                        if (nextList) {\r\n                            listParent = nextList;\r\n                            nested = true;\r\n                            nextList = null;\r\n                        } else {\r\n                            listParent = originParent.cloneNode(false);\r\n                        }\r\n                    }\r\n\r\n                    lineArr.push(line);\r\n                    nextLine = rangeLines[i + 1];\r\n\r\n                    if (i === len - 1 || (nextLine && nextLine.parentNode !== originParent)) {\r\n                        // nested list\r\n                        if (nextLine && line.contains(nextLine.parentNode)) {\r\n                            nextList = nextLine.parentNode.cloneNode(false);\r\n                        }\r\n\r\n                        let list = originParent.parentNode, p;\r\n                        while (util.isList(list)) {\r\n                            p = util.createElement(list.nodeName);\r\n                            p.appendChild(listParent);\r\n                            listParent = p;\r\n                            list = list.parentNode;\r\n                        }\r\n\r\n                        const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\r\n\r\n                        if (parentDepth >= depth) {\r\n                            parentDepth = depth;\r\n                            pElement = edge.cc;\r\n                            beforeTag = removeItems(pElement, originParent, edge.ec);\r\n                            if (beforeTag) pElement = beforeTag.parentNode;\r\n                        } else if (pElement === edge.cc) {\r\n                            beforeTag = edge.ec;\r\n                        }\r\n\r\n                        if (pElement !== edge.cc) {\r\n                            before = removeItems(pElement, edge.cc, before);\r\n                            if (before !== undefined) beforeTag = before;\r\n                            else beforeTag = edge.cc;\r\n                        }\r\n\r\n                        for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\r\n                            listParent.appendChild(edge.removeArray[c]);\r\n                        }\r\n\r\n                        if (!nested) rangeElement.appendChild(listParent);\r\n                        if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\r\n                        listParent = null;\r\n                        nested = false;\r\n                    }\r\n                } else {\r\n                    if (parentDepth >= depth) {\r\n                        parentDepth = depth;\r\n                        pElement = originParent;\r\n                        beforeTag = line.nextSibling;\r\n                    }\r\n                    \r\n                    rangeElement.appendChild(line);\r\n\r\n                    if (pElement !== originParent) {\r\n                        before = removeItems(pElement, originParent);\r\n                        if (before !== undefined) beforeTag = before;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.effectNode = null;\r\n            util.mergeSameTags(rangeElement, null, false);\r\n            util.mergeNestedTags(rangeElement, function (current) { return this.isList(current); }.bind(util));\r\n\r\n            // Nested list\r\n            if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\r\n                const depthFormat = util.getParentElement(beforeTag, function (current) { return this.isRangeFormatElement(current) && !this.isList(current); }.bind(util));\r\n                const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                splitRange.parentNode.insertBefore(rangeElement, splitRange);\r\n            } else { // basic\r\n                pElement.insertBefore(rangeElement, beforeTag);\r\n                removeItems(rangeElement, beforeTag);\r\n            }\r\n\r\n            const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\r\n            if (rangeLines.length > 1) {\r\n                this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\r\n            } else {\r\n                this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n         * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n         * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n         * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n         * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n         * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @returns {Object}\r\n         */\r\n        detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\r\n            const range = this.getRange();\r\n            const so = range.startOffset;\r\n            const eo = range.endOffset;\r\n\r\n            let children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n            let parent = rangeElement.parentNode;\r\n            let firstNode = null;\r\n            let lastNode = null;\r\n            let rangeEl = rangeElement.cloneNode(false);\r\n            \r\n            const removeArray = [];\r\n            const newList = util.isList(newRangeElement);\r\n            let insertedNew = false;\r\n            let reset = false;\r\n            let moveComplete = false;\r\n\r\n            function appendNode (parent, insNode, sibling, originNode) {\r\n                if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\r\n\r\n                if (insNode.nodeType === 3) {\r\n                    parent.insertBefore(insNode, sibling);\r\n                    return insNode;\r\n                }\r\n                \r\n                const insChildren = (moveComplete ? insNode : originNode).childNodes;\r\n                let format = insNode.cloneNode(false);\r\n                let first = null;\r\n                let c = null;\r\n\r\n                while (insChildren[0]) {\r\n                    c = insChildren[0];\r\n                    if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\r\n                        if (format.childNodes.length > 0) {\r\n                            if (!first) first = format;\r\n                            parent.insertBefore(format, sibling);\r\n                            format = insNode.cloneNode(false);\r\n                        }\r\n                        parent.insertBefore(c, sibling);\r\n                        if (!first) first = c;\r\n                    } else {\r\n                        format.appendChild(c);\r\n                    }\r\n                }\r\n\r\n                if (format.childNodes.length > 0) {\r\n                    if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\r\n                        if (newList) {\r\n                            first = sibling;\r\n                            while(sibling) {\r\n                                format.appendChild(sibling);\r\n                                sibling = sibling.nextSibling;\r\n                            }\r\n                            parent.parentNode.insertBefore(format, parent.nextElementSibling);\r\n                        } else {\r\n                            const originNext = originNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(originNode, false);\r\n                            if ((rangeElement !== detachRange) || (originNext !== originNode.nextElementSibling)) {\r\n                                const fChildren = format.childNodes;\r\n                                while (fChildren[0]) {\r\n                                    originNode.appendChild(fChildren[0]);\r\n                                }\r\n\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        parent.insertBefore(format, sibling);\r\n                    }\r\n\r\n                    if (!first) first = format;\r\n                }\r\n\r\n                return first;\r\n            }\r\n\r\n            // detach loop\r\n            for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\r\n                insNode = children[i];\r\n                if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\r\n                \r\n                moveComplete = false;\r\n                if (remove && i === 0) {\r\n                    if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\r\n                        firstNode = rangeElement.previousSibling;\r\n                    } else {\r\n                        firstNode = rangeEl;\r\n                    }\r\n                }\r\n\r\n                if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\r\n                if (selectedFormats && lineIndex === -1) {\r\n                    if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\r\n                    rangeEl.appendChild(insNode);\r\n                } else {\r\n                    if (selectedFormats) next = selectedFormats[lineIndex + 1];\r\n                    if (rangeEl && rangeEl.children.length > 0) {\r\n                        parent.insertBefore(rangeEl, rangeElement);\r\n                        rangeEl = null;\r\n                    }\r\n\r\n                    if (!newList && util.isListCell(insNode)) {\r\n                        if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\r\n                            const insNext = insNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(insNode, false);\r\n                            if ((rangeElement !== detachRange) || insNext !== insNode.nextElementSibling) {\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        } else {\r\n                            const inner = insNode;\r\n                            insNode = util.createElement(remove ? inner.nodeName : (util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode)) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\r\n                            const isCell = util.isListCell(insNode);\r\n                            const innerChildren = inner.childNodes;\r\n                            while (innerChildren[0]) {\r\n                                if (util.isList(innerChildren[0]) && !isCell) break;\r\n                                insNode.appendChild(innerChildren[0]);\r\n                            }\r\n                            util.copyFormatAttributes(insNode, inner);\r\n                            moveComplete = true;\r\n                        }\r\n                    } else {\r\n                        insNode = insNode.cloneNode(false);\r\n                    }\r\n\r\n                    if (!reset) {\r\n                        if (!remove) {\r\n                            if (newRangeElement) {\r\n                                if (!insertedNew) {\r\n                                    parent.insertBefore(newRangeElement, rangeElement);\r\n                                    insertedNew = true;\r\n                                }\r\n                                insNode = appendNode(newRangeElement, insNode, null, children[i]);\r\n                            } else {\r\n                                insNode = appendNode(parent, insNode, rangeElement, children[i]);\r\n                            }\r\n    \r\n                            if (!reset) {\r\n                                if (selectedFormats) {\r\n                                    lastNode = insNode;\r\n                                    if (!firstNode) {\r\n                                        firstNode = insNode;\r\n                                    }\r\n                                } else if (!firstNode) {\r\n                                    firstNode = lastNode = insNode;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            removeArray.push(insNode);\r\n                            util.removeItem(children[i]);\r\n                        }\r\n\r\n                        if (reset) {\r\n                            reset = moveComplete = false;\r\n                            children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n                            rangeEl = rangeElement.cloneNode(false);\r\n                            parent = rangeElement.parentNode;\r\n                            i = -1;\r\n                            len = children.length;\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const rangeParent = rangeElement.parentNode;\r\n            let rangeRight = rangeElement.nextSibling;\r\n            if (rangeEl && rangeEl.children.length > 0) {\r\n                rangeParent.insertBefore(rangeEl, rangeRight);\r\n            }\r\n            \r\n            if (newRangeElement) firstNode = newRangeElement.previousSibling;\r\n            else if (!firstNode) firstNode = rangeElement.previousSibling;\r\n            rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\r\n\r\n            if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\r\n                util.removeItem(rangeElement);\r\n            } else {\r\n                util.removeEmptyNode(rangeElement, null);\r\n            }\r\n\r\n            let edge = null;\r\n            if (remove) {\r\n                edge = {\r\n                    cc: rangeParent,\r\n                    sc: firstNode,\r\n                    ec: rangeRight,\r\n                    removeArray: removeArray\r\n                };\r\n            } else {\r\n                if (!firstNode) firstNode = lastNode;\r\n                if (!lastNode) lastNode = firstNode;\r\n                const childEdge = util.getEdgeChildNodes(firstNode, (lastNode.parentNode ? firstNode : lastNode));\r\n                edge = {\r\n                    cc: (childEdge.sc || childEdge.ec).parentNode,\r\n                    sc: childEdge.sc,\r\n                    ec: childEdge.ec\r\n                };\r\n            }\r\n\r\n            this.effectNode = null;\r\n            if (notHistoryPush) return edge;\r\n            \r\n            if (!remove && edge) {\r\n                if (!selectedFormats) {\r\n                    this.setRange(edge.sc, 0, edge.sc, 0);\r\n                } else {\r\n                    this.setRange(edge.sc, so, edge.ec, eo);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description \"selectedFormats\" array are detached from the list element.\r\n         * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n         * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n         */\r\n        detachList: function (selectedFormats, remove) {\r\n            let rangeArr = {};\r\n            let listFirst = false;\r\n            let listLast = false;\r\n            let first = null;\r\n            let last = null;\r\n            const passComponent = function (current) { return !this.isComponent(current); }.bind(util);\r\n\r\n            for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\r\n                lastIndex = i === len - 1;\r\n                o = util.getRangeFormatElement(selectedFormats[i], passComponent);\r\n                isList = util.isList(o);\r\n                if (!r && isList) {\r\n                    r = o;\r\n                    rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                    if (i === 0) listFirst = true;\r\n                } else if (r && isList) {\r\n                    if (r !== o) {\r\n                        const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                        o = selectedFormats[i].parentNode;\r\n                        if (listFirst) {\r\n                            first = edge.sc;\r\n                            listFirst = false;\r\n                        }\r\n                        if (lastIndex) last = edge.ec;\r\n\r\n                        if (isList) {\r\n                            r = o;\r\n                            rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                            if (lastIndex) listLast = true;\r\n                        } else {\r\n                            r = null;\r\n                        }\r\n                    } else {\r\n                        rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\r\n                        if (lastIndex) listLast = true;\r\n                    }\r\n                }\r\n\r\n                if (lastIndex && util.isList(r)) {\r\n                    const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                    if (listLast || len === 1) last = edge.ec;\r\n                    if (listFirst) first = edge.sc || last;\r\n                }\r\n            }\r\n\r\n            return {\r\n                sc: first,\r\n                ec: last\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Add, update, and delete nodes from selected text.\r\n         * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n         * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n         * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n         * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n         *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n         * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n         *    (The class name is preceded by \".\" [\".className\"])\r\n         * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n         * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n         * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n         * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         *10. It won't work if the parent node has the same class and same value style.\r\n         *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n         * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n         * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n         * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n         * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         */\r\n        nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\r\n            this._resetRangeToTextNode();\r\n            let range = this.getRange_addLine(this.getRange(), null);\r\n            styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\r\n            removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\r\n            \r\n            const isRemoveNode = !appendNode;\r\n            const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n\r\n            if ((isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) && util.isFormatElement(endCon.parentNode)) || (startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon))) {\r\n                return;\r\n            }\r\n\r\n            if (range.collapsed && !isRemoveFormat) {\r\n                if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\r\n                    let afterNode = null;\r\n                    const focusNode = startCon.childNodes[startOff];\r\n\r\n                    if (focusNode) {\r\n                        if (!focusNode.nextSibling) {\r\n                            afterNode = null;\r\n                        } else {\r\n                            afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\r\n                        }\r\n                    }\r\n\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    startCon.insertBefore(zeroWidth, afterNode);\r\n                    this.setRange(zeroWidth, 1, zeroWidth, 1);\r\n\r\n                    range = this.getRange();\r\n                    startCon = range.startContainer;\r\n                    startOff = range.startOffset;\r\n                    endCon = range.endContainer;\r\n                    endOff = range.endOffset;\r\n                }\r\n            }\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.firstChild;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            if (isRemoveNode) {\r\n                appendNode = util.createElement('DIV');\r\n            }\r\n\r\n            const wRegExp = _w.RegExp;\r\n            const newNodeName = appendNode.nodeName;\r\n\r\n            /* checked same style property */\r\n            if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\r\n                let sNode = startCon;\r\n                let checkCnt = 0;\r\n                const checkAttrs = [];\r\n                \r\n                const checkStyles = appendNode.style;\r\n                for (let i = 0, len = checkStyles.length; i < len; i++) {\r\n                    checkAttrs.push(checkStyles[i]);\r\n                }\r\n\r\n                const ckeckClasses = appendNode.classList;\r\n                for (let i = 0, len = ckeckClasses.length; i < len; i++) {\r\n                    checkAttrs.push('.' + ckeckClasses[i]);\r\n                }\r\n\r\n                if (checkAttrs.length > 0) {\r\n                    while(!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\r\n                        for (let i = 0; i < checkAttrs.length; i++) {\r\n                            if (sNode.nodeType === 1) {\r\n                                const s = checkAttrs[i];\r\n                                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\r\n    \r\n                                const styleCheck = isRemoveNode ? !!sNode.style[s] : (!!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s]);\r\n                                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\r\n                                if (styleCheck || classCheck) {\r\n                                    checkCnt++;\r\n                                }\r\n                            }\r\n                        }\r\n                        sNode = sNode.parentNode;\r\n                    }\r\n    \r\n                    if (checkCnt >= checkAttrs.length) return;\r\n                }\r\n            }\r\n\r\n            let start = {}, end = {};\r\n            let newNode, styleRegExp = '', classRegExp = '', removeNodeRegExp = '';\r\n\r\n            if (styleArray) {\r\n                for (let i = 0, len = styleArray.length, s; i < len; i++) {\r\n                    s = styleArray[i];\r\n                    if (/^\\./.test(s)) {\r\n                        classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\r\n                    } else {\r\n                        styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\r\n                    }\r\n                }\r\n\r\n                if (styleRegExp) {\r\n                    styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\r\n                    styleRegExp = new wRegExp(styleRegExp, 'ig');\r\n                }\r\n\r\n                if (classRegExp) {\r\n                    classRegExp += ')(?=\\\\s+|$)';\r\n                    classRegExp = new wRegExp(classRegExp, 'ig');\r\n                }\r\n            }\r\n\r\n            if (removeNodeArray) {\r\n                removeNodeRegExp = '^(?:' + removeNodeArray[0];\r\n                for (let i = 1; i < removeNodeArray.length; i++) {\r\n                    removeNodeRegExp += '|' + removeNodeArray[i];\r\n                }\r\n                removeNodeRegExp += ')$';\r\n                removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\r\n            }\r\n\r\n            /** validation check function*/\r\n            const wBoolean = _w.Boolean;\r\n            const _removeCheck = {v: false};\r\n            const validation = function (checkNode) {\r\n                const vNode = checkNode.cloneNode(false);\r\n\r\n                // all path\r\n                if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode;\r\n                // all remove\r\n                if (isRemoveFormat) return null;\r\n\r\n                // remove node check\r\n                const tagRemove = (!removeNodeRegExp && isRemoveNode) || (removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName));\r\n\r\n                // tag remove\r\n                if (tagRemove && !strictRemove) {\r\n                    _removeCheck.v = true;\r\n                    return null;\r\n                }\r\n\r\n                // style regexp\r\n                const originStyle = vNode.style.cssText;\r\n                let style = '';\r\n                if (styleRegExp && originStyle.length > 0) {\r\n                    style = originStyle.replace(styleRegExp, '').trim();\r\n                    if (style !== originStyle) _removeCheck.v = true;\r\n                }\r\n\r\n                // class check\r\n                const originClasses = vNode.className;\r\n                let classes = '';\r\n                if (classRegExp && originClasses.length > 0) {\r\n                    classes = originClasses.replace(classRegExp, '').trim();\r\n                    if (classes !== originClasses) _removeCheck.v = true;\r\n                }\r\n\r\n                // remove only\r\n                if (isRemoveNode) {\r\n                    if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // change\r\n                if (style || classes || vNode.nodeName !== newNodeName || (wBoolean(styleRegExp) !== wBoolean(originStyle)) || (wBoolean(classRegExp) !== wBoolean(originClasses))) {\r\n                    if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\r\n                    if (!vNode.style.cssText) {\r\n                        vNode.removeAttribute('style');\r\n                    }\r\n\r\n                    if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\r\n                    if (!vNode.className.trim()) {\r\n                        vNode.removeAttribute('class');\r\n                    }\r\n\r\n                    if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n\r\n                    return vNode;\r\n                }\r\n\r\n                _removeCheck.v = true;\r\n                return null;\r\n            };\r\n\r\n            // get line nodes\r\n            const lineNodes = this.getSelectedElements(null);\r\n            range = this.getRange();\r\n            startCon = range.startContainer;\r\n            startOff = range.startOffset;\r\n            endCon = range.endContainer;\r\n            endOff = range.endOffset;\r\n\r\n            if (!util.getFormatElement(startCon, null)) {\r\n                startCon = util.getChildElement(lineNodes[0], function (current) { return current.nodeType === 3; }, false);\r\n                startOff = 0;\r\n            }\r\n\r\n            if (!util.getFormatElement(endCon, null)) {\r\n                endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) { return current.nodeType === 3; }, false);\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            \r\n            const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\r\n            const endLength = lineNodes.length - (oneLine ? 0 : 1);\r\n\r\n            // node Changes\r\n            newNode = appendNode.cloneNode(false);\r\n\r\n            const isRemoveAnchor = isRemoveFormat || (isRemoveNode && (function (arr) {\r\n                for (let n = 0, len = arr.length; n < len; n++) {\r\n                    if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\r\n                }\r\n                return false;\r\n            })(removeNodeArray));\r\n\r\n            const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\r\n            const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n            const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n\r\n            // one line\r\n            if (oneLine) {\r\n                const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                start.container = newRange.startContainer;\r\n                start.offset = newRange.startOffset;\r\n                end.container = newRange.endContainer;\r\n                end.offset = newRange.endOffset;\r\n                if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\r\n                    start.offset = end.offset = 1;\r\n                }\r\n                this._setCommonListStyle(newRange.ancestor, null);\r\n            } else { // multi line \r\n                // end\r\n                if (endLength > 0) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                }\r\n\r\n                // mid\r\n                for (let i = endLength - 1, newRange; i > 0; i--) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\r\n                    if (newRange.endContainer) {\r\n                        end.ancestor = null;\r\n                        end.container = newRange.endContainer;\r\n                    }\r\n                    this._setCommonListStyle(newRange.ancestor, null);\r\n                }\r\n\r\n                // start\r\n                newNode = appendNode.cloneNode(false);\r\n                start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\r\n\r\n                if (start.endContainer) {\r\n                    end.ancestor = null;\r\n                    end.container = start.endContainer;\r\n                }\r\n\r\n                if (endLength <= 0) {\r\n                    end = start;\r\n                } else if (!end.container) {\r\n                    end.ancestor = null;\r\n                    end.container = start.container;\r\n                    end.offset = start.container.textContent.length;\r\n                }\r\n\r\n                this._setCommonListStyle(start.ancestor, null);\r\n                this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\r\n            }\r\n\r\n            // set range\r\n            this.controllersOff();\r\n            this.setRange(start.container, start.offset, end.container, end.offset);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n         * @private\r\n         */\r\n        _setCommonListStyle: function (el, child) {\r\n            if (!util.isListCell(el)) return;\r\n            if (!child) el.removeAttribute('style');\r\n            \r\n            const children = util.getArrayItem((child || el).childNodes, function (current) { return !util.isBreak(current); }, true);\r\n            if (children[0] && children.length === 1){\r\n                child = children[0];\r\n                if (!child || child.nodeType !== 1) return;\r\n\r\n                const childStyle = child.style;\r\n                const elStyle = el.style;\r\n\r\n                // bold, italic\r\n                if (options._textTagsMap[child.nodeName.toLowerCase()] === this._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold'; // bold\r\n                else if (childStyle.fontWeight) elStyle.fontWeight = childStyle.fontWeight;\r\n                if (options._textTagsMap[child.nodeName.toLowerCase()] === this._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic'; // italic\r\n                else if (childStyle.fontStyle) elStyle.fontStyle = childStyle.fontStyle;\r\n\r\n                // styles\r\n                if (childStyle.color) elStyle.color = childStyle.color; // color\r\n                if (childStyle.fontSize) elStyle.fontSize = childStyle.fontSize; // size\r\n\r\n                this._setCommonListStyle(el, child);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Strip remove node\r\n         * @param {Node} removeNode The remove node\r\n         * @private\r\n         */\r\n        _stripRemoveNode: function (removeNode) {\r\n            const element = removeNode.parentNode;\r\n            if (!removeNode || removeNode.nodeType === 3 || !element) return;\r\n            \r\n            const children = removeNode.childNodes;\r\n            while (children[0]) {\r\n                element.insertBefore(children[0], removeNode);\r\n            }\r\n\r\n            element.removeChild(removeNode);\r\n        },\r\n\r\n        /**\r\n         * @description Return the parent maintained tag. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove) return null;\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\r\n        },\r\n\r\n        /**\r\n         * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove || element.nodeType !== 1) return false;\r\n            const anchor = this._isMaintainedNode(element);\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : (anchor || (!_isSizeNode ? this._isSizeNode(element) : false));\r\n        },\r\n\r\n        /**\r\n         * @description wraps text nodes of line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Boolean} collapsed range.collapsed\r\n         * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n         * @private\r\n         */\r\n        _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\r\n                if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                    const children = parentCon.childNodes;\r\n                    let sameTag = true;\r\n    \r\n                    for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\r\n                        c = children[i];\r\n                        z = !util.onlyZeroWidthSpace(c);\r\n                        if (c === startCon) {\r\n                            s = true;\r\n                            continue;\r\n                        }\r\n                        if (c === endCon) {\r\n                            e = true;\r\n                            continue;\r\n                        }\r\n                        if ((!s && z) || (s && e && z)) {\r\n                            sameTag = false;\r\n                            break;\r\n                        }\r\n                    }\r\n    \r\n                    if (sameTag) {\r\n                        util.copyTagAttributes(parentCon, newInnerNode);\r\n        \r\n                        return {\r\n                            startContainer: startCon,\r\n                            startOffset: startOff,\r\n                            endContainer: endCon,\r\n                            endOffset: endOff\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n            const isSameNode = startCon === endCon;\r\n            let startContainer = startCon;\r\n            let startOffset = startOff;\r\n            let endContainer = endCon;\r\n            let endOffset = endOff;\r\n            let startPass = false;\r\n            let endPass = false;\r\n            let pCurrent, newNode, appendNode, cssText, anchorNode;\r\n\r\n            const wRegExp = _w.RegExp;\r\n            function checkCss (vNode) {\r\n                const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\r\n                let style = '';\r\n\r\n                if (regExp && vNode.style.cssText.length > 0) {\r\n                    style = regExp.test(vNode.style.cssText);\r\n                }\r\n            \r\n                return !style;\r\n            }\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n                    let cloneNode;\r\n\r\n                    // startContainer\r\n                    if (!startPass && child === startContainer) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\r\n                        const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, \r\n                                isSameNode ? \r\n                                (endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset) : \r\n                                startContainer.data.length - startOffset)\r\n                            );\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== line && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        newInnerNode.appendChild(childNode);\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        if (anchorNode && !_getMaintainedNode(endContainer)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        startContainer = textNode;\r\n                        startOffset = 0;\r\n                        startPass = true;\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(startContainer);\r\n                        if (!isSameNode) continue;\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!endPass && child === endContainer) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, (endContainer.length - endOffset)));\r\n                        const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            newNode = child;\r\n                            cssText = '';\r\n                            pCurrent = [];\r\n                            const anchors = [];\r\n                            while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                                if (newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                    if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));\r\n                                    else pCurrent.push(newNode.cloneNode(false));\r\n                                    cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                                }\r\n                                newNode = newNode.parentNode;\r\n                            }\r\n                            pCurrent = pCurrent.concat(anchors);\r\n\r\n                            cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\r\n                            while (pCurrent.length > 0) {\r\n                                newNode = pCurrent.pop();\r\n                                appendNode.appendChild(newNode);\r\n                                appendNode = newNode;\r\n                            }\r\n\r\n                            pNode.appendChild(cloneNode);\r\n                            newNode.textContent = afterNode.data;\r\n                        }\r\n\r\n                        if (anchorNode && cloneNode) {\r\n                            const afterAnchorNode = _getMaintainedNode(cloneNode);\r\n                            if (afterAnchorNode) {\r\n                                anchorNode = afterAnchorNode;\r\n                            }\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            newInnerNode.appendChild(childNode);\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.appendChild(anchorNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                        }\r\n\r\n                        endContainer = textNode;\r\n                        endOffset = textNode.data.length;\r\n                        endPass = true;\r\n\r\n                        if (!isRemoveFormat && collapsed) {\r\n                            newInnerNode = textNode;\r\n                            textNode.textContent = util.zeroWidthSpace;\r\n                        }\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(endContainer);\r\n                        continue;\r\n                    }\r\n\r\n                    // other\r\n                    if (startPass) {\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                pNode.appendChild(child.cloneNode(true));\r\n                                if (!collapsed) {\r\n                                    newInnerNode = newInnerNode.cloneNode(false);\r\n                                    pNode.appendChild(newInnerNode);\r\n                                    nNodeArray.push(newInnerNode);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\r\n                            if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n                        \r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (childNode === child) {\r\n                            if (!endPass) ancestor = newInnerNode;\r\n                            else ancestor = pNode;\r\n                        } else if (endPass) {\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    cloneNode = child.cloneNode(false);\r\n                    ancestor.appendChild(cloneNode);\r\n                    if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    startContainer: startCon,\r\n                    startOffset: startOff,\r\n                    endContainer: endCon,\r\n                    endOffset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    let textNode, textNode_s, textNode_e;\r\n                    \r\n                    if (collapsed) {\r\n                        textNode = util.createTextNode(util.zeroWidthSpace);\r\n                        pNode.replaceChild(textNode, removeNode);\r\n                    } else {\r\n                        const rChildren = removeNode.childNodes;\r\n                        textNode_s = rChildren[0];\r\n                        while (rChildren[0]) {\r\n                            textNode_e = rChildren[0];\r\n                            pNode.insertBefore(textNode_e, removeNode);\r\n                        }\r\n                        util.removeItem(removeNode);\r\n                    }\r\n\r\n                    if (i === 0) {\r\n                        if (collapsed) {\r\n                            startContainer = endContainer = textNode;\r\n                        } else {\r\n                            startContainer = textNode_s;\r\n                            endContainer = textNode_e;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (isRemoveNode) {\r\n                    for (let i = 0; i < nNodeArray.length; i++) {\r\n                        this._stripRemoveNode(nNodeArray[i]);\r\n                    }\r\n                }\r\n                \r\n                if (collapsed) {\r\n                    startContainer = endContainer = newInnerNode;\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n            if (collapsed) {\r\n                startOffset = startContainer.textContent.length;\r\n                endOffset = endContainer.textContent.length;\r\n            }\r\n\r\n            // endContainer reset\r\n            const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\r\n\r\n            if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\r\n                util.removeItem(endContainer);\r\n                endContainer = startContainer;\r\n            }\r\n            endOffset = endConReset ? endContainer.textContent.length : endOffset;\r\n\r\n            // node change\r\n            const newStartOffset = {s: 0, e: 0};\r\n            const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\r\n\r\n            const mergeEndCon = !endContainer.parentNode;\r\n            if (mergeEndCon) endContainer = startContainer;\r\n            const newEndOffset = {s: 0, e: 0};\r\n            const endPath = util.getNodePath(endContainer , pNode, (!mergeEndCon && !endConReset) ? newEndOffset : null);\r\n\r\n            startOffset += newStartOffset.s;\r\n            endOffset = (collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s);\r\n\r\n            // tag merge\r\n            const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\r\n\r\n            element.parentNode.replaceChild(pNode, element);\r\n\r\n            startContainer = util.getNodeFromPath(startPath, pNode);\r\n            endContainer = util.getNodeFromPath(endPath, pNode);\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                startContainer: startContainer,\r\n                startOffset: startOffset + newOffsets[0],\r\n                endContainer: endContainer,\r\n                endOffset: endOffset + newOffsets[1]\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps first line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {null|Node} If end container is renewed, returned renewed node\r\n         * @returns {Object} { ancestor, container, offset, endContainer }\r\n         * @private\r\n         */\r\n        _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\r\n                let sameTag = true;\r\n                let s = startCon.previousSibling;\r\n                while (s) {\r\n                    if (!util.onlyZeroWidthSpace(s)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    s = s.previousSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: startCon,\r\n                        offset: startOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = startCon;\r\n            let offset = startOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                cloneChild = child.cloneNode(true);\r\n                                pNode.appendChild(cloneChild);\r\n                                pNode.appendChild(newInnerNode);\r\n                                nNodeArray.push(newInnerNode);\r\n\r\n                                // end container\r\n                                if (_endContainer && child.contains(_endContainer)) {\r\n                                    const endPath = util.getNodePath(_endContainer, child);\r\n                                    _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\r\n                            nNodeArray.push(newInnerNode);\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // startContainer\r\n                    if (!passNode && child === container) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== line && newNode !== null) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        container = textNode;\r\n                        offset = 0;\r\n                        passNode = true;\r\n\r\n                        ancestor.appendChild(container);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.appendChild(vNode);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: startCon,\r\n                    offset: startOff,\r\n                    endContainer: _endContainer\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n\r\n                    const rChildren = removeNode.childNodes;\r\n                    const textNode = rChildren[0];\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === 0) container = textNode;\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = 0;\r\n                }\r\n\r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset,\r\n                endContainer: _endContainer\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps mid lines selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n         * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n         * @private\r\n         */\r\n        _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\r\n            // not add tag\r\n            if (!isRemoveNode) {\r\n                // end container path\r\n                let endPath = null;\r\n                if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\r\n\r\n                const tempNode = element.cloneNode(true);\r\n                const newNodeName = newInnerNode.nodeName;\r\n                const newCssText = newInnerNode.style.cssText;\r\n                const newClass = newInnerNode.className;\r\n\r\n                let children = tempNode.childNodes;\r\n                let i = 0, len = children.length;\r\n                for (let child; i < len; i++) {\r\n                    child = children[i];\r\n                    if (child.nodeType === 3) break;\r\n                    if (child.nodeName === newNodeName) {\r\n                        child.style.cssText += newCssText;\r\n                        util.addClass(child, newClass);\r\n                    } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        continue;\r\n                    } else if (len === 1) {\r\n                        children = child.childNodes;\r\n                        len = children.length;\r\n                        i = -1;\r\n                        continue;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (len > 0 && i === len) {\r\n                    element.innerHTML = tempNode.innerHTML;\r\n                    return {\r\n                        ancestor: element,\r\n                        endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const pNode = element.cloneNode(false);\r\n            const nNodeArray = [newInnerNode];\r\n            let noneChange = true;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        if (newInnerNode.childNodes.length > 0) {\r\n                            pNode.appendChild(newInnerNode);\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        cloneChild = child.cloneNode(true);\r\n                        pNode.appendChild(cloneChild);\r\n                        pNode.appendChild(newInnerNode);\r\n                        nNodeArray.push(newInnerNode);\r\n                        ancestor = newInnerNode;\r\n\r\n                        // end container\r\n                        if (_endContainer && child.contains(_endContainer)) {\r\n                            const endPath = util.getNodePath(_endContainer, child);\r\n                            _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                        }\r\n\r\n                        continue;\r\n                    } else {\r\n                        vNode = validation(child);\r\n                        if (vNode) {\r\n                            noneChange = false;\r\n                            ancestor.appendChild(vNode);\r\n                            if (child.nodeType === 1) coverNode = vNode;\r\n                        }\r\n                    }\r\n\r\n                    if (!util.isBreak(child)) recursionFunc(child, coverNode);\r\n                }\r\n            })(element, newInnerNode);\r\n\r\n            // not remove tag\r\n            if (noneChange || (isRemoveNode && !isRemoveFormat && !_removeCheck.v)) return { ancestor: element, endContainer: _endContainer };\r\n\r\n            pNode.appendChild(newInnerNode);\r\n\r\n            if (isRemoveFormat && isRemoveNode) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n            util.mergeSameTags(pNode, null, true);\r\n\r\n            // node change\r\n            element.parentNode.replaceChild(pNode, element);\r\n            return { ancestor: pNode, endContainer: _endContainer };\r\n        },\r\n\r\n        /**\r\n         * @description wraps last line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {Object} { ancestor, container, offset }\r\n         * @private\r\n         */\r\n        _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = endCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n            \r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                let sameTag = true;\r\n                let e = endCon.nextSibling;\r\n                while (e) {\r\n                    if (!util.onlyZeroWidthSpace(e)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    e = e.nextSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: endCon,\r\n                        offset: endOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = endCon;\r\n            let offset = endOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                const cloneChild = child.cloneNode(true);\r\n                                pNode.insertBefore(cloneChild, ancestor);\r\n                                pNode.insertBefore(newInnerNode, cloneChild);\r\n                                nNodeArray.push(newInnerNode);\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.insertBefore(childNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!passNode && child === container) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== pNode) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== pNode) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.insertBefore(a, m.parentNode.firstChild);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            ancestor.insertBefore(afterNode, ancestor.firstChild);\r\n                        }\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== pNode && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        \r\n                        if (anchorNode) {\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.insertBefore(anchorNode, pNode.firstChild);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                        }\r\n\r\n                        container = textNode;\r\n                        offset = textNode.data.length;\r\n                        passNode = true;\r\n\r\n                        ancestor.insertBefore(container, ancestor.firstChild);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.insertBefore(vNode, ancestor.firstChild);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: endCon,\r\n                    offset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    let textNode = null;\r\n                    while (rChildren[0]) {\r\n                        textNode = rChildren[0];\r\n                        pNode.insertBefore(textNode, removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === nNodeArray.length - 1) {\r\n                        container = textNode;\r\n                        offset = textNode.textContent.length;\r\n                    }\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                if (!isRemoveNode && newInnerNode.textContent.length === 0) {\r\n                    util.removeEmptyNode(pNode, null);\r\n                    return {\r\n                        ancestor: null,\r\n                        container: null,\r\n                        offset: 0\r\n                    };\r\n                }\r\n\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = container.textContent.length;\r\n                } else if (util.onlyZeroWidthSpace(container)) {\r\n                    container = newInnerNode;\r\n                    offset = 1;\r\n                }\r\n                \r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Run plugin calls and basic commands.\r\n         * @param {String} command Command string\r\n         * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n         * @param {Element} target The element of command button\r\n         */\r\n        actionCall: function (command, display, target) {\r\n            // call plugins\r\n            if (display) {\r\n                if (/more/i.test(display) && target !== this._moreLayerActiveButton) {\r\n                    const layer = context.element.toolbar.querySelector('.' + command);\r\n                    if (layer) {\r\n                        if (this._moreLayerActiveButton) {\r\n                            (context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'))).style.display = 'none';\r\n                            util.removeClass(this._moreLayerActiveButton, 'on');\r\n                        }\r\n                        util.addClass(target, 'on');\r\n                        this._moreLayerActiveButton = target;\r\n                        layer.style.display = 'block';\r\n\r\n                        event._showToolbarBalloon();\r\n                        event._showToolbarInline();\r\n                    }\r\n                    return;\r\n                }\r\n                \r\n                if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\r\n                    this.callPlugin(command, this.containerOn.bind(this, target), target);\r\n                    return;\r\n                } \r\n                \r\n                if (this.isReadOnly) return;\r\n                if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\r\n                    this.callPlugin(command, this.submenuOn.bind(this, target), target);\r\n                    return;\r\n                } else if (/dialog/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this), target);\r\n                    return;\r\n                } else if (/command/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].action.bind(this), target);\r\n                } else if (/fileBrowser/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\r\n                }\r\n            } // default command\r\n            else if (command) {\r\n                this.commandHandler(target, command);\r\n            }\r\n\r\n            if (/more/i.test(display)) {\r\n                const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                if (layer) {\r\n                    util.removeClass(this._moreLayerActiveButton, 'on');\r\n                    this._moreLayerActiveButton = null;\r\n                    layer.style.display = 'none';\r\n\r\n                    event._showToolbarBalloon();\r\n                    event._showToolbarInline();\r\n                }\r\n            } else if (/submenu/.test(display)) {\r\n                this.submenuOff();\r\n            } else if (!/command/.test(display)) {\r\n                this.submenuOff();\r\n                this.containerOff();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Execute command of command button(All Buttons except submenu and dialog)\r\n         * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n         * @param {Element|null} target The element of command button\r\n         * @param {String} command Property of command button (data-value)\r\n         */\r\n        commandHandler: function (target, command) {\r\n            if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\r\n            switch (command) {\r\n                case 'copy':\r\n                case 'cut':\r\n                    this.execCommand(command);\r\n                    break;\r\n                case 'paste':\r\n                    break;\r\n                case 'selectAll':\r\n                    const wysiwyg = context.element.wysiwyg;\r\n                    let first = util.getChildElement(wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false) || wysiwyg.firstChild;\r\n                    let last = util.getChildElement(wysiwyg.lastChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true) || wysiwyg.lastChild;\r\n                    if (!first || !last) return;\r\n                    if (util.isMedia(first)) {\r\n                        const info = this.getFileComponent(first);\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        first = info ? info.component : first;\r\n                        first.parentNode.insertBefore(format, first);\r\n                        first = br;\r\n                    }\r\n                    if (util.isMedia(last)) {\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        wysiwyg.appendChild(format);\r\n                        last = br;\r\n                    }\r\n                    this.setRange(first, 0, last, last.textContent.length);\r\n                    break;\r\n                case 'codeView':\r\n                    this.toggleCodeView();\r\n                    break;\r\n                case 'fullScreen':\r\n                    this.toggleFullScreen(target);\r\n                    break;\r\n                case 'indent':\r\n                case 'outdent':\r\n                    this.indent(command);\r\n                    break;\r\n                case 'undo':\r\n                    this.history.undo();\r\n                    break;\r\n                case 'redo':\r\n                    this.history.redo();\r\n                    break;\r\n                case 'removeFormat':\r\n                    this.removeFormat();\r\n                    this.focus();\r\n                    break;\r\n                case 'print':\r\n                    this.print();\r\n                    break;\r\n                case 'preview':\r\n                    this.preview();\r\n                    break;\r\n                case 'showBlocks':\r\n                    this.toggleDisplayBlocks();\r\n                    break;\r\n                case 'save':\r\n                    if (typeof options.callBackSave === 'function') {\r\n                        options.callBackSave(this.getContents(false), this._variable.isChanged);\r\n                    } else if (this._variable.isChanged && typeof functions.save === 'function') {\r\n                        functions.save();\r\n                    } else {\r\n                        throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\r\n                    }\r\n\r\n                    this._variable.isChanged = false;\r\n                    if (context.tool.save) context.tool.save.setAttribute('disabled', true);\r\n                    break;\r\n                default : // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\r\n                    command = this._defaultCommand[command.toLowerCase()] || command;\r\n                    if (!this.commandMap[command]) this.commandMap[command] = target;\r\n\r\n                    const nodesMap = this._variable.currentNodesMap;\r\n                    const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\r\n                    let removeNode = command;\r\n\r\n                    if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\r\n                        removeNode = 'SUP';\r\n                    } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\r\n                        removeNode = 'SUB';\r\n                    }\r\n\r\n                    this.nodeChange(cmd, null, [removeNode], false);\r\n                    this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove format of the currently selected range\r\n         */\r\n        removeFormat: function () {\r\n            this.nodeChange(null, null, null, null);\r\n        },\r\n\r\n        /**\r\n         * @description This method implements indentation to selected range.\r\n         * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n         * @param {String} command Separator (\"indent\" or \"outdent\")\r\n         */\r\n        indent: function (command) {\r\n            const range = this.getRange();\r\n            const rangeLines = this.getSelectedElements(null);\r\n            const cells = [];\r\n            const shift = 'indent' !== command;\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            let sc = range.startContainer;\r\n            let ec = range.endContainer;\r\n            let so = range.startOffset;\r\n            let eo = range.endOffset;\r\n\r\n            for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\r\n                f = rangeLines[i];\r\n                if (!util.isListCell(f) || !this.plugins.list) {\r\n                    margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\r\n                    if (shift) {\r\n                        margin -= 25;\r\n                    } else {\r\n                        margin += 25;\r\n                    }\r\n                    util.setStyle(f, marginDir, (margin <= 0 ? '' : margin + 'px'));\r\n                } else {\r\n                    if (shift || f.previousElementSibling) {\r\n                        cells.push(f);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // list cells\r\n            if (cells.length > 0) {\r\n                this.plugins.list.editInsideList.call(this, shift, cells);\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.setRange(sc, so, ec, eo);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Add or remove the class name of \"body\" so that the code block is visible\r\n         */\r\n        toggleDisplayBlocks: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            util.toggleClass(wysiwyg, 'se-show-block');\r\n            if (util.hasClass(wysiwyg, 'se-show-block')) {\r\n                util.addClass(this._styleCommandMap.showBlocks, 'active');\r\n            } else {\r\n                util.removeClass(this._styleCommandMap.showBlocks, 'active');\r\n            }\r\n            this._resourcesStateChange();\r\n        },\r\n\r\n        /**\r\n         * @description Changes to code view or wysiwyg view\r\n         */\r\n        toggleCodeView: function () {\r\n            const isCodeView = this._variable.isCodeView;\r\n            this.controllersOff();\r\n            util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\r\n\r\n            if (isCodeView) {\r\n                this._setCodeDataToEditor();\r\n                context.element.wysiwygFrame.scrollTop = 0;\r\n                context.element.code.style.display = 'none';\r\n                context.element.wysiwygFrame.style.display = 'block';\r\n\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\r\n                \r\n                this._variable.isCodeView = false;\r\n                \r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = false;\r\n                    if (/balloon|balloon-always/i.test(options.mode)) {\r\n                        context.element._arrow.style.display = '';\r\n                        this._isInline = false;\r\n                        this._isBalloon = true;\r\n                        event._hideToolbar();    \r\n                    }\r\n                }\r\n\r\n                this.nativeFocus();\r\n                util.removeClass(this._styleCommandMap.codeView, 'active');\r\n\r\n                // history stack\r\n                this.history.push(false);\r\n                this.history._resetCachingButton();\r\n            } else {\r\n                this._setEditorDataToCodeView();\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? (context.element.code.scrollHeight + 'px') : 'auto';\r\n                if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\r\n                \r\n                this._variable.isCodeView = true;\r\n\r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = true;\r\n                    if (this._isBalloon) {\r\n                        context.element._arrow.style.display = 'none';\r\n                        context.element.toolbar.style.left = '';\r\n                        this._isInline = true;\r\n                        this._isBalloon = false;\r\n                        event._showToolbarInline();\r\n                    }\r\n                }\r\n                \r\n                this._variable._range = null;\r\n                context.element.code.focus();\r\n                util.addClass(this._styleCommandMap.codeView, 'active');\r\n            }\r\n\r\n            this._checkPlaceholder();\r\n            if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons);\r\n\r\n            // user event\r\n            if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n         * @private\r\n         */\r\n        _setCodeDataToEditor: function () {\r\n            const code_html = this._getCodeView();\r\n\r\n            if (options.fullPage) {\r\n                const parseDocument = this._parser.parseFromString(code_html, 'text/html');\r\n                const headChildren = parseDocument.head.children;\r\n\r\n                for (let i = 0, len = headChildren.length; i < len; i++) {\r\n                    if (/^script$/i.test(headChildren[i].tagName)) {\r\n                        parseDocument.head.removeChild(headChildren[i]);\r\n                        i--, len--;\r\n                    }\r\n                }\r\n\r\n                this._wd.head.innerHTML = parseDocument.head.innerHTML;\r\n                this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\r\n\r\n                const attrs = parseDocument.body.attributes;\r\n                for (let i = 0, len = attrs.length; i < len; i++) {\r\n                    if (attrs[i].name === 'contenteditable') continue;\r\n                    this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\r\n                }\r\n                if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\r\n                    const editableClasses = options._editableClass.split(' ');\r\n                    for (let i = 0; i < editableClasses.length; i++) {\r\n                        util.addClass(this._wd.body, options._editableClass[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n         * @private\r\n         */\r\n        _setEditorDataToCodeView: function () {\r\n            const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg);\r\n            let codeValue = '';\r\n\r\n            if (options.fullPage) {\r\n                const attrs = util.getAttributesToString(this._wd.body, null);\r\n                codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\r\n            } else {\r\n                codeValue = codeContents;\r\n            }\r\n\r\n            context.element.code.style.display = 'block';\r\n            context.element.wysiwygFrame.style.display = 'none';\r\n\r\n            this._setCodeView(codeValue);\r\n        },\r\n\r\n        /**\r\n         * @description Changes to full screen or default screen\r\n         * @param {Element} element full screen button\r\n         */\r\n        toggleFullScreen: function (element) {\r\n            const topArea = context.element.topArea;\r\n            const toolbar = context.element.toolbar;\r\n            const editorArea = context.element.editorArea;\r\n            const wysiwygFrame = context.element.wysiwygFrame;\r\n            const code = context.element.code;\r\n            const _var = this._variable;\r\n            this.controllersOff();\r\n\r\n            if (!_var.isFullScreen) {\r\n                _var.isFullScreen = true;\r\n                \r\n                _var._fullScreenAttrs.inline = this._isInline;\r\n                _var._fullScreenAttrs.balloon = this._isBalloon;\r\n\r\n                if (this._isInline || this._isBalloon) {\r\n                    this._isInline = false;\r\n                    this._isBalloon = false;\r\n                }\r\n                \r\n                if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\r\n\r\n                topArea.style.position = 'fixed';\r\n                topArea.style.top = '0';\r\n                topArea.style.left = '0';\r\n                topArea.style.width = '100%';\r\n                topArea.style.maxWidth = '100%';\r\n                topArea.style.height = '100%';\r\n                topArea.style.zIndex = '2147483647';\r\n\r\n                if (context.element._stickyDummy.style.display !== ('none' && '')) {\r\n                    _var._fullScreenAttrs.sticky = true;\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                _var._bodyOverflow = _d.body.style.overflow;\r\n                _d.body.style.overflow = 'hidden';\r\n\r\n                _var._editorAreaOriginCssText = editorArea.style.cssText;\r\n                _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\r\n                _var._codeOriginCssText = code.style.cssText;\r\n\r\n                editorArea.style.cssText = toolbar.style.cssText = '';\r\n                wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\r\n                toolbar.style.position = 'relative';\r\n                toolbar.style.display = 'block';\r\n\r\n                _var.innerHeight_fullScreen = (_w.innerHeight - toolbar.offsetHeight);\r\n                editorArea.style.height = (_var.innerHeight_fullScreen - options.fullScreenOffset) + 'px';\r\n\r\n                util.changeElement(element.firstElementChild, icons.reduction);\r\n\r\n                if (options.iframe && options.height === 'auto') {\r\n                    editorArea.style.overflow = 'auto';\r\n                    this._iframeAutoHeight();\r\n                }\r\n\r\n                context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\r\n                util.addClass(this._styleCommandMap.fullScreen, 'active');\r\n            } else {\r\n                _var.isFullScreen = false;\r\n\r\n                wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\r\n                code.style.cssText = _var._codeOriginCssText;\r\n                toolbar.style.cssText = '';\r\n                editorArea.style.cssText = _var._editorAreaOriginCssText;\r\n                topArea.style.cssText = _var._originCssText;\r\n                _d.body.style.overflow = _var._bodyOverflow;\r\n\r\n                if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\r\n\r\n                if (options.stickyToolbar > -1) {\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\r\n                    _var._fullScreenAttrs.sticky = false;\r\n                    context.element._stickyDummy.style.display = 'block';\r\n                    util.addClass(toolbar, \"se-toolbar-sticky\");\r\n                }\r\n\r\n                this._isInline = _var._fullScreenAttrs.inline;\r\n                this._isBalloon = _var._fullScreenAttrs.balloon;\r\n                if (this._isInline) event._showToolbarInline();\r\n                if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\r\n\r\n                event.onScroll_window();\r\n                util.changeElement(element.firstElementChild, icons.expansion);\r\n\r\n                context.element.topArea.style.marginTop = '';\r\n                util.removeClass(this._styleCommandMap.fullScreen, 'active');\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\r\n        },\r\n\r\n        /**\r\n         * @description Prints the current contents of the editor.\r\n         */\r\n        print: function () {\r\n            const iframe = util.createElement('IFRAME');\r\n            iframe.style.display = 'none';\r\n            _d.body.appendChild(iframe);\r\n\r\n            const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const printDocument = util.getIframeDocument(iframe);\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n\r\n            this.showLoading();\r\n            _w.setTimeout(function () {\r\n                try {\r\n                    iframe.focus();\r\n                    // IE or Edge\r\n                    if (util.isIE_Edge || !!_d.documentMode || !!_w.StyleMedia) {\r\n                        try {\r\n                            iframe.contentWindow.document.execCommand('print', false, null);\r\n                        } catch (e) {\r\n                            iframe.contentWindow.print();\r\n                        }\r\n                    } else {\r\n                        // Other browsers\r\n                        iframe.contentWindow.print();\r\n                    }\r\n                } catch (error) {\r\n                    throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\r\n                } finally {\r\n                    core.closeLoading();\r\n                    util.removeItem(iframe);\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        /**\r\n         * @description Open the preview window.\r\n         */\r\n        preview: function () {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            \r\n            const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const windowObject = _w.open('', '_blank');\r\n            windowObject.mimeType = 'text/html';\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n                \r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    '<meta charset=\"utf-8\" />' +\r\n                    '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' +\r\n                    '<title>' + lang.toolbar.preview + '</title>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the HTML string\r\n         * @param {String|undefined} html HTML string\r\n         */\r\n        setContents: function (html) {\r\n            this.removeRange();\r\n            \r\n            const convertValue = (html === null || html === undefined) ? '' : this.convertContentsForEditor(html);\r\n            this._resetComponents();\r\n\r\n            if (!this._variable.isCodeView) {\r\n                context.element.wysiwyg.innerHTML = convertValue;\r\n                // history stack\r\n                this.history.push(false);\r\n            } else {\r\n                const value = this.convertHTMLForCodeView(convertValue);\r\n                this._setCodeView(value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n         * @param {Object} ctx { head: HTML string, body: HTML string}\r\n         */\r\n        setIframeContents: function (ctx) {\r\n            if (!options.iframe) return false;\r\n            if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\r\n            if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {Object}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            const contents = context.element.wysiwyg.innerHTML;\r\n            const renderHTML = util.createElement('DIV');\r\n            renderHTML.innerHTML = contents;\r\n\r\n            const figcaptions = util.getListChildren(renderHTML, function (current) {\r\n                return /FIGCAPTION/i.test(current.nodeName);\r\n            });\r\n\r\n            for (let i = 0, len = figcaptions.length; i < len; i++) {\r\n                figcaptions[i].removeAttribute('contenteditable');\r\n            }\r\n\r\n            if (options.fullPage && !onlyContents) {\r\n                const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\r\n                return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\r\n            } else {\r\n                return renderHTML.innerHTML;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Returns HTML string according to tag type and configuration.\r\n         * Use only \"cleanHTML\"\r\n         * @param {Node} node Node\r\n         * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n         * @private\r\n         */\r\n        _makeLine: function (node, requireFormat) {\r\n            const defaultTag = options.defaultTag;\r\n            // element\r\n            if (node.nodeType === 1) {\r\n                if (util._disallowedTags(node)) return '';\r\n                if (!requireFormat || (util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || (util.isAnchor(node) && util.isMedia(node.firstElementChild)))) {\r\n                    return node.outerHTML;\r\n                } else {\r\n                    return '<' + defaultTag + '>' + node.outerHTML + '</' + defaultTag + '>';\r\n                }\r\n            }\r\n            // text\r\n            if (node.nodeType === 3) {\r\n                if (!requireFormat) return util._HTMLConvertor(node.textContent);\r\n                const textArray = node.textContent.split(/\\n/g);\r\n                let html = '';\r\n                for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\r\n                    text = textArray[i].trim();\r\n                    if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\r\n                }\r\n                return html;\r\n            }\r\n            // comments\r\n            if (node.nodeType === 8 && this._allowHTMLComments) {\r\n                return '<!--' + node.textContent.trim() + '-->';\r\n            }\r\n\r\n            return '';\r\n        },\r\n\r\n        /**\r\n         * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n         * @param {String} text \r\n         * @returns {String} HTML string\r\n         * @private\r\n         */\r\n        _tagConvertor: function (text) {\r\n            if (!this._disallowedTextTagsRegExp) return text;\r\n\r\n            const ec = options._textTagsMap;\r\n            return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\r\n                return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Delete disallowed tags\r\n         * @param {String} html HTML string\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _deleteDisallowedTags: function (html) {\r\n            return html\r\n                .replace(/\\n/g, '')\r\n                .replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '')\r\n                .replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '')\r\n                .replace(this.editorTagsWhitelistRegExp, '');\r\n        },\r\n\r\n        /**\r\n         * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n         * @param {Boolean} lowLevelCheck Row level check\r\n         * @param {String} m RegExp value\r\n         * @param {String} t RegExp value\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _cleanTags: function (lowLevelCheck, m, t) {\r\n            if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\r\n\r\n            let v = null;\r\n            const tAttr = this._attributesTagsWhitelist[t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase()];\r\n            if (tAttr) v = m.match(tAttr);\r\n            else v = m.match(this._attributesWhitelistRegExp);\r\n\r\n            if (!lowLevelCheck || /<a\\b/i.test(t)) {\r\n                const sv = m.match(/id\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv) {\r\n                    if (!v) v = [];\r\n                    v.push(sv[0]);\r\n                }\r\n            }\r\n\r\n            if ((!lowLevelCheck || /<span/i.test(t)) && (!v || !/style=/i.test(v.toString()))) {\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv) {\r\n                    if (!v) v = [];\r\n                    v.push(sv[0]);\r\n                }\r\n            }\r\n\r\n            if (v) {\r\n                for (let i = 0, len = v.length; i < len; i++) {\r\n                    if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i])) continue;\r\n                    t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i]) ? '' : v[i]);\r\n                }\r\n            }\r\n\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the clean HTML code for editor\r\n         * @param {String} html HTML string\r\n         * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n         * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n         * @returns {String}\r\n         */\r\n        cleanHTML: function (html, whitelist) {\r\n            html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true));\r\n\r\n            const dom = _d.createRange().createContextualFragment(html);\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, true);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\r\n            }\r\n            \r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            let requireFormat = false;\r\n\r\n            for (let i = 0, len = domTree.length, t; i < len; i++) {\r\n                t = domTree[i];\r\n                if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\r\n                    requireFormat = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], requireFormat);\r\n            }\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(!cleanHTML ? html : !whitelist ? cleanHTML : cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, ''));\r\n        },\r\n\r\n        /**\r\n         * @description Converts contents into a format that can be placed in an editor\r\n         * @param {String} contents contents\r\n         * @returns {String}\r\n         */\r\n        convertContentsForEditor: function (contents) {\r\n            contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\r\n            const dom = _d.createRange().createContextualFragment(contents);\r\n\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, false);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\r\n            }\r\n\r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], true);\r\n            }\r\n\r\n            if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n         * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n         * @returns {String}\r\n         */\r\n        convertHTMLForCodeView: function (html) {\r\n            let returnHTML = '';\r\n            const wRegExp = _w.RegExp;\r\n            const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\r\n            const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\r\n            const isFormat = function (current) { return this.isFormatElement(current) || this.isComponent(current); }.bind(util);\r\n\r\n            let indentSize = this._variable.codeIndent * 1;\r\n            indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\r\n\r\n            (function recursionFunc (element, indent, lineBR) {\r\n                const children = element.childNodes;\r\n                const elementRegTest = brReg.test(element.nodeName);\r\n                const elementIndent = (elementRegTest ? indent : '');\r\n\r\n                for (let i = 0, len = children.length, node, br, nodeRegTest, tag, tagIndent; i < len; i++) {\r\n                    node = children[i];\r\n                    nodeRegTest = brReg.test(node.nodeName);\r\n                    br = nodeRegTest ? '\\n' : '';\r\n                    lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? '\\n' : '';\r\n\r\n                    if (node.nodeType === 8) {\r\n                        returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\r\n                        continue;\r\n                    }\r\n                    if (node.nodeType === 3) {\r\n                        if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\r\n                        continue;\r\n                    }\r\n                    if (node.childNodes.length === 0) {\r\n                        returnHTML += (/^HR$/i.test(node.nodeName) ? '\\n' : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\r\n                        continue;\r\n                    }\r\n\r\n                    if (!node.outerHTML) { // IE\r\n                        returnHTML += new _w.XMLSerializer().serializeToString(node);\r\n                    } else {\r\n                        tag = node.nodeName.toLowerCase();\r\n                        tagIndent = elementIndent || nodeRegTest ? indent : '';\r\n                        returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\r\n                        recursionFunc(node, indent + indentSize, '');\r\n                        returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? '\\n' : '' || /^(TH|TD)$/i.test(node.nodeName) ? '\\n' : '');\r\n                    }\r\n                }\r\n            }(wDoc, '', '\\n'));\r\n\r\n            return returnHTML.trim() + '\\n';\r\n        },\r\n\r\n        /**\r\n         * @description Add an event to document.\r\n         * When created as an Iframe, the same event is added to the document in the Iframe.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         * @param {Boolean} useCapture Use event capture\r\n         */\r\n        addDocEvent: function (type, listener, useCapture) {\r\n            _d.addEventListener(type, listener, useCapture);\r\n            if (options.iframe) {\r\n                this._wd.addEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove events from document.\r\n        * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         */\r\n        removeDocEvent: function (type, listener) {\r\n            _d.removeEventListener(type, listener);\r\n            if (options.iframe) {\r\n                this._wd.removeEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The current number of characters is counted and displayed.\r\n         * @param {String} inputText Text added.\r\n         * @returns {Boolean}\r\n         * @private\r\n         */\r\n        _charCount: function (inputText) {\r\n            const maxCharCount = options.maxCharCount;\r\n            const countType = options.charCounterType;\r\n            let nextCharCount = 0;\r\n            if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\r\n\r\n            this._setCharCount();\r\n\r\n            if (maxCharCount > 0) {\r\n                let over = false;\r\n                const count = functions.getCharCount(countType);\r\n                \r\n                if (count > maxCharCount) {\r\n                    over = true;\r\n                    if (nextCharCount > 0) {\r\n                        this._editorRange();\r\n                        const range = this.getRange();\r\n                        const endOff = range.endOffset - 1;\r\n                        const text = this.getSelectionNode().textContent;\r\n                        const slicePosition = range.endOffset - (count - maxCharCount);\r\n    \r\n                        this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\r\n                        this.setRange(range.endContainer, endOff, range.endContainer, endOff);\r\n                    }\r\n                } else if ((count + nextCharCount) > maxCharCount) {\r\n                    over = true;\r\n                }\r\n\r\n                if (over) {\r\n                    this._callCounterBlink();\r\n                    if (nextCharCount > 0) return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n         * @param {Node|String} element Element node or String.\r\n         * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n         * @returns {Boolean}\r\n         */\r\n        checkCharCount: function (element, charCounterType) {\r\n            if (options.maxCharCount) {\r\n                const countType = charCounterType || options.charCounterType;\r\n                const length = this.getCharLength((typeof element === 'string' ? element : (this._charTypeHTML && element.nodeType === 1) ? element.outerHTML : element.textContent), countType);\r\n                if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\r\n                    this._callCounterBlink();\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Get the length of the content.\r\n         * Depending on the option, the length of the character is taken. (charCounterType)\r\n         * @param {String} content Content to count\r\n         * @param {String} charCounterType options.charCounterType\r\n         * @returns {Number}\r\n         */\r\n        getCharLength: function (content, charCounterType) {\r\n            return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\r\n        },\r\n\r\n        /**\r\n         * @description Set the char count to charCounter element textContent.\r\n         * @private\r\n         */\r\n        _setCharCount: function () {\r\n            if (context.element.charCounter) {\r\n                _w.setTimeout(function () { context.element.charCounter.textContent = functions.getCharCount(options.charCounterType); });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The character counter blinks.\r\n         * @private\r\n         */\r\n        _callCounterBlink: function () {\r\n            const charWrapper = context.element.charWrapper;\r\n            if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\r\n                util.addClass(charWrapper, 'se-blink');\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(charWrapper, 'se-blink');\r\n                }, 600);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Check the components such as image and video and modify them according to the format.\r\n         * @private\r\n         */\r\n        _checkComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\r\n                this._fileInfoPluginsCheck[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initialize the information of the components.\r\n         * @private\r\n         */\r\n        _resetComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\r\n                this._fileInfoPluginsReset[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set method in the code view area\r\n         * @param {String} value HTML string\r\n         * @private\r\n         */\r\n        _setCodeView: function (value) {\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.getDoc().setValue(value);\r\n            } else {\r\n                context.element.code.value = value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Get method in the code view area\r\n         * @private\r\n         */\r\n        _getCodeView: function () {\r\n            return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\r\n        },\r\n\r\n        /**\r\n         * @description remove class, display text.\r\n         * @param {Array|null} ignoredList Igonred button list\r\n         */\r\n        _setKeyEffect: function (ignoredList) {\r\n            const commandMap = this.commandMap;\r\n            const activePlugins = this.activePlugins;\r\n\r\n            for (let key in commandMap) {\r\n                if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(this, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    if (!this.isReadOnly) commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    if (!this.isReadOnly) commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initializ core variable\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _init: function (reload, _initHTML) {\r\n            const wRegExp = _w.RegExp;\r\n            this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\r\n            this._wd = _d;\r\n            this._charTypeHTML = options.charCounterType === 'byte-html';\r\n\r\n            if (!options.iframe && typeof _w.ShadowRoot === 'function') {\r\n                let child = context.element.wysiwygFrame;\r\n                while (child) {\r\n                    if (child.shadowRoot) {\r\n                        this._shadowRoot = child.shadowRoot;\r\n                        break;\r\n                    } else if (child instanceof _w.ShadowRoot) {\r\n                        this._shadowRoot = child;\r\n                        break;\r\n                    }\r\n                    child = child.parentNode;\r\n                }\r\n                if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\r\n            }\r\n\r\n            // set disallow text nodes\r\n            const disallowTextTags = _w.Object.keys(options._textTagsMap);\r\n            const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) { return /b|i|ins|s|strike/i.test(v); });\r\n            for (let i = 0; i < allowTextTags.length; i++) {\r\n                disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\r\n            }\r\n            this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi');\r\n\r\n            // set whitelist\r\n            const defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|origin-size|data-exp|data-font-size';\r\n            this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1;\r\n            this._htmlCheckWhitelistRegExp = new wRegExp('^(' + options._editorTagsWhitelist.replace('|//', '') + ')$', 'i');\r\n            this.editorTagsWhitelistRegExp = util.createTagsWhitelist(options._editorTagsWhitelist.replace('|//', '|<!--|-->'));\r\n            this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(options.pasteTagsWhitelist);\r\n\r\n            const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\r\n            const _attr = options.attributesWhitelist;\r\n            const tagsAttr = {};\r\n            let allAttr = '';\r\n            if (!!_attr) {\r\n                for (let k in _attr) {\r\n                    if (!util.hasOwn(_attr, k) || /^on[a-z]+$/i.test(_attr[k])) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = _attr[k] + '|';\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('(?:' + _attr[k] + '|' + defaultAttr + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._attributesWhitelistRegExp = new wRegExp('(?:' + allAttr + defaultAttr + ')' + regEndStr, 'ig');\r\n            this._attributesTagsWhitelist = tagsAttr;\r\n\r\n            // set modes\r\n            this._isInline = /inline/i.test(options.mode);\r\n            this._isBalloon = /balloon|balloon-always/i.test(options.mode);\r\n            this._isBalloonAlways = /balloon-always/i.test(options.mode);\r\n\r\n            // caching buttons\r\n            this._cachingButtons();\r\n\r\n            // file components\r\n            this._fileInfoPluginsCheck = [];\r\n            this._fileInfoPluginsReset = [];\r\n\r\n            // text components\r\n            this.managedTagsInfo = { query: '', map: {} };\r\n            const managedClass = [];\r\n\r\n            // Command and file plugins registration\r\n            this.activePlugins = [];\r\n            this._fileManager.tags = [];\r\n            this._fileManager.pluginMap = {};\r\n\r\n            let filePluginRegExp = [];\r\n            let plugin, button;\r\n            for (let key in plugins) {\r\n                if (!util.hasOwn(plugins, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if (plugin.active && button) {\r\n                    this.callPlugin(key, null, button);\r\n                }\r\n                if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\r\n                    this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\r\n                }\r\n                if (_w.Array.isArray(plugin.fileTags)) {\r\n                    const fileTags = plugin.fileTags;\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileManager.tags = this._fileManager.tags.concat(fileTags);\r\n                    filePluginRegExp.push(key);\r\n                    for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\r\n                        this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\r\n                    }\r\n                }\r\n                if (plugin.managedTags) {\r\n                    const info = plugin.managedTags();\r\n                    managedClass.push('.' + info.className);\r\n                    this.managedTagsInfo.map[info.className] = info.method.bind(this);\r\n                }\r\n            }\r\n\r\n            this.managedTagsInfo.query = managedClass.toString();\r\n            this._fileManager.queryString = this._fileManager.tags.join(',');\r\n            this._fileManager.regExp = new wRegExp('^(' +  this._fileManager.tags.join('|') + ')$', 'i');\r\n            this._fileManager.pluginRegExp = new wRegExp('^(' +  (filePluginRegExp.length === 0 ? 'undefined' : filePluginRegExp.join('|')) + ')$', 'i');\r\n            \r\n            // cache editor's element\r\n            this._variable._originCssText = context.element.topArea.style.cssText;\r\n            this._placeholder = context.element.placeholder;\r\n            this._lineBreaker = context.element.lineBreaker;\r\n            this._lineBreakerButton = this._lineBreaker.querySelector('button');\r\n\r\n            // Excute history function\r\n            this.history = _history(this, this._onChange_historyStack.bind(this));\r\n\r\n            // register notice module\r\n            this.addModule([_notice]);\r\n\r\n            // Init, validate\r\n            if (options.iframe) {\r\n                this._wd = context.element.wysiwygFrame.contentDocument;\r\n                context.element.wysiwyg = this._wd.body;\r\n                if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\r\n                if (options.height === 'auto') this._iframeAuto = this._wd.body;\r\n            }\r\n            \r\n            this._initWysiwygArea(reload, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Caching basic buttons to use\r\n         * @private\r\n         */\r\n        _cachingButtons: function () {\r\n            this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"])');\r\n            this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\r\n\r\n            const tool = context.tool;\r\n            this.commandMap = {\r\n                SUB: tool.subscript,\r\n                SUP: tool.superscript,\r\n                OUTDENT: tool.outdent,\r\n                INDENT: tool.indent\r\n            };\r\n            this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\r\n            this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\r\n            this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\r\n            this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\r\n            \r\n            this._styleCommandMap = {\r\n                fullScreen: tool.fullScreen,\r\n                showBlocks: tool.showBlocks,\r\n                codeView: tool.codeView\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Initializ wysiwyg area (Only called from core._init)\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _initWysiwygArea: function (reload, _initHTML) {\r\n            context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\r\n        },\r\n\r\n        /**\r\n         * @description Called when there are changes to tags in the wysiwyg region.\r\n         * @private\r\n         */\r\n        _resourcesStateChange: function () {\r\n            this._iframeAutoHeight();\r\n            this._checkPlaceholder();\r\n        },\r\n\r\n        /**\r\n         * @description Called when after execute \"history.push\"\r\n         * @private\r\n         */\r\n        _onChange_historyStack: function () {\r\n            if (this.hasFocus) event._applyTagEffects();\r\n            this._variable.isChanged = true;\r\n            if (context.tool.save) context.tool.save.removeAttribute('disabled');\r\n            // user event\r\n            if (functions.onChange) functions.onChange(this.getContents(true), this);\r\n            if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n         * @private\r\n         */\r\n        _iframeAutoHeight: function () {\r\n            if (this._iframeAuto) {\r\n                _w.setTimeout(function () { context.element.wysiwygFrame.style.height = core._iframeAuto.offsetHeight + 'px'; });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set display property when there is placeholder.\r\n         * @private\r\n         */\r\n        _checkPlaceholder: function () {\r\n            if (this._placeholder) {\r\n                if (this._variable.isCodeView) {\r\n                    this._placeholder.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\r\n                    this._placeholder.style.display = 'none';\r\n                } else {\r\n                    this._placeholder.style.display = 'block';\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If there is no default format, add a format and move \"selection\".\r\n         * @param {String|null} formatName Format tag name (default: 'P')\r\n         * @returns {undefined|null}\r\n         * @private\r\n         */\r\n        _setDefaultFormat: function (formatName) {\r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\r\n\r\n            const range = this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startCon = range.startContainer;\r\n            const rangeEl = util.getRangeFormatElement(commonCon, null);\r\n            let focusNode, offset, format;\r\n\r\n            const fileComponent = util.getParentElement(commonCon, util.isComponent);\r\n            if (fileComponent && !util.isTable(fileComponent)) return;\r\n            if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\r\n            if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\r\n\r\n            if (rangeEl) {\r\n                format = util.createElement(formatName || options.defaultTag);\r\n                format.innerHTML = rangeEl.innerHTML;\r\n                if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\r\n\r\n                rangeEl.innerHTML = format.outerHTML;\r\n                format = rangeEl.firstChild;\r\n                focusNode = util.getEdgeChildNodes(format, null).sc;\r\n\r\n                if (!focusNode) {\r\n                    focusNode = util.createTextNode(util.zeroWidthSpace);\r\n                    format.insertBefore(focusNode, format.firstChild);\r\n                }\r\n                \r\n                offset = focusNode.textContent.length;\r\n                this.setRange(focusNode, offset, focusNode, offset);\r\n                return;\r\n            }\r\n\r\n            if(util.isRangeFormatElement(commonCon) && (commonCon.childNodes.length <= 1)) {\r\n                let br = null;\r\n                if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\r\n                    br = commonCon.firstChild;\r\n                } else {\r\n                    br = util.createTextNode(util.zeroWidthSpace);\r\n                    commonCon.appendChild(br);\r\n                }\r\n\r\n                this.setRange(br, 1, br, 1);\r\n                return;\r\n            }\r\n\r\n            this.execCommand('formatBlock', false, (formatName || options.defaultTag));\r\n            focusNode = util.getEdgeChildNodes(commonCon, commonCon);\r\n            focusNode = focusNode ? focusNode.ec : commonCon;\r\n\r\n            format = util.getFormatElement(focusNode, null);\r\n            if (!format) {\r\n                this.removeRange();\r\n                this._editorRange();\r\n                return;\r\n            }\r\n            \r\n            if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\r\n            if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\r\n            if (util.isBreak(focusNode)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                focusNode.parentNode.insertBefore(zeroWidth, focusNode);\r\n                focusNode = zeroWidth;\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.nativeFocus();\r\n        },\r\n\r\n        /**\r\n         * @description Initialization after \"setOptions\"\r\n         * @param {Object} el context.element\r\n         * @param {String} _initHTML Initial html string\r\n         * @private\r\n         */\r\n        _setOptionsInit: function (el, _initHTML) {\r\n            this.context = context = _Context(el.originElement, this._getConstructed(el), options);\r\n            this._componentsInfoReset = true;\r\n            this._editorInit(true, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Initializ editor\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _editorInit: function (reload, _initHTML) {\r\n            // initialize core and add event listeners\r\n            this._init(reload, _initHTML);\r\n            event._addEvent();\r\n            this._setCharCount();\r\n            event._offStickyToolbar();\r\n            event.onResize_window();\r\n\r\n            // toolbar visibility\r\n            context.element.toolbar.style.visibility = '';\r\n\r\n            this._checkComponents();\r\n            this._componentsInfoInit = false;\r\n            this._componentsInfoReset = false;\r\n\r\n            this.history.reset(true);\r\n            this._resourcesStateChange();\r\n\r\n            _w.setTimeout(function () {\r\n                // user event\r\n                if (typeof functions.onload === 'function') functions.onload(core, reload);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Create and return an object to cache the new context.\r\n         * @param {Element} contextEl context.element\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _getConstructed: function (contextEl) {\r\n            return {\r\n                _top: contextEl.topArea,\r\n                _relative: contextEl.relative,\r\n                _toolBar: contextEl.toolbar,\r\n                _menuTray: contextEl._menuTray,\r\n                _editorArea: contextEl.editorArea,\r\n                _wysiwygArea: contextEl.wysiwygFrame,\r\n                _codeArea: contextEl.code,\r\n                _placeholder: contextEl.placeholder,\r\n                _resizingBar: contextEl.resizingBar,\r\n                _navigation: contextEl.navigation,\r\n                _charCounter: contextEl.charCounter,\r\n                _charWrapper: contextEl.charWrapper,\r\n                _loading: contextEl.loading,\r\n                _lineBreaker: contextEl.lineBreaker,\r\n                _lineBreaker_t: contextEl.lineBreaker_t,\r\n                _lineBreaker_b: contextEl.lineBreaker_b,\r\n                _resizeBack: contextEl.resizeBackground,\r\n                _stickyDummy: contextEl._stickyDummy,\r\n                _arrow: contextEl._arrow\r\n            };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description event function\r\n     */\r\n    const event = {\r\n        _IEisComposing: false, // In IE, there is no \"e.isComposing\" in the key-up event.\r\n        _lineBreakerBind: null,\r\n        _responsiveCurrentSize: 'default',\r\n        _responsiveButtonSize: null,\r\n        _responsiveButtons: null,\r\n        _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\r\n        _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\r\n        _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\r\n        _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\r\n        _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\r\n        _keyCodeShortcut: {\r\n            65: 'A',\r\n            66: 'B',\r\n            83: 'S',\r\n            85: 'U',\r\n            73: 'I',\r\n            89: 'Y',\r\n            90: 'Z',\r\n            219: '[',\r\n            221: ']'\r\n        },\r\n\r\n        _shortcutCommand: function (keyCode, shift) {\r\n            let command = null;\r\n            const keyStr = event._keyCodeShortcut[keyCode];\r\n\r\n            switch (keyStr) {\r\n                case 'A':\r\n                    command = 'selectAll';\r\n                    break;\r\n                case 'B':\r\n                    if (options.shortcutsDisable.indexOf('bold') === -1) {\r\n                        command = 'bold';\r\n                    }\r\n                    break;\r\n                case 'S':\r\n                    if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\r\n                        command = 'strike';\r\n                    } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\r\n                        command = 'save';\r\n                    }\r\n                    break;\r\n                case 'U':\r\n                    if (options.shortcutsDisable.indexOf('underline') === -1) {\r\n                        command = 'underline';\r\n                    }\r\n                    break;\r\n                case 'I':\r\n                    if (options.shortcutsDisable.indexOf('italic') === -1) {\r\n                        command = 'italic';\r\n                    }\r\n                    break;\r\n                case 'Z':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        if (shift) {\r\n                            command = 'redo';\r\n                        } else {\r\n                            command = 'undo';\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'Y':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        command = 'redo';\r\n                    }\r\n                    break;\r\n                case '[':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'indent' : 'outdent';\r\n                    }\r\n                    break;\r\n                case ']':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'outdent' : 'indent';\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (!command) return false;\r\n\r\n            core.commandHandler(core.commandMap[command], command);\r\n            return true;\r\n        },\r\n\r\n        _applyTagEffects: function () {\r\n            let selectionNode = core.getSelectionNode();\r\n            if (selectionNode === core.effectNode) return;\r\n            core.effectNode = selectionNode;\r\n\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            const commandMap = core.commandMap;\r\n            const classOnCheck = this._onButtonsCheck;\r\n            const commandMapNodes = [];\r\n            const currentNodes = [];\r\n\r\n            const activePlugins = core.activePlugins;\r\n            const cLen = activePlugins.length;\r\n            let nodeName = '';\r\n\r\n            while (selectionNode.firstChild) {\r\n                selectionNode = selectionNode.firstChild;\r\n            }\r\n\r\n            for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\r\n                if (!element) break;\r\n                if (element.nodeType !== 1 || util.isBreak(element)) continue;\r\n                nodeName = element.nodeName.toUpperCase();\r\n                currentNodes.push(nodeName);\r\n\r\n                /* Active plugins */\r\n                if (!core.isReadOnly) {\r\n                    for (let c = 0, name; c < cLen; c++) {\r\n                        name = activePlugins[c];\r\n                        if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\r\n                            commandMapNodes.push(name);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (!core.isReadOnly && util.isFormatElement(element)) {\r\n                    /* Outdent */\r\n                    if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT) {\r\n                        if (util.isListCell(element) || (element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0)) {\r\n                            commandMapNodes.push('OUTDENT');\r\n                            commandMap.OUTDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    /* Indent */\r\n                    if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT) {\r\n                        commandMapNodes.push('INDENT');\r\n                        if (util.isListCell(element) && !element.previousElementSibling) {\r\n                            commandMap.INDENT.setAttribute('disabled', true);\r\n                        } else {\r\n                            commandMap.INDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                /** default active buttons [strong, ins, em, del, sub, sup] */\r\n                if (classOnCheck.test(nodeName)) {\r\n                    commandMapNodes.push(nodeName);\r\n                    util.addClass(commandMap[nodeName], 'active');\r\n                }\r\n            }\r\n\r\n            core._setKeyEffect(commandMapNodes);\r\n\r\n            /** save current nodes */\r\n            core._variable.currentNodes = currentNodes.reverse();\r\n            core._variable.currentNodesMap = commandMapNodes;\r\n\r\n            /**  Displays the current node structure to resizingBar */\r\n            if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\r\n        },\r\n\r\n        _cancelCaptionEdit: function () {\r\n            this.setAttribute('contenteditable', false);\r\n            this.removeEventListener('blur', event._cancelCaptionEdit);\r\n        },\r\n\r\n        _buttonsEventHandler: function (e) {\r\n            let target = e.target;\r\n            if (core._bindControllersOff) e.stopPropagation();\r\n\r\n            if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\r\n                core._antiBlur = false;\r\n            } else {\r\n                e.preventDefault();\r\n            }\r\n\r\n            if (util.getParentElement(target, '.se-submenu')) {\r\n                e.stopPropagation();\r\n                core._notHideToolbar = true;\r\n            } else {\r\n                let command = target.getAttribute('data-command');\r\n                let className = target.className;\r\n    \r\n                while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\r\n                    target = target.parentNode;\r\n                    command = target.getAttribute('data-command');\r\n                    className = target.className;\r\n                }\r\n    \r\n                if (command === core._submenuName || command === core._containerName) {\r\n                    e.stopPropagation();\r\n                }\r\n            }\r\n        },\r\n\r\n        onClick_toolbar: function (e) {\r\n            let target = e.target;\r\n            let display = target.getAttribute('data-display');\r\n            let command = target.getAttribute('data-command');\r\n            let className = target.className;\r\n            core.controllersOff();\r\n\r\n            while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\r\n                target = target.parentNode;\r\n                command = target.getAttribute('data-command');\r\n                display = target.getAttribute('data-display');\r\n                className = target.className;\r\n            }\r\n\r\n            if (!command && !display) return;\r\n            if (target.disabled) return;\r\n            if (!core.isReadOnly && !core.hasFocus) core.nativeFocus();\r\n            if (!core.isReadOnly && !core._variable.isCodeView) core._editorRange();\r\n\r\n            core.actionCall(command, display, target);\r\n        },\r\n\r\n        onMouseDown_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\r\n            \r\n            const tableCell = util.getParentElement(e.target, util.isCell);\r\n            if (tableCell) {\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\r\n                    core.callPlugin('table', function () {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\r\n                    }, null);\r\n                }\r\n            }\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\r\n        },\r\n\r\n        onClick_wysiwyg: function (e) {\r\n            const targetElement = e.target;\r\n\r\n            if (core.isReadOnly) {\r\n                e.preventDefault();\r\n                if (util.isAnchor(targetElement)){\r\n                    _w.open(targetElement.href, targetElement.target);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\r\n\r\n            const fileComponentInfo = core.getFileComponent(targetElement);\r\n            if (fileComponentInfo) {\r\n                e.preventDefault();\r\n                core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                return;\r\n            }\r\n\r\n            const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\r\n            if (util.isNonEditable(figcaption)) {\r\n                e.preventDefault();\r\n                figcaption.setAttribute('contenteditable', true);\r\n                figcaption.focus();\r\n\r\n                if (core._isInline && !core._inlineToolbarAttr.isShow) {\r\n                    event._showToolbarInline();\r\n\r\n                    const hideToolbar = function () {\r\n                        event._hideToolbar();\r\n                        figcaption.removeEventListener('blur', hideToolbar);\r\n                    };\r\n\r\n                    figcaption.addEventListener('blur', hideToolbar);\r\n                }\r\n            }\r\n\r\n            _w.setTimeout(core._editorRange.bind(core));\r\n            core._editorRange();\r\n\r\n            const selectionNode = core.getSelectionNode();\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\r\n                const range = core.getRange();\r\n                if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\r\n                    if (util.isList(rangeEl)) {\r\n                        e.preventDefault();\r\n                        const oLi = util.createElement('LI');\r\n                        const prevLi = selectionNode.nextElementSibling;\r\n                        oLi.appendChild(selectionNode);\r\n                        rangeEl.insertBefore(oLi, prevLi);\r\n                        core.focus();\r\n                    } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        core.focus();\r\n                    } else {\r\n                        event._applyTagEffects();\r\n                    }\r\n                }\r\n            } else {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\r\n        },\r\n\r\n        _balloonDelay: null,\r\n        _showToolbarBalloonDelay: function () {\r\n            if (event._balloonDelay) {\r\n                _w.clearTimeout(event._balloonDelay);\r\n            }\r\n\r\n            event._balloonDelay = _w.setTimeout(function () {\r\n                _w.clearTimeout(this._balloonDelay);\r\n                this._balloonDelay = null;\r\n                this._showToolbarBalloon();\r\n            }.bind(event), 350);\r\n        },\r\n\r\n        _toggleToolbarBalloon: function () {\r\n            core._editorRange();\r\n            const range = core.getRange();\r\n            if (core._bindControllersOff || (!core._isBalloonAlways && range.collapsed)) event._hideToolbar();\r\n            else event._showToolbarBalloon(range);\r\n        },\r\n\r\n        _showToolbarBalloon: function (rangeObj) {\r\n            if (!core._isBalloon) return;\r\n\r\n            const range = rangeObj || core.getRange();\r\n            const toolbar = context.element.toolbar;\r\n            const topArea = context.element.topArea;\r\n            const selection = core.getSelection();\r\n\r\n            let isDirTop;\r\n            if (core._isBalloonAlways && range.collapsed) {\r\n                isDirTop = true;\r\n            } else if (selection.focusNode === selection.anchorNode) {\r\n                isDirTop = selection.focusOffset < selection.anchorOffset;\r\n            } else {\r\n                const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\r\n                isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\r\n            }\r\n\r\n            let rects = range.getClientRects();\r\n            rects = rects[isDirTop ? 0 : rects.length - 1];\r\n\r\n            const globalScroll = core.getGlobalScrollOffset();\r\n            let scrollLeft = globalScroll.left;\r\n            let scrollTop = globalScroll.top;\r\n\r\n            const editorWidth = topArea.offsetWidth;\r\n            const offsets = event._getEditorOffsets(null);\r\n            const stickyTop = offsets.top;\r\n            const editorLeft = offsets.left;\r\n            \r\n            toolbar.style.top = '-10000px';\r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n\r\n            if (!rects) {\r\n                const node = core.getSelectionNode();\r\n                if (util.isFormatElement(node)) {\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    core.insertNode(zeroWidth, null, false);\r\n                    core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n                    core._editorRange();\r\n                    rects = core.getRange().getClientRects();\r\n                    rects = rects[isDirTop ? 0 : rects.length - 1];\r\n                }\r\n\r\n                if (!rects) {\r\n                    const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\r\n                    rects = {\r\n                        left: nodeOffset.left,\r\n                        top: nodeOffset.top,\r\n                        right: nodeOffset.left,\r\n                        bottom: nodeOffset.top + node.offsetHeight,\r\n                        noText: true\r\n                    };\r\n                    scrollLeft = 0;\r\n                    scrollTop = 0;\r\n                }\r\n\r\n                isDirTop = true;\r\n            }\r\n\r\n            const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = toolbar.offsetHeight;\r\n            const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\r\n            if (iframeRects) {\r\n                rects = {\r\n                    left: rects.left + iframeRects.left,\r\n                    top: rects.top + iframeRects.top,\r\n                    right: rects.right + iframeRects.right - iframeRects.width,\r\n                    bottom: rects.bottom + iframeRects.bottom - iframeRects.height\r\n                };\r\n            }\r\n            \r\n            event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\r\n                event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            }\r\n\r\n            if (options.toolbarContainer) {\r\n                const editorParent = topArea.parentElement;\r\n\r\n                let container = options.toolbarContainer;\r\n                let left = container.offsetLeft;\r\n                let top = container.offsetTop;\r\n\r\n                while(!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\r\n                    container = container.offsetParent;\r\n                    left += container.offsetLeft;\r\n                    top += container.offsetTop;\r\n                }\r\n\r\n                toolbar.style.left = (toolbar.offsetLeft - left + topArea.offsetLeft) + 'px';\r\n                toolbar.style.top = (toolbar.offsetTop - top + topArea.offsetTop) + 'px';\r\n            }\r\n\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\r\n            const padding = 1;\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\r\n\r\n            const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - (toolbarWidth / 2) + scrollLeft;\r\n            const overRight = absoluteLeft + toolbarWidth - editorWidth;\r\n            \r\n            let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n            let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\r\n\r\n            let resetTop = false;\r\n            const space = t + (isDirTop ? (event._getEditorOffsets(null).top) : (toolbar.offsetHeight - context.element.wysiwyg.offsetHeight));\r\n            if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\r\n                isDirTop = true;\r\n                resetTop = true;\r\n            } else if (isDirTop && _d.documentElement.offsetTop > space) {\r\n                isDirTop = false;\r\n                resetTop = true;\r\n            }\r\n\r\n            if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n\r\n            toolbar.style.left = _w.Math.floor(l) + 'px';\r\n            toolbar.style.top = _w.Math.floor(t) + 'px';\r\n\r\n            if (isDirTop) {\r\n                util.removeClass(context.element._arrow, 'se-arrow-up');\r\n                util.addClass(context.element._arrow, 'se-arrow-down');\r\n                context.element._arrow.style.top = toolbarHeight + 'px';\r\n            } else {\r\n                util.removeClass(context.element._arrow, 'se-arrow-down');\r\n                util.addClass(context.element._arrow, 'se-arrow-up');\r\n                context.element._arrow.style.top = -arrowMargin + 'px';\r\n            }\r\n\r\n            const arrow_left = _w.Math.floor((toolbarWidth / 2) + (absoluteLeft - l));\r\n            context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\r\n        },\r\n\r\n        _showToolbarInline: function () {\r\n            if (!core._isInline) return;\r\n\r\n            const toolbar = context.element.toolbar;\r\n            if (options.toolbarContainer) toolbar.style.position = 'relative';\r\n            else toolbar.style.position = 'absolute';\r\n            \r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n            core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\r\n            core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : (-1 - toolbar.offsetHeight)) + 'px';\r\n            \r\n            if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\r\n\r\n            event.onScroll_window();\r\n            core._inlineToolbarAttr.isShow = true;\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _hideToolbar: function () {\r\n            if (!core._notHideToolbar && !core._variable.isFullScreen) {\r\n                context.element.toolbar.style.display = 'none';\r\n                core._inlineToolbarAttr.isShow = false;\r\n            }\r\n        },\r\n\r\n        onInput_wysiwyg: function (e) {\r\n            if (core.isReadOnly || core.isDisabled) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                core.history.go(core.history.getCurrentIndex());\r\n                return false;\r\n            }\r\n\r\n            core._editorRange();\r\n\r\n            // user event\r\n            if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\r\n\r\n            const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';       \r\n            if (!core._charCount(data)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(true);\r\n        },\r\n\r\n        _isUneditableNode: function (range, isFront) {\r\n            const container = isFront ? range.startContainer : range.endContainer;\r\n            const offset = isFront ? range.startOffset : range.endOffset;\r\n            const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\r\n            const isElement = container.nodeType === 1;\r\n            let siblingNode;\r\n\r\n            if (isElement) {\r\n                siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\r\n                return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\r\n            } else {\r\n                siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\r\n                return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && (siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false');\r\n            }\r\n        },\r\n\r\n        _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\r\n            if (!selectNode) return null;\r\n            let siblingNode = selectNode[siblingKey];\r\n\r\n            if (!siblingNode) {\r\n                siblingNode = util.getFormatElement(container);\r\n                siblingNode = siblingNode ? siblingNode[siblingKey] : null;\r\n                if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;\r\n                else return null;\r\n            }\r\n\r\n            return siblingNode;\r\n        },\r\n\r\n        _onShortcutKey: false,\r\n        onKeyDown_wysiwyg: function (e) {\r\n            const keyCode = e.keyCode;\r\n            const shift = e.shiftKey;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n            event._IEisComposing = keyCode === 229;\r\n\r\n            if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            core.submenuOff();\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\r\n\r\n            /** Shortcuts */\r\n            if (ctrl && event._shortcutCommand(keyCode, shift)) {\r\n                event._onShortcutKey = true;\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            } else if (event._onShortcutKey) {\r\n                event._onShortcutKey = false;\r\n            }\r\n\r\n            /** default key action */\r\n            let selectionNode = core.getSelectionNode();\r\n            const range = core.getRange();\r\n            const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\r\n            const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\r\n            let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\r\n            let rangeEl = util.getRangeFormatElement(formatEl, null);\r\n\r\n            switch (keyCode) {\r\n                case 8: /** backspace key */\r\n                    if (!selectRange) {\r\n                        if (fileComponentName) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            core.plugins[fileComponentName].destroy.call(core);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        return false;\r\n                    }\r\n\r\n                    if (!selectRange && !formatEl.previousElementSibling && (range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && \r\n                     (util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))))) {\r\n                        // closure range\r\n                        if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            return false;\r\n                        }\r\n                        // maintain default format\r\n                        if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\r\n                                formatEl.innerHTML = '<br>';\r\n                                const attrs = formatEl.attributes;\r\n                                while (attrs[0]) {\r\n                                    formatEl.removeAttribute(attrs[0].name);\r\n                                }\r\n                            } else {\r\n                                const defaultFormat = util.createElement(options.defaultTag);\r\n                                defaultFormat.innerHTML = '<br>';\r\n                                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\r\n                            }\r\n\r\n                            core.nativeFocus();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    // clean remove tag\r\n                    if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\r\n                        if (range.collapsed ? selectionNode.textContent.length === 1 : (range.endOffset - range.startOffset) === selectionNode.textContent.length) {\r\n                            e.preventDefault();\r\n\r\n                            let offset = null;\r\n                            let prev = selectionNode.parentNode.previousSibling;\r\n                            const next = selectionNode.parentNode.nextSibling;\r\n                            if (!prev) {\r\n                                if (!next) {\r\n                                    prev = util.createElement('BR');\r\n                                    formatEl.appendChild(prev);\r\n                                } else {\r\n                                    prev = next;\r\n                                    offset = 0;\r\n                                }\r\n                            }\r\n\r\n                            selectionNode.textContent = '';\r\n                            util.removeItemAllParents(selectionNode, null, formatEl);\r\n                            offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\r\n                            core.setRange(prev, offset, prev, offset);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, true)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // nested list\r\n                    const commonCon = range.commonAncestorContainer;\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling)))) &&\r\n                         (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : (range.startOffset === 0  && range.collapsed))) {\r\n                            if (range.startContainer !== range.endContainer) {\r\n                                e.preventDefault();\r\n\r\n                                core.removeNode();\r\n                                if (range.startContainer.nodeType === 3) {\r\n                                    core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\r\n                                }\r\n                                // history stack\r\n                                core.history.push(true);\r\n                            } else {\r\n                                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\r\n                                if (util.isListCell(prev)) {\r\n                                    e.preventDefault();\r\n\r\n                                    let prevLast = prev;\r\n                                    if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                        prevLast = prevLast.lastElementChild.lastElementChild;\r\n                                        while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                            prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\r\n                                        }\r\n                                        prev = prevLast;\r\n                                    }\r\n\r\n                                    let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\r\n                                    if (!con) {\r\n                                        con = util.createTextNode(util.zeroWidthSpace);\r\n                                        rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\r\n                                    }\r\n                                    const offset = con.nodeType === 3 ? con.textContent.length : 1;\r\n                                    const children = formatEl.childNodes;\r\n                                    let after = con;\r\n                                    let child = children[0];\r\n                                    while ((child = children[0])) {\r\n                                        prev.insertBefore(child, after.nextSibling);\r\n                                        after = child;\r\n                                    }\r\n\r\n                                    util.removeItem(formatEl);\r\n                                    if (rangeEl.children.length === 0) util.removeItem(rangeEl);\r\n\r\n                                    core.setRange(con, offset, con, offset);\r\n                                    // history stack\r\n                                    core.history.push(true);\r\n                                }\r\n                            }\r\n                            \r\n                            break;\r\n                        }\r\n\r\n                        // detach range\r\n                        if (!selectRange && range.startOffset === 0) {\r\n                            let detach = true;\r\n                            let comm = commonCon;\r\n                            while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\r\n                                if (comm.previousSibling) {\r\n                                    if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\r\n                                        detach = false;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                comm = comm.parentNode;\r\n                            }\r\n    \r\n                            if (detach && rangeEl.parentNode) {\r\n                                e.preventDefault();\r\n                                core.detachRangeFormatElement(rangeEl, (util.isListCell(formatEl) ? [formatEl] : null), null, false, false);\r\n                                // history stack\r\n                                core.history.push(true);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // component\r\n                    if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\r\n                        const prev = formatEl.previousSibling;\r\n                        // select file component\r\n                        const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\r\n                        if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || (ignoreZWS && util.isComponent(prev)))) {\r\n                            const fileComponentInfo = core.getFileComponent(prev);\r\n                            if (fileComponentInfo) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(prev)) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                util.removeItem(prev);\r\n                            }\r\n                            break;\r\n                        }\r\n                        // delete nonEditable\r\n                        if (util.isNonEditable(sel.previousSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.previousSibling);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                case 46: /** delete key */\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.plugins[fileComponentName].destroy.call(core);\r\n                        break;\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, false)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // component\r\n                    if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || (util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null)) && range.startOffset === selectionNode.textContent.length) {\r\n                        const nextEl = formatEl.nextElementSibling;\r\n                        if (!nextEl) break;\r\n                        if (util.isComponent(nextEl)) {\r\n                            e.preventDefault();\r\n\r\n                            if (util.onlyZeroWidthSpace(formatEl)) {\r\n                                util.removeItem(formatEl);\r\n                                // table component\r\n                                if (util.isTable(nextEl)) {\r\n                                    let cell = util.getChildElement(nextEl, util.isCell, false);\r\n                                    cell = cell.firstElementChild || cell;\r\n                                    core.setRange(cell, 0, cell, 0);\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            // select file component\r\n                            const fileComponentInfo = core.getFileComponent(nextEl);\r\n                            if (fileComponentInfo) {\r\n                                e.stopPropagation();\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(nextEl)) {\r\n                                e.stopPropagation();\r\n                                util.removeItem(nextEl);\r\n                            }\r\n\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode;\r\n                        // delete nonEditable\r\n                        if (sel && util.isNonEditable(sel.nextSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.nextSibling);\r\n                            break;\r\n                        } else if (util.isComponent(sel)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // nested list\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) &&\r\n                     (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : (range.endOffset === selectionNode.textContent.length && range.collapsed))))) {\r\n                        if (range.startContainer !== range.endContainer) core.removeNode();\r\n                        \r\n                        let next = util.getArrayItem(formatEl.children, util.isList, false);\r\n                        next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\r\n                        if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\r\n                            e.preventDefault();\r\n\r\n                            let con, children;\r\n                            if (util.isList(next)) {\r\n                                const child = next.firstElementChild;\r\n                                children = child.childNodes;\r\n                                con = children[0];\r\n                                while (children[0]) {\r\n                                    formatEl.insertBefore(children[0], next);\r\n                                }\r\n                                util.removeItem(child);\r\n                            } else {\r\n                                con = next.firstChild;\r\n                                children = next.childNodes;\r\n                                while (children[0]) {\r\n                                    formatEl.appendChild(children[0]);\r\n                                }\r\n                                util.removeItem(next);\r\n                            }\r\n                            core.setRange(con, 0, con, 0);\r\n                            // history stack\r\n                            core.history.push(true);\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    break;\r\n                case 9: /** tab key */\r\n                    if (fileComponentName || options.tabDisable) break;\r\n                    e.preventDefault();\r\n                    if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\r\n\r\n                    const isEdge = (!range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset));            \r\n                    const selectedFormats = core.getSelectedElements(null);\r\n                    selectionNode = core.getSelectionNode();\r\n                    const cells = [];\r\n                    let lines = [];\r\n                    let fc = util.isListCell(selectedFormats[0]), lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\r\n                    let r = {sc: range.startContainer, so: range.startOffset, ec: range.endContainer, eo: range.endOffset};\r\n                    for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\r\n                        f = selectedFormats[i];\r\n                        if (util.isListCell(f)) {\r\n                            if (!f.previousElementSibling && !shift) {\r\n                                continue;\r\n                            } else {\r\n                                cells.push(f);\r\n                            }\r\n                        } else {\r\n                            lines.push(f);\r\n                        }\r\n                    }\r\n                    \r\n                    // Nested list\r\n                    if (cells.length > 0 && isEdge && core.plugins.list) {\r\n                        r = core.plugins.list.editInsideList.call(core, shift, cells);\r\n                    } else {\r\n                        // table\r\n                        const tableCell = util.getParentElement(selectionNode, util.isCell);\r\n                        if (tableCell && isEdge) {\r\n                            const table = util.getParentElement(tableCell, 'table');\r\n                            const cells = util.getListChildren(table, util.isCell);\r\n                            let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\r\n\r\n                            if (idx === cells.length && !shift) idx = 0;\r\n                            if (idx === -1 && shift) idx = cells.length - 1;\r\n\r\n                            let moveCell = cells[idx];\r\n                            if (!moveCell) break;\r\n                            moveCell = moveCell.firstElementChild || moveCell;\r\n                            core.setRange(moveCell, 0, moveCell, 0);\r\n                            break;\r\n                        }\r\n\r\n                        lines = lines.concat(cells);\r\n                        fc = lc = null;\r\n                    }\r\n\r\n                    // Lines tab(4)\r\n                    if (lines.length > 0) {\r\n                        if (!shift) {\r\n                            const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\r\n                            if (lines.length === 1) {\r\n                                const textRange = core.insertNode(tabText, null, true);\r\n                                if (!textRange) return false;\r\n                                if (!fc) {\r\n                                    r.sc = tabText;\r\n                                    r.so = textRange.endOffset;\r\n                                }\r\n                                if (!lc) {\r\n                                    r.ec = tabText;\r\n                                    r.eo = textRange.endOffset;\r\n                                }\r\n                            } else {\r\n                                const len = lines.length - 1;\r\n                                for (let i = 0, child; i <= len; i++) {\r\n                                    child = lines[i].firstChild;\r\n                                    if (!child) continue;\r\n    \r\n                                    if (util.isBreak(child)) {\r\n                                        lines[i].insertBefore(tabText.cloneNode(false), child);\r\n                                    } else {\r\n                                        child.textContent = tabText.textContent + child.textContent;\r\n                                    }\r\n                                }\r\n    \r\n                                const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                                const endChild = util.getChildElement(lines[len], 'text', true);\r\n                                if (!fc && firstChild) {\r\n                                    r.sc = firstChild;\r\n                                    r.so = 0;\r\n                                }\r\n                                if (!lc && endChild) {\r\n                                    r.ec = endChild;\r\n                                    r.eo = endChild.textContent.length;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            const len = lines.length - 1;\r\n                            for (let i = 0, line; i <= len; i++) {\r\n                                line = lines[i].childNodes;\r\n                                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\r\n                                    child = line[c];\r\n                                    if (!child) break;\r\n                                    if (util.onlyZeroWidthSpace(child)) continue;\r\n        \r\n                                    if (/^\\s{1,4}$/.test(child.textContent)) {\r\n                                        util.removeItem(child);\r\n                                    } else if (/^\\s{1,4}/.test(child.textContent)) {\r\n                                        child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\r\n                                    }\r\n                                    \r\n                                    break;\r\n                                }\r\n                            }\r\n    \r\n                            const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                            const endChild = util.getChildElement(lines[len], 'text', true);\r\n                            if (!fc && firstChild) {\r\n                                r.sc = firstChild;\r\n                                r.so = 0;\r\n                            }\r\n                            if (!lc && endChild) {\r\n                                r.ec = endChild;\r\n                                r.eo = endChild.textContent.length;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    core.setRange(r.sc, r.so, r.ec, r.eo);\r\n                    // history stack\r\n                    core.history.push(false);\r\n                    \r\n                    break;\r\n                case 13: /** enter key */\r\n                    const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\r\n\r\n                    if (core._charTypeHTML) {\r\n                        let enterHTML = '';\r\n                        if ((!shift && freeFormatEl) || shift) {\r\n                            enterHTML = '<br>';\r\n                        } else {\r\n                            enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\r\n                        }\r\n\r\n                        if (!core.checkCharCount(enterHTML, 'byte-html')) {\r\n                            e.preventDefault();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    if (!shift) {\r\n                        const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\r\n                        if ((formatInners && /^H[1-6]$/i.test(formatEl.nodeName)) || /^HR$/i.test(formatEl.nodeName)) {\r\n                            e.preventDefault();\r\n                            let temp = null;\r\n                            const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\r\n\r\n                            if (formatInners && formatInners.length > 0) {\r\n                                temp = formatInners.pop();\r\n                                const innerNode = temp;\r\n                                while(formatInners.length > 0) {\r\n                                    temp = temp.appendChild(formatInners.pop());\r\n                                }\r\n                                newFormat.appendChild(innerNode);\r\n                            }\r\n\r\n                            temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\r\n                            core.setRange(temp, 0, temp, 0);\r\n                            break;\r\n                        }\r\n\r\n                        if (freeFormatEl) {\r\n                            e.preventDefault();\r\n                            const selectionFormat = selectionNode === freeFormatEl;\r\n                            const wSelection = core.getSelection();\r\n                            const children = selectionNode.childNodes, offset = wSelection.focusOffset, prev = selectionNode.previousElementSibling, next = selectionNode.nextSibling;\r\n    \r\n                            if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && ((selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || ((!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent))) &&  offset > 0 && util.isBreak(children[offset - 1])) ||\r\n                              (!selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || (!util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))))) {\r\n                                if (selectionFormat) util.removeItem(children[offset - 1]);\r\n                                else util.removeItem(selectionNode);\r\n                                const newEl = core.appendFormatTag(freeFormatEl, (util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling)) ? freeFormatEl.nextElementSibling : null);\r\n                                util.copyFormatAttributes(newEl, freeFormatEl);\r\n                                core.setRange(newEl, 1, newEl, 1);\r\n                                break;\r\n                            }\r\n                            \r\n                            if (selectionFormat) {\r\n                                functions.insertHTML(((range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1])) ? '<br>' : '<br><br>'), true, false);\r\n    \r\n                                let focusNode = wSelection.focusNode;\r\n                                const wOffset = wSelection.focusOffset;\r\n                                if (freeFormatEl === focusNode) {\r\n                                    focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\r\n                                }\r\n    \r\n                                core.setRange(focusNode, 1, focusNode, 1);\r\n                            } else {\r\n                                const focusNext = wSelection.focusNode.nextSibling;\r\n                                const br = util.createElement('BR');\r\n                                core.insertNode(br, null, false);\r\n    \r\n                                const brPrev = br.previousSibling, brNext = br.nextSibling;\r\n                                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\r\n                                    br.parentNode.insertBefore(br.cloneNode(false), br);\r\n                                    core.setRange(br, 1, br, 1);\r\n                                } else {\r\n                                    core.setRange(brNext, 0, brNext, 0);\r\n                                }\r\n                            }\r\n    \r\n                            event._onShortcutKey = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange) break;\r\n                    \r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        const range = core.getRange();\r\n                        if(core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\r\n                            e.preventDefault();\r\n                            const newEl = util.createElement('LI');\r\n                            const br = util.createElement('BR');\r\n                            newEl.appendChild(br);\r\n\r\n                            formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\r\n                            newEl.appendChild(selectionNode.nextSibling);\r\n                            \r\n                            core.setRange(br, 1, br, 1);\r\n                            break;\r\n                        }\r\n\r\n                        if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\r\n                            e.preventDefault();\r\n                            let newEl = null;\r\n\r\n                            if (util.isListCell(rangeEl.parentNode)) {\r\n                                rangeEl = formatEl.parentNode.parentNode.parentNode;\r\n                                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\r\n                                if (!newEl) {\r\n                                    const newListCell = util.createElement('LI');\r\n                                    newListCell.innerHTML = '<br>';\r\n                                    rangeEl.insertBefore(newListCell, newEl);\r\n                                    newEl = newListCell;\r\n                                }\r\n                            } else {\r\n                                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : (util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling)) ? rangeEl.nextElementSibling.nodeName : (util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling)) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\r\n                                newEl = util.createElement(newFormat);\r\n                                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\r\n                                edge.cc.insertBefore(newEl, edge.ec);\r\n                            }\r\n                            \r\n                            newEl.innerHTML = '<br>';\r\n                            util.removeItemAllParents(formatEl, null, null);\r\n                            core.setRange(newEl, 1, newEl, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\r\n                        e.preventDefault();\r\n                        formatEl = core.appendFormatTag(formatEl, null);\r\n                        core.setRange(formatEl, 0, formatEl, 0);\r\n                    }\r\n\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        const compContext = context[fileComponentName];\r\n                        const container = compContext._container;\r\n                        const sibling = container.previousElementSibling || container.nextElementSibling;\r\n\r\n                        let newEl = null;\r\n                        if (util.isListCell(container.parentNode)) {\r\n                            newEl = util.createElement('BR');\r\n                        } else {\r\n                            newEl = util.createElement((util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling)) ? sibling.nodeName : options.defaultTag);\r\n                            newEl.innerHTML = '<br>';\r\n                        }\r\n\r\n                        container.parentNode.insertBefore(newEl, container);\r\n                        \r\n                        core.callPlugin(fileComponentName, function () {\r\n                            if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\r\n                        }, null);\r\n                    }\r\n                    \r\n                    break;\r\n                case 27:\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.controllersOff();\r\n                        return false;\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (shift && keyCode === 16) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\r\n                    const cell = util.getParentElement(formatEl, util.isCell);\r\n                    if (cell) {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, cell, true);\r\n                        return;\r\n                    }\r\n                }\r\n            } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\r\n                if (nbsp && nbsp.container) {\r\n                    core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && range.collapsed && range.startContainer === range.endContainer && util.isBreak(range.commonAncestorContainer)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                core.insertNode(zeroWidth, null, false);\r\n                core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n            }\r\n        },\r\n\r\n        onKeyUp_wysiwyg: function (e) {\r\n            if (event._onShortcutKey) return;\r\n\r\n            core._editorRange();\r\n            const keyCode = e.keyCode;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n\r\n            if (core.isReadOnly) {\r\n                if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\r\n                return;\r\n            }\r\n\r\n            const range = core.getRange();\r\n            let selectionNode = core.getSelectionNode();\r\n\r\n            if (core._isBalloon && ((core._isBalloonAlways && keyCode !== 27) || !range.collapsed)) {\r\n                if (core._isBalloonAlways) {\r\n                    if (keyCode !== 27) event._showToolbarBalloonDelay();\r\n                } else {\r\n                    event._showToolbarBalloon();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            /** when format tag deleted */\r\n            if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                selectionNode.innerHTML = '';\r\n\r\n                const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\r\n                oFormatTag.innerHTML = '<br>';\r\n\r\n                selectionNode.appendChild(oFormatTag);\r\n                core.setRange(oFormatTag, 0, oFormatTag, 0);\r\n                event._applyTagEffects();\r\n\r\n                core.history.push(false);\r\n                return;\r\n            }\r\n\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                selectionNode = core.getSelectionNode();\r\n            }\r\n\r\n            if (event._directionKeyCode.test(keyCode)) {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\r\n                let so = range.startOffset, eo = range.endOffset;\r\n                const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\r\n                so = range.startOffset - frontZeroWidthCnt;\r\n                eo = range.endOffset - frontZeroWidthCnt;\r\n                selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\r\n                core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\r\n            }\r\n\r\n            core._charCount('');\r\n\r\n            // user event\r\n            if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return;\r\n\r\n            // history stack\r\n            if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\r\n                core.history.push(true);\r\n            }\r\n        },\r\n\r\n        onScroll_wysiwyg: function (e) {\r\n            core.controllersOff();\r\n            if (core._isBalloon) event._hideToolbar();\r\n\r\n            // user event\r\n            if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\r\n        },\r\n\r\n        onFocus_wysiwyg: function (e) {\r\n            if (core._antiBlur) return;\r\n            core.hasFocus = true;\r\n            event._applyTagEffects();\r\n            \r\n            if (core._isInline) event._showToolbarInline();\r\n\r\n            // user event\r\n            if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\r\n        },\r\n\r\n        onBlur_wysiwyg: function (e) {\r\n            if (core._antiBlur || core._variable.isCodeView) return;\r\n            core.hasFocus = false;\r\n            core.controllersOff();\r\n            if (core._isInline || core._isBalloon) event._hideToolbar();\r\n\r\n            core._setKeyEffect([]);\r\n\r\n            core._variable.currentNodes = [];\r\n            core._variable.currentNodesMap = [];\r\n            if (options.showPathLabel) context.element.navigation.textContent = '';\r\n\r\n            // user event\r\n            if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\r\n        },\r\n\r\n        onMouseDown_resizingBar: function (e) {\r\n            e.stopPropagation();\r\n\r\n            core.submenuOff();\r\n            core.controllersOff();\r\n\r\n            const prevHeight = util.getNumber(context.element.wysiwygFrame.style.height, 0);\r\n            core._variable.resizeClientY = e.clientY;\r\n            context.element.resizeBackground.style.display = 'block';\r\n\r\n            function closureFunc() {\r\n                context.element.resizeBackground.style.display = 'none';\r\n                _d.removeEventListener('mousemove', event._resize_editor);\r\n                _d.removeEventListener('mouseup', closureFunc);\r\n                if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(util.getNumber(context.element.wysiwygFrame.style.height, 0), prevHeight, core);\r\n            }\r\n\r\n            _d.addEventListener('mousemove', event._resize_editor);\r\n            _d.addEventListener('mouseup', closureFunc);\r\n        },\r\n\r\n        _resize_editor: function (e) {\r\n            const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\r\n            context.element.wysiwygFrame.style.height = context.element.code.style.height = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval) + 'px';\r\n            core._variable.resizeClientY = e.clientY;\r\n        },\r\n\r\n        onResize_window: function () {\r\n            core.controllersOff();\r\n\r\n            const responsiveSize = event._responsiveButtonSize;\r\n            if (responsiveSize) {\r\n                let w = 0;\r\n                if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\r\n                    w = context.element.topArea.offsetWidth;\r\n                } else {\r\n                    w = context.element.toolbar.offsetWidth;\r\n                }\r\n\r\n                let responsiveWidth = 'default';\r\n                for (let i = 1, len = responsiveSize.length; i < len; i++) {\r\n                    if (w < responsiveSize[i]) {\r\n                        responsiveWidth = responsiveSize[i] + '';\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (event._responsiveCurrentSize !== responsiveWidth) {\r\n                    event._responsiveCurrentSize = responsiveWidth;\r\n                    functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\r\n                }\r\n            }\r\n\r\n            if (context.element.toolbar.offsetWidth === 0) return;\r\n\r\n            if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\r\n                context.fileBrowser.body.style.maxHeight = (_w.innerHeight - context.fileBrowser.header.offsetHeight - 50) + 'px';\r\n            }\r\n\r\n            if (core.submenuActiveButton && core.submenu) {\r\n                core._setMenuPosition(core.submenuActiveButton, core.submenu);\r\n            }\r\n\r\n            if (core._variable.isFullScreen) {\r\n                core._variable.innerHeight_fullScreen += (_w.innerHeight - context.element.toolbar.offsetHeight) - core._variable.innerHeight_fullScreen;\r\n                context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\r\n                return;\r\n            }\r\n\r\n            if (core._variable.isCodeView && core._isInline) {\r\n                event._showToolbarInline();\r\n                return;\r\n            }\r\n            \r\n            core._iframeAutoHeight();\r\n\r\n            if (core._sticky) {\r\n                context.element.toolbar.style.width = (context.element.topArea.offsetWidth - 2) + 'px';\r\n                event.onScroll_window();\r\n            }\r\n        },\r\n\r\n        onScroll_window: function () {\r\n            if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\r\n\r\n            const element = context.element;\r\n            const editorHeight = element.editorArea.offsetHeight;\r\n            const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\r\n            const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\r\n            const inlineOffset = core._isInline && (y - editorTop) > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\r\n            \r\n            if (y < editorTop) {\r\n                event._offStickyToolbar();\r\n            }\r\n            else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\r\n                if (!core._sticky) event._onStickyToolbar(inlineOffset);\r\n                element.toolbar.style.top = (inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize) + 'px';\r\n            }\r\n            else if (y >= editorTop) {\r\n                event._onStickyToolbar(inlineOffset);\r\n            }\r\n        },\r\n\r\n        _getEditorOffsets: function (container) {\r\n            let offsetEl = container || context.element.topArea;\r\n            let t = 0, l = 0, s = 0;\r\n\r\n            while (offsetEl) {\r\n                t += offsetEl.offsetTop;\r\n                l += offsetEl.offsetLeft;\r\n                s += offsetEl.scrollTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l,\r\n                scroll: s\r\n            };\r\n        },\r\n\r\n        _getPageBottomSpace: function () {\r\n            return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\r\n        },\r\n\r\n        _onStickyToolbar: function (inlineOffset) {\r\n            const element = context.element;\r\n\r\n            if (!core._isInline && !options.toolbarContainer) {\r\n                element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\r\n                element._stickyDummy.style.display = 'block';\r\n            }\r\n\r\n            element.toolbar.style.top = (options.stickyToolbar + inlineOffset) + 'px';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\r\n            util.addClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = true;\r\n        },\r\n\r\n        _offStickyToolbar: function () {\r\n            const element = context.element;\r\n\r\n            element._stickyDummy.style.display = 'none';\r\n            element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\r\n            element.editorArea.style.marginTop = '';\r\n\r\n            util.removeClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = false;\r\n        },\r\n\r\n        _codeViewAutoHeight: function () {\r\n            context.element.code.style.height = context.element.code.scrollHeight + 'px';\r\n        },\r\n\r\n        // FireFox - table delete, Chrome - image, video, audio\r\n        _hardDelete: function () {\r\n            const range = core.getRange();\r\n            const sc = range.startContainer;\r\n            const ec = range.endContainer;\r\n            \r\n            // table\r\n            const sCell = util.getRangeFormatElement(sc);\r\n            const eCell = util.getRangeFormatElement(ec);\r\n            const sIsCell = util.isCell(sCell);\r\n            const eIsCell = util.isCell(eCell);\r\n            const ancestor = range.commonAncestorContainer;\r\n            if (((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling) || (eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling)) && sCell !== eCell) {\r\n                if (!sIsCell) {\r\n                    util.removeItem(util.getParentElement(eCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else if (!eIsCell) {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                    core.nativeFocus();\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            // component\r\n            const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\r\n            const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\r\n            if (sComp) util.removeItem(sComp);\r\n            if (eComp) util.removeItem(eComp);\r\n\r\n            return false;\r\n        },\r\n\r\n        onPaste_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            if (!clipboardData) return true;\r\n            return event._dataTransferAction('paste', e, clipboardData);\r\n        },\r\n\r\n        _setClipboardComponent: function (e, info, clipboardData) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            clipboardData.setData('text/html', info.component.outerHTML);\r\n        },\r\n\r\n        onCopy_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            \r\n            // user event\r\n            if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.addClass(info.component, 'se-component-copy');\r\n                // copy effect\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(info.component, 'se-component-copy');\r\n                }, 150);\r\n            }\r\n        },\r\n\r\n        onCut_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n\r\n            // user event\r\n            if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.removeItem(info.component);\r\n                core.controllersOff();\r\n            }\r\n\r\n            _w.setTimeout(function () {\r\n                // history stack\r\n                core.history.push(false);\r\n            });\r\n        },\r\n\r\n        onDrop_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isIE) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const dataTransfer = e.dataTransfer;\r\n            if (!dataTransfer) return true;\r\n\r\n            core.removeNode();\r\n            event._setDropLocationSelection(e);\r\n            return event._dataTransferAction('drop', e, dataTransfer);\r\n        },\r\n\r\n        _setDropLocationSelection: function (e) {\r\n            if (e.rangeParent) {\r\n                core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\r\n            } else if (core._wd.caretRangeFromPoint) {\r\n                const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            } else {\r\n                const r = core.getRange();\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            }\r\n        },\r\n\r\n        _dataTransferAction: function (type, e, data) {\r\n            let plainText, cleanData;\r\n            if (util.isIE) {\r\n                plainText = data.getData('Text');\r\n                \r\n                const range = core.getRange();\r\n                const tempDiv = util.createElement('DIV');\r\n                const tempRange = {\r\n                    sc: range.startContainer,\r\n                    so: range.startOffset,\r\n                    ec: range.endContainer,\r\n                    eo: range.endOffset\r\n                };\r\n\r\n                tempDiv.setAttribute('contenteditable', true);\r\n                tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\r\n                \r\n                context.element.relative.appendChild(tempDiv);\r\n                tempDiv.focus();\r\n\r\n                _w.setTimeout(function () {\r\n                    cleanData = tempDiv.innerHTML;\r\n                    util.removeItem(tempDiv);\r\n                    core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\r\n                    event._setClipboardData(type, e, plainText, cleanData, data);\r\n                });\r\n\r\n                return true;\r\n            } else {\r\n                plainText = data.getData('text/plain');\r\n                cleanData = data.getData('text/html');\r\n                if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    return false;\r\n                }\r\n            }\r\n        },\r\n\r\n        _setClipboardData: function (type, e, plainText, cleanData, data) {\r\n            // MS word, OneNode, Excel\r\n            const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\r\n            const onlyText = !cleanData;\r\n\r\n            if (!onlyText) {\r\n                if (MSData) {\r\n                    cleanData = cleanData.replace(/\\n/g, ' ');\r\n                    plainText = plainText.replace(/\\n/g, ' ');\r\n                } else {\r\n                    cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\r\n                }\r\n                cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp);\r\n            } else {\r\n                cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\r\n            }\r\n\r\n            const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText);\r\n            // user event - paste\r\n            if (type === 'paste' && typeof functions.onPaste === 'function') {\r\n                const value = functions.onPaste(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n            // user event - drop\r\n            if (type === 'drop' && typeof functions.onDrop === 'function') {\r\n                const value = functions.onDrop(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n\r\n            // files\r\n            const files = data.files;\r\n            if (files.length > 0 && !MSData) {\r\n                if (/^image/.test(files[0].type) && core.plugins.image) {\r\n                    functions.insertImage(files);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (!maxCharCount) {\r\n                return false;\r\n            }\r\n\r\n            if (cleanData) {\r\n                functions.insertHTML(cleanData, true, false);\r\n                return false;\r\n            }\r\n        },\r\n\r\n        onMouseMove_wysiwyg: function (e) {\r\n            if (core.isDisabled || core.isReadOnly) return false;\r\n            const component = util.getParentElement(e.target, util.isComponent);\r\n            const lineBreakerStyle = core._lineBreaker.style;\r\n            \r\n            if (component && !core.currentControllerName) {\r\n                const ctxEl = context.element;\r\n                let scrollTop = 0;\r\n                let el = ctxEl.wysiwyg;\r\n                do {\r\n                    scrollTop += el.scrollTop;\r\n                    el = el.parentElement;\r\n                } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\r\n\r\n                const wScroll = ctxEl.wysiwyg.scrollTop;\r\n                const offsets = event._getEditorOffsets(null);\r\n                const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\r\n                const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\r\n                const c = componentTop + (options.iframe ? scrollTop : offsets.top);\r\n\r\n                const isList = util.isListCell(component.parentNode);\r\n                let dir = '', top = '';\r\n                if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < (c + 20)) {\r\n                    top = componentTop;\r\n                    dir = 't';\r\n                } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > (c + component.offsetHeight - 20)) {\r\n                    top = componentTop + component.offsetHeight;\r\n                    dir = 'b';\r\n                } else {\r\n                    lineBreakerStyle.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                core._variable._lineBreakComp = component;\r\n                core._variable._lineBreakDir = dir;\r\n                lineBreakerStyle.top = (top - wScroll) + 'px';\r\n                core._lineBreakerButton.style.left = (util.getOffset(component).left + (component.offsetWidth / 2) - 15) + 'px';\r\n                lineBreakerStyle.display = 'block';\r\n            } // off line breaker\r\n            else if (lineBreakerStyle.display !== 'none') {\r\n                lineBreakerStyle.display = 'none';\r\n            }\r\n        },\r\n\r\n        _onMouseDown_lineBreak: function (e) {\r\n            e.preventDefault();\r\n        },\r\n\r\n        _onLineBreak: function (e) {\r\n            e.preventDefault();\r\n            \r\n            const component = core._variable._lineBreakComp;\r\n            const dir = !this ? core._variable._lineBreakDir : this;\r\n            const isList = util.isListCell(component.parentNode);\r\n\r\n            const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\r\n            if (!isList) format.innerHTML = '<br>';\r\n\r\n            if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\r\n\r\n            component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\r\n            core._lineBreaker.style.display = 'none';\r\n            core._variable._lineBreakComp = null;\r\n\r\n            const focusEl = isList ? format : format.firstChild;\r\n            core.setRange(focusEl, 1, focusEl, 1);\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        _addEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            /** toolbar event */\r\n            context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\r\n            /** editor area */\r\n            eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\r\n            eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\r\n\r\n            /** line breaker */\r\n            event._lineBreakerBind = { a: event._onLineBreak.bind(''), t: event._onLineBreak.bind('t'), b: event._onLineBreak.bind('b') };\r\n            eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\r\n            core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\r\n            core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\r\n            context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\r\n            context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\r\n\r\n            /** Events are registered only when there is a table plugin.  */\r\n            if (core.plugins.table) {\r\n                eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            }\r\n            \r\n            /** code view area auto line */\r\n            if (options.height === 'auto' && !options.codeMirrorEditor) {\r\n                context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\r\n            }\r\n\r\n            /** resizingBar */\r\n            if (context.element.resizingBar) {\r\n                if (/\\d+/.test(options.height)) {\r\n                    context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\r\n                } else {\r\n                    util.addClass(context.element.resizingBar, 'se-resizing-none');\r\n                }\r\n            }\r\n            \r\n            /** window event */\r\n            event._setResponsiveToolbar();\r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n\r\n            _w.addEventListener('resize', event.onResize_window, false);\r\n            if (options.stickyToolbar > -1) {\r\n                _w.addEventListener('scroll', event.onScroll_window, false);\r\n            }\r\n        },\r\n\r\n        _removeEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\r\n\r\n            eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\r\n            eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\r\n            eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\r\n            eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\r\n            eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\r\n            eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\r\n            eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\r\n\r\n            eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\r\n            core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\r\n            core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\r\n            context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\r\n            context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\r\n            event._lineBreakerBind = null;\r\n            \r\n            eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            \r\n            eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\r\n            eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\r\n\r\n            context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\r\n            \r\n            if (context.element.resizingBar) {\r\n                context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\r\n            }\r\n            \r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n        },\r\n\r\n        _setResponsiveToolbar: function () {\r\n            if (_responsiveButtons.length === 0) {\r\n                _responsiveButtons = null;\r\n                return;\r\n            }\r\n\r\n            event._responsiveCurrentSize = 'default';\r\n            const sizeArray = event._responsiveButtonSize = [];\r\n            const buttonsObj = event._responsiveButtons = {default: _responsiveButtons[0]};\r\n            for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\r\n                buttonGroup = _responsiveButtons[i];\r\n                size = buttonGroup[0] * 1;\r\n                sizeArray.push(size);\r\n                buttonsObj[size] = buttonGroup[1];\r\n            }\r\n\r\n            sizeArray.sort(function (a, b) { return a - b; }).unshift('default');\r\n        }\r\n    };\r\n\r\n    /** functions */\r\n    const functions = {\r\n        /**\r\n         * @description Core, Util object\r\n         */\r\n        core: core,\r\n        util: util,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {Object} e Event Object\r\n         * @param {Object} core Core object\r\n         */\r\n        onload: null,\r\n        onScroll: null,\r\n        onMouseDown: null,\r\n        onClick: null,\r\n        onInput: null,\r\n        onKeyDown: null,\r\n        onKeyUp: null,\r\n        onCopy: null,\r\n        onCut: null,\r\n        onFocus: null,\r\n        onBlur: null,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n        onChange: null,\r\n\r\n        /**\r\n         * @description Event functions (drop, paste)\r\n         * When false is returned, the default behavior is stopped.\r\n         * If the string is returned, the cleanData value is modified to the return value.\r\n         * @param {Object} e Event object.\r\n         * @param {String} cleanData HTML string modified for editor format.\r\n         * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean|String}\r\n         */\r\n        onDrop: null,\r\n        onPaste: null,\r\n\r\n        /**\r\n         * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n         * @param {Element} toolbar Toolbar Element\r\n         * @param {Object} context The editor's context object (editor.getContext())\r\n         * @param {Object} core Core object\r\n         */\r\n        showInline: null,\r\n\r\n        /**\r\n         * @description Called just after the controller is positioned and displayed on the screen.\r\n         * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n         * @param {String} name The name of the plugin that called the controller\r\n         * @param {Array} controllers Array of Controller elements\r\n         * @param {Object} core Core object\r\n         */\r\n        showController: null,\r\n\r\n        /**\r\n         * @description An event when toggling between code view and wysiwyg view.\r\n         * @param {Boolean} isCodeView Whether the current code view mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleCodeView: null,\r\n\r\n        /**\r\n         * @description An event when toggling full screen.\r\n         * @param {Boolean} isFullScreen Whether the current full screen mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleFullScreen: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the image upload\r\n         * @param {Object} response Response object\r\n         * @param {Object} info Input information\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * @param {Object} core Core object\r\n         */\r\n        imageUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the video upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * @param core Core object\r\n         */\r\n        videoUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the audio upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * @param core Core object\r\n         */\r\n        audioUploadHandler: null,\r\n\r\n        /**\r\n         * @description Called before the image is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no image upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onImageUploadBefore: null,\r\n        /**\r\n         * @description Called before the video is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no video(iframe, video) upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onVideoUploadBefore: null,\r\n        /**\r\n         * @description Called before the audio is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no audio upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onAudioUploadBefore: null,\r\n\r\n        /**\r\n         * @description Called when the image is uploaded, updated, deleted\r\n         * @param {Element} targetElement Target element\r\n         * @param {Number} index Uploaded index\r\n         * @param {String} state Upload status ('create', 'update', 'delete')\r\n         * @param {Object} info Image info object\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n         * @param {Object} core Core object\r\n         */\r\n        onImageUpload: null,\r\n         /**\r\n         * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onVideoUpload: null,\r\n         /**\r\n         * @description Called when the audio is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onAudioUpload: null,\r\n\r\n        /**\r\n         * @description Called when the image is upload failed\r\n         * @param {String} errorMessage Error message\r\n         * @param {Object} result Response Object\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean}\r\n         */\r\n        onImageUploadError: null,\r\n        /**\r\n         * @description Called when the video(iframe, video) upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onVideoUploadError: null,\r\n        /**\r\n         * @description Called when the audio upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onAudioUploadError: null,\r\n\r\n        /**\r\n         * @description Called when the editor is resized using the bottom bar\r\n         */\r\n        onResizeEditor: null,\r\n\r\n        /**\r\n         * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n         * You cannot set a new plugin for the button.\r\n         * @param {Array} buttonList Button list \r\n         */\r\n        setToolbarButtons: function (buttonList) {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            \r\n            const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\r\n            _responsiveButtons = newToolbar.responsiveButtons;\r\n            core._moreLayerActiveButton = null;\r\n            event._setResponsiveToolbar();\r\n\r\n            context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\r\n            const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\r\n\r\n            context.element = newContext.element;\r\n            context.tool = newContext.tool;\r\n            if (options.iframe) context.element.wysiwyg = core._wd.body;\r\n            core._cachingButtons();\r\n            core.history._resetCachingButton();\r\n\r\n            core.activePlugins = [];\r\n            const oldCallButtons = pluginCallButtons;\r\n            pluginCallButtons = newToolbar.pluginCallButtons;\r\n            let plugin, button, oldButton;\r\n            for (let key in pluginCallButtons) {\r\n                if (!util.hasOwn(pluginCallButtons, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if (plugin.active && button) {\r\n                    oldButton = oldCallButtons[key];\r\n                    core.callPlugin(key, null, oldButton || button);\r\n                    if (oldButton) {\r\n                        button.parentElement.replaceChild(oldButton, button);\r\n                        pluginCallButtons[key] = oldButton;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (core.hasFocus) event._applyTagEffects();\r\n\r\n            if (core._variable.isCodeView) util.addClass(core._styleCommandMap.codeView, 'active');\r\n            if (core._variable.isFullScreen) util.addClass(core._styleCommandMap.fullScreen, 'active');\r\n            if (util.hasClass(context.element.wysiwyg, 'se-show-block')) util.addClass(core._styleCommandMap.showBlocks, 'active');\r\n        },\r\n\r\n        /**\r\n         * @description Add or reset option property (Editor is reloaded)\r\n         * @param {Object} _options Options\r\n         */\r\n        setOptions: function (_options) {\r\n            event._removeEvent();\r\n            core._resetComponents();\r\n            \r\n            util.removeClass(core._styleCommandMap.showBlocks, 'active');\r\n            util.removeClass(core._styleCommandMap.codeView, 'active');\r\n            core._variable.isCodeView = false;\r\n            core._iframeAuto = null;\r\n\r\n            core.plugins = _options.plugins || core.plugins;\r\n            const mergeOptions = [options, _options].reduce(function (init, option) {\r\n                for (let key in option) {\r\n                    if (!util.hasOwn(option, key)) continue;\r\n                    if (key === 'plugins' && option[key] && init[key]) {\r\n                        let i = init[key], o = option[key];\r\n                        i = i.length ? i : _w.Object.keys(i).map(function(name) { return i[name]; });\r\n                        o = o.length ? o : _w.Object.keys(o).map(function(name) { return o[name]; });\r\n                        init[key] = (o.filter(function(val) { return i.indexOf(val) === -1; })).concat(i);\r\n                    } else {\r\n                        init[key] = option[key];\r\n                    }\r\n                }\r\n                return init;\r\n            }, {});\r\n\r\n            const el = context.element;\r\n            const _initHTML = el.wysiwyg.innerHTML;\r\n\r\n            // set option\r\n            const cons = _Constructor._setOptions(mergeOptions, context, options);        \r\n\r\n            if (cons.callButtons) {\r\n                pluginCallButtons = cons.callButtons;\r\n                core.initPlugins = {};\r\n            }\r\n\r\n            if (cons.plugins) {\r\n                core.plugins = plugins = cons.plugins;\r\n            }\r\n\r\n            // reset context\r\n            if (el._menuTray.children.length === 0) this._menuTray = {};\r\n            _responsiveButtons = cons.toolbar.responsiveButtons;\r\n            core.options = options = mergeOptions;\r\n            core.lang = lang = options.lang;\r\n\r\n            if (options.iframe) {\r\n                el.wysiwygFrame.addEventListener('load', function () {\r\n                    util._setIframeDocument(this, options);\r\n                    core._setOptionsInit(el, _initHTML);\r\n                });\r\n            }\r\n\r\n            el.editorArea.appendChild(el.wysiwygFrame);\r\n\r\n            if (!options.iframe) {\r\n                core._setOptionsInit(el, _initHTML);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set \"options.defaultStyle\" style.\r\n         * Define the style of the edit area\r\n         * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n         * @param {String} style Style string\r\n         */\r\n        setDefaultStyle: function (style) {\r\n            const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\r\n            const el = context.element;\r\n\r\n            // top area\r\n            el.topArea.style.cssText = newStyles.top;\r\n            // code view\r\n            el.code.style.cssText = options._editorStyles.frame;\r\n            el.code.style.display = 'none';\r\n            if (options.height === 'auto') {\r\n                el.code.style.overflow = 'hidden';\r\n            } else {\r\n                el.code.style.overflow = '';\r\n            }\r\n            // wysiwyg frame\r\n            if (!options.iframe) {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\r\n            } else {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame;\r\n                el.wysiwyg.style.cssText = newStyles.editor;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Open a notice area\r\n         * @param {String} message Notice message\r\n         */\r\n        noticeOpen: function (message) {\r\n            core.notice.open.call(core, message);\r\n        },\r\n\r\n        /**\r\n         * @description Close a notice area\r\n         */\r\n        noticeClose: function () {\r\n            core.notice.close.call(core);\r\n        },\r\n\r\n        /**\r\n         * @description Copying the contents of the editor to the original textarea\r\n         */\r\n        save: function () {\r\n            context.element.originElement.value = core.getContents(false);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n         * @returns {Object}\r\n         */\r\n        getContext: function () {\r\n            return context;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the contents of the suneditor\r\n         * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            return core.getContents(onlyContents);\r\n        },\r\n\r\n        /**\r\n         * @description Gets only the text of the suneditor contents\r\n         * @returns {String}\r\n         */\r\n        getText: function () {\r\n            return context.element.wysiwyg.textContent;\r\n        },\r\n\r\n        /**\r\n         * @description Get the editor's number of characters or binary data size.\r\n         * You can use the \"charCounterType\" option format.\r\n         * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n         * If argument is no value, the currently set \"charCounterType\" option is used.\r\n         * @returns {Number}\r\n         */\r\n        getCharCount: function (charCounterType) {\r\n            charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\r\n            return core.getCharLength((core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent), charCounterType);\r\n        },\r\n\r\n        /**\r\n         * @description Gets uploaded images informations\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @returns {Array}\r\n         */\r\n        getImagesInfo: function () {\r\n            return context.image ? context.image._infoList : [];\r\n        },\r\n        \r\n        /**\r\n         * @description Gets uploaded files(plugin using fileManager) information list.\r\n         * image: [img], video: [video, iframe], audio: [audio]\r\n         * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {String} pluginName Plugin name (image, video, audio)\r\n         * @returns {Array}\r\n         */\r\n        getFilesInfo: function (pluginName) {\r\n            return context[pluginName] ? context[pluginName]._infoList : [];\r\n        },\r\n\r\n        /**\r\n         * @description Upload images using image plugin\r\n         * @param {FileList} files FileList\r\n         */\r\n        insertImage: function (files) {\r\n            if (!core.plugins.image || !files) return;\r\n\r\n            if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);\r\n            else core.plugins.image.submitAction.call(core, files);\r\n            core.focus();\r\n        },\r\n\r\n        /**\r\n         * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n         * @param {Element|String} html HTML Element or HTML string or plain string\r\n         * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n         */\r\n        insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\r\n            if (typeof html === 'string') {\r\n                if (!notCleaningData) html = core.cleanHTML(html, null);\r\n                try {\r\n                    const dom = _d.createRange().createContextualFragment(html);\r\n                    const domTree = dom.childNodes;\r\n\r\n                    if (checkCharCount) {\r\n                        const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\r\n                        let checkHTML = '';\r\n                        for (let i = 0, len = domTree.length; i < len; i++) {\r\n                            checkHTML += domTree[i][type];\r\n                        }\r\n                        if (!core.checkCharCount(checkHTML, null)) return;\r\n                    }\r\n\r\n                    let c, a, t, prev, firstCon;\r\n                    while ((c = domTree[0])) {\r\n                        if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\r\n                            prev = c;\r\n                            util.removeItem(c);\r\n                            continue;\r\n                        }\r\n                        t = core.insertNode(c, a, false);\r\n                        a = t.container || t;\r\n                        if (!firstCon) firstCon = t;\r\n                        prev = c;\r\n                    }\r\n\r\n                    if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\r\n                    const offset = a.nodeType === 3 ? (t.endOffset || a.textContent.length): a.childNodes.length;\r\n                    if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);\r\n                    else core.setRange(a, offset, a, offset);\r\n                } catch (error) {\r\n                    if (core.isDisabled || core.isReadOnly) return;\r\n                    console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\r\n                    core.execCommand('insertHTML', false, html);\r\n                }\r\n            } else {\r\n                if (util.isComponent(html)) {\r\n                    core.insertComponent(html, false, checkCharCount, false);\r\n                } else {\r\n                    let afterNode = null;\r\n                    if (util.isFormatElement(html) || util.isMedia(html)) {\r\n                        afterNode = util.getFormatElement(core.getSelectionNode(), null);\t\r\n                    }\r\n                    core.insertNode(html, afterNode, checkCharCount);\r\n                }\r\n            }\r\n            \r\n            core.effectNode = null;\r\n            core.focus();\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Change the contents of the suneditor\r\n         * @param {String|undefined} contents Contents to Input\r\n         */\r\n        setContents: function (contents) {\r\n            core.setContents(contents);\r\n        },\r\n\r\n        /**\r\n         * @description Add contents to the suneditor\r\n         * @param {String} contents Contents to Input\r\n         */\r\n        appendContents: function (contents) {\r\n            const convertValue = core.convertContentsForEditor(contents);\r\n            \r\n            if (!core._variable.isCodeView) {\r\n                const temp = util.createElement('DIV');\r\n                temp.innerHTML = convertValue;\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const children = temp.children;\r\n                for (let i = 0, len = children.length; i < len; i++) {\r\n                    wysiwyg.appendChild(children[i]);\r\n                }\r\n            } else {\r\n                core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue));\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Switch to or off \"ReadOnly\" mode.\r\n         * @param {Boolean} value \"readOnly\" boolean value.\r\n         */\r\n        readOnly: function (value) {\r\n            core.isReadOnly = value;\r\n            \r\n            if (value) {\r\n                context.element.code.setAttribute(\"readOnly\", \"true\");\r\n            } else {\r\n                context.element.code.removeAttribute(\"readOnly\");\r\n            }\r\n\r\n            util.setDisabledButtons(!!value, core.resizingDisabledButtons);\r\n            if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\r\n        },\r\n\r\n        /**\r\n         * @description Disable the suneditor\r\n         */\r\n        disabled: function () {\r\n            context.tool.cover.style.display = 'block';\r\n            context.element.wysiwyg.setAttribute('contenteditable', false);\r\n            core.isDisabled = true;\r\n\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.setOption('readOnly', true);\r\n            } else {\r\n                context.element.code.setAttribute('disabled', 'disabled');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable the suneditor\r\n         */\r\n        enabled: function () {\r\n            context.tool.cover.style.display = 'none';\r\n            context.element.wysiwyg.setAttribute('contenteditable', true);\r\n            core.isDisabled = false;\r\n\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.setOption('readOnly', false);\r\n            } else {\r\n                context.element.code.removeAttribute('disabled');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Show the suneditor\r\n         */\r\n        show: function () {\r\n            const topAreaStyle = context.element.topArea.style;\r\n            if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\r\n        },\r\n\r\n        /**\r\n         * @description Hide the suneditor\r\n         */\r\n        hide: function () {\r\n            context.element.topArea.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Destroy the suneditor\r\n         */\r\n        destroy: function () {\r\n            /** off menus */\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            if (core.notice) core.notice.close.call(core);\r\n            if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n            /** remove history */\r\n            core.history._destroy();\r\n\r\n            /** remove event listeners */\r\n            event._removeEvent();\r\n            \r\n            /** remove element */\r\n            util.removeItem(context.element.toolbar);\r\n            util.removeItem(context.element.topArea);\r\n\r\n            /** remove object reference */\r\n            for (let k in core.functions) { if (util.hasOwn(core, k)) delete core.functions[k]; }\r\n            for (let k in core) { if (util.hasOwn(core, k)) delete core[k]; }\r\n            for (let k in event) { if (util.hasOwn(event, k)) delete event[k]; }\r\n            for (let k in context) { if (util.hasOwn(context, k)) delete context[k]; }\r\n            for (let k in pluginCallButtons) { if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k]; }\r\n            \r\n            /** remove user object */\r\n            for (let k in this) { if (util.hasOwn(this, k)) delete this[k]; }\r\n        },\r\n\r\n        /**\r\n         * @description Toolbar methods\r\n         */\r\n        toolbar: {\r\n            /**\r\n             * @description Disable the toolbar\r\n             */\r\n            disabled: function () {\r\n                context.tool.cover.style.display = 'block';\r\n            },\r\n\r\n            /**\r\n             * @description Enable the toolbar\r\n             */\r\n            enabled: function () {\r\n                context.tool.cover.style.display = 'none';\r\n            },\r\n\r\n            /**\r\n             * @description Show the toolbar\r\n             */\r\n            show: function () {\r\n                if (core._isInline) {\r\n                    event._showToolbarInline();\r\n                } else {\r\n                    context.element.toolbar.style.display = '';\r\n                    context.element._stickyDummy.style.display = '';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Hide the toolbar\r\n             */\r\n            hide: function () {\r\n                if (core._isInline) {\r\n                    event._hideToolbar();\r\n                } else {\r\n                    context.element.toolbar.style.display = 'none';\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                }\r\n            },\r\n        }\r\n    };\r\n\r\n    /************ Core init ************/\r\n    // functions\r\n    core.functions = functions;\r\n    core.options = options;\r\n\r\n    // Create to sibling node\r\n    let contextEl = context.element;\r\n    let originEl = contextEl.originElement;\r\n    let topEl = contextEl.topArea;\r\n    originEl.style.display = 'none';\r\n    topEl.style.display = 'block';\r\n\r\n    // init\r\n    if (options.iframe) {\r\n        contextEl.wysiwygFrame.addEventListener('load', function () {\r\n            util._setIframeDocument(this, options);\r\n            core._editorInit(false, options.value);\r\n            options.value = null;\r\n        });\r\n    }\r\n\r\n    // insert editor element\r\n    if (typeof originEl.nextElementSibling === 'object') {\r\n        originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\r\n    } else {\r\n        originEl.parentNode.appendChild(topEl);\r\n    }\r\n\r\n    contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\r\n    contextEl = originEl = topEl = null;\r\n\r\n    // init\r\n    if (!options.iframe) {\r\n        core._editorInit(false, options.value);\r\n        options.value = null;\r\n    }\r\n\r\n    return functions;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}